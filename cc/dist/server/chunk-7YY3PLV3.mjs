import './polyfills.server.mjs';
import{a as cT,b as lT,c as uT,f as hT,j as fT,l as Jo,m as Wg}from"./chunk-BBDAFRXS.mjs";import{$a as Bg,$b as Ei,A as Xn,Aa as Ci,Ab as ni,Ac as Wd,B as Pg,Ba as ir,Bb as Us,Bc as zg,Ca as zS,Cb as JS,Cc as Gg,Db as eT,E as Ng,Eb as tT,Fb as jd,G as il,Gb as qd,Ha as q,Hb as zd,I as Wo,Ia as z,Ja as Fd,K as jS,Ka as ol,La as GS,Ma as Ld,N as $o,Na as WS,Nb as nT,O as rl,Oa as rr,P as Pd,Pa as $S,Q as Nd,Qa as ae,Qb as iT,R as Pr,S as Nr,Sa as Bd,T as Fg,Ta as Ot,U as nr,Ua as Qo,V as Lg,Vb as Ug,W as Ho,Wb as Xo,Y as Bs,Ya as $e,Z as ie,Za as Vs,_ as re,_a as me,a as nl,aa as J,ab as kn,bb as HS,bc as jg,c as un,ca as C,cb as Vg,da as je,db as S,ea as dn,eb as w,ec as Oe,f as We,fb as oe,g as NS,gb as KS,h as Md,ha as Ye,hb as QS,i as FS,ia as Ee,ib as lt,ja as se,jb as YS,k as Or,ka as Me,kb as ce,l as Ls,la as qS,lb as XS,lc as rT,m as Yn,mb as fe,n as An,nb as Vd,nc as sT,ob as Yo,oc as Zo,pa as sl,pb as sr,pc as Rn,qa as ye,qb as or,qc as oT,r as Ae,ra as be,rb as ar,s as LS,sa as Ko,sb as Ud,ta as Vt,tb as F,tc as aT,ub as bn,uc as Gd,v as BS,va as nt,vb as Zn,wa as Dn,wb as ZS,x as VS,xb as Jn,y as US,yb as ei,yc as dT,z as Od,zb as ti,zc as qg}from"./chunk-F2UZ4SVP.mjs";import{a as mT,b as pT,c as $g,d as gT,e as al,f as Hg,g as $d,h as yT,i as bT,j as Kg,k as Xe,l as js,m as Si,n as Hd,o as cl,p as Qg,q as vT,r as _T,s as ll,t as Kd,u as Ut,v as Xt,w as nF,x as Yg}from"./chunk-2JNPUQOR.mjs";import{a as he,b as In,c as Ie,f as E,h as Mg,i as Og,j as p}from"./chunk-H6KHSOBK.mjs";var Te=E(On=>{"use strict";Object.defineProperty(On,"__esModule",{value:!0});On.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=On.DEFAULT_MAX_SEND_MESSAGE_LENGTH=On.Propagate=On.LogVerbosity=On.Status=void 0;var xI=function(n){return n[n.OK=0]="OK",n[n.CANCELLED=1]="CANCELLED",n[n.UNKNOWN=2]="UNKNOWN",n[n.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",n[n.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",n[n.NOT_FOUND=5]="NOT_FOUND",n[n.ALREADY_EXISTS=6]="ALREADY_EXISTS",n[n.PERMISSION_DENIED=7]="PERMISSION_DENIED",n[n.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",n[n.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",n[n.ABORTED=10]="ABORTED",n[n.OUT_OF_RANGE=11]="OUT_OF_RANGE",n[n.UNIMPLEMENTED=12]="UNIMPLEMENTED",n[n.INTERNAL=13]="INTERNAL",n[n.UNAVAILABLE=14]="UNAVAILABLE",n[n.DATA_LOSS=15]="DATA_LOSS",n[n.UNAUTHENTICATED=16]="UNAUTHENTICATED",n}(xI||(On.Status=xI={})),II=function(n){return n[n.DEBUG=0]="DEBUG",n[n.INFO=1]="INFO",n[n.ERROR=2]="ERROR",n[n.NONE=3]="NONE",n}(II||(On.LogVerbosity=II={})),AI=function(n){return n[n.DEADLINE=1]="DEADLINE",n[n.CENSUS_STATS_CONTEXT=2]="CENSUS_STATS_CONTEXT",n[n.CENSUS_TRACING_CONTEXT=4]="CENSUS_TRACING_CONTEXT",n[n.CANCELLATION=8]="CANCELLATION",n[n.DEFAULTS=65535]="DEFAULTS",n}(AI||(On.Propagate=AI={}));On.DEFAULT_MAX_SEND_MESSAGE_LENGTH=-1;On.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=4*1024*1024});var ab=E((fX,wL)=>{wL.exports={name:"@grpc/grpc-js",version:"1.9.14",description:"gRPC Library for Node - pure JS implementation",homepage:"https://grpc.io/",repository:"https://github.com/grpc/grpc-node/tree/master/packages/grpc-js",main:"build/src/index.js",engines:{node:"^8.13.0 || >=10.10.0"},keywords:[],author:{name:"Google Inc."},types:"build/src/index.d.ts",license:"Apache-2.0",devDependencies:{"@types/gulp":"^4.0.6","@types/gulp-mocha":"0.0.32","@types/lodash":"^4.14.186","@types/mocha":"^5.2.6","@types/ncp":"^2.0.1","@types/pify":"^3.0.2","@types/semver":"^7.3.9","@typescript-eslint/eslint-plugin":"^5.59.11","@typescript-eslint/parser":"^5.59.11","@typescript-eslint/typescript-estree":"^5.59.11","clang-format":"^1.0.55",eslint:"^8.42.0","eslint-config-prettier":"^8.8.0","eslint-plugin-node":"^11.1.0","eslint-plugin-prettier":"^4.2.1",execa:"^2.0.3",gulp:"^4.0.2","gulp-mocha":"^6.0.0",lodash:"^4.17.4",madge:"^5.0.1","mocha-jenkins-reporter":"^0.4.1",ncp:"^2.0.0",pify:"^4.0.1",prettier:"^2.8.8",rimraf:"^3.0.2",semver:"^7.3.5","ts-node":"^10.9.1",typescript:"^5.1.3"},contributors:[{name:"Google Inc."}],scripts:{build:"npm run compile",clean:"rimraf ./build",compile:"tsc -p .",format:'clang-format -i -style="{Language: JavaScript, BasedOnStyle: Google, ColumnLimit: 80}" src/*.ts test/*.ts',lint:"eslint src/*.ts test/*.ts",prepare:"npm run generate-types && npm run compile",test:"gulp test",check:"npm run lint",fix:"eslint --fix src/*.ts test/*.ts",pretest:"npm run generate-types && npm run generate-test-types && npm run compile",posttest:"npm run check && madge -c ./build/src","generate-types":"proto-loader-gen-types --keepCase --longs String --enums String --defaults --oneofs --includeComments --includeDirs proto/ --include-dirs test/fixtures/ -O src/generated/ --grpcLib ../index channelz.proto","generate-test-types":"proto-loader-gen-types --keepCase --longs String --enums String --defaults --oneofs --includeComments --include-dirs test/fixtures/ -O test/generated/ --grpcLib ../../src/index test_service.proto"},dependencies:{"@grpc/proto-loader":"^0.7.8","@types/node":">=12.12.47"},files:["src/**/*.ts","build/src/**/*.{js,d.ts,js.map}","proto/*.proto","LICENSE","deps/envoy-api/envoy/api/v2/**/*.proto","deps/envoy-api/envoy/config/**/*.proto","deps/envoy-api/envoy/service/**/*.proto","deps/envoy-api/envoy/type/**/*.proto","deps/udpa/udpa/**/*.proto","deps/googleapis/google/api/*.proto","deps/googleapis/google/rpc/*.proto","deps/protoc-gen-validate/validate/**/*.proto"]}});var rt=E(tn=>{"use strict";var cb,lb,ub,db;Object.defineProperty(tn,"__esModule",{value:!0});tn.isTracerEnabled=tn.trace=tn.log=tn.setLoggerVerbosity=tn.setLogger=tn.getLogger=void 0;var Ur=Te(),CL=Ie("process"),EL=ab().version,SL={error:(n,...e)=>{console.error("E "+n,...e)},info:(n,...e)=>{console.error("I "+n,...e)},debug:(n,...e)=>{console.error("D "+n,...e)}},Qs=SL,ha=Ur.LogVerbosity.ERROR,TL=(lb=(cb=process.env.GRPC_NODE_VERBOSITY)!==null&&cb!==void 0?cb:process.env.GRPC_VERBOSITY)!==null&&lb!==void 0?lb:"";switch(TL.toUpperCase()){case"DEBUG":ha=Ur.LogVerbosity.DEBUG;break;case"INFO":ha=Ur.LogVerbosity.INFO;break;case"ERROR":ha=Ur.LogVerbosity.ERROR;break;case"NONE":ha=Ur.LogVerbosity.NONE;break;default:}var xL=()=>Qs;tn.getLogger=xL;var IL=n=>{Qs=n};tn.setLogger=IL;var AL=n=>{ha=n};tn.setLoggerVerbosity=AL;var DL=(n,...e)=>{let t;if(n>=ha){switch(n){case Ur.LogVerbosity.DEBUG:t=Qs.debug;break;case Ur.LogVerbosity.INFO:t=Qs.info;break;case Ur.LogVerbosity.ERROR:t=Qs.error;break}t||(t=Qs.error),t&&t.bind(Qs)(...e)}};tn.log=DL;var kL=(db=(ub=process.env.GRPC_NODE_TRACE)!==null&&ub!==void 0?ub:process.env.GRPC_TRACE)!==null&&db!==void 0?db:"",hb=new Set,DI=new Set;for(let n of kL.split(","))n.startsWith("-")?DI.add(n.substring(1)):hb.add(n);var RL=hb.has("all");function ML(n,e,t){kI(e)&&(0,tn.log)(n,new Date().toISOString()+" | v"+EL+" "+CL.pid+" | "+e+" | "+t)}tn.trace=ML;function kI(n){return!DI.has(n)&&(RL||hb.has(n))}tn.isTracerEnabled=kI});var zh=E(fa=>{"use strict";Object.defineProperty(fa,"__esModule",{value:!0});fa.getErrorCode=fa.getErrorMessage=void 0;function OL(n){return n instanceof Error?n.message:String(n)}fa.getErrorMessage=OL;function PL(n){return typeof n=="object"&&n!==null&&"code"in n&&typeof n.code=="number"?n.code:null}fa.getErrorCode=PL});var nn=E(Wh=>{"use strict";Object.defineProperty(Wh,"__esModule",{value:!0});Wh.Metadata=void 0;var NL=rt(),FL=Te(),LL=zh(),BL=/^[0-9a-z_.-]+$/,VL=/^[ -~]*$/;function UL(n){return BL.test(n)}function jL(n){return VL.test(n)}function MI(n){return n.endsWith("-bin")}function qL(n){return!n.startsWith("grpc-")}function Gh(n){return n.toLowerCase()}function RI(n,e){if(!UL(n))throw new Error('Metadata key "'+n+'" contains illegal characters');if(e!=null)if(MI(n)){if(!Buffer.isBuffer(e))throw new Error("keys that end with '-bin' must have Buffer values")}else{if(Buffer.isBuffer(e))throw new Error("keys that don't end with '-bin' must have String values");if(!jL(e))throw new Error('Metadata string value "'+e+'" contains illegal characters')}}var fb=class n{constructor(e={}){this.internalRepr=new Map,this.options=e}set(e,t){e=Gh(e),RI(e,t),this.internalRepr.set(e,[t])}add(e,t){e=Gh(e),RI(e,t);let i=this.internalRepr.get(e);i===void 0?this.internalRepr.set(e,[t]):i.push(t)}remove(e){e=Gh(e),this.internalRepr.delete(e)}get(e){return e=Gh(e),this.internalRepr.get(e)||[]}getMap(){let e={};for(let[t,i]of this.internalRepr)if(i.length>0){let r=i[0];e[t]=Buffer.isBuffer(r)?Buffer.from(r):r}return e}clone(){let e=new n(this.options),t=e.internalRepr;for(let[i,r]of this.internalRepr){let s=r.map(o=>Buffer.isBuffer(o)?Buffer.from(o):o);t.set(i,s)}return e}merge(e){for(let[t,i]of e.internalRepr){let r=(this.internalRepr.get(t)||[]).concat(i);this.internalRepr.set(t,r)}}setOptions(e){this.options=e}getOptions(){return this.options}toHttp2Headers(){let e={};for(let[t,i]of this.internalRepr)e[t]=i.map(zL);return e}toJSON(){let e={};for(let[t,i]of this.internalRepr)e[t]=i;return e}static fromHttp2Headers(e){let t=new n;for(let i of Object.keys(e)){if(i.charAt(0)===":")continue;let r=e[i];try{MI(i)?Array.isArray(r)?r.forEach(s=>{t.add(i,Buffer.from(s,"base64"))}):r!==void 0&&(qL(i)?r.split(",").forEach(s=>{t.add(i,Buffer.from(s.trim(),"base64"))}):t.add(i,Buffer.from(r,"base64"))):Array.isArray(r)?r.forEach(s=>{t.add(i,s)}):r!==void 0&&t.add(i,r)}catch(s){let o=`Failed to add metadata entry ${i}: ${r}. ${(0,LL.getErrorMessage)(s)}. For more information see https://github.com/grpc/grpc-node/issues/1173`;(0,NL.log)(FL.LogVerbosity.ERROR,o)}}return t}};Wh.Metadata=fb;var zL=n=>Buffer.isBuffer(n)?n.toString("base64"):n});var bb=E($h=>{"use strict";Object.defineProperty($h,"__esModule",{value:!0});$h.CallCredentials=void 0;var yb=nn();function GL(n){return"getRequestHeaders"in n&&typeof n.getRequestHeaders=="function"}var ma=class n{static createFromMetadataGenerator(e){return new pb(e)}static createFromGoogleCredential(e){return n.createFromMetadataGenerator((t,i)=>{let r;GL(e)?r=e.getRequestHeaders(t.service_url):r=new Promise((s,o)=>{e.getRequestMetadata(t.service_url,(a,c)=>{if(a){o(a);return}if(!c){o(new Error("Headers not set by metadata plugin"));return}s(c)})}),r.then(s=>{let o=new yb.Metadata;for(let a of Object.keys(s))o.add(a,s[a]);i(null,o)},s=>{i(s)})})}static createEmpty(){return new gb}};$h.CallCredentials=ma;var mb=class n extends ma{constructor(e){super(),this.creds=e}generateMetadata(e){return p(this,null,function*(){let t=new yb.Metadata,i=yield Promise.all(this.creds.map(r=>r.generateMetadata(e)));for(let r of i)t.merge(r);return t})}compose(e){return new n(this.creds.concat([e]))}_equals(e){return this===e?!0:e instanceof n?this.creds.every((t,i)=>t._equals(e.creds[i])):!1}},pb=class n extends ma{constructor(e){super(),this.metadataGenerator=e}generateMetadata(e){return new Promise((t,i)=>{this.metadataGenerator(e,(r,s)=>{s!==void 0?t(s):i(r)})})}compose(e){return new mb([this,e])}_equals(e){return this===e?!0:e instanceof n?this.metadataGenerator===e.metadataGenerator:!1}},gb=class n extends ma{generateMetadata(e){return Promise.resolve(new yb.Metadata)}compose(e){return e}_equals(e){return e instanceof n}}});var _b=E(pa=>{"use strict";Object.defineProperty(pa,"__esModule",{value:!0});pa.getDefaultRootsData=pa.CIPHER_SUITES=void 0;var WL=Ie("fs");pa.CIPHER_SUITES=process.env.GRPC_SSL_CIPHER_SUITES;var OI=process.env.GRPC_DEFAULT_SSL_ROOTS_FILE_PATH,vb=null;function $L(){return OI?(vb===null&&(vb=WL.readFileSync(OI)),vb):null}pa.getDefaultRootsData=$L});var Qh=E(Kh=>{"use strict";Object.defineProperty(Kh,"__esModule",{value:!0});Kh.ChannelCredentials=void 0;var HL=Ie("tls"),KL=bb(),PI=_b();function wb(n,e){if(n&&!(n instanceof Buffer))throw new TypeError(`${e}, if provided, must be a Buffer.`)}var ga=class{constructor(e){this.callCredentials=e||KL.CallCredentials.createEmpty()}_getCallCredentials(){return this.callCredentials}static createSsl(e,t,i,r){var s;if(wb(e,"Root certificate"),wb(t,"Private key"),wb(i,"Certificate chain"),t&&!i)throw new Error("Private key must be given with accompanying certificate chain");if(!t&&i)throw new Error("Certificate chain must be given with accompanying private key");let o=(0,HL.createSecureContext)({ca:(s=e??(0,PI.getDefaultRootsData)())!==null&&s!==void 0?s:void 0,key:t??void 0,cert:i??void 0,ciphers:PI.CIPHER_SUITES});return new Hh(o,r??{})}static createFromSecureContext(e,t){return new Hh(e,t??{})}static createInsecure(){return new Cb}};Kh.ChannelCredentials=ga;var Cb=class n extends ga{constructor(e){super(e)}compose(e){throw new Error("Cannot compose insecure credentials")}_getConnectionOptions(){return null}_isSecure(){return!1}_equals(e){return e instanceof n}},Hh=class n extends ga{constructor(e,t){super(),this.secureContext=e,this.verifyOptions=t,this.connectionOptions={secureContext:e},t?.checkServerIdentity&&(this.connectionOptions.checkServerIdentity=t.checkServerIdentity)}compose(e){let t=this.callCredentials.compose(e);return new Eb(this,t)}_getConnectionOptions(){return Object.assign({},this.connectionOptions)}_isSecure(){return!0}_equals(e){return this===e?!0:e instanceof n?this.secureContext===e.secureContext&&this.verifyOptions.checkServerIdentity===e.verifyOptions.checkServerIdentity:!1}},Eb=class n extends ga{constructor(e,t){super(t),this.channelCredentials=e}compose(e){let t=this.callCredentials.compose(e);return new n(this.channelCredentials,t)}_getConnectionOptions(){return this.channelCredentials._getConnectionOptions()}_isSecure(){return!0}_equals(e){return this===e?!0:e instanceof n?this.channelCredentials._equals(e.channelCredentials)&&this.callCredentials._equals(e.callCredentials):!1}}});var qr=E(zt=>{"use strict";Object.defineProperty(zt,"__esModule",{value:!0});zt.validateLoadBalancingConfig=zt.getFirstUsableConfig=zt.isLoadBalancerNameRegistered=zt.createLoadBalancer=zt.registerDefaultLoadBalancerType=zt.registerLoadBalancerType=zt.createChildChannelControlHelper=void 0;function QL(n,e){var t,i,r,s,o,a,c,l,u,d;return{createSubchannel:(i=(t=e.createSubchannel)===null||t===void 0?void 0:t.bind(e))!==null&&i!==void 0?i:n.createSubchannel.bind(n),updateState:(s=(r=e.updateState)===null||r===void 0?void 0:r.bind(e))!==null&&s!==void 0?s:n.updateState.bind(n),requestReresolution:(a=(o=e.requestReresolution)===null||o===void 0?void 0:o.bind(e))!==null&&a!==void 0?a:n.requestReresolution.bind(n),addChannelzChild:(l=(c=e.addChannelzChild)===null||c===void 0?void 0:c.bind(e))!==null&&l!==void 0?l:n.addChannelzChild.bind(n),removeChannelzChild:(d=(u=e.removeChannelzChild)===null||u===void 0?void 0:u.bind(e))!==null&&d!==void 0?d:n.removeChannelzChild.bind(n)}}zt.createChildChannelControlHelper=QL;var jr={},Sb=null;function YL(n,e,t){jr[n]={LoadBalancer:e,LoadBalancingConfig:t}}zt.registerLoadBalancerType=YL;function XL(n){Sb=n}zt.registerDefaultLoadBalancerType=XL;function ZL(n,e){let t=n.getLoadBalancerName();return t in jr?new jr[t].LoadBalancer(e):null}zt.createLoadBalancer=ZL;function JL(n){return n in jr}zt.isLoadBalancerNameRegistered=JL;function eB(n,e=!1){for(let t of n)if(t.getLoadBalancerName()in jr)return t;return e&&Sb?new jr[Sb].LoadBalancingConfig:null}zt.getFirstUsableConfig=eB;function tB(n){if(!(n!==null&&typeof n=="object"))throw new Error("Load balancing config must be an object");let e=Object.keys(n);if(e.length!==1)throw new Error("Provided load balancing config has multiple conflicting entries");let t=e[0];if(t in jr)return jr[t].LoadBalancingConfig.createFromJson(n[t]);throw new Error(`Unrecognized load balancing config name ${t}`)}zt.validateLoadBalancingConfig=tB});var Tb=E(zr=>{"use strict";Object.defineProperty(zr,"__esModule",{value:!0});zr.extractAndSelectServiceConfig=zr.validateServiceConfig=zr.validateRetryThrottling=void 0;var nB=Ie("os"),Yh=Te(),iB=qr(),Xh=/^\d+(\.\d{1,9})?s$/,rB="node";function sB(n){if("service"in n&&n.service!==""){if(typeof n.service!="string")throw new Error(`Invalid method config name: invalid service: expected type string, got ${typeof n.service}`);if("method"in n&&n.method!==""){if(typeof n.method!="string")throw new Error(`Invalid method config name: invalid method: expected type string, got ${typeof n.service}`);return{service:n.service,method:n.method}}else return{service:n.service}}else{if("method"in n&&n.method!==void 0)throw new Error("Invalid method config name: method set with empty or unset service");return{}}}function oB(n){if(!("maxAttempts"in n)||!Number.isInteger(n.maxAttempts)||n.maxAttempts<2)throw new Error("Invalid method config retry policy: maxAttempts must be an integer at least 2");if(!("initialBackoff"in n)||typeof n.initialBackoff!="string"||!Xh.test(n.initialBackoff))throw new Error("Invalid method config retry policy: initialBackoff must be a string consisting of a positive integer followed by s");if(!("maxBackoff"in n)||typeof n.maxBackoff!="string"||!Xh.test(n.maxBackoff))throw new Error("Invalid method config retry policy: maxBackoff must be a string consisting of a positive integer followed by s");if(!("backoffMultiplier"in n)||typeof n.backoffMultiplier!="number"||n.backoffMultiplier<=0)throw new Error("Invalid method config retry policy: backoffMultiplier must be a number greater than 0");if(!("retryableStatusCodes"in n&&Array.isArray(n.retryableStatusCodes)))throw new Error("Invalid method config retry policy: retryableStatusCodes is required");if(n.retryableStatusCodes.length===0)throw new Error("Invalid method config retry policy: retryableStatusCodes must be non-empty");for(let e of n.retryableStatusCodes)if(typeof e=="number"){if(!Object.values(Yh.Status).includes(e))throw new Error("Invalid method config retry policy: retryableStatusCodes value not in status code range")}else if(typeof e=="string"){if(!Object.values(Yh.Status).includes(e.toUpperCase()))throw new Error("Invalid method config retry policy: retryableStatusCodes value not a status code name")}else throw new Error("Invalid method config retry policy: retryableStatusCodes value must be a string or number");return{maxAttempts:n.maxAttempts,initialBackoff:n.initialBackoff,maxBackoff:n.maxBackoff,backoffMultiplier:n.backoffMultiplier,retryableStatusCodes:n.retryableStatusCodes}}function aB(n){if(!("maxAttempts"in n)||!Number.isInteger(n.maxAttempts)||n.maxAttempts<2)throw new Error("Invalid method config hedging policy: maxAttempts must be an integer at least 2");if("hedgingDelay"in n&&(typeof n.hedgingDelay!="string"||!Xh.test(n.hedgingDelay)))throw new Error("Invalid method config hedging policy: hedgingDelay must be a string consisting of a positive integer followed by s");if("nonFatalStatusCodes"in n&&Array.isArray(n.nonFatalStatusCodes))for(let t of n.nonFatalStatusCodes)if(typeof t=="number"){if(!Object.values(Yh.Status).includes(t))throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value not in status code range")}else if(typeof t=="string"){if(!Object.values(Yh.Status).includes(t.toUpperCase()))throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value not a status code name")}else throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value must be a string or number");let e={maxAttempts:n.maxAttempts};return n.hedgingDelay&&(e.hedgingDelay=n.hedgingDelay),n.nonFatalStatusCodes&&(e.nonFatalStatusCodes=n.nonFatalStatusCodes),e}function cB(n){var e;let t={name:[]};if(!("name"in n)||!Array.isArray(n.name))throw new Error("Invalid method config: invalid name array");for(let i of n.name)t.name.push(sB(i));if("waitForReady"in n){if(typeof n.waitForReady!="boolean")throw new Error("Invalid method config: invalid waitForReady");t.waitForReady=n.waitForReady}if("timeout"in n)if(typeof n.timeout=="object"){if(!("seconds"in n.timeout)||typeof n.timeout.seconds!="number")throw new Error("Invalid method config: invalid timeout.seconds");if(!("nanos"in n.timeout)||typeof n.timeout.nanos!="number")throw new Error("Invalid method config: invalid timeout.nanos");t.timeout=n.timeout}else if(typeof n.timeout=="string"&&Xh.test(n.timeout)){let i=n.timeout.substring(0,n.timeout.length-1).split(".");t.timeout={seconds:i[0]|0,nanos:((e=i[1])!==null&&e!==void 0?e:0)|0}}else throw new Error("Invalid method config: invalid timeout");if("maxRequestBytes"in n){if(typeof n.maxRequestBytes!="number")throw new Error("Invalid method config: invalid maxRequestBytes");t.maxRequestBytes=n.maxRequestBytes}if("maxResponseBytes"in n){if(typeof n.maxResponseBytes!="number")throw new Error("Invalid method config: invalid maxRequestBytes");t.maxResponseBytes=n.maxResponseBytes}if("retryPolicy"in n){if("hedgingPolicy"in n)throw new Error("Invalid method config: retryPolicy and hedgingPolicy cannot both be specified");t.retryPolicy=oB(n.retryPolicy)}else"hedgingPolicy"in n&&(t.hedgingPolicy=aB(n.hedgingPolicy));return t}function NI(n){if(!("maxTokens"in n)||typeof n.maxTokens!="number"||n.maxTokens<=0||n.maxTokens>1e3)throw new Error("Invalid retryThrottling: maxTokens must be a number in (0, 1000]");if(!("tokenRatio"in n)||typeof n.tokenRatio!="number"||n.tokenRatio<=0)throw new Error("Invalid retryThrottling: tokenRatio must be a number greater than 0");return{maxTokens:+n.maxTokens.toFixed(3),tokenRatio:+n.tokenRatio.toFixed(3)}}zr.validateRetryThrottling=NI;function FI(n){let e={loadBalancingConfig:[],methodConfig:[]};if("loadBalancingPolicy"in n)if(typeof n.loadBalancingPolicy=="string")e.loadBalancingPolicy=n.loadBalancingPolicy;else throw new Error("Invalid service config: invalid loadBalancingPolicy");if("loadBalancingConfig"in n)if(Array.isArray(n.loadBalancingConfig))for(let i of n.loadBalancingConfig)e.loadBalancingConfig.push((0,iB.validateLoadBalancingConfig)(i));else throw new Error("Invalid service config: invalid loadBalancingConfig");if("methodConfig"in n&&Array.isArray(n.methodConfig))for(let i of n.methodConfig)e.methodConfig.push(cB(i));"retryThrottling"in n&&(e.retryThrottling=NI(n.retryThrottling));let t=[];for(let i of e.methodConfig)for(let r of i.name){for(let s of t)if(r.service===s.service&&r.method===s.method)throw new Error(`Invalid service config: duplicate name ${r.service}/${r.method}`);t.push(r)}return e}zr.validateServiceConfig=FI;function lB(n){if(!("serviceConfig"in n))throw new Error("Invalid service config choice: missing service config");let e={serviceConfig:FI(n.serviceConfig)};if("clientLanguage"in n)if(Array.isArray(n.clientLanguage)){e.clientLanguage=[];for(let i of n.clientLanguage)if(typeof i=="string")e.clientLanguage.push(i);else throw new Error("Invalid service config choice: invalid clientLanguage")}else throw new Error("Invalid service config choice: invalid clientLanguage");if("clientHostname"in n)if(Array.isArray(n.clientHostname)){e.clientHostname=[];for(let i of n.clientHostname)if(typeof i=="string")e.clientHostname.push(i);else throw new Error("Invalid service config choice: invalid clientHostname")}else throw new Error("Invalid service config choice: invalid clientHostname");if("percentage"in n)if(typeof n.percentage=="number"&&0<=n.percentage&&n.percentage<=100)e.percentage=n.percentage;else throw new Error("Invalid service config choice: invalid percentage");let t=["clientLanguage","percentage","clientHostname","serviceConfig"];for(let i in n)if(!t.includes(i))throw new Error(`Invalid service config choice: unexpected field ${i}`);return e}function uB(n,e){if(!Array.isArray(n))throw new Error("Invalid service config list");for(let t of n){let i=lB(t);if(!(typeof i.percentage=="number"&&e>i.percentage)){if(Array.isArray(i.clientHostname)){let r=!1;for(let s of i.clientHostname)s===nB.hostname()&&(r=!0);if(!r)continue}if(Array.isArray(i.clientLanguage)){let r=!1;for(let s of i.clientLanguage)s===rB&&(r=!0);if(!r)continue}return i.serviceConfig}}throw new Error("No matching service config found")}function dB(n,e){for(let t of n)if(t.length>0&&t[0].startsWith("grpc_config=")){let i=t.join("").substring(12),r=JSON.parse(i);return uB(r,e)}return null}zr.extractAndSelectServiceConfig=dB});var Pn=E(Zh=>{"use strict";Object.defineProperty(Zh,"__esModule",{value:!0});Zh.ConnectivityState=void 0;var LI=function(n){return n[n.IDLE=0]="IDLE",n[n.CONNECTING=1]="CONNECTING",n[n.READY=2]="READY",n[n.TRANSIENT_FAILURE=3]="TRANSIENT_FAILURE",n[n.SHUTDOWN=4]="SHUTDOWN",n}(LI||(Zh.ConnectivityState=LI={}))});var _n=E(Gr=>{"use strict";Object.defineProperty(Gr,"__esModule",{value:!0});Gr.uriToString=Gr.splitHostPort=Gr.parseUri=void 0;var hB=/^(?:([A-Za-z0-9+.-]+):)?(?:\/\/([^/]*)\/)?(.+)$/;function fB(n){let e=hB.exec(n);return e===null?null:{scheme:e[1],authority:e[2],path:e[3]}}Gr.parseUri=fB;var BI=/^\d+$/;function mB(n){if(n.startsWith("[")){let e=n.indexOf("]");if(e===-1)return null;let t=n.substring(1,e);if(t.indexOf(":")===-1)return null;if(n.length>e+1)if(n[e+1]===":"){let i=n.substring(e+2);return BI.test(i)?{host:t,port:+i}:null}else return null;else return{host:t}}else{let e=n.split(":");return e.length===2?BI.test(e[1])?{host:e[0],port:+e[1]}:null:{host:n}}}Gr.splitHostPort=mB;function pB(n){let e="";return n.scheme!==void 0&&(e+=n.scheme+":"),n.authority!==void 0&&(e+="//"+n.authority+"/"),e+=n.path,e}Gr.uriToString=pB});var ki=E(Nn=>{"use strict";Object.defineProperty(Nn,"__esModule",{value:!0});Nn.mapUriDefaultScheme=Nn.getDefaultAuthority=Nn.createResolver=Nn.registerDefaultScheme=Nn.registerResolver=void 0;var Ib=_n(),ya={},xb=null;function gB(n,e){ya[n]=e}Nn.registerResolver=gB;function yB(n){xb=n}Nn.registerDefaultScheme=yB;function bB(n,e,t){if(n.scheme!==void 0&&n.scheme in ya)return new ya[n.scheme](n,e,t);throw new Error(`No resolver could be created for target ${(0,Ib.uriToString)(n)}`)}Nn.createResolver=bB;function vB(n){if(n.scheme!==void 0&&n.scheme in ya)return ya[n.scheme].getDefaultAuthority(n);throw new Error(`Invalid target ${(0,Ib.uriToString)(n)}`)}Nn.getDefaultAuthority=vB;function _B(n){return n.scheme===void 0||!(n.scheme in ya)?xb!==null?{scheme:xb,authority:void 0,path:(0,Ib.uriToString)(n)}:null:n}Nn.mapUriDefaultScheme=_B});var $r=E(Wr=>{"use strict";Object.defineProperty(Wr,"__esModule",{value:!0});Wr.QueuePicker=Wr.UnavailablePicker=Wr.PickResultType=void 0;var wB=nn(),CB=Te(),Jh=function(n){return n[n.COMPLETE=0]="COMPLETE",n[n.QUEUE=1]="QUEUE",n[n.TRANSIENT_FAILURE=2]="TRANSIENT_FAILURE",n[n.DROP=3]="DROP",n}(Jh||(Wr.PickResultType=Jh={})),Ab=class{constructor(e){this.status=Object.assign({code:CB.Status.UNAVAILABLE,details:"No connection established",metadata:new wB.Metadata},e)}pick(e){return{pickResultType:Jh.TRANSIENT_FAILURE,subchannel:null,status:this.status,onCallStarted:null,onCallEnded:null}}};Wr.UnavailablePicker=Ab;var Db=class{constructor(e){this.loadBalancer=e,this.calledExitIdle=!1}pick(e){return this.calledExitIdle||(process.nextTick(()=>{this.loadBalancer.exitIdle()}),this.calledExitIdle=!0),{pickResultType:Jh.QUEUE,subchannel:null,status:null,onCallStarted:null,onCallEnded:null}}};Wr.QueuePicker=Db});var jl=E(ef=>{"use strict";Object.defineProperty(ef,"__esModule",{value:!0});ef.BackoffTimeout=void 0;var EB=1e3,SB=1.6,TB=12e4,xB=.2;function IB(n,e){return Math.random()*(e-n)+n}var kb=class{constructor(e,t){this.callback=e,this.initialDelay=EB,this.multiplier=SB,this.maxDelay=TB,this.jitter=xB,this.running=!1,this.hasRef=!0,this.startTime=new Date,this.endTime=new Date,t&&(t.initialDelay&&(this.initialDelay=t.initialDelay),t.multiplier&&(this.multiplier=t.multiplier),t.jitter&&(this.jitter=t.jitter),t.maxDelay&&(this.maxDelay=t.maxDelay)),this.nextDelay=this.initialDelay,this.timerId=setTimeout(()=>{},0),clearTimeout(this.timerId)}runTimer(e){var t,i;this.endTime=this.startTime,this.endTime.setMilliseconds(this.endTime.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),this.timerId=setTimeout(()=>{this.callback(),this.running=!1},e),this.hasRef||(i=(t=this.timerId).unref)===null||i===void 0||i.call(t)}runOnce(){this.running=!0,this.startTime=new Date,this.runTimer(this.nextDelay);let e=Math.min(this.nextDelay*this.multiplier,this.maxDelay),t=e*this.jitter;this.nextDelay=e+IB(-t,t)}stop(){clearTimeout(this.timerId),this.running=!1}reset(){if(this.nextDelay=this.initialDelay,this.running){let e=new Date,t=this.startTime;t.setMilliseconds(t.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),e<t?this.runTimer(t.getTime()-e.getTime()):this.running=!1}}isRunning(){return this.running}ref(){var e,t;this.hasRef=!0,(t=(e=this.timerId).ref)===null||t===void 0||t.call(e)}unref(){var e,t;this.hasRef=!1,(t=(e=this.timerId).unref)===null||t===void 0||t.call(e)}getEndTime(){return this.endTime}};ef.BackoffTimeout=kb});var nf=E(tf=>{"use strict";Object.defineProperty(tf,"__esModule",{value:!0});tf.ChildLoadBalancerHandler=void 0;var AB=qr(),DB=Pn(),kB="child_load_balancer_helper",Rb=class{constructor(e){this.channelControlHelper=e,this.currentChild=null,this.pendingChild=null,this.latestConfig=null,this.ChildPolicyHelper=class{constructor(t){this.parent=t,this.child=null}createSubchannel(t,i){return this.parent.channelControlHelper.createSubchannel(t,i)}updateState(t,i){var r;if(this.calledByPendingChild()){if(t===DB.ConnectivityState.CONNECTING)return;(r=this.parent.currentChild)===null||r===void 0||r.destroy(),this.parent.currentChild=this.parent.pendingChild,this.parent.pendingChild=null}else if(!this.calledByCurrentChild())return;this.parent.channelControlHelper.updateState(t,i)}requestReresolution(){var t;let i=(t=this.parent.pendingChild)!==null&&t!==void 0?t:this.parent.currentChild;this.child===i&&this.parent.channelControlHelper.requestReresolution()}setChild(t){this.child=t}addChannelzChild(t){this.parent.channelControlHelper.addChannelzChild(t)}removeChannelzChild(t){this.parent.channelControlHelper.removeChannelzChild(t)}calledByPendingChild(){return this.child===this.parent.pendingChild}calledByCurrentChild(){return this.child===this.parent.currentChild}}}configUpdateRequiresNewPolicyInstance(e,t){return e.getLoadBalancerName()!==t.getLoadBalancerName()}updateAddressList(e,t,i){let r;if(this.currentChild===null||this.latestConfig===null||this.configUpdateRequiresNewPolicyInstance(this.latestConfig,t)){let s=new this.ChildPolicyHelper(this),o=(0,AB.createLoadBalancer)(t,s);s.setChild(o),this.currentChild===null?(this.currentChild=o,r=this.currentChild):(this.pendingChild&&this.pendingChild.destroy(),this.pendingChild=o,r=this.pendingChild)}else this.pendingChild===null?r=this.currentChild:r=this.pendingChild;this.latestConfig=t,r.updateAddressList(e,t,i)}exitIdle(){this.currentChild&&(this.currentChild.exitIdle(),this.pendingChild&&this.pendingChild.exitIdle())}resetBackoff(){this.currentChild&&(this.currentChild.resetBackoff(),this.pendingChild&&this.pendingChild.resetBackoff())}destroy(){this.currentChild&&(this.currentChild.destroy(),this.currentChild=null),this.pendingChild&&(this.pendingChild.destroy(),this.pendingChild=null)}getTypeName(){return kB}};tf.ChildLoadBalancerHandler=Rb});var UI=E(rf=>{"use strict";Object.defineProperty(rf,"__esModule",{value:!0});rf.ResolvingLoadBalancer=void 0;var RB=qr(),MB=Tb(),fn=Pn(),OB=ki(),ba=$r(),PB=jl(),Mb=Te(),NB=nn(),FB=rt(),LB=Te(),BB=_n(),VB=nf(),UB="resolving_load_balancer";function VI(n){FB.trace(LB.LogVerbosity.DEBUG,UB,n)}var jB=["SERVICE_AND_METHOD","SERVICE","EMPTY"];function qB(n,e,t,i){for(let r of t.name)switch(i){case"EMPTY":if(!r.service&&!r.method)return!0;break;case"SERVICE":if(r.service===n&&!r.method)return!0;break;case"SERVICE_AND_METHOD":if(r.service===n&&r.method===e)return!0}return!1}function zB(n,e,t,i){for(let r of t)if(qB(n,e,r,i))return r;return null}function GB(n){return function(t,i){var r,s;let o=t.split("/").filter(l=>l.length>0),a=(r=o[0])!==null&&r!==void 0?r:"",c=(s=o[1])!==null&&s!==void 0?s:"";if(n&&n.methodConfig)for(let l of jB){let u=zB(a,c,n.methodConfig,l);if(u)return{methodConfig:u,pickInformation:{},status:Mb.Status.OK,dynamicFilterFactories:[]}}return{methodConfig:{name:[]},pickInformation:{},status:Mb.Status.OK,dynamicFilterFactories:[]}}}var Ob=class{constructor(e,t,i,r,s){this.target=e,this.channelControlHelper=t,this.onSuccessfulResolution=r,this.onFailedResolution=s,this.latestChildState=fn.ConnectivityState.IDLE,this.latestChildPicker=new ba.QueuePicker(this),this.currentState=fn.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1,i["grpc.service_config"]?this.defaultServiceConfig=(0,MB.validateServiceConfig)(JSON.parse(i["grpc.service_config"])):this.defaultServiceConfig={loadBalancingConfig:[],methodConfig:[]},this.updateState(fn.ConnectivityState.IDLE,new ba.QueuePicker(this)),this.childLoadBalancer=new VB.ChildLoadBalancerHandler({createSubchannel:t.createSubchannel.bind(t),requestReresolution:()=>{this.backoffTimeout.isRunning()?(VI("requestReresolution delayed by backoff timer until "+this.backoffTimeout.getEndTime().toISOString()),this.continueResolving=!0):this.updateResolution()},updateState:(a,c)=>{this.latestChildState=a,this.latestChildPicker=c,this.updateState(a,c)},addChannelzChild:t.addChannelzChild.bind(t),removeChannelzChild:t.removeChannelzChild.bind(t)}),this.innerResolver=(0,OB.createResolver)(e,{onSuccessfulResolution:(a,c,l,u,d)=>{var h;this.backoffTimeout.stop(),this.backoffTimeout.reset();let m=null;c===null?l===null?(this.previousServiceConfig=null,m=this.defaultServiceConfig):this.previousServiceConfig===null?this.handleResolutionFailure(l):m=this.previousServiceConfig:(m=c,this.previousServiceConfig=c);let g=(h=m?.loadBalancingConfig)!==null&&h!==void 0?h:[],y=(0,RB.getFirstUsableConfig)(g,!0);if(y===null){this.handleResolutionFailure({code:Mb.Status.UNAVAILABLE,details:"All load balancer options in service config are not compatible",metadata:new NB.Metadata});return}this.childLoadBalancer.updateAddressList(a,y,d);let _=m??this.defaultServiceConfig;this.onSuccessfulResolution(_,u??GB(_))},onError:a=>{this.handleResolutionFailure(a)}},i);let o={initialDelay:i["grpc.initial_reconnect_backoff_ms"],maxDelay:i["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new PB.BackoffTimeout(()=>{this.continueResolving?(this.updateResolution(),this.continueResolving=!1):this.updateState(this.latestChildState,this.latestChildPicker)},o),this.backoffTimeout.unref()}updateResolution(){this.innerResolver.updateResolution(),this.currentState===fn.ConnectivityState.IDLE&&this.updateState(fn.ConnectivityState.CONNECTING,new ba.QueuePicker(this)),this.backoffTimeout.runOnce()}updateState(e,t){VI((0,BB.uriToString)(this.target)+" "+fn.ConnectivityState[this.currentState]+" -> "+fn.ConnectivityState[e]),e===fn.ConnectivityState.IDLE&&(t=new ba.QueuePicker(this)),this.currentState=e,this.channelControlHelper.updateState(e,t)}handleResolutionFailure(e){this.latestChildState===fn.ConnectivityState.IDLE&&(this.updateState(fn.ConnectivityState.TRANSIENT_FAILURE,new ba.UnavailablePicker(e)),this.onFailedResolution(e))}exitIdle(){(this.currentState===fn.ConnectivityState.IDLE||this.currentState===fn.ConnectivityState.TRANSIENT_FAILURE)&&(this.backoffTimeout.isRunning()?this.continueResolving=!0:this.updateResolution()),this.childLoadBalancer.exitIdle()}updateAddressList(e,t){throw new Error("updateAddressList not supported on ResolvingLoadBalancer")}resetBackoff(){this.backoffTimeout.reset(),this.childLoadBalancer.resetBackoff()}destroy(){this.childLoadBalancer.destroy(),this.innerResolver.destroy(),this.backoffTimeout.reset(),this.backoffTimeout.stop(),this.latestChildState=fn.ConnectivityState.IDLE,this.latestChildPicker=new ba.QueuePicker(this),this.currentState=fn.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1}getTypeName(){return"resolving_load_balancer"}};rf.ResolvingLoadBalancer=Ob});var jI=E(va=>{"use strict";Object.defineProperty(va,"__esModule",{value:!0});va.channelOptionsEqual=va.recognizedOptions=void 0;va.recognizedOptions={"grpc.ssl_target_name_override":!0,"grpc.primary_user_agent":!0,"grpc.secondary_user_agent":!0,"grpc.default_authority":!0,"grpc.keepalive_time_ms":!0,"grpc.keepalive_timeout_ms":!0,"grpc.keepalive_permit_without_calls":!0,"grpc.service_config":!0,"grpc.max_concurrent_streams":!0,"grpc.initial_reconnect_backoff_ms":!0,"grpc.max_reconnect_backoff_ms":!0,"grpc.use_local_subchannel_pool":!0,"grpc.max_send_message_length":!0,"grpc.max_receive_message_length":!0,"grpc.enable_http_proxy":!0,"grpc.enable_channelz":!0,"grpc.dns_min_time_between_resolutions_ms":!0,"grpc.enable_retries":!0,"grpc.per_rpc_retry_buffer_size":!0,"grpc.retry_buffer_size":!0,"grpc.max_connection_age_ms":!0,"grpc.max_connection_age_grace_ms":!0,"grpc-node.max_session_memory":!0,"grpc.service_config_disable_resolution":!0,"grpc.client_idle_timeout_ms":!0,"grpc-node.tls_enable_trace":!0};function WB(n,e){let t=Object.keys(n).sort(),i=Object.keys(e).sort();if(t.length!==i.length)return!1;for(let r=0;r<t.length;r+=1)if(t[r]!==i[r]||n[t[r]]!==e[i[r]])return!1;return!0}va.channelOptionsEqual=WB});var Mi=E(Ri=>{"use strict";Object.defineProperty(Ri,"__esModule",{value:!0});Ri.stringToSubchannelAddress=Ri.subchannelAddressToString=Ri.subchannelAddressEqual=Ri.isTcpSubchannelAddress=void 0;var $B=Ie("net");function ql(n){return"port"in n}Ri.isTcpSubchannelAddress=ql;function HB(n,e){return!n&&!e?!0:!n||!e?!1:ql(n)?ql(e)&&n.host===e.host&&n.port===e.port:!ql(e)&&n.path===e.path}Ri.subchannelAddressEqual=HB;function KB(n){return ql(n)?n.host+":"+n.port:n.path}Ri.subchannelAddressToString=KB;var QB=443;function YB(n,e){return(0,$B.isIP)(n)?{host:n,port:e??QB}:{path:n}}Ri.stringToSubchannelAddress=YB});var sf=E(_a=>{"use strict";Object.defineProperty(_a,"__esModule",{value:!0});_a.addAdminServicesToServer=_a.registerAdminService=void 0;var qI=[];function XB(n,e){qI.push({getServiceDefinition:n,getHandlers:e})}_a.registerAdminService=XB;function ZB(n){for(let{getServiceDefinition:e,getHandlers:t}of qI)n.addService(e(),t())}_a.addAdminServicesToServer=ZB});var zI=E(Fn=>{"use strict";Object.defineProperty(Fn,"__esModule",{value:!0});Fn.ClientDuplexStreamImpl=Fn.ClientWritableStreamImpl=Fn.ClientReadableStreamImpl=Fn.ClientUnaryCallImpl=Fn.callErrorFromStatus=void 0;var JB=Ie("events"),Bb=Ie("stream"),zl=Te();function eV(n,e){let t=`${n.code} ${zl.Status[n.code]}: ${n.details}`,r=`${new Error(t).stack}
for call at
${e}`;return Object.assign(new Error(t),n,{stack:r})}Fn.callErrorFromStatus=eV;var Pb=class extends JB.EventEmitter{constructor(){super()}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(zl.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}};Fn.ClientUnaryCallImpl=Pb;var Nb=class extends Bb.Readable{constructor(e){super({objectMode:!0}),this.deserialize=e}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(zl.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_read(e){var t;(t=this.call)===null||t===void 0||t.startRead()}};Fn.ClientReadableStreamImpl=Nb;var Fb=class extends Bb.Writable{constructor(e){super({objectMode:!0}),this.serialize=e}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(zl.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_write(e,t,i){var r;let s={callback:i},o=Number(t);Number.isNaN(o)||(s.flags=o),(r=this.call)===null||r===void 0||r.sendMessageWithContext(s,e)}_final(e){var t;(t=this.call)===null||t===void 0||t.halfClose(),e()}};Fn.ClientWritableStreamImpl=Fb;var Lb=class extends Bb.Duplex{constructor(e,t){super({objectMode:!0}),this.serialize=e,this.deserialize=t}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(zl.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_read(e){var t;(t=this.call)===null||t===void 0||t.startRead()}_write(e,t,i){var r;let s={callback:i},o=Number(t);Number.isNaN(o)||(s.flags=o),(r=this.call)===null||r===void 0||r.sendMessageWithContext(s,e)}_final(e){var t;(t=this.call)===null||t===void 0||t.halfClose(),e()}};Fn.ClientDuplexStreamImpl=Lb});var GI=E(wa=>{"use strict";Object.defineProperty(wa,"__esModule",{value:!0});wa.InterceptingListenerImpl=wa.isInterceptingListener=void 0;function tV(n){return n.onReceiveMetadata!==void 0&&n.onReceiveMetadata.length===1}wa.isInterceptingListener=tV;var Vb=class{constructor(e,t){this.listener=e,this.nextListener=t,this.processingMetadata=!1,this.hasPendingMessage=!1,this.processingMessage=!1,this.pendingStatus=null}processPendingMessage(){this.hasPendingMessage&&(this.nextListener.onReceiveMessage(this.pendingMessage),this.pendingMessage=null,this.hasPendingMessage=!1)}processPendingStatus(){this.pendingStatus&&this.nextListener.onReceiveStatus(this.pendingStatus)}onReceiveMetadata(e){this.processingMetadata=!0,this.listener.onReceiveMetadata(e,t=>{this.processingMetadata=!1,this.nextListener.onReceiveMetadata(t),this.processPendingMessage(),this.processPendingStatus()})}onReceiveMessage(e){this.processingMessage=!0,this.listener.onReceiveMessage(e,t=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessage=t,this.hasPendingMessage=!0):(this.nextListener.onReceiveMessage(t),this.processPendingStatus())})}onReceiveStatus(e){this.listener.onReceiveStatus(e,t=>{this.processingMetadata||this.processingMessage?this.pendingStatus=t:this.nextListener.onReceiveStatus(t)})}};wa.InterceptingListenerImpl=Vb});var $b=E(Ln=>{"use strict";Object.defineProperty(Ln,"__esModule",{value:!0});Ln.getInterceptingCall=Ln.InterceptingCall=Ln.RequesterBuilder=Ln.ListenerBuilder=Ln.InterceptorConfigurationError=void 0;var nV=nn(),WI=GI(),$I=Te(),HI=zh(),Wl=class n extends Error{constructor(e){super(e),this.name="InterceptorConfigurationError",Error.captureStackTrace(this,n)}};Ln.InterceptorConfigurationError=Wl;var jb=class{constructor(){this.metadata=void 0,this.message=void 0,this.status=void 0}withOnReceiveMetadata(e){return this.metadata=e,this}withOnReceiveMessage(e){return this.message=e,this}withOnReceiveStatus(e){return this.status=e,this}build(){return{onReceiveMetadata:this.metadata,onReceiveMessage:this.message,onReceiveStatus:this.status}}};Ln.ListenerBuilder=jb;var qb=class{constructor(){this.start=void 0,this.message=void 0,this.halfClose=void 0,this.cancel=void 0}withStart(e){return this.start=e,this}withSendMessage(e){return this.message=e,this}withHalfClose(e){return this.halfClose=e,this}withCancel(e){return this.cancel=e,this}build(){return{start:this.start,sendMessage:this.message,halfClose:this.halfClose,cancel:this.cancel}}};Ln.RequesterBuilder=qb;var Ub={onReceiveMetadata:(n,e)=>{e(n)},onReceiveMessage:(n,e)=>{e(n)},onReceiveStatus:(n,e)=>{e(n)}},Gl={start:(n,e,t)=>{t(n,e)},sendMessage:(n,e)=>{e(n)},halfClose:n=>{n()},cancel:n=>{n()}},zb=class{constructor(e,t){var i,r,s,o;this.nextCall=e,this.processingMetadata=!1,this.pendingMessageContext=null,this.processingMessage=!1,this.pendingHalfClose=!1,t?this.requester={start:(i=t.start)!==null&&i!==void 0?i:Gl.start,sendMessage:(r=t.sendMessage)!==null&&r!==void 0?r:Gl.sendMessage,halfClose:(s=t.halfClose)!==null&&s!==void 0?s:Gl.halfClose,cancel:(o=t.cancel)!==null&&o!==void 0?o:Gl.cancel}:this.requester=Gl}cancelWithStatus(e,t){this.requester.cancel(()=>{this.nextCall.cancelWithStatus(e,t)})}getPeer(){return this.nextCall.getPeer()}processPendingMessage(){this.pendingMessageContext&&(this.nextCall.sendMessageWithContext(this.pendingMessageContext,this.pendingMessage),this.pendingMessageContext=null,this.pendingMessage=null)}processPendingHalfClose(){this.pendingHalfClose&&this.nextCall.halfClose()}start(e,t){var i,r,s,o,a,c;let l={onReceiveMetadata:(r=(i=t?.onReceiveMetadata)===null||i===void 0?void 0:i.bind(t))!==null&&r!==void 0?r:u=>{},onReceiveMessage:(o=(s=t?.onReceiveMessage)===null||s===void 0?void 0:s.bind(t))!==null&&o!==void 0?o:u=>{},onReceiveStatus:(c=(a=t?.onReceiveStatus)===null||a===void 0?void 0:a.bind(t))!==null&&c!==void 0?c:u=>{}};this.processingMetadata=!0,this.requester.start(e,l,(u,d)=>{var h,m,g;this.processingMetadata=!1;let y;if((0,WI.isInterceptingListener)(d))y=d;else{let _={onReceiveMetadata:(h=d.onReceiveMetadata)!==null&&h!==void 0?h:Ub.onReceiveMetadata,onReceiveMessage:(m=d.onReceiveMessage)!==null&&m!==void 0?m:Ub.onReceiveMessage,onReceiveStatus:(g=d.onReceiveStatus)!==null&&g!==void 0?g:Ub.onReceiveStatus};y=new WI.InterceptingListenerImpl(_,l)}this.nextCall.start(u,y),this.processPendingMessage(),this.processPendingHalfClose()})}sendMessageWithContext(e,t){this.processingMessage=!0,this.requester.sendMessage(t,i=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessageContext=e,this.pendingMessage=t):(this.nextCall.sendMessageWithContext(e,i),this.processPendingHalfClose())})}sendMessage(e){this.sendMessageWithContext({},e)}startRead(){this.nextCall.startRead()}halfClose(){this.requester.halfClose(()=>{this.processingMetadata||this.processingMessage?this.pendingHalfClose=!0:this.nextCall.halfClose()})}};Ln.InterceptingCall=zb;function iV(n,e,t){var i,r;let s=(i=t.deadline)!==null&&i!==void 0?i:1/0,o=t.host,a=(r=t.parent)!==null&&r!==void 0?r:null,c=t.propagate_flags,l=t.credentials,u=n.createCall(e,s,o,a,c);return l&&u.setCredentials(l),u}var of=class{constructor(e,t){this.call=e,this.methodDefinition=t}cancelWithStatus(e,t){this.call.cancelWithStatus(e,t)}getPeer(){return this.call.getPeer()}sendMessageWithContext(e,t){let i;try{i=this.methodDefinition.requestSerialize(t)}catch(r){this.call.cancelWithStatus($I.Status.INTERNAL,`Request message serialization failure: ${(0,HI.getErrorMessage)(r)}`);return}this.call.sendMessageWithContext(e,i)}sendMessage(e){this.sendMessageWithContext({},e)}start(e,t){let i=null;this.call.start(e,{onReceiveMetadata:r=>{var s;(s=t?.onReceiveMetadata)===null||s===void 0||s.call(t,r)},onReceiveMessage:r=>{var s;let o;try{o=this.methodDefinition.responseDeserialize(r)}catch(a){i={code:$I.Status.INTERNAL,details:`Response message parsing error: ${(0,HI.getErrorMessage)(a)}`,metadata:new nV.Metadata},this.call.cancelWithStatus(i.code,i.details);return}(s=t?.onReceiveMessage)===null||s===void 0||s.call(t,o)},onReceiveStatus:r=>{var s,o;i?(s=t?.onReceiveStatus)===null||s===void 0||s.call(t,i):(o=t?.onReceiveStatus)===null||o===void 0||o.call(t,r)}})}startRead(){this.call.startRead()}halfClose(){this.call.halfClose()}},Gb=class extends of{constructor(e,t){super(e,t)}start(e,t){var i,r;let s=!1,o={onReceiveMetadata:(r=(i=t?.onReceiveMetadata)===null||i===void 0?void 0:i.bind(t))!==null&&r!==void 0?r:a=>{},onReceiveMessage:a=>{var c;s=!0,(c=t?.onReceiveMessage)===null||c===void 0||c.call(t,a)},onReceiveStatus:a=>{var c,l;s||(c=t?.onReceiveMessage)===null||c===void 0||c.call(t,null),(l=t?.onReceiveStatus)===null||l===void 0||l.call(t,a)}};super.start(e,o),this.call.startRead()}},Wb=class extends of{};function rV(n,e,t){let i=iV(n,t.path,e);return t.responseStream?new Wb(i,t):new Gb(i,t)}function sV(n,e,t,i){if(n.clientInterceptors.length>0&&n.clientInterceptorProviders.length>0)throw new Wl("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(n.callInterceptors.length>0&&n.callInterceptorProviders.length>0)throw new Wl("Both interceptors and interceptor_providers were passed as call options. Only one of these is allowed.");let r=[];n.callInterceptors.length>0||n.callInterceptorProviders.length>0?r=[].concat(n.callInterceptors,n.callInterceptorProviders.map(a=>a(e))).filter(a=>a):r=[].concat(n.clientInterceptors,n.clientInterceptorProviders.map(a=>a(e))).filter(a=>a);let s=Object.assign({},t,{method_definition:e});return r.reduceRight((a,c)=>l=>c(l,a),a=>rV(i,a,e))(s)}Ln.getInterceptingCall=sV});var Qb=E(cf=>{"use strict";Object.defineProperty(cf,"__esModule",{value:!0});cf.Client=void 0;var Oi=zI(),oV=Yb(),aV=Pn(),Hr=Te(),Ca=nn(),af=$b(),ai=Symbol(),Ea=Symbol(),Sa=Symbol(),fr=Symbol();function Hb(n){return typeof n=="function"}function Ta(n){return n.stack.split(`
`).slice(1).join(`
`)}var Kb=class{constructor(e,t,i={}){var r,s;if(i=Object.assign({},i),this[Ea]=(r=i.interceptors)!==null&&r!==void 0?r:[],delete i.interceptors,this[Sa]=(s=i.interceptor_providers)!==null&&s!==void 0?s:[],delete i.interceptor_providers,this[Ea].length>0&&this[Sa].length>0)throw new Error("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(this[fr]=i.callInvocationTransformer,delete i.callInvocationTransformer,i.channelOverride)this[ai]=i.channelOverride;else if(i.channelFactoryOverride){let o=i.channelFactoryOverride;delete i.channelFactoryOverride,this[ai]=o(e,t,i)}else this[ai]=new oV.ChannelImplementation(e,t,i)}close(){this[ai].close()}getChannel(){return this[ai]}waitForReady(e,t){let i=r=>{if(r){t(new Error("Failed to connect before the deadline"));return}let s;try{s=this[ai].getConnectivityState(!0)}catch{t(new Error("The channel has been closed"));return}if(s===aV.ConnectivityState.READY)t();else try{this[ai].watchConnectivityState(s,e,i)}catch{t(new Error("The channel has been closed"))}};setImmediate(i)}checkOptionalUnaryResponseArguments(e,t,i){if(Hb(e))return{metadata:new Ca.Metadata,options:{},callback:e};if(Hb(t))return e instanceof Ca.Metadata?{metadata:e,options:{},callback:t}:{metadata:new Ca.Metadata,options:e,callback:t};if(!(e instanceof Ca.Metadata&&t instanceof Object&&Hb(i)))throw new Error("Incorrect arguments passed");return{metadata:e,options:t,callback:i}}makeUnaryRequest(e,t,i,r,s,o,a){var c,l;let u=this.checkOptionalUnaryResponseArguments(s,o,a),d={path:e,requestStream:!1,responseStream:!1,requestSerialize:t,responseDeserialize:i},h={argument:r,metadata:u.metadata,call:new Oi.ClientUnaryCallImpl,channel:this[ai],methodDefinition:d,callOptions:u.options,callback:u.callback};this[fr]&&(h=this[fr](h));let m=h.call,g={clientInterceptors:this[Ea],clientInterceptorProviders:this[Sa],callInterceptors:(c=h.callOptions.interceptors)!==null&&c!==void 0?c:[],callInterceptorProviders:(l=h.callOptions.interceptor_providers)!==null&&l!==void 0?l:[]},y=(0,af.getInterceptingCall)(g,h.methodDefinition,h.callOptions,h.channel);m.call=y;let _=null,M=!1,T=new Error;return y.start(h.metadata,{onReceiveMetadata:O=>{m.emit("metadata",O)},onReceiveMessage(O){_!==null&&y.cancelWithStatus(Hr.Status.INTERNAL,"Too many responses received"),_=O},onReceiveStatus(O){if(!M){if(M=!0,O.code===Hr.Status.OK)if(_===null){let P=Ta(T);h.callback((0,Oi.callErrorFromStatus)({code:Hr.Status.INTERNAL,details:"No message received",metadata:O.metadata},P))}else h.callback(null,_);else{let P=Ta(T);h.callback((0,Oi.callErrorFromStatus)(O,P))}T=null,m.emit("status",O)}}}),y.sendMessage(r),y.halfClose(),m}makeClientStreamRequest(e,t,i,r,s,o){var a,c;let l=this.checkOptionalUnaryResponseArguments(r,s,o),u={path:e,requestStream:!0,responseStream:!1,requestSerialize:t,responseDeserialize:i},d={metadata:l.metadata,call:new Oi.ClientWritableStreamImpl(t),channel:this[ai],methodDefinition:u,callOptions:l.options,callback:l.callback};this[fr]&&(d=this[fr](d));let h=d.call,m={clientInterceptors:this[Ea],clientInterceptorProviders:this[Sa],callInterceptors:(a=d.callOptions.interceptors)!==null&&a!==void 0?a:[],callInterceptorProviders:(c=d.callOptions.interceptor_providers)!==null&&c!==void 0?c:[]},g=(0,af.getInterceptingCall)(m,d.methodDefinition,d.callOptions,d.channel);h.call=g;let y=null,_=!1,M=new Error;return g.start(d.metadata,{onReceiveMetadata:T=>{h.emit("metadata",T)},onReceiveMessage(T){y!==null&&g.cancelWithStatus(Hr.Status.INTERNAL,"Too many responses received"),y=T},onReceiveStatus(T){if(!_){if(_=!0,T.code===Hr.Status.OK)if(y===null){let O=Ta(M);d.callback((0,Oi.callErrorFromStatus)({code:Hr.Status.INTERNAL,details:"No message received",metadata:T.metadata},O))}else d.callback(null,y);else{let O=Ta(M);d.callback((0,Oi.callErrorFromStatus)(T,O))}M=null,h.emit("status",T)}}}),h}checkMetadataAndOptions(e,t){let i,r;return e instanceof Ca.Metadata?(i=e,t?r=t:r={}):(e?r=e:r={},i=new Ca.Metadata),{metadata:i,options:r}}makeServerStreamRequest(e,t,i,r,s,o){var a,c;let l=this.checkMetadataAndOptions(s,o),u={path:e,requestStream:!1,responseStream:!0,requestSerialize:t,responseDeserialize:i},d={argument:r,metadata:l.metadata,call:new Oi.ClientReadableStreamImpl(i),channel:this[ai],methodDefinition:u,callOptions:l.options};this[fr]&&(d=this[fr](d));let h=d.call,m={clientInterceptors:this[Ea],clientInterceptorProviders:this[Sa],callInterceptors:(a=d.callOptions.interceptors)!==null&&a!==void 0?a:[],callInterceptorProviders:(c=d.callOptions.interceptor_providers)!==null&&c!==void 0?c:[]},g=(0,af.getInterceptingCall)(m,d.methodDefinition,d.callOptions,d.channel);h.call=g;let y=!1,_=new Error;return g.start(d.metadata,{onReceiveMetadata(M){h.emit("metadata",M)},onReceiveMessage(M){h.push(M)},onReceiveStatus(M){if(!y){if(y=!0,h.push(null),M.code!==Hr.Status.OK){let T=Ta(_);h.emit("error",(0,Oi.callErrorFromStatus)(M,T))}_=null,h.emit("status",M)}}}),g.sendMessage(r),g.halfClose(),h}makeBidiStreamRequest(e,t,i,r,s){var o,a;let c=this.checkMetadataAndOptions(r,s),l={path:e,requestStream:!0,responseStream:!0,requestSerialize:t,responseDeserialize:i},u={metadata:c.metadata,call:new Oi.ClientDuplexStreamImpl(t,i),channel:this[ai],methodDefinition:l,callOptions:c.options};this[fr]&&(u=this[fr](u));let d=u.call,h={clientInterceptors:this[Ea],clientInterceptorProviders:this[Sa],callInterceptors:(o=u.callOptions.interceptors)!==null&&o!==void 0?o:[],callInterceptorProviders:(a=u.callOptions.interceptor_providers)!==null&&a!==void 0?a:[]},m=(0,af.getInterceptingCall)(h,u.methodDefinition,u.callOptions,u.channel);d.call=m;let g=!1,y=new Error;return m.start(u.metadata,{onReceiveMetadata(_){d.emit("metadata",_)},onReceiveMessage(_){d.push(_)},onReceiveStatus(_){if(!g){if(g=!0,d.push(null),_.code!==Hr.Status.OK){let M=Ta(y);d.emit("error",(0,Oi.callErrorFromStatus)(_,M))}y=null,d.emit("status",_)}}}),d}};cf.Client=Kb});var Zb=E(xa=>{"use strict";Object.defineProperty(xa,"__esModule",{value:!0});xa.loadPackageDefinition=xa.makeClientConstructor=void 0;var $l=Qb(),cV={unary:$l.Client.prototype.makeUnaryRequest,server_stream:$l.Client.prototype.makeServerStreamRequest,client_stream:$l.Client.prototype.makeClientStreamRequest,bidi:$l.Client.prototype.makeBidiStreamRequest};function Xb(n){return["__proto__","prototype","constructor"].includes(n)}function KI(n,e,t){t||(t={});class i extends $l.Client{}return Object.keys(n).forEach(r=>{if(Xb(r))return;let s=n[r],o;if(typeof r=="string"&&r.charAt(0)==="$")throw new Error("Method names cannot start with $");s.requestStream?s.responseStream?o="bidi":o="client_stream":s.responseStream?o="server_stream":o="unary";let a=s.requestSerialize,c=s.responseDeserialize,l=lV(cV[o],s.path,a,c);i.prototype[r]=l,Object.assign(i.prototype[r],s),s.originalName&&!Xb(s.originalName)&&(i.prototype[s.originalName]=i.prototype[r])}),i.service=n,i.serviceName=e,i}xa.makeClientConstructor=KI;function lV(n,e,t,i){return function(...r){return n.call(this,e,t,i,...r)}}function uV(n){return"format"in n}function dV(n){let e={};for(let t in n)if(Object.prototype.hasOwnProperty.call(n,t)){let i=n[t],r=t.split(".");if(r.some(a=>Xb(a)))continue;let s=r[r.length-1],o=e;for(let a of r.slice(0,-1))o[a]||(o[a]={}),o=o[a];uV(i)?o[s]=i:o[s]=KI(i,s,{})}return e}xa.loadPackageDefinition=dV});var vA=E((VX,bA)=>{"use strict";var hV=1/0,fV="[object Symbol]",mV=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,pV=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,uf="\\ud800-\\udfff",nA="\\u0300-\\u036f\\ufe20-\\ufe23",iA="\\u20d0-\\u20f0",rA="\\u2700-\\u27bf",sA="a-z\\xdf-\\xf6\\xf8-\\xff",gV="\\xac\\xb1\\xd7\\xf7",yV="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",bV="\\u2000-\\u206f",vV=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",oA="A-Z\\xc0-\\xd6\\xd8-\\xde",aA="\\ufe0e\\ufe0f",cA=gV+yV+bV+vV,ev="['\u2019]",_V="["+uf+"]",QI="["+cA+"]",lf="["+nA+iA+"]",lA="\\d+",wV="["+rA+"]",uA="["+sA+"]",dA="[^"+uf+cA+lA+rA+sA+oA+"]",Jb="\\ud83c[\\udffb-\\udfff]",CV="(?:"+lf+"|"+Jb+")",hA="[^"+uf+"]",tv="(?:\\ud83c[\\udde6-\\uddff]){2}",nv="[\\ud800-\\udbff][\\udc00-\\udfff]",Ia="["+oA+"]",fA="\\u200d",YI="(?:"+uA+"|"+dA+")",EV="(?:"+Ia+"|"+dA+")",XI="(?:"+ev+"(?:d|ll|m|re|s|t|ve))?",ZI="(?:"+ev+"(?:D|LL|M|RE|S|T|VE))?",mA=CV+"?",pA="["+aA+"]?",SV="(?:"+fA+"(?:"+[hA,tv,nv].join("|")+")"+pA+mA+")*",gA=pA+mA+SV,TV="(?:"+[wV,tv,nv].join("|")+")"+gA,xV="(?:"+[hA+lf+"?",lf,tv,nv,_V].join("|")+")",IV=RegExp(ev,"g"),AV=RegExp(lf,"g"),DV=RegExp(Jb+"(?="+Jb+")|"+xV+gA,"g"),kV=RegExp([Ia+"?"+uA+"+"+XI+"(?="+[QI,Ia,"$"].join("|")+")",EV+"+"+ZI+"(?="+[QI,Ia+YI,"$"].join("|")+")",Ia+"?"+YI+"+"+XI,Ia+"+"+ZI,lA,TV].join("|"),"g"),RV=RegExp("["+fA+uf+nA+iA+aA+"]"),MV=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,OV={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"ss"},PV=typeof global=="object"&&global&&global.Object===Object&&global,NV=typeof self=="object"&&self&&self.Object===Object&&self,FV=PV||NV||Function("return this")();function LV(n,e,t,i){var r=-1,s=n?n.length:0;for(i&&s&&(t=n[++r]);++r<s;)t=e(t,n[r],r,n);return t}function BV(n){return n.split("")}function VV(n){return n.match(mV)||[]}function UV(n){return function(e){return n?.[e]}}var jV=UV(OV);function yA(n){return RV.test(n)}function qV(n){return MV.test(n)}function zV(n){return yA(n)?GV(n):BV(n)}function GV(n){return n.match(DV)||[]}function WV(n){return n.match(kV)||[]}var $V=Object.prototype,HV=$V.toString,JI=FV.Symbol,eA=JI?JI.prototype:void 0,tA=eA?eA.toString:void 0;function KV(n,e,t){var i=-1,r=n.length;e<0&&(e=-e>r?0:r+e),t=t>r?r:t,t<0&&(t+=r),r=e>t?0:t-e>>>0,e>>>=0;for(var s=Array(r);++i<r;)s[i]=n[i+e];return s}function QV(n){if(typeof n=="string")return n;if(eU(n))return tA?tA.call(n):"";var e=n+"";return e=="0"&&1/n==-hV?"-0":e}function YV(n,e,t){var i=n.length;return t=t===void 0?i:t,!e&&t>=i?n:KV(n,e,t)}function XV(n){return function(e){e=df(e);var t=yA(e)?zV(e):void 0,i=t?t[0]:e.charAt(0),r=t?YV(t,1).join(""):e.slice(1);return i[n]()+r}}function ZV(n){return function(e){return LV(sU(iU(e).replace(IV,"")),n,"")}}function JV(n){return!!n&&typeof n=="object"}function eU(n){return typeof n=="symbol"||JV(n)&&HV.call(n)==fV}function df(n){return n==null?"":QV(n)}var tU=ZV(function(n,e,t){return e=e.toLowerCase(),n+(t?nU(e):e)});function nU(n){return rU(df(n).toLowerCase())}function iU(n){return n=df(n),n&&n.replace(pV,jV).replace(AV,"")}var rU=XV("toUpperCase");function sU(n,e,t){return n=df(n),e=t?void 0:e,e===void 0?qV(n)?WV(n):VV(n):n.match(e)||[]}bA.exports=tU});var iv=E((UX,_A)=>{"use strict";_A.exports=oU;function oU(n,e){for(var t=new Array(arguments.length-1),i=0,r=2,s=!0;r<arguments.length;)t[i++]=arguments[r++];return new Promise(function(a,c){t[i]=function(u){if(s)if(s=!1,u)c(u);else{for(var d=new Array(arguments.length-1),h=0;h<d.length;)d[h++]=arguments[h];a.apply(null,d)}};try{n.apply(e||null,t)}catch(l){s&&(s=!1,c(l))}})}});var SA=E(EA=>{"use strict";var hf=EA;hf.length=function(e){var t=e.length;if(!t)return 0;for(var i=0;--t%4>1&&e.charAt(t)==="=";)++i;return Math.ceil(e.length*3)/4-i};var Aa=new Array(64),CA=new Array(123);for(ci=0;ci<64;)CA[Aa[ci]=ci<26?ci+65:ci<52?ci+71:ci<62?ci-4:ci-59|43]=ci++;var ci;hf.encode=function(e,t,i){for(var r=null,s=[],o=0,a=0,c;t<i;){var l=e[t++];switch(a){case 0:s[o++]=Aa[l>>2],c=(l&3)<<4,a=1;break;case 1:s[o++]=Aa[c|l>>4],c=(l&15)<<2,a=2;break;case 2:s[o++]=Aa[c|l>>6],s[o++]=Aa[l&63],a=0;break}o>8191&&((r||(r=[])).push(String.fromCharCode.apply(String,s)),o=0)}return a&&(s[o++]=Aa[c],s[o++]=61,a===1&&(s[o++]=61)),r?(o&&r.push(String.fromCharCode.apply(String,s.slice(0,o))),r.join("")):String.fromCharCode.apply(String,s.slice(0,o))};var wA="invalid encoding";hf.decode=function(e,t,i){for(var r=i,s=0,o,a=0;a<e.length;){var c=e.charCodeAt(a++);if(c===61&&s>1)break;if((c=CA[c])===void 0)throw Error(wA);switch(s){case 0:o=c,s=1;break;case 1:t[i++]=o<<2|(c&48)>>4,o=c,s=2;break;case 2:t[i++]=(o&15)<<4|(c&60)>>2,o=c,s=3;break;case 3:t[i++]=(o&3)<<6|c,s=0;break}}if(s===1)throw Error(wA);return i-r};hf.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}});var xA=E((qX,TA)=>{"use strict";TA.exports=ff;function ff(){this._listeners={}}ff.prototype.on=function(e,t,i){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:i||this}),this};ff.prototype.off=function(e,t){if(e===void 0)this._listeners={};else if(t===void 0)this._listeners[e]=[];else for(var i=this._listeners[e],r=0;r<i.length;)i[r].fn===t?i.splice(r,1):++r;return this};ff.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var i=[],r=1;r<arguments.length;)i.push(arguments[r++]);for(r=0;r<t.length;)t[r].fn.apply(t[r++].ctx,i)}return this}});var OA=E((zX,MA)=>{"use strict";MA.exports=IA(IA);function IA(n){return typeof Float32Array<"u"?function(){var e=new Float32Array([-0]),t=new Uint8Array(e.buffer),i=t[3]===128;function r(c,l,u){e[0]=c,l[u]=t[0],l[u+1]=t[1],l[u+2]=t[2],l[u+3]=t[3]}function s(c,l,u){e[0]=c,l[u]=t[3],l[u+1]=t[2],l[u+2]=t[1],l[u+3]=t[0]}n.writeFloatLE=i?r:s,n.writeFloatBE=i?s:r;function o(c,l){return t[0]=c[l],t[1]=c[l+1],t[2]=c[l+2],t[3]=c[l+3],e[0]}function a(c,l){return t[3]=c[l],t[2]=c[l+1],t[1]=c[l+2],t[0]=c[l+3],e[0]}n.readFloatLE=i?o:a,n.readFloatBE=i?a:o}():function(){function e(i,r,s,o){var a=r<0?1:0;if(a&&(r=-r),r===0)i(1/r>0?0:2147483648,s,o);else if(isNaN(r))i(2143289344,s,o);else if(r>34028234663852886e22)i((a<<31|2139095040)>>>0,s,o);else if(r<11754943508222875e-54)i((a<<31|Math.round(r/1401298464324817e-60))>>>0,s,o);else{var c=Math.floor(Math.log(r)/Math.LN2),l=Math.round(r*Math.pow(2,-c)*8388608)&8388607;i((a<<31|c+127<<23|l)>>>0,s,o)}}n.writeFloatLE=e.bind(null,AA),n.writeFloatBE=e.bind(null,DA);function t(i,r,s){var o=i(r,s),a=(o>>31)*2+1,c=o>>>23&255,l=o&8388607;return c===255?l?NaN:a*(1/0):c===0?a*1401298464324817e-60*l:a*Math.pow(2,c-150)*(l+8388608)}n.readFloatLE=t.bind(null,kA),n.readFloatBE=t.bind(null,RA)}(),typeof Float64Array<"u"?function(){var e=new Float64Array([-0]),t=new Uint8Array(e.buffer),i=t[7]===128;function r(c,l,u){e[0]=c,l[u]=t[0],l[u+1]=t[1],l[u+2]=t[2],l[u+3]=t[3],l[u+4]=t[4],l[u+5]=t[5],l[u+6]=t[6],l[u+7]=t[7]}function s(c,l,u){e[0]=c,l[u]=t[7],l[u+1]=t[6],l[u+2]=t[5],l[u+3]=t[4],l[u+4]=t[3],l[u+5]=t[2],l[u+6]=t[1],l[u+7]=t[0]}n.writeDoubleLE=i?r:s,n.writeDoubleBE=i?s:r;function o(c,l){return t[0]=c[l],t[1]=c[l+1],t[2]=c[l+2],t[3]=c[l+3],t[4]=c[l+4],t[5]=c[l+5],t[6]=c[l+6],t[7]=c[l+7],e[0]}function a(c,l){return t[7]=c[l],t[6]=c[l+1],t[5]=c[l+2],t[4]=c[l+3],t[3]=c[l+4],t[2]=c[l+5],t[1]=c[l+6],t[0]=c[l+7],e[0]}n.readDoubleLE=i?o:a,n.readDoubleBE=i?a:o}():function(){function e(i,r,s,o,a,c){var l=o<0?1:0;if(l&&(o=-o),o===0)i(0,a,c+r),i(1/o>0?0:2147483648,a,c+s);else if(isNaN(o))i(0,a,c+r),i(2146959360,a,c+s);else if(o>17976931348623157e292)i(0,a,c+r),i((l<<31|2146435072)>>>0,a,c+s);else{var u;if(o<22250738585072014e-324)u=o/5e-324,i(u>>>0,a,c+r),i((l<<31|u/4294967296)>>>0,a,c+s);else{var d=Math.floor(Math.log(o)/Math.LN2);d===1024&&(d=1023),u=o*Math.pow(2,-d),i(u*4503599627370496>>>0,a,c+r),i((l<<31|d+1023<<20|u*1048576&1048575)>>>0,a,c+s)}}}n.writeDoubleLE=e.bind(null,AA,0,4),n.writeDoubleBE=e.bind(null,DA,4,0);function t(i,r,s,o,a){var c=i(o,a+r),l=i(o,a+s),u=(l>>31)*2+1,d=l>>>20&2047,h=4294967296*(l&1048575)+c;return d===2047?h?NaN:u*(1/0):d===0?u*5e-324*h:u*Math.pow(2,d-1075)*(h+4503599627370496)}n.readDoubleLE=t.bind(null,kA,0,4),n.readDoubleBE=t.bind(null,RA,4,0)}(),n}function AA(n,e,t){e[t]=n&255,e[t+1]=n>>>8&255,e[t+2]=n>>>16&255,e[t+3]=n>>>24}function DA(n,e,t){e[t]=n>>>24,e[t+1]=n>>>16&255,e[t+2]=n>>>8&255,e[t+3]=n&255}function kA(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16|n[e+3]<<24)>>>0}function RA(n,e){return(n[e]<<24|n[e+1]<<16|n[e+2]<<8|n[e+3])>>>0}});var rv=E((exports,module)=>{"use strict";module.exports=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(n){}return null}});var NA=E(PA=>{"use strict";var sv=PA;sv.length=function(e){for(var t=0,i=0,r=0;r<e.length;++r)i=e.charCodeAt(r),i<128?t+=1:i<2048?t+=2:(i&64512)===55296&&(e.charCodeAt(r+1)&64512)===56320?(++r,t+=4):t+=3;return t};sv.read=function(e,t,i){var r=i-t;if(r<1)return"";for(var s=null,o=[],a=0,c;t<i;)c=e[t++],c<128?o[a++]=c:c>191&&c<224?o[a++]=(c&31)<<6|e[t++]&63:c>239&&c<365?(c=((c&7)<<18|(e[t++]&63)<<12|(e[t++]&63)<<6|e[t++]&63)-65536,o[a++]=55296+(c>>10),o[a++]=56320+(c&1023)):o[a++]=(c&15)<<12|(e[t++]&63)<<6|e[t++]&63,a>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,o)),a=0);return s?(a&&s.push(String.fromCharCode.apply(String,o.slice(0,a))),s.join("")):String.fromCharCode.apply(String,o.slice(0,a))};sv.write=function(e,t,i){for(var r=i,s,o,a=0;a<e.length;++a)s=e.charCodeAt(a),s<128?t[i++]=s:s<2048?(t[i++]=s>>6|192,t[i++]=s&63|128):(s&64512)===55296&&((o=e.charCodeAt(a+1))&64512)===56320?(s=65536+((s&1023)<<10)+(o&1023),++a,t[i++]=s>>18|240,t[i++]=s>>12&63|128,t[i++]=s>>6&63|128,t[i++]=s&63|128):(t[i++]=s>>12|224,t[i++]=s>>6&63|128,t[i++]=s&63|128);return i-r}});var LA=E((WX,FA)=>{"use strict";FA.exports=aU;function aU(n,e,t){var i=t||8192,r=i>>>1,s=null,o=i;return function(c){if(c<1||c>r)return n(c);o+c>i&&(s=n(i),o=0);var l=e.call(s,o,o+=c);return o&7&&(o=(o|7)+1),l}}});var VA=E(($X,BA)=>{"use strict";BA.exports=xt;var Hl=Pi();function xt(n,e){this.lo=n>>>0,this.hi=e>>>0}var Ys=xt.zero=new xt(0,0);Ys.toNumber=function(){return 0};Ys.zzEncode=Ys.zzDecode=function(){return this};Ys.length=function(){return 1};var cU=xt.zeroHash="\0\0\0\0\0\0\0\0";xt.fromNumber=function(e){if(e===0)return Ys;var t=e<0;t&&(e=-e);var i=e>>>0,r=(e-i)/4294967296>>>0;return t&&(r=~r>>>0,i=~i>>>0,++i>4294967295&&(i=0,++r>4294967295&&(r=0))),new xt(i,r)};xt.from=function(e){if(typeof e=="number")return xt.fromNumber(e);if(Hl.isString(e))if(Hl.Long)e=Hl.Long.fromString(e);else return xt.fromNumber(parseInt(e,10));return e.low||e.high?new xt(e.low>>>0,e.high>>>0):Ys};xt.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=~this.lo+1>>>0,i=~this.hi>>>0;return t||(i=i+1>>>0),-(t+i*4294967296)}return this.lo+this.hi*4294967296};xt.prototype.toLong=function(e){return Hl.Long?new Hl.Long(this.lo|0,this.hi|0,!!e):{low:this.lo|0,high:this.hi|0,unsigned:!!e}};var Kr=String.prototype.charCodeAt;xt.fromHash=function(e){return e===cU?Ys:new xt((Kr.call(e,0)|Kr.call(e,1)<<8|Kr.call(e,2)<<16|Kr.call(e,3)<<24)>>>0,(Kr.call(e,4)|Kr.call(e,5)<<8|Kr.call(e,6)<<16|Kr.call(e,7)<<24)>>>0)};xt.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)};xt.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this};xt.prototype.zzDecode=function(){var e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this};xt.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,i=this.hi>>>24;return i===0?t===0?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:i<128?9:10}});var Pi=E(ov=>{"use strict";var H=ov;H.asPromise=iv();H.base64=SA();H.EventEmitter=xA();H.float=OA();H.inquire=rv();H.utf8=NA();H.pool=LA();H.LongBits=VA();H.isNode=!!(typeof global<"u"&&global&&global.process&&global.process.versions&&global.process.versions.node);H.global=H.isNode&&global||typeof window<"u"&&window||typeof self<"u"&&self||ov;H.emptyArray=Object.freeze?Object.freeze([]):[];H.emptyObject=Object.freeze?Object.freeze({}):{};H.isInteger=Number.isInteger||function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e};H.isString=function(e){return typeof e=="string"||e instanceof String};H.isObject=function(e){return e&&typeof e=="object"};H.isset=H.isSet=function(e,t){var i=e[t];return i!=null&&e.hasOwnProperty(t)?typeof i!="object"||(Array.isArray(i)?i.length:Object.keys(i).length)>0:!1};H.Buffer=function(){try{var n=H.inquire("buffer").Buffer;return n.prototype.utf8Write?n:null}catch{return null}}();H._Buffer_from=null;H._Buffer_allocUnsafe=null;H.newBuffer=function(e){return typeof e=="number"?H.Buffer?H._Buffer_allocUnsafe(e):new H.Array(e):H.Buffer?H._Buffer_from(e):typeof Uint8Array>"u"?e:new Uint8Array(e)};H.Array=typeof Uint8Array<"u"?Uint8Array:Array;H.Long=H.global.dcodeIO&&H.global.dcodeIO.Long||H.global.Long||H.inquire("long");H.key2Re=/^true|false|0|1$/;H.key32Re=/^-?(?:0|[1-9][0-9]*)$/;H.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/;H.longToHash=function(e){return e?H.LongBits.from(e).toHash():H.LongBits.zeroHash};H.longFromHash=function(e,t){var i=H.LongBits.fromHash(e);return H.Long?H.Long.fromBits(i.lo,i.hi,t):i.toNumber(!!t)};function UA(n,e,t){for(var i=Object.keys(e),r=0;r<i.length;++r)(n[i[r]]===void 0||!t)&&(n[i[r]]=e[i[r]]);return n}H.merge=UA;H.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)};function jA(n){function e(t,i){if(!(this instanceof e))return new e(t,i);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:new Error().stack||""}),i&&UA(this,i)}return e.prototype=Object.create(Error.prototype,{constructor:{value:e,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return n},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),e}H.newError=jA;H.ProtocolError=jA("ProtocolError");H.oneOfGetter=function(e){for(var t={},i=0;i<e.length;++i)t[e[i]]=1;return function(){for(var r=Object.keys(this),s=r.length-1;s>-1;--s)if(t[r[s]]===1&&this[r[s]]!==void 0&&this[r[s]]!==null)return r[s]}};H.oneOfSetter=function(e){return function(t){for(var i=0;i<e.length;++i)e[i]!==t&&delete this[e[i]]}};H.toJSONOptions={longs:String,enums:String,bytes:String,json:!0};H._configure=function(){var n=H.Buffer;if(!n){H._Buffer_from=H._Buffer_allocUnsafe=null;return}H._Buffer_from=n.from!==Uint8Array.from&&n.from||function(t,i){return new n(t,i)},H._Buffer_allocUnsafe=n.allocUnsafe||function(t){return new n(t)}}});var pf=E((KX,WA)=>{"use strict";WA.exports=Se;var Bn=Pi(),av,mf=Bn.LongBits,qA=Bn.base64,zA=Bn.utf8;function Kl(n,e,t){this.fn=n,this.len=e,this.next=void 0,this.val=t}function lv(){}function lU(n){this.head=n.head,this.tail=n.tail,this.len=n.len,this.next=n.states}function Se(){this.len=0,this.head=new Kl(lv,0,0),this.tail=this.head,this.states=null}var GA=function(){return Bn.Buffer?function(){return(Se.create=function(){return new av})()}:function(){return new Se}};Se.create=GA();Se.alloc=function(e){return new Bn.Array(e)};Bn.Array!==Array&&(Se.alloc=Bn.pool(Se.alloc,Bn.Array.prototype.subarray));Se.prototype._push=function(e,t,i){return this.tail=this.tail.next=new Kl(e,t,i),this.len+=t,this};function uv(n,e,t){e[t]=n&255}function uU(n,e,t){for(;n>127;)e[t++]=n&127|128,n>>>=7;e[t]=n}function dv(n,e){this.len=n,this.next=void 0,this.val=e}dv.prototype=Object.create(Kl.prototype);dv.prototype.fn=uU;Se.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new dv((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this};Se.prototype.int32=function(e){return e<0?this._push(hv,10,mf.fromNumber(e)):this.uint32(e)};Se.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)};function hv(n,e,t){for(;n.hi;)e[t++]=n.lo&127|128,n.lo=(n.lo>>>7|n.hi<<25)>>>0,n.hi>>>=7;for(;n.lo>127;)e[t++]=n.lo&127|128,n.lo=n.lo>>>7;e[t++]=n.lo}Se.prototype.uint64=function(e){var t=mf.from(e);return this._push(hv,t.length(),t)};Se.prototype.int64=Se.prototype.uint64;Se.prototype.sint64=function(e){var t=mf.from(e).zzEncode();return this._push(hv,t.length(),t)};Se.prototype.bool=function(e){return this._push(uv,1,e?1:0)};function cv(n,e,t){e[t]=n&255,e[t+1]=n>>>8&255,e[t+2]=n>>>16&255,e[t+3]=n>>>24}Se.prototype.fixed32=function(e){return this._push(cv,4,e>>>0)};Se.prototype.sfixed32=Se.prototype.fixed32;Se.prototype.fixed64=function(e){var t=mf.from(e);return this._push(cv,4,t.lo)._push(cv,4,t.hi)};Se.prototype.sfixed64=Se.prototype.fixed64;Se.prototype.float=function(e){return this._push(Bn.float.writeFloatLE,4,e)};Se.prototype.double=function(e){return this._push(Bn.float.writeDoubleLE,8,e)};var dU=Bn.Array.prototype.set?function(e,t,i){t.set(e,i)}:function(e,t,i){for(var r=0;r<e.length;++r)t[i+r]=e[r]};Se.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(uv,1,0);if(Bn.isString(e)){var i=Se.alloc(t=qA.length(e));qA.decode(e,i,0),e=i}return this.uint32(t)._push(dU,t,e)};Se.prototype.string=function(e){var t=zA.length(e);return t?this.uint32(t)._push(zA.write,t,e):this._push(uv,1,0)};Se.prototype.fork=function(){return this.states=new lU(this),this.head=this.tail=new Kl(lv,0,0),this.len=0,this};Se.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Kl(lv,0,0),this.len=0),this};Se.prototype.ldelim=function(){var e=this.head,t=this.tail,i=this.len;return this.reset().uint32(i),i&&(this.tail.next=e.next,this.tail=t,this.len+=i),this};Se.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),i=0;e;)e.fn(e.val,t,i),i+=e.len,e=e.next;return t};Se._configure=function(n){av=n,Se.create=GA(),av._configure()}});var KA=E((QX,HA)=>{"use strict";HA.exports=Ni;var $A=pf();(Ni.prototype=Object.create($A.prototype)).constructor=Ni;var Qr=Pi();function Ni(){$A.call(this)}Ni._configure=function(){Ni.alloc=Qr._Buffer_allocUnsafe,Ni.writeBytesBuffer=Qr.Buffer&&Qr.Buffer.prototype instanceof Uint8Array&&Qr.Buffer.prototype.set.name==="set"?function(e,t,i){t.set(e,i)}:function(e,t,i){if(e.copy)e.copy(t,i,0,e.length);else for(var r=0;r<e.length;)t[i++]=e[r++]}};Ni.prototype.bytes=function(e){Qr.isString(e)&&(e=Qr._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(Ni.writeBytesBuffer,t,e),this};function hU(n,e,t){n.length<40?Qr.utf8.write(n,e,t):e.utf8Write?e.utf8Write(n,t):e.write(n,t)}Ni.prototype.string=function(e){var t=Qr.Buffer.byteLength(e);return this.uint32(t),t&&this._push(hU,t,e),this};Ni._configure()});var yf=E((YX,JA)=>{"use strict";JA.exports=ut;var Fi=Pi(),mv,XA=Fi.LongBits,fU=Fi.utf8;function li(n,e){return RangeError("index out of range: "+n.pos+" + "+(e||1)+" > "+n.len)}function ut(n){this.buf=n,this.pos=0,this.len=n.length}var QA=typeof Uint8Array<"u"?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new ut(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new ut(e);throw Error("illegal buffer")},ZA=function(){return Fi.Buffer?function(t){return(ut.create=function(r){return Fi.Buffer.isBuffer(r)?new mv(r):QA(r)})(t)}:QA};ut.create=ZA();ut.prototype._slice=Fi.Array.prototype.subarray||Fi.Array.prototype.slice;ut.prototype.uint32=function(){var e=4294967295;return function(){if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,li(this,10);return e}}();ut.prototype.int32=function(){return this.uint32()|0};ut.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(e&1)|0};function fv(){var n=new XA(0,0),e=0;if(this.len-this.pos>4){for(;e<4;++e)if(n.lo=(n.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return n;if(n.lo=(n.lo|(this.buf[this.pos]&127)<<28)>>>0,n.hi=(n.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return n;e=0}else{for(;e<3;++e){if(this.pos>=this.len)throw li(this);if(n.lo=(n.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return n}return n.lo=(n.lo|(this.buf[this.pos++]&127)<<e*7)>>>0,n}if(this.len-this.pos>4){for(;e<5;++e)if(n.hi=(n.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return n}else for(;e<5;++e){if(this.pos>=this.len)throw li(this);if(n.hi=(n.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return n}throw Error("invalid varint encoding")}ut.prototype.bool=function(){return this.uint32()!==0};function gf(n,e){return(n[e-4]|n[e-3]<<8|n[e-2]<<16|n[e-1]<<24)>>>0}ut.prototype.fixed32=function(){if(this.pos+4>this.len)throw li(this,4);return gf(this.buf,this.pos+=4)};ut.prototype.sfixed32=function(){if(this.pos+4>this.len)throw li(this,4);return gf(this.buf,this.pos+=4)|0};function YA(){if(this.pos+8>this.len)throw li(this,8);return new XA(gf(this.buf,this.pos+=4),gf(this.buf,this.pos+=4))}ut.prototype.float=function(){if(this.pos+4>this.len)throw li(this,4);var e=Fi.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e};ut.prototype.double=function(){if(this.pos+8>this.len)throw li(this,4);var e=Fi.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e};ut.prototype.bytes=function(){var e=this.uint32(),t=this.pos,i=this.pos+e;if(i>this.len)throw li(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,i):t===i?new this.buf.constructor(0):this._slice.call(this.buf,t,i)};ut.prototype.string=function(){var e=this.bytes();return fU.read(e,0,e.length)};ut.prototype.skip=function(e){if(typeof e=="number"){if(this.pos+e>this.len)throw li(this,e);this.pos+=e}else do if(this.pos>=this.len)throw li(this);while(this.buf[this.pos++]&128);return this};ut.prototype.skipType=function(n){switch(n){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(n=this.uint32()&7)!==4;)this.skipType(n);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+n+" at offset "+this.pos)}return this};ut._configure=function(n){mv=n,ut.create=ZA(),mv._configure();var e=Fi.Long?"toLong":"toNumber";Fi.merge(ut.prototype,{int64:function(){return fv.call(this)[e](!1)},uint64:function(){return fv.call(this)[e](!0)},sint64:function(){return fv.call(this).zzDecode()[e](!1)},fixed64:function(){return YA.call(this)[e](!0)},sfixed64:function(){return YA.call(this)[e](!1)}})}});var iD=E((XX,nD)=>{"use strict";nD.exports=Xs;var tD=yf();(Xs.prototype=Object.create(tD.prototype)).constructor=Xs;var eD=Pi();function Xs(n){tD.call(this,n)}Xs._configure=function(){eD.Buffer&&(Xs.prototype._slice=eD.Buffer.prototype.slice)};Xs.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))};Xs._configure()});var sD=E((ZX,rD)=>{"use strict";rD.exports=Ql;var pv=Pi();(Ql.prototype=Object.create(pv.EventEmitter.prototype)).constructor=Ql;function Ql(n,e,t){if(typeof n!="function")throw TypeError("rpcImpl must be a function");pv.EventEmitter.call(this),this.rpcImpl=n,this.requestDelimited=!!e,this.responseDelimited=!!t}Ql.prototype.rpcCall=function n(e,t,i,r,s){if(!r)throw TypeError("request must be specified");var o=this;if(!s)return pv.asPromise(n,o,e,t,i,r);if(!o.rpcImpl){setTimeout(function(){s(Error("already ended"))},0);return}try{return o.rpcImpl(e,t[o.requestDelimited?"encodeDelimited":"encode"](r).finish(),function(c,l){if(c)return o.emit("error",c,e),s(c);if(l===null){o.end(!0);return}if(!(l instanceof i))try{l=i[o.responseDelimited?"decodeDelimited":"decode"](l)}catch(u){return o.emit("error",u,e),s(u)}return o.emit("data",l,e),s(null,l)})}catch(a){o.emit("error",a,e),setTimeout(function(){s(a)},0);return}};Ql.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}});var gv=E(oD=>{"use strict";var mU=oD;mU.Service=sD()});var yv=E((eZ,aD)=>{"use strict";aD.exports={}});var uD=E(lD=>{"use strict";var mn=lD;mn.build="minimal";mn.Writer=pf();mn.BufferWriter=KA();mn.Reader=yf();mn.BufferReader=iD();mn.util=Pi();mn.rpc=gv();mn.roots=yv();mn.configure=cD;function cD(){mn.util._configure(),mn.Writer._configure(mn.BufferWriter),mn.Reader._configure(mn.BufferReader)}cD()});var hD=E((nZ,dD)=>{"use strict";dD.exports=bv;function bv(n,e){typeof n=="string"&&(e=n,n=void 0);var t=[];function i(s){if(typeof s!="string"){var o=r();if(bv.verbose&&console.log("codegen: "+o),o="return "+o,s){for(var a=Object.keys(s),c=new Array(a.length+1),l=new Array(a.length),u=0;u<a.length;)c[u]=a[u],l[u]=s[a[u++]];return c[u]=o,Function.apply(null,c).apply(null,l)}return Function(o)()}for(var d=new Array(arguments.length-1),h=0;h<d.length;)d[h]=arguments[++h];if(h=0,s=s.replace(/%([%dfijs])/g,function(g,y){var _=d[h++];switch(y){case"d":case"f":return String(Number(_));case"i":return String(Math.floor(_));case"j":return JSON.stringify(_);case"s":return String(_)}return"%"}),h!==d.length)throw Error("parameter count mismatch");return t.push(s),i}function r(s){return"function "+(s||e||"")+"("+(n&&n.join(",")||"")+`){
  `+t.join(`
  `)+`
}`}return i.toString=r,i}bv.verbose=!1});var mD=E((iZ,fD)=>{"use strict";fD.exports=Yl;var pU=iv(),gU=rv(),vv=gU("fs");function Yl(n,e,t){return typeof e=="function"?(t=e,e={}):e||(e={}),t?!e.xhr&&vv&&vv.readFile?vv.readFile(n,function(r,s){return r&&typeof XMLHttpRequest<"u"?Yl.xhr(n,e,t):r?t(r):t(null,e.binary?s:s.toString("utf8"))}):Yl.xhr(n,e,t):pU(Yl,this,n,e)}Yl.xhr=function(e,t,i){var r=new XMLHttpRequest;r.onreadystatechange=function(){if(r.readyState===4){if(r.status!==0&&r.status!==200)return i(Error("status "+r.status));if(t.binary){var o=r.response;if(!o){o=[];for(var a=0;a<r.responseText.length;++a)o.push(r.responseText.charCodeAt(a)&255)}return i(null,typeof Uint8Array<"u"?new Uint8Array(o):o)}return i(null,r.responseText)}},t.binary&&("overrideMimeType"in r&&r.overrideMimeType("text/plain; charset=x-user-defined"),r.responseType="arraybuffer"),r.open("GET",e),r.send()}});var yD=E(gD=>{"use strict";var wv=gD,pD=wv.isAbsolute=function(e){return/^(?:\/|\w+:)/.test(e)},_v=wv.normalize=function(e){e=e.replace(/\\/g,"/").replace(/\/{2,}/g,"/");var t=e.split("/"),i=pD(e),r="";i&&(r=t.shift()+"/");for(var s=0;s<t.length;)t[s]===".."?s>0&&t[s-1]!==".."?t.splice(--s,2):i?t.splice(s,1):++s:t[s]==="."?t.splice(s,1):++s;return r+t.join("/")};wv.resolve=function(e,t,i){return i||(t=_v(t)),pD(t)?t:(i||(e=_v(e)),(e=e.replace(/(?:\/|^)[^/]+$/,"")).length?_v(e+"/"+t):t)}});var Zs=E(bD=>{"use strict";var Xl=bD,yU=It(),bU=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function Zl(n,e){var t=0,i={};for(e|=0;t<n.length;)i[bU[t+e]]=n[t++];return i}Xl.basic=Zl([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]);Xl.defaults=Zl([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",yU.emptyArray,null]);Xl.long=Zl([0,0,0,1,1],7);Xl.mapKey=Zl([0,0,0,5,5,0,0,0,1,1,0,2],2);Xl.packed=Zl([1,5,0,0,0,5,5,0,0,0,1,1,0])});var Yr=E((oZ,wD)=>{"use strict";wD.exports=Vn;var bf=Js();((Vn.prototype=Object.create(bf.prototype)).constructor=Vn).className="Field";var vD=ui(),_D=Zs(),bt=It(),Cv,vU=/^required|optional|repeated$/;Vn.fromJSON=function(e,t){return new Vn(e,t.id,t.type,t.rule,t.extend,t.options,t.comment)};function Vn(n,e,t,i,r,s,o){if(bt.isObject(i)?(o=r,s=i,i=r=void 0):bt.isObject(r)&&(o=s,s=r,r=void 0),bf.call(this,n,s),!bt.isInteger(e)||e<0)throw TypeError("id must be a non-negative integer");if(!bt.isString(t))throw TypeError("type must be a string");if(i!==void 0&&!vU.test(i=i.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(r!==void 0&&!bt.isString(r))throw TypeError("extend must be a string");i==="proto3_optional"&&(i="optional"),this.rule=i&&i!=="optional"?i:void 0,this.type=t,this.id=e,this.extend=r||void 0,this.required=i==="required",this.optional=!this.required,this.repeated=i==="repeated",this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=bt.Long?_D.long[t]!==void 0:!1,this.bytes=t==="bytes",this.resolvedType=null,this.extensionField=null,this.declaringField=null,this._packed=null,this.comment=o}Object.defineProperty(Vn.prototype,"packed",{get:function(){return this._packed===null&&(this._packed=this.getOption("packed")!==!1),this._packed}});Vn.prototype.setOption=function(e,t,i){return e==="packed"&&(this._packed=null),bf.prototype.setOption.call(this,e,t,i)};Vn.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return bt.toObject(["rule",this.rule!=="optional"&&this.rule||void 0,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])};Vn.prototype.resolve=function(){if(this.resolved)return this;if((this.typeDefault=_D.defaults[this.type])===void 0?(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof Cv?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]):this.options&&this.options.proto3_optional&&(this.typeDefault=null),this.options&&this.options.default!=null&&(this.typeDefault=this.options.default,this.resolvedType instanceof vD&&typeof this.typeDefault=="string"&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&((this.options.packed===!0||this.options.packed!==void 0&&this.resolvedType&&!(this.resolvedType instanceof vD))&&delete this.options.packed,Object.keys(this.options).length||(this.options=void 0)),this.long)this.typeDefault=bt.Long.fromNumber(this.typeDefault,this.type.charAt(0)==="u"),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&typeof this.typeDefault=="string"){var e;bt.base64.test(this.typeDefault)?bt.base64.decode(this.typeDefault,e=bt.newBuffer(bt.base64.length(this.typeDefault)),0):bt.utf8.write(this.typeDefault,e=bt.newBuffer(bt.utf8.length(this.typeDefault)),0),this.typeDefault=e}return this.map?this.defaultValue=bt.emptyObject:this.repeated?this.defaultValue=bt.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof Cv&&(this.parent.ctor.prototype[this.name]=this.defaultValue),bf.prototype.resolve.call(this)};Vn.d=function(e,t,i,r){return typeof t=="function"?t=bt.decorateType(t).name:t&&typeof t=="object"&&(t=bt.decorateEnum(t).name),function(o,a){bt.decorateType(o.constructor).add(new Vn(a,e,t,i,{default:r}))}};Vn._configure=function(e){Cv=e}});var Da=E((aZ,SD)=>{"use strict";SD.exports=Un;var _f=Js();((Un.prototype=Object.create(_f.prototype)).constructor=Un).className="OneOf";var CD=Yr(),vf=It();function Un(n,e,t,i){if(Array.isArray(e)||(t=e,e=void 0),_f.call(this,n,t),!(e===void 0||Array.isArray(e)))throw TypeError("fieldNames must be an Array");this.oneof=e||[],this.fieldsArray=[],this.comment=i}Un.fromJSON=function(e,t){return new Un(e,t.oneof,t.options,t.comment)};Un.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return vf.toObject(["options",this.options,"oneof",this.oneof,"comment",t?this.comment:void 0])};function ED(n){if(n.parent)for(var e=0;e<n.fieldsArray.length;++e)n.fieldsArray[e].parent||n.parent.add(n.fieldsArray[e])}Un.prototype.add=function(e){if(!(e instanceof CD))throw TypeError("field must be a Field");return e.parent&&e.parent!==this.parent&&e.parent.remove(e),this.oneof.push(e.name),this.fieldsArray.push(e),e.partOf=this,ED(this),this};Un.prototype.remove=function(e){if(!(e instanceof CD))throw TypeError("field must be a Field");var t=this.fieldsArray.indexOf(e);if(t<0)throw Error(e+" is not a member of "+this);return this.fieldsArray.splice(t,1),t=this.oneof.indexOf(e.name),t>-1&&this.oneof.splice(t,1),e.partOf=null,this};Un.prototype.onAdd=function(e){_f.prototype.onAdd.call(this,e);for(var t=this,i=0;i<this.oneof.length;++i){var r=e.get(this.oneof[i]);r&&!r.partOf&&(r.partOf=t,t.fieldsArray.push(r))}ED(this)};Un.prototype.onRemove=function(e){for(var t=0,i;t<this.fieldsArray.length;++t)(i=this.fieldsArray[t]).parent&&i.parent.remove(i);_f.prototype.onRemove.call(this,e)};Un.d=function(){for(var e=new Array(arguments.length),t=0;t<arguments.length;)e[t]=arguments[t++];return function(r,s){vf.decorateType(r.constructor).add(new Un(s,e)),Object.defineProperty(r,s,{get:vf.oneOfGetter(e),set:vf.oneOfSetter(e)})}}});var Ma=E((cZ,AD)=>{"use strict";AD.exports=xe;var Ev=Js();((xe.prototype=Object.create(Ev.prototype)).constructor=xe).className="Namespace";var TD=Yr(),wf=It(),_U=Da(),ka,Jl,Ra;xe.fromJSON=function(e,t){return new xe(e,t.options).addJSON(t.nested)};function xD(n,e){if(n&&n.length){for(var t={},i=0;i<n.length;++i)t[n[i].name]=n[i].toJSON(e);return t}}xe.arrayToJSON=xD;xe.isReservedId=function(e,t){if(e){for(var i=0;i<e.length;++i)if(typeof e[i]!="string"&&e[i][0]<=t&&e[i][1]>t)return!0}return!1};xe.isReservedName=function(e,t){if(e){for(var i=0;i<e.length;++i)if(e[i]===t)return!0}return!1};function xe(n,e){Ev.call(this,n,e),this.nested=void 0,this._nestedArray=null}function ID(n){return n._nestedArray=null,n}Object.defineProperty(xe.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=wf.toArray(this.nested))}});xe.prototype.toJSON=function(e){return wf.toObject(["options",this.options,"nested",xD(this.nestedArray,e)])};xe.prototype.addJSON=function(e){var t=this;if(e)for(var i=Object.keys(e),r=0,s;r<i.length;++r)s=e[i[r]],t.add((s.fields!==void 0?ka.fromJSON:s.values!==void 0?Ra.fromJSON:s.methods!==void 0?Jl.fromJSON:s.id!==void 0?TD.fromJSON:xe.fromJSON)(i[r],s));return this};xe.prototype.get=function(e){return this.nested&&this.nested[e]||null};xe.prototype.getEnum=function(e){if(this.nested&&this.nested[e]instanceof Ra)return this.nested[e].values;throw Error("no such enum: "+e)};xe.prototype.add=function(e){if(!(e instanceof TD&&e.extend!==void 0||e instanceof ka||e instanceof _U||e instanceof Ra||e instanceof Jl||e instanceof xe))throw TypeError("object must be a valid nested object");if(!this.nested)this.nested={};else{var t=this.get(e.name);if(t)if(t instanceof xe&&e instanceof xe&&!(t instanceof ka||t instanceof Jl)){for(var i=t.nestedArray,r=0;r<i.length;++r)e.add(i[r]);this.remove(t),this.nested||(this.nested={}),e.setOptions(t.options,!0)}else throw Error("duplicate name '"+e.name+"' in "+this)}return this.nested[e.name]=e,e.onAdd(this),ID(this)};xe.prototype.remove=function(e){if(!(e instanceof Ev))throw TypeError("object must be a ReflectionObject");if(e.parent!==this)throw Error(e+" is not a member of "+this);return delete this.nested[e.name],Object.keys(this.nested).length||(this.nested=void 0),e.onRemove(this),ID(this)};xe.prototype.define=function(e,t){if(wf.isString(e))e=e.split(".");else if(!Array.isArray(e))throw TypeError("illegal path");if(e&&e.length&&e[0]==="")throw Error("path must be relative");for(var i=this;e.length>0;){var r=e.shift();if(i.nested&&i.nested[r]){if(i=i.nested[r],!(i instanceof xe))throw Error("path conflicts with non-namespace objects")}else i.add(i=new xe(r))}return t&&i.addJSON(t),i};xe.prototype.resolveAll=function(){for(var e=this.nestedArray,t=0;t<e.length;)e[t]instanceof xe?e[t++].resolveAll():e[t++].resolve();return this.resolve()};xe.prototype.lookup=function(e,t,i){if(typeof t=="boolean"?(i=t,t=void 0):t&&!Array.isArray(t)&&(t=[t]),wf.isString(e)&&e.length){if(e===".")return this.root;e=e.split(".")}else if(!e.length)return this;if(e[0]==="")return this.root.lookup(e.slice(1),t);var r=this.get(e[0]);if(r){if(e.length===1){if(!t||t.indexOf(r.constructor)>-1)return r}else if(r instanceof xe&&(r=r.lookup(e.slice(1),t,!0)))return r}else for(var s=0;s<this.nestedArray.length;++s)if(this._nestedArray[s]instanceof xe&&(r=this._nestedArray[s].lookup(e,t,!0)))return r;return this.parent===null||i?null:this.parent.lookup(e,t)};xe.prototype.lookupType=function(e){var t=this.lookup(e,[ka]);if(!t)throw Error("no such type: "+e);return t};xe.prototype.lookupEnum=function(e){var t=this.lookup(e,[Ra]);if(!t)throw Error("no such Enum '"+e+"' in "+this);return t};xe.prototype.lookupTypeOrEnum=function(e){var t=this.lookup(e,[ka,Ra]);if(!t)throw Error("no such Type or Enum '"+e+"' in "+this);return t};xe.prototype.lookupService=function(e){var t=this.lookup(e,[Jl]);if(!t)throw Error("no such Service '"+e+"' in "+this);return t};xe._configure=function(n,e,t){ka=n,Jl=e,Ra=t}});var Cf=E((lZ,DD)=>{"use strict";DD.exports=mr;var Sv=Yr();((mr.prototype=Object.create(Sv.prototype)).constructor=mr).className="MapField";var wU=Zs(),eu=It();function mr(n,e,t,i,r,s){if(Sv.call(this,n,e,i,void 0,void 0,r,s),!eu.isString(t))throw TypeError("keyType must be a string");this.keyType=t,this.resolvedKeyType=null,this.map=!0}mr.fromJSON=function(e,t){return new mr(e,t.id,t.keyType,t.type,t.options,t.comment)};mr.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return eu.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])};mr.prototype.resolve=function(){if(this.resolved)return this;if(wU.mapKey[this.keyType]===void 0)throw Error("invalid key type: "+this.keyType);return Sv.prototype.resolve.call(this)};mr.d=function(e,t,i){return typeof i=="function"?i=eu.decorateType(i).name:i&&typeof i=="object"&&(i=eu.decorateEnum(i).name),function(s,o){eu.decorateType(s.constructor).add(new mr(o,e,t,i))}}});var Ef=E((uZ,kD)=>{"use strict";kD.exports=eo;var Tv=Js();((eo.prototype=Object.create(Tv.prototype)).constructor=eo).className="Method";var Oa=It();function eo(n,e,t,i,r,s,o,a,c){if(Oa.isObject(r)?(o=r,r=s=void 0):Oa.isObject(s)&&(o=s,s=void 0),!(e===void 0||Oa.isString(e)))throw TypeError("type must be a string");if(!Oa.isString(t))throw TypeError("requestType must be a string");if(!Oa.isString(i))throw TypeError("responseType must be a string");Tv.call(this,n,o),this.type=e||"rpc",this.requestType=t,this.requestStream=r?!0:void 0,this.responseType=i,this.responseStream=s?!0:void 0,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=a,this.parsedOptions=c}eo.fromJSON=function(e,t){return new eo(e,t.type,t.requestType,t.responseType,t.requestStream,t.responseStream,t.options,t.comment,t.parsedOptions)};eo.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return Oa.toObject(["type",this.type!=="rpc"&&this.type||void 0,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",t?this.comment:void 0,"parsedOptions",this.parsedOptions])};eo.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),Tv.prototype.resolve.call(this))}});var Sf=E((dZ,MD)=>{"use strict";MD.exports=jn;var Xr=Ma();((jn.prototype=Object.create(Xr.prototype)).constructor=jn).className="Service";var xv=Ef(),tu=It(),CU=gv();function jn(n,e){Xr.call(this,n,e),this.methods={},this._methodsArray=null}jn.fromJSON=function(e,t){var i=new jn(e,t.options);if(t.methods)for(var r=Object.keys(t.methods),s=0;s<r.length;++s)i.add(xv.fromJSON(r[s],t.methods[r[s]]));return t.nested&&i.addJSON(t.nested),i.comment=t.comment,i};jn.prototype.toJSON=function(e){var t=Xr.prototype.toJSON.call(this,e),i=e?!!e.keepComments:!1;return tu.toObject(["options",t&&t.options||void 0,"methods",Xr.arrayToJSON(this.methodsArray,e)||{},"nested",t&&t.nested||void 0,"comment",i?this.comment:void 0])};Object.defineProperty(jn.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=tu.toArray(this.methods))}});function RD(n){return n._methodsArray=null,n}jn.prototype.get=function(e){return this.methods[e]||Xr.prototype.get.call(this,e)};jn.prototype.resolveAll=function(){for(var e=this.methodsArray,t=0;t<e.length;++t)e[t].resolve();return Xr.prototype.resolve.call(this)};jn.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);return e instanceof xv?(this.methods[e.name]=e,e.parent=this,RD(this)):Xr.prototype.add.call(this,e)};jn.prototype.remove=function(e){if(e instanceof xv){if(this.methods[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.methods[e.name],e.parent=null,RD(this)}return Xr.prototype.remove.call(this,e)};jn.prototype.create=function(e,t,i){for(var r=new CU.Service(e,t,i),s=0,o;s<this.methodsArray.length;++s){var a=tu.lcFirst((o=this._methodsArray[s]).resolve().name).replace(/[^$\w_]/g,"");r[a]=tu.codegen(["r","c"],tu.isReserved(a)?a+"_":a)("return this.rpcCall(m,q,s,r,c)")({m:o,q:o.resolvedRequestType.ctor,s:o.resolvedResponseType.ctor})}return r}});var Tf=E((hZ,OD)=>{"use strict";OD.exports=Li;var EU=Pi();function Li(n){if(n)for(var e=Object.keys(n),t=0;t<e.length;++t)this[e[t]]=n[e[t]]}Li.create=function(e){return this.$type.create(e)};Li.encode=function(e,t){return this.$type.encode(e,t)};Li.encodeDelimited=function(e,t){return this.$type.encodeDelimited(e,t)};Li.decode=function(e){return this.$type.decode(e)};Li.decodeDelimited=function(e){return this.$type.decodeDelimited(e)};Li.verify=function(e){return this.$type.verify(e)};Li.fromObject=function(e){return this.$type.fromObject(e)};Li.toObject=function(e,t){return this.$type.toObject(e,t)};Li.prototype.toJSON=function(){return this.$type.toObject(this,EU.toJSONOptions)}});var Iv=E((fZ,ND)=>{"use strict";ND.exports=xU;var SU=ui(),pr=Zs(),PD=It();function TU(n){return"missing required '"+n.name+"'"}function xU(n){var e=PD.codegen(["r","l"],n.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(n.fieldsArray.filter(function(a){return a.map}).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()");n.group&&e("if((t&7)===4)")("break"),e("switch(t>>>3){");for(var t=0;t<n.fieldsArray.length;++t){var i=n._fieldsArray[t].resolve(),r=i.resolvedType instanceof SU?"int32":i.type,s="m"+PD.safeProp(i.name);e("case %i: {",i.id),i.map?(e("if(%s===util.emptyObject)",s)("%s={}",s)("var c2 = r.uint32()+r.pos"),pr.defaults[i.keyType]!==void 0?e("k=%j",pr.defaults[i.keyType]):e("k=null"),pr.defaults[r]!==void 0?e("value=%j",pr.defaults[r]):e("value=null"),e("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",i.keyType)("case 2:"),pr.basic[r]===void 0?e("value=types[%i].decode(r,r.uint32())",t):e("value=r.%s()",r),e("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),pr.long[i.keyType]!==void 0?e('%s[typeof k==="object"?util.longToHash(k):k]=value',s):e("%s[k]=value",s)):i.repeated?(e("if(!(%s&&%s.length))",s,s)("%s=[]",s),pr.packed[r]!==void 0&&e("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",s,r)("}else"),pr.basic[r]===void 0?e(i.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",s,t):e("%s.push(r.%s())",s,r)):pr.basic[r]===void 0?e(i.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",s,t):e("%s=r.%s()",s,r),e("break")("}")}for(e("default:")("r.skipType(t&7)")("break")("}")("}"),t=0;t<n._fieldsArray.length;++t){var o=n._fieldsArray[t];o.required&&e("if(!m.hasOwnProperty(%j))",o.name)("throw util.ProtocolError(%j,{instance:m})",TU(o))}return e("return m")}});var kv=E((mZ,FD)=>{"use strict";FD.exports=DU;var IU=ui(),Av=It();function qn(n,e){return n.name+": "+e+(n.repeated&&e!=="array"?"[]":n.map&&e!=="object"?"{k:"+n.keyType+"}":"")+" expected"}function Dv(n,e,t,i){if(e.resolvedType)if(e.resolvedType instanceof IU){n("switch(%s){",i)("default:")("return%j",qn(e,"enum value"));for(var r=Object.keys(e.resolvedType.values),s=0;s<r.length;++s)n("case %i:",e.resolvedType.values[r[s]]);n("break")("}")}else n("{")("var e=types[%i].verify(%s);",t,i)("if(e)")("return%j+e",e.name+".")("}");else switch(e.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":n("if(!util.isInteger(%s))",i)("return%j",qn(e,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":n("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",i,i,i,i)("return%j",qn(e,"integer|Long"));break;case"float":case"double":n('if(typeof %s!=="number")',i)("return%j",qn(e,"number"));break;case"bool":n('if(typeof %s!=="boolean")',i)("return%j",qn(e,"boolean"));break;case"string":n("if(!util.isString(%s))",i)("return%j",qn(e,"string"));break;case"bytes":n('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',i,i,i)("return%j",qn(e,"buffer"));break}return n}function AU(n,e,t){switch(e.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":n("if(!util.key32Re.test(%s))",t)("return%j",qn(e,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":n("if(!util.key64Re.test(%s))",t)("return%j",qn(e,"integer|Long key"));break;case"bool":n("if(!util.key2Re.test(%s))",t)("return%j",qn(e,"boolean key"));break}return n}function DU(n){var e=Av.codegen(["m"],n.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),t=n.oneofsArray,i={};t.length&&e("var p={}");for(var r=0;r<n.fieldsArray.length;++r){var s=n._fieldsArray[r].resolve(),o="m"+Av.safeProp(s.name);if(s.optional&&e("if(%s!=null&&m.hasOwnProperty(%j)){",o,s.name),s.map)e("if(!util.isObject(%s))",o)("return%j",qn(s,"object"))("var k=Object.keys(%s)",o)("for(var i=0;i<k.length;++i){"),AU(e,s,"k[i]"),Dv(e,s,r,o+"[k[i]]")("}");else if(s.repeated)e("if(!Array.isArray(%s))",o)("return%j",qn(s,"array"))("for(var i=0;i<%s.length;++i){",o),Dv(e,s,r,o+"[i]")("}");else{if(s.partOf){var a=Av.safeProp(s.partOf.name);i[s.partOf.name]===1&&e("if(p%s===1)",a)("return%j",s.partOf.name+": multiple values"),i[s.partOf.name]=1,e("p%s=1",a)}Dv(e,s,r,o)}s.optional&&e("}")}return e("return null")}});var Ov=E(BD=>{"use strict";var LD=BD,nu=ui(),Bi=It();function Rv(n,e,t,i){var r=!1;if(e.resolvedType)if(e.resolvedType instanceof nu){n("switch(d%s){",i);for(var s=e.resolvedType.values,o=Object.keys(s),a=0;a<o.length;++a)s[o[a]]===e.typeDefault&&!r&&(n("default:")('if(typeof(d%s)==="number"){m%s=d%s;break}',i,i,i),e.repeated||n("break"),r=!0),n("case%j:",o[a])("case %i:",s[o[a]])("m%s=%j",i,s[o[a]])("break");n("}")}else n('if(typeof d%s!=="object")',i)("throw TypeError(%j)",e.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",i,t,i);else{var c=!1;switch(e.type){case"double":case"float":n("m%s=Number(d%s)",i,i);break;case"uint32":case"fixed32":n("m%s=d%s>>>0",i,i);break;case"int32":case"sint32":case"sfixed32":n("m%s=d%s|0",i,i);break;case"uint64":c=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":n("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",i,i,c)('else if(typeof d%s==="string")',i)("m%s=parseInt(d%s,10)",i,i)('else if(typeof d%s==="number")',i)("m%s=d%s",i,i)('else if(typeof d%s==="object")',i)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",i,i,i,c?"true":"");break;case"bytes":n('if(typeof d%s==="string")',i)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",i,i,i)("else if(d%s.length >= 0)",i)("m%s=d%s",i,i);break;case"string":n("m%s=String(d%s)",i,i);break;case"bool":n("m%s=Boolean(d%s)",i,i);break}}return n}LD.fromObject=function(e){var t=e.fieldsArray,i=Bi.codegen(["d"],e.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!t.length)return i("return new this.ctor");i("var m=new this.ctor");for(var r=0;r<t.length;++r){var s=t[r].resolve(),o=Bi.safeProp(s.name);s.map?(i("if(d%s){",o)('if(typeof d%s!=="object")',o)("throw TypeError(%j)",s.fullName+": object expected")("m%s={}",o)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",o),Rv(i,s,r,o+"[ks[i]]")("}")("}")):s.repeated?(i("if(d%s){",o)("if(!Array.isArray(d%s))",o)("throw TypeError(%j)",s.fullName+": array expected")("m%s=[]",o)("for(var i=0;i<d%s.length;++i){",o),Rv(i,s,r,o+"[i]")("}")("}")):(s.resolvedType instanceof nu||i("if(d%s!=null){",o),Rv(i,s,r,o),s.resolvedType instanceof nu||i("}"))}return i("return m")};function Mv(n,e,t,i){if(e.resolvedType)e.resolvedType instanceof nu?n("d%s=o.enums===String?(types[%i].values[m%s]===undefined?m%s:types[%i].values[m%s]):m%s",i,t,i,i,t,i,i):n("d%s=types[%i].toObject(m%s,o)",i,t,i);else{var r=!1;switch(e.type){case"double":case"float":n("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",i,i,i,i);break;case"uint64":r=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":n('if(typeof m%s==="number")',i)("d%s=o.longs===String?String(m%s):m%s",i,i,i)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",i,i,i,i,r?"true":"",i);break;case"bytes":n("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",i,i,i,i,i);break;default:n("d%s=m%s",i,i);break}}return n}LD.toObject=function(e){var t=e.fieldsArray.slice().sort(Bi.compareFieldsById);if(!t.length)return Bi.codegen()("return {}");for(var i=Bi.codegen(["m","o"],e.name+"$toObject")("if(!o)")("o={}")("var d={}"),r=[],s=[],o=[],a=0;a<t.length;++a)t[a].partOf||(t[a].resolve().repeated?r:t[a].map?s:o).push(t[a]);if(r.length){for(i("if(o.arrays||o.defaults){"),a=0;a<r.length;++a)i("d%s=[]",Bi.safeProp(r[a].name));i("}")}if(s.length){for(i("if(o.objects||o.defaults){"),a=0;a<s.length;++a)i("d%s={}",Bi.safeProp(s[a].name));i("}")}if(o.length){for(i("if(o.defaults){"),a=0;a<o.length;++a){var c=o[a],l=Bi.safeProp(c.name);if(c.resolvedType instanceof nu)i("d%s=o.enums===String?%j:%j",l,c.resolvedType.valuesById[c.typeDefault],c.typeDefault);else if(c.long)i("if(util.Long){")("var n=new util.Long(%i,%i,%j)",c.typeDefault.low,c.typeDefault.high,c.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",l)("}else")("d%s=o.longs===String?%j:%i",l,c.typeDefault.toString(),c.typeDefault.toNumber());else if(c.bytes){var u="["+Array.prototype.slice.call(c.typeDefault).join(",")+"]";i("if(o.bytes===String)d%s=%j",l,String.fromCharCode.apply(String,c.typeDefault))("else{")("d%s=%s",l,u)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",l,l)("}")}else i("d%s=%j",l,c.typeDefault)}i("}")}var d=!1;for(a=0;a<t.length;++a){var c=t[a],h=e._fieldsArray.indexOf(c),l=Bi.safeProp(c.name);c.map?(d||(d=!0,i("var ks2")),i("if(m%s&&(ks2=Object.keys(m%s)).length){",l,l)("d%s={}",l)("for(var j=0;j<ks2.length;++j){"),Mv(i,c,h,l+"[ks2[j]]")("}")):c.repeated?(i("if(m%s&&m%s.length){",l,l)("d%s=[]",l)("for(var j=0;j<m%s.length;++j){",l),Mv(i,c,h,l+"[j]")("}")):(i("if(m%s!=null&&m.hasOwnProperty(%j)){",l,c.name),Mv(i,c,h,l),c.partOf&&i("if(o.oneofs)")("d%s=%j",Bi.safeProp(c.partOf.name),c.name)),i("}")}return i("return d")}});var Pv=E(VD=>{"use strict";var kU=VD,RU=Tf();kU[".google.protobuf.Any"]={fromObject:function(n){if(n&&n["@type"]){var e=n["@type"].substring(n["@type"].lastIndexOf("/")+1),t=this.lookup(e);if(t){var i=n["@type"].charAt(0)==="."?n["@type"].slice(1):n["@type"];return i.indexOf("/")===-1&&(i="/"+i),this.create({type_url:i,value:t.encode(t.fromObject(n)).finish()})}}return this.fromObject(n)},toObject:function(n,e){var t="type.googleapis.com/",i="",r="";if(e&&e.json&&n.type_url&&n.value){r=n.type_url.substring(n.type_url.lastIndexOf("/")+1),i=n.type_url.substring(0,n.type_url.lastIndexOf("/")+1);var s=this.lookup(r);s&&(n=s.decode(n.value))}if(!(n instanceof this.ctor)&&n instanceof RU){var o=n.$type.toObject(n,e),a=n.$type.fullName[0]==="."?n.$type.fullName.slice(1):n.$type.fullName;return i===""&&(i=t),r=i+a,o["@type"]=r,o}return this.toObject(n,e)}}});var Af=E((yZ,jD)=>{"use strict";jD.exports=Le;var di=Ma();((Le.prototype=Object.create(di.prototype)).constructor=Le).className="Type";var MU=ui(),Lv=Da(),xf=Yr(),OU=Cf(),PU=Sf(),Nv=Tf(),Fv=yf(),NU=pf(),Gt=It(),FU=Bv(),LU=Iv(),BU=kv(),UD=Ov(),VU=Pv();function Le(n,e){di.call(this,n,e),this.fields={},this.oneofs=void 0,this.extensions=void 0,this.reserved=void 0,this.group=void 0,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}Object.defineProperties(Le.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var n=Object.keys(this.fields),e=0;e<n.length;++e){var t=this.fields[n[e]],i=t.id;if(this._fieldsById[i])throw Error("duplicate id "+i+" in "+this);this._fieldsById[i]=t}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=Gt.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=Gt.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=Le.generateConstructor(this)())},set:function(n){var e=n.prototype;e instanceof Nv||((n.prototype=new Nv).constructor=n,Gt.merge(n.prototype,e)),n.$type=n.prototype.$type=this,Gt.merge(n,Nv,!0),this._ctor=n;for(var t=0;t<this.fieldsArray.length;++t)this._fieldsArray[t].resolve();var i={};for(t=0;t<this.oneofsArray.length;++t)i[this._oneofsArray[t].resolve().name]={get:Gt.oneOfGetter(this._oneofsArray[t].oneof),set:Gt.oneOfSetter(this._oneofsArray[t].oneof)};t&&Object.defineProperties(n.prototype,i)}}});Le.generateConstructor=function(e){for(var t=Gt.codegen(["p"],e.name),i=0,r;i<e.fieldsArray.length;++i)(r=e._fieldsArray[i]).map?t("this%s={}",Gt.safeProp(r.name)):r.repeated&&t("this%s=[]",Gt.safeProp(r.name));return t("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")};function If(n){return n._fieldsById=n._fieldsArray=n._oneofsArray=null,delete n.encode,delete n.decode,delete n.verify,n}Le.fromJSON=function(e,t){var i=new Le(e,t.options);i.extensions=t.extensions,i.reserved=t.reserved;for(var r=Object.keys(t.fields),s=0;s<r.length;++s)i.add((typeof t.fields[r[s]].keyType<"u"?OU.fromJSON:xf.fromJSON)(r[s],t.fields[r[s]]));if(t.oneofs)for(r=Object.keys(t.oneofs),s=0;s<r.length;++s)i.add(Lv.fromJSON(r[s],t.oneofs[r[s]]));if(t.nested)for(r=Object.keys(t.nested),s=0;s<r.length;++s){var o=t.nested[r[s]];i.add((o.id!==void 0?xf.fromJSON:o.fields!==void 0?Le.fromJSON:o.values!==void 0?MU.fromJSON:o.methods!==void 0?PU.fromJSON:di.fromJSON)(r[s],o))}return t.extensions&&t.extensions.length&&(i.extensions=t.extensions),t.reserved&&t.reserved.length&&(i.reserved=t.reserved),t.group&&(i.group=!0),t.comment&&(i.comment=t.comment),i};Le.prototype.toJSON=function(e){var t=di.prototype.toJSON.call(this,e),i=e?!!e.keepComments:!1;return Gt.toObject(["options",t&&t.options||void 0,"oneofs",di.arrayToJSON(this.oneofsArray,e),"fields",di.arrayToJSON(this.fieldsArray.filter(function(r){return!r.declaringField}),e)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:void 0,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"group",this.group||void 0,"nested",t&&t.nested||void 0,"comment",i?this.comment:void 0])};Le.prototype.resolveAll=function(){for(var e=this.fieldsArray,t=0;t<e.length;)e[t++].resolve();var i=this.oneofsArray;for(t=0;t<i.length;)i[t++].resolve();return di.prototype.resolveAll.call(this)};Le.prototype.get=function(e){return this.fields[e]||this.oneofs&&this.oneofs[e]||this.nested&&this.nested[e]||null};Le.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);if(e instanceof xf&&e.extend===void 0){if(this._fieldsById?this._fieldsById[e.id]:this.fieldsById[e.id])throw Error("duplicate id "+e.id+" in "+this);if(this.isReservedId(e.id))throw Error("id "+e.id+" is reserved in "+this);if(this.isReservedName(e.name))throw Error("name '"+e.name+"' is reserved in "+this);return e.parent&&e.parent.remove(e),this.fields[e.name]=e,e.message=this,e.onAdd(this),If(this)}return e instanceof Lv?(this.oneofs||(this.oneofs={}),this.oneofs[e.name]=e,e.onAdd(this),If(this)):di.prototype.add.call(this,e)};Le.prototype.remove=function(e){if(e instanceof xf&&e.extend===void 0){if(!this.fields||this.fields[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.fields[e.name],e.parent=null,e.onRemove(this),If(this)}if(e instanceof Lv){if(!this.oneofs||this.oneofs[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.oneofs[e.name],e.parent=null,e.onRemove(this),If(this)}return di.prototype.remove.call(this,e)};Le.prototype.isReservedId=function(e){return di.isReservedId(this.reserved,e)};Le.prototype.isReservedName=function(e){return di.isReservedName(this.reserved,e)};Le.prototype.create=function(e){return new this.ctor(e)};Le.prototype.setup=function(){for(var e=this.fullName,t=[],i=0;i<this.fieldsArray.length;++i)t.push(this._fieldsArray[i].resolve().resolvedType);this.encode=FU(this)({Writer:NU,types:t,util:Gt}),this.decode=LU(this)({Reader:Fv,types:t,util:Gt}),this.verify=BU(this)({types:t,util:Gt}),this.fromObject=UD.fromObject(this)({types:t,util:Gt}),this.toObject=UD.toObject(this)({types:t,util:Gt});var r=VU[e];if(r){var s=Object.create(this);s.fromObject=this.fromObject,this.fromObject=r.fromObject.bind(s),s.toObject=this.toObject,this.toObject=r.toObject.bind(s)}return this};Le.prototype.encode=function(e,t){return this.setup().encode(e,t)};Le.prototype.encodeDelimited=function(e,t){return this.encode(e,t&&t.len?t.fork():t).ldelim()};Le.prototype.decode=function(e,t){return this.setup().decode(e,t)};Le.prototype.decodeDelimited=function(e){return e instanceof Fv||(e=Fv.create(e)),this.decode(e,e.uint32())};Le.prototype.verify=function(e){return this.setup().verify(e)};Le.prototype.fromObject=function(e){return this.setup().fromObject(e)};Le.prototype.toObject=function(e,t){return this.setup().toObject(e,t)};Le.d=function(e){return function(i){Gt.decorateType(i,e)}}});var Rf=E((bZ,$D)=>{"use strict";$D.exports=wn;var kf=Ma();((wn.prototype=Object.create(kf.prototype)).constructor=wn).className="Root";var Uv=Yr(),zD=ui(),UU=Da(),Zr=It(),GD,Vv,iu;function wn(n){kf.call(this,"",n),this.deferred=[],this.files=[]}wn.fromJSON=function(e,t){return t||(t=new wn),e.options&&t.setOptions(e.options),t.addJSON(e.nested)};wn.prototype.resolvePath=Zr.path.resolve;wn.prototype.fetch=Zr.fetch;function WD(){}wn.prototype.load=function n(e,t,i){typeof t=="function"&&(i=t,t=void 0);var r=this;if(!i)return Zr.asPromise(n,r,e,t);var s=i===WD;function o(m,g){if(i){var y=i;if(i=null,s)throw m;y(m,g)}}function a(m){var g=m.lastIndexOf("google/protobuf/");if(g>-1){var y=m.substring(g);if(y in iu)return y}return null}function c(m,g){try{if(Zr.isString(g)&&g.charAt(0)==="{"&&(g=JSON.parse(g)),!Zr.isString(g))r.setOptions(g.options).addJSON(g.nested);else{Vv.filename=m;var y=Vv(g,r,t),_,M=0;if(y.imports)for(;M<y.imports.length;++M)(_=a(y.imports[M])||r.resolvePath(m,y.imports[M]))&&l(_);if(y.weakImports)for(M=0;M<y.weakImports.length;++M)(_=a(y.weakImports[M])||r.resolvePath(m,y.weakImports[M]))&&l(_,!0)}}catch(T){o(T)}!s&&!u&&o(null,r)}function l(m,g){if(m=a(m)||m,!(r.files.indexOf(m)>-1)){if(r.files.push(m),m in iu){s?c(m,iu[m]):(++u,setTimeout(function(){--u,c(m,iu[m])}));return}if(s){var y;try{y=Zr.fs.readFileSync(m).toString("utf8")}catch(_){g||o(_);return}c(m,y)}else++u,r.fetch(m,function(_,M){if(--u,!!i){if(_){g?u||o(null,r):o(_);return}c(m,M)}})}}var u=0;Zr.isString(e)&&(e=[e]);for(var d=0,h;d<e.length;++d)(h=r.resolvePath("",e[d]))&&l(h);if(s)return r;u||o(null,r)};wn.prototype.loadSync=function(e,t){if(!Zr.isNode)throw Error("not supported");return this.load(e,t,WD)};wn.prototype.resolveAll=function(){if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map(function(e){return"'extend "+e.extend+"' in "+e.parent.fullName}).join(", "));return kf.prototype.resolveAll.call(this)};var Df=/^[A-Z]/;function qD(n,e){var t=e.parent.lookup(e.extend);if(t){var i=new Uv(e.fullName,e.id,e.type,e.rule,void 0,e.options);return t.get(i.name)||(i.declaringField=e,e.extensionField=i,t.add(i)),!0}return!1}wn.prototype._handleAdd=function(e){if(e instanceof Uv)e.extend!==void 0&&!e.extensionField&&(qD(this,e)||this.deferred.push(e));else if(e instanceof zD)Df.test(e.name)&&(e.parent[e.name]=e.values);else if(!(e instanceof UU)){if(e instanceof GD)for(var t=0;t<this.deferred.length;)qD(this,this.deferred[t])?this.deferred.splice(t,1):++t;for(var i=0;i<e.nestedArray.length;++i)this._handleAdd(e._nestedArray[i]);Df.test(e.name)&&(e.parent[e.name]=e)}};wn.prototype._handleRemove=function(e){if(e instanceof Uv){if(e.extend!==void 0)if(e.extensionField)e.extensionField.parent.remove(e.extensionField),e.extensionField=null;else{var t=this.deferred.indexOf(e);t>-1&&this.deferred.splice(t,1)}}else if(e instanceof zD)Df.test(e.name)&&delete e.parent[e.name];else if(e instanceof kf){for(var i=0;i<e.nestedArray.length;++i)this._handleRemove(e._nestedArray[i]);Df.test(e.name)&&delete e.parent[e.name]}};wn._configure=function(n,e,t){GD=n,Vv=e,iu=t}});var It=E((vZ,KD)=>{"use strict";var dt=KD.exports=Pi(),HD=yv(),jv,qv;dt.codegen=hD();dt.fetch=mD();dt.path=yD();dt.fs=dt.inquire("fs");dt.toArray=function(e){if(e){for(var t=Object.keys(e),i=new Array(t.length),r=0;r<t.length;)i[r]=e[t[r++]];return i}return[]};dt.toObject=function(e){for(var t={},i=0;i<e.length;){var r=e[i++],s=e[i++];s!==void 0&&(t[r]=s)}return t};var jU=/\\/g,qU=/"/g;dt.isReserved=function(e){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(e)};dt.safeProp=function(e){return!/^[$\w_]+$/.test(e)||dt.isReserved(e)?'["'+e.replace(jU,"\\\\").replace(qU,'\\"')+'"]':"."+e};dt.ucFirst=function(e){return e.charAt(0).toUpperCase()+e.substring(1)};var zU=/_([a-z])/g;dt.camelCase=function(e){return e.substring(0,1)+e.substring(1).replace(zU,function(t,i){return i.toUpperCase()})};dt.compareFieldsById=function(e,t){return e.id-t.id};dt.decorateType=function(e,t){if(e.$type)return t&&e.$type.name!==t&&(dt.decorateRoot.remove(e.$type),e.$type.name=t,dt.decorateRoot.add(e.$type)),e.$type;jv||(jv=Af());var i=new jv(t||e.name);return dt.decorateRoot.add(i),i.ctor=e,Object.defineProperty(e,"$type",{value:i,enumerable:!1}),Object.defineProperty(e.prototype,"$type",{value:i,enumerable:!1}),i};var GU=0;dt.decorateEnum=function(e){if(e.$type)return e.$type;qv||(qv=ui());var t=new qv("Enum"+GU++,e);return dt.decorateRoot.add(t),Object.defineProperty(e,"$type",{value:t,enumerable:!1}),t};dt.setProperty=function(e,t,i){function r(s,o,a){var c=o.shift();if(c==="__proto__"||c==="prototype")return s;if(o.length>0)s[c]=r(s[c]||{},o,a);else{var l=s[c];l&&(a=[].concat(l).concat(a)),s[c]=a}return s}if(typeof e!="object")throw TypeError("dst must be an object");if(!t)throw TypeError("path must be specified");return t=t.split("."),r(e,t,i)};Object.defineProperty(dt,"decorateRoot",{get:function(){return HD.decorated||(HD.decorated=new(Rf()))}})});var Js=E((_Z,QD)=>{"use strict";QD.exports=Cn;Cn.className="ReflectionObject";var Mf=It(),Of;function Cn(n,e){if(!Mf.isString(n))throw TypeError("name must be a string");if(e&&!Mf.isObject(e))throw TypeError("options must be an object");this.options=e,this.parsedOptions=null,this.name=n,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}Object.defineProperties(Cn.prototype,{root:{get:function(){for(var n=this;n.parent!==null;)n=n.parent;return n}},fullName:{get:function(){for(var n=[this.name],e=this.parent;e;)n.unshift(e.name),e=e.parent;return n.join(".")}}});Cn.prototype.toJSON=function(){throw Error()};Cn.prototype.onAdd=function(e){this.parent&&this.parent!==e&&this.parent.remove(this),this.parent=e,this.resolved=!1;var t=e.root;t instanceof Of&&t._handleAdd(this)};Cn.prototype.onRemove=function(e){var t=e.root;t instanceof Of&&t._handleRemove(this),this.parent=null,this.resolved=!1};Cn.prototype.resolve=function(){return this.resolved?this:(this.root instanceof Of&&(this.resolved=!0),this)};Cn.prototype.getOption=function(e){if(this.options)return this.options[e]};Cn.prototype.setOption=function(e,t,i){return(!i||!this.options||this.options[e]===void 0)&&((this.options||(this.options={}))[e]=t),this};Cn.prototype.setParsedOption=function(e,t,i){this.parsedOptions||(this.parsedOptions=[]);var r=this.parsedOptions;if(i){var s=r.find(function(c){return Object.prototype.hasOwnProperty.call(c,e)});if(s){var o=s[e];Mf.setProperty(o,i,t)}else s={},s[e]=Mf.setProperty({},i,t),r.push(s)}else{var a={};a[e]=t,r.push(a)}return this};Cn.prototype.setOptions=function(e,t){if(e)for(var i=Object.keys(e),r=0;r<i.length;++r)this.setOption(i[r],e[i[r]],t);return this};Cn.prototype.toString=function(){var e=this.constructor.className,t=this.fullName;return t.length?e+" "+t:e};Cn._configure=function(n){Of=n}});var ui=E((wZ,ZD)=>{"use strict";ZD.exports=Vi;var YD=Js();((Vi.prototype=Object.create(YD.prototype)).constructor=Vi).className="Enum";var XD=Ma(),Pf=It();function Vi(n,e,t,i,r,s){if(YD.call(this,n,t),e&&typeof e!="object")throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=i,this.comments=r||{},this.valuesOptions=s,this.reserved=void 0,e)for(var o=Object.keys(e),a=0;a<o.length;++a)typeof e[o[a]]=="number"&&(this.valuesById[this.values[o[a]]=e[o[a]]]=o[a])}Vi.fromJSON=function(e,t){var i=new Vi(e,t.values,t.options,t.comment,t.comments);return i.reserved=t.reserved,i};Vi.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return Pf.toObject(["options",this.options,"valuesOptions",this.valuesOptions,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"comment",t?this.comment:void 0,"comments",t?this.comments:void 0])};Vi.prototype.add=function(e,t,i,r){if(!Pf.isString(e))throw TypeError("name must be a string");if(!Pf.isInteger(t))throw TypeError("id must be an integer");if(this.values[e]!==void 0)throw Error("duplicate name '"+e+"' in "+this);if(this.isReservedId(t))throw Error("id "+t+" is reserved in "+this);if(this.isReservedName(e))throw Error("name '"+e+"' is reserved in "+this);if(this.valuesById[t]!==void 0){if(!(this.options&&this.options.allow_alias))throw Error("duplicate id "+t+" in "+this);this.values[e]=t}else this.valuesById[this.values[e]=t]=e;return r&&(this.valuesOptions===void 0&&(this.valuesOptions={}),this.valuesOptions[e]=r||null),this.comments[e]=i||null,this};Vi.prototype.remove=function(e){if(!Pf.isString(e))throw TypeError("name must be a string");var t=this.values[e];if(t==null)throw Error("name '"+e+"' does not exist in "+this);return delete this.valuesById[t],delete this.values[e],delete this.comments[e],this.valuesOptions&&delete this.valuesOptions[e],this};Vi.prototype.isReservedId=function(e){return XD.isReservedId(this.reserved,e)};Vi.prototype.isReservedName=function(e){return XD.isReservedName(this.reserved,e)}});var Bv=E((CZ,e1)=>{"use strict";e1.exports=$U;var WU=ui(),zv=Zs(),Gv=It();function JD(n,e,t,i){return e.resolvedType.group?n("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",t,i,(e.id<<3|3)>>>0,(e.id<<3|4)>>>0):n("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",t,i,(e.id<<3|2)>>>0)}function $U(n){for(var e=Gv.codegen(["m","w"],n.name+"$encode")("if(!w)")("w=Writer.create()"),t,i,r=n.fieldsArray.slice().sort(Gv.compareFieldsById),t=0;t<r.length;++t){var s=r[t].resolve(),o=n._fieldsArray.indexOf(s),a=s.resolvedType instanceof WU?"int32":s.type,c=zv.basic[a];i="m"+Gv.safeProp(s.name),s.map?(e("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",i,s.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",i)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(s.id<<3|2)>>>0,8|zv.mapKey[s.keyType],s.keyType),c===void 0?e("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",o,i):e(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|c,a,i),e("}")("}")):s.repeated?(e("if(%s!=null&&%s.length){",i,i),s.packed&&zv.packed[a]!==void 0?e("w.uint32(%i).fork()",(s.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",i)("w.%s(%s[i])",a,i)("w.ldelim()"):(e("for(var i=0;i<%s.length;++i)",i),c===void 0?JD(e,s,o,i+"[i]"):e("w.uint32(%i).%s(%s[i])",(s.id<<3|c)>>>0,a,i)),e("}")):(s.optional&&e("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",i,s.name),c===void 0?JD(e,s,o,i):e("w.uint32(%i).%s(%s)",(s.id<<3|c)>>>0,a,i))}return e("return w")}});var n1=E((EZ,t1)=>{"use strict";var ve=t1.exports=uD();ve.build="light";function HU(n,e,t){return typeof e=="function"?(t=e,e=new ve.Root):e||(e=new ve.Root),e.load(n,t)}ve.load=HU;function KU(n,e){return e||(e=new ve.Root),e.loadSync(n)}ve.loadSync=KU;ve.encoder=Bv();ve.decoder=Iv();ve.verifier=kv();ve.converter=Ov();ve.ReflectionObject=Js();ve.Namespace=Ma();ve.Root=Rf();ve.Enum=ui();ve.Type=Af();ve.Field=Yr();ve.OneOf=Da();ve.MapField=Cf();ve.Service=Sf();ve.Method=Ef();ve.Message=Tf();ve.wrappers=Pv();ve.types=Zs();ve.util=It();ve.ReflectionObject._configure(ve.Root);ve.Namespace._configure(ve.Type,ve.Service,ve.Enum);ve.Root._configure(ve.Type);ve.Field._configure(ve.Type)});var $v=E((SZ,s1)=>{"use strict";s1.exports=r1;var Wv=/[\s{}=;:[\],'"()<>]/g,QU=/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,YU=/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,XU=/^ *[*/]+ */,ZU=/^\s*\*?\/*/,JU=/\n/g,e4=/\s/,t4=/\\(.?)/g,n4={0:"\0",r:"\r",n:`
`,t:"	"};function i1(n){return n.replace(t4,function(e,t){switch(t){case"\\":case"":return t;default:return n4[t]||""}})}r1.unescape=i1;function r1(n,e){n=n.toString();var t=0,i=n.length,r=1,s=0,o={},a=[],c=null;function l(P){return Error("illegal "+P+" (line "+r+")")}function u(){var P=c==="'"?YU:QU;P.lastIndex=t-1;var W=P.exec(n);if(!W)throw l("string");return t=P.lastIndex,_(c),c=null,i1(W[1])}function d(P){return n.charAt(P)}function h(P,W,X){var ue={type:n.charAt(P++),lineEmpty:!1,leading:X},Ct;e?Ct=2:Ct=3;var Lt=P-Ct,Fe;do if(--Lt<0||(Fe=n.charAt(Lt))===`
`){ue.lineEmpty=!0;break}while(Fe===" "||Fe==="	");for(var I=n.substring(P,W).split(JU),et=0;et<I.length;++et)I[et]=I[et].replace(e?ZU:XU,"").trim();ue.text=I.join(`
`).trim(),o[r]=ue,s=r}function m(P){var W=g(P),X=n.substring(P,W),ue=/^\s*\/{1,2}/.test(X);return ue}function g(P){for(var W=P;W<i&&d(W)!==`
`;)W++;return W}function y(){if(a.length>0)return a.shift();if(c)return u();var P,W,X,ue,Ct,Lt=t===0;do{if(t===i)return null;for(P=!1;e4.test(X=d(t));)if(X===`
`&&(Lt=!0,++r),++t===i)return null;if(d(t)==="/"){if(++t===i)throw l("comment");if(d(t)==="/")if(e){if(ue=t,Ct=!1,m(t)){Ct=!0;do if(t=g(t),t===i||(t++,!Lt))break;while(m(t))}else t=Math.min(i,g(t)+1);Ct&&(h(ue,t,Lt),Lt=!0),r++,P=!0}else{for(Ct=d(ue=t+1)==="/";d(++t)!==`
`;)if(t===i)return null;++t,Ct&&(h(ue,t-1,Lt),Lt=!0),++r,P=!0}else if((X=d(t))==="*"){ue=t+1,Ct=e||d(ue)==="*";do{if(X===`
`&&++r,++t===i)throw l("comment");W=X,X=d(t)}while(W!=="*"||X!=="/");++t,Ct&&(h(ue,t-2,Lt),Lt=!0),P=!0}else return"/"}}while(P);var Fe=t;Wv.lastIndex=0;var I=Wv.test(d(Fe++));if(!I)for(;Fe<i&&!Wv.test(d(Fe));)++Fe;var et=n.substring(t,t=Fe);return(et==='"'||et==="'")&&(c=et),et}function _(P){a.push(P)}function M(){if(!a.length){var P=y();if(P===null)return null;_(P)}return a[0]}function T(P,W){var X=M(),ue=X===P;if(ue)return y(),!0;if(!W)throw l("token '"+X+"', '"+P+"' expected");return!1}function O(P){var W=null,X;return P===void 0?(X=o[r-1],delete o[r-1],X&&(e||X.type==="*"||X.lineEmpty)&&(W=X.leading?X.text:null)):(s<P&&M(),X=o[P],delete o[P],X&&!X.lineEmpty&&(e||X.type==="/")&&(W=X.leading?null:X.text)),W}return Object.defineProperty({next:y,peek:M,push:_,skip:T,cmnt:O},"line",{get:function(){return r}})}});var d1=E((TZ,u1)=>{"use strict";u1.exports=gr;gr.filename=null;gr.defaults={keepCase:!1};var i4=$v(),o1=Rf(),a1=Af(),c1=Yr(),r4=Cf(),l1=Da(),s4=ui(),o4=Sf(),a4=Ef(),Hv=Zs(),Kv=It(),c4=/^[1-9][0-9]*$/,l4=/^-?[1-9][0-9]*$/,u4=/^0[x][0-9a-fA-F]+$/,d4=/^-?0[x][0-9a-fA-F]+$/,h4=/^0[0-7]+$/,f4=/^-?0[0-7]+$/,m4=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/,Ui=/^[a-zA-Z_][a-zA-Z_0-9]*$/,ji=/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)(?:\.[a-zA-Z_][a-zA-Z_0-9]*)*$/,p4=/^(?:\.[a-zA-Z_][a-zA-Z_0-9]*)+$/;function gr(n,e,t){e instanceof o1||(t=e,e=new o1),t||(t=gr.defaults);var i=t.preferTrailingComment||!1,r=i4(n,t.alternateCommentMode||!1),s=r.next,o=r.push,a=r.peek,c=r.skip,l=r.cmnt,u=!0,d,h,m,g,y=!1,_=e,M=t.keepCase?function(D){return D}:Kv.camelCase;function T(D,k,N){var Y=gr.filename;return N||(gr.filename=null),Error("illegal "+(k||"token")+" '"+D+"' ("+(Y?Y+", ":"")+"line "+r.line+")")}function O(){var D=[],k;do{if((k=s())!=='"'&&k!=="'")throw T(k);D.push(s()),c(k),k=a()}while(k==='"'||k==="'");return D.join("")}function P(D){var k=s();switch(k){case"'":case'"':return o(k),O();case"true":case"TRUE":return!0;case"false":case"FALSE":return!1}try{return X(k,!0)}catch{if(D&&ji.test(k))return k;throw T(k,"value")}}function W(D,k){var N,Y;do k&&((N=a())==='"'||N==="'")?D.push(O()):D.push([Y=ue(s()),c("to",!0)?ue(s()):Y]);while(c(",",!0));c(";")}function X(D,k){var N=1;switch(D.charAt(0)==="-"&&(N=-1,D=D.substring(1)),D){case"inf":case"INF":case"Inf":return N*(1/0);case"nan":case"NAN":case"Nan":case"NaN":return NaN;case"0":return 0}if(c4.test(D))return N*parseInt(D,10);if(u4.test(D))return N*parseInt(D,16);if(h4.test(D))return N*parseInt(D,8);if(m4.test(D))return N*parseFloat(D);throw T(D,"number",k)}function ue(D,k){switch(D){case"max":case"MAX":case"Max":return 536870911;case"0":return 0}if(!k&&D.charAt(0)==="-")throw T(D,"id");if(l4.test(D))return parseInt(D,10);if(d4.test(D))return parseInt(D,16);if(f4.test(D))return parseInt(D,8);throw T(D,"id")}function Ct(){if(d!==void 0)throw T("package");if(d=s(),!ji.test(d))throw T(d,"name");_=_.define(d),c(";")}function Lt(){var D=a(),k;switch(D){case"weak":k=m||(m=[]),s();break;case"public":s();default:k=h||(h=[]);break}D=O(),c(";"),k.push(D)}function Fe(){if(c("="),g=O(),y=g==="proto3",!y&&g!=="proto2")throw T(g,"syntax");c(";")}function I(D,k){switch(k){case"option":return Ue(D,k),c(";"),!0;case"message":return A(D,k),!0;case"enum":return Re(D,k),!0;case"service":return yt(D,k),!0;case"extend":return Go(D,k),!0}return!1}function et(D,k,N){var Y=r.line;if(D&&(typeof D.comment!="string"&&(D.comment=l()),D.filename=gr.filename),c("{",!0)){for(var K;(K=s())!=="}";)k(K);c(";",!0)}else N&&N(),c(";"),D&&(typeof D.comment!="string"||i)&&(D.comment=l(Y)||D.comment)}function A(D,k){if(!Ui.test(k=s()))throw T(k,"type name");var N=new a1(k);et(N,function(K){if(!I(N,K))switch(K){case"map":Ce(N,K);break;case"required":case"repeated":f(N,K);break;case"optional":y?f(N,"proto3_optional"):f(N,"optional");break;case"oneof":Ge(N,K);break;case"extensions":W(N.extensions||(N.extensions=[]));break;case"reserved":W(N.reserved||(N.reserved=[]),!0);break;default:if(!y||!ji.test(K))throw T(K);o(K),f(N,"optional");break}}),D.add(N)}function f(D,k,N){var Y=s();if(Y==="group"){U(D,k);return}for(;Y.endsWith(".")||a().startsWith(".");)Y+=s();if(!ji.test(Y))throw T(Y,"type");var K=s();if(!Ui.test(K))throw T(K,"name");K=M(K),c("=");var de=new c1(K,ue(s()),Y,k,N);if(et(de,function(yn){if(yn==="option")Ue(de,yn),c(";");else throw T(yn)},function(){Bt(de)}),k==="proto3_optional"){var Mt=new l1("_"+K);de.setOption("proto3_optional",!0),Mt.add(de),D.add(Mt)}else D.add(de);!y&&de.repeated&&(Hv.packed[Y]!==void 0||Hv.basic[Y]===void 0)&&de.setOption("packed",!1,!0)}function U(D,k){var N=s();if(!Ui.test(N))throw T(N,"name");var Y=Kv.lcFirst(N);N===Y&&(N=Kv.ucFirst(N)),c("=");var K=ue(s()),de=new a1(N);de.group=!0;var Mt=new c1(Y,K,N,k);Mt.filename=gr.filename,et(de,function(yn){switch(yn){case"option":Ue(de,yn),c(";");break;case"required":case"repeated":f(de,yn);break;case"optional":y?f(de,"proto3_optional"):f(de,"optional");break;case"message":A(de,yn);break;case"enum":Re(de,yn);break;default:throw T(yn)}}),D.add(de).add(Mt)}function Ce(D){c("<");var k=s();if(Hv.mapKey[k]===void 0)throw T(k,"type");c(",");var N=s();if(!ji.test(N))throw T(N,"type");c(">");var Y=s();if(!Ui.test(Y))throw T(Y,"name");c("=");var K=new r4(M(Y),ue(s()),k,N);et(K,function(Mt){if(Mt==="option")Ue(K,Mt),c(";");else throw T(Mt)},function(){Bt(K)}),D.add(K)}function Ge(D,k){if(!Ui.test(k=s()))throw T(k,"name");var N=new l1(M(k));et(N,function(K){K==="option"?(Ue(N,K),c(";")):(o(K),f(N,"optional"))}),D.add(N)}function Re(D,k){if(!Ui.test(k=s()))throw T(k,"name");var N=new s4(k);et(N,function(K){switch(K){case"option":Ue(N,K),c(";");break;case"reserved":W(N.reserved||(N.reserved=[]),!0);break;default:ct(N,K)}}),D.add(N)}function ct(D,k){if(!Ui.test(k))throw T(k,"name");c("=");var N=ue(s(),!0),Y={options:void 0};Y.setOption=function(K,de){this.options===void 0&&(this.options={}),this.options[K]=de},et(Y,function(de){if(de==="option")Ue(Y,de),c(";");else throw T(de)},function(){Bt(Y)}),D.add(k,N,Y.comment,Y.options)}function Ue(D,k){var N=c("(",!0);if(!ji.test(k=s()))throw T(k,"name");var Y=k,K=Y,de;N&&(c(")"),Y="("+Y+")",K=Y,k=a(),p4.test(k)&&(de=k.slice(1),Y+=k,s())),c("=");var Mt=Qt(D,Y);tt(D,K,Mt,de)}function Qt(D,k){if(c("{",!0)){for(var N={};!c("}",!0);){if(!Ui.test(ln=s()))throw T(ln,"name");var Y,K=ln;if(c(":",!0),a()==="{")Y=Qt(D,k+"."+ln);else if(a()==="["){Y=[];var de;if(c("[",!0)){do de=P(!0),Y.push(de);while(c(",",!0));c("]"),typeof de<"u"&&gt(D,k+"."+ln,de)}}else Y=P(!0),gt(D,k+"."+ln,Y);var Mt=N[K];Mt&&(Y=[].concat(Mt).concat(Y)),N[K]=Y,c(",",!0),c(";",!0)}return N}var Mr=P(!0);return gt(D,k,Mr),Mr}function gt(D,k,N){D.setOption&&D.setOption(k,N)}function tt(D,k,N,Y){D.setParsedOption&&D.setParsedOption(k,N,Y)}function Bt(D){if(c("[",!0)){do Ue(D,"option");while(c(",",!0));c("]")}return D}function yt(D,k){if(!Ui.test(k=s()))throw T(k,"service name");var N=new o4(k);et(N,function(K){if(!I(N,K))if(K==="rpc")Yt(N,K);else throw T(K)}),D.add(N)}function Yt(D,k){var N=l(),Y=k;if(!Ui.test(k=s()))throw T(k,"name");var K=k,de,Mt,Mr,yn;if(c("("),c("stream",!0)&&(Mt=!0),!ji.test(k=s())||(de=k,c(")"),c("returns"),c("("),c("stream",!0)&&(yn=!0),!ji.test(k=s())))throw T(k);Mr=k,c(")");var Rd=new a4(K,Y,de,Mr,Mt,yn);Rd.comment=N,et(Rd,function(Rg){if(Rg==="option")Ue(Rd,Rg),c(";");else throw T(Rg)}),D.add(Rd)}function Go(D,k){if(!ji.test(k=s()))throw T(k,"reference");var N=k;et(null,function(K){switch(K){case"required":case"repeated":f(D,K,N);break;case"optional":y?f(D,"proto3_optional",N):f(D,"optional",N);break;default:if(!y||!ji.test(K))throw T(K);o(K),f(D,"optional",N);break}})}for(var ln;(ln=s())!==null;)switch(ln){case"package":if(!u)throw T(ln);Ct();break;case"import":if(!u)throw T(ln);Lt();break;case"syntax":if(!u)throw T(ln);Fe();break;case"option":Ue(_,ln),c(";");break;default:if(I(_,ln)){u=!1;continue}throw T(ln)}return gr.filename=null,{package:d,imports:h,weakImports:m,syntax:g,root:e}}});var m1=E((xZ,f1)=>{"use strict";f1.exports=hi;var g4=/\/|\./;function hi(n,e){g4.test(n)||(n="google/protobuf/"+n+".proto",e={nested:{google:{nested:{protobuf:{nested:e}}}}}),hi[n]=e}hi("any",{Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}}});var h1;hi("duration",{Duration:h1={fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}});hi("timestamp",{Timestamp:h1});hi("empty",{Empty:{fields:{}}});hi("struct",{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}}});hi("wrappers",{DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}}});hi("field_mask",{FieldMask:{fields:{paths:{rule:"repeated",type:"string",id:1}}}});hi.get=function(e){return hi[e]||null}});var g1=E((IZ,p1)=>{"use strict";var Jr=p1.exports=n1();Jr.build="full";Jr.tokenize=$v();Jr.parse=d1();Jr.common=m1();Jr.Root._configure(Jr.Type,Jr.parse,Jr.common)});var Nf=E((AZ,y1)=>{"use strict";y1.exports=g1()});var Qv=E((DZ,y4)=>{y4.exports={nested:{google:{nested:{protobuf:{nested:{FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5},serverStreaming:{type:"bool",id:6}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16},javaGenericServices:{type:"bool",id:17},pyGenericServices:{type:"bool",id:18},deprecated:{type:"bool",id:23},ccEnableArenas:{type:"bool",id:31},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1},noStandardDescriptorAccessor:{type:"bool",id:2},deprecated:{type:"bool",id:3},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[8,8]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5},deprecated:{type:"bool",id:3},weak:{type:"bool",id:10},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}}}}}}}}});var C1=E((le,w1)=>{"use strict";var rn=Nf();w1.exports=le=rn.descriptor=rn.Root.fromJSON(Qv()).lookup(".google.protobuf");var b1=rn.Namespace,ru=rn.Root,yr=rn.Enum,es=rn.Type,ts=rn.Field,b4=rn.MapField,Ff=rn.OneOf,su=rn.Service,Lf=rn.Method;ru.fromDescriptor=function(e){typeof e.length=="number"&&(e=le.FileDescriptorSet.decode(e));var t=new ru;if(e.file)for(var i,r,s=0,o;s<e.file.length;++s){if(r=t,(i=e.file[s]).package&&i.package.length&&(r=t.define(i.package)),i.name&&i.name.length&&t.files.push(r.filename=i.name),i.messageType)for(o=0;o<i.messageType.length;++o)r.add(es.fromDescriptor(i.messageType[o],i.syntax));if(i.enumType)for(o=0;o<i.enumType.length;++o)r.add(yr.fromDescriptor(i.enumType[o]));if(i.extension)for(o=0;o<i.extension.length;++o)r.add(ts.fromDescriptor(i.extension[o]));if(i.service)for(o=0;o<i.service.length;++o)r.add(su.fromDescriptor(i.service[o]));var a=Pa(i.options,le.FileOptions);if(a){var c=Object.keys(a);for(o=0;o<c.length;++o)r.setOption(c[o],a[c[o]])}}return t};ru.prototype.toDescriptor=function(e){var t=le.FileDescriptorSet.create();return v1(this,t.file,e),t};function v1(n,e,t){var i=le.FileDescriptorProto.create({name:n.filename||(n.fullName.substring(1).replace(/\./g,"_")||"root")+".proto"});t&&(i.syntax=t),n instanceof ru||(i.package=n.fullName.substring(1));for(var r=0,s;r<n.nestedArray.length;++r)(s=n._nestedArray[r])instanceof es?i.messageType.push(s.toDescriptor(t)):s instanceof yr?i.enumType.push(s.toDescriptor()):s instanceof ts?i.extension.push(s.toDescriptor(t)):s instanceof su?i.service.push(s.toDescriptor()):s instanceof b1&&v1(s,e,t);i.options=Na(n.options,le.FileOptions),i.messageType.length+i.enumType.length+i.extension.length+i.service.length&&e.push(i)}var v4=0;es.fromDescriptor=function(e,t){typeof e.length=="number"&&(e=le.DescriptorProto.decode(e));var i=new es(e.name.length?e.name:"Type"+v4++,Pa(e.options,le.MessageOptions)),r;if(e.oneofDecl)for(r=0;r<e.oneofDecl.length;++r)i.add(Ff.fromDescriptor(e.oneofDecl[r]));if(e.field)for(r=0;r<e.field.length;++r){var s=ts.fromDescriptor(e.field[r],t);i.add(s),e.field[r].hasOwnProperty("oneofIndex")&&i.oneofsArray[e.field[r].oneofIndex].add(s)}if(e.extension)for(r=0;r<e.extension.length;++r)i.add(ts.fromDescriptor(e.extension[r],t));if(e.nestedType)for(r=0;r<e.nestedType.length;++r)i.add(es.fromDescriptor(e.nestedType[r],t)),e.nestedType[r].options&&e.nestedType[r].options.mapEntry&&i.setOption("map_entry",!0);if(e.enumType)for(r=0;r<e.enumType.length;++r)i.add(yr.fromDescriptor(e.enumType[r]));if(e.extensionRange&&e.extensionRange.length)for(i.extensions=[],r=0;r<e.extensionRange.length;++r)i.extensions.push([e.extensionRange[r].start,e.extensionRange[r].end]);if(e.reservedRange&&e.reservedRange.length||e.reservedName&&e.reservedName.length){if(i.reserved=[],e.reservedRange)for(r=0;r<e.reservedRange.length;++r)i.reserved.push([e.reservedRange[r].start,e.reservedRange[r].end]);if(e.reservedName)for(r=0;r<e.reservedName.length;++r)i.reserved.push(e.reservedName[r])}return i};es.prototype.toDescriptor=function(e){var t=le.DescriptorProto.create({name:this.name}),i;for(i=0;i<this.fieldsArray.length;++i){var r;if(t.field.push(r=this._fieldsArray[i].toDescriptor(e)),this._fieldsArray[i]instanceof b4){var s=Yv(this._fieldsArray[i].keyType,this._fieldsArray[i].resolvedKeyType),o=Yv(this._fieldsArray[i].type,this._fieldsArray[i].resolvedType),a=o===11||o===14?this._fieldsArray[i].resolvedType&&_1(this.parent,this._fieldsArray[i].resolvedType)||this._fieldsArray[i].type:void 0;t.nestedType.push(le.DescriptorProto.create({name:r.typeName,field:[le.FieldDescriptorProto.create({name:"key",number:1,label:1,type:s}),le.FieldDescriptorProto.create({name:"value",number:2,label:1,type:o,typeName:a})],options:le.MessageOptions.create({mapEntry:!0})}))}}for(i=0;i<this.oneofsArray.length;++i)t.oneofDecl.push(this._oneofsArray[i].toDescriptor());for(i=0;i<this.nestedArray.length;++i)this._nestedArray[i]instanceof ts?t.field.push(this._nestedArray[i].toDescriptor(e)):this._nestedArray[i]instanceof es?t.nestedType.push(this._nestedArray[i].toDescriptor(e)):this._nestedArray[i]instanceof yr&&t.enumType.push(this._nestedArray[i].toDescriptor());if(this.extensions)for(i=0;i<this.extensions.length;++i)t.extensionRange.push(le.DescriptorProto.ExtensionRange.create({start:this.extensions[i][0],end:this.extensions[i][1]}));if(this.reserved)for(i=0;i<this.reserved.length;++i)typeof this.reserved[i]=="string"?t.reservedName.push(this.reserved[i]):t.reservedRange.push(le.DescriptorProto.ReservedRange.create({start:this.reserved[i][0],end:this.reserved[i][1]}));return t.options=Na(this.options,le.MessageOptions),t};var _4=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/;ts.fromDescriptor=function(e,t){if(typeof e.length=="number"&&(e=le.DescriptorProto.decode(e)),typeof e.number!="number")throw Error("missing field id");var i;e.typeName&&e.typeName.length?i=e.typeName:i=T4(e.type);var r;switch(e.label){case 1:r=void 0;break;case 2:r="required";break;case 3:r="repeated";break;default:throw Error("illegal label: "+e.label)}var s=e.extendee;e.extendee!==void 0&&(s=s.length?s:void 0);var o=new ts(e.name.length?e.name:"field"+e.number,e.number,i,r,s);if(o.options=Pa(e.options,le.FieldOptions),e.defaultValue&&e.defaultValue.length){var a=e.defaultValue;switch(a){case"true":case"TRUE":a=!0;break;case"false":case"FALSE":a=!1;break;default:var c=_4.exec(a);c&&(a=parseInt(a));break}o.setOption("default",a)}return x4(e.type)&&(t==="proto3"?e.options&&!e.options.packed&&o.setOption("packed",!1):e.options&&e.options.packed||o.setOption("packed",!1)),o};ts.prototype.toDescriptor=function(e){var t=le.FieldDescriptorProto.create({name:this.name,number:this.id});if(this.map)t.type=11,t.typeName=rn.util.ucFirst(this.name),t.label=3;else{switch(t.type=Yv(this.type,this.resolve().resolvedType)){case 10:case 11:case 14:t.typeName=this.resolvedType?_1(this.parent,this.resolvedType):this.type;break}switch(this.rule){case"repeated":t.label=3;break;case"required":t.label=2;break;default:t.label=1;break}}if(t.extendee=this.extensionField?this.extensionField.parent.fullName:this.extend,this.partOf&&(t.oneofIndex=this.parent.oneofsArray.indexOf(this.partOf))<0)throw Error("missing oneof");return this.options&&(t.options=Na(this.options,le.FieldOptions),this.options.default!=null&&(t.defaultValue=String(this.options.default))),e==="proto3"?this.packed||((t.options||(t.options=le.FieldOptions.create())).packed=!1):this.packed&&((t.options||(t.options=le.FieldOptions.create())).packed=!0),t};var w4=0;yr.fromDescriptor=function(e){typeof e.length=="number"&&(e=le.EnumDescriptorProto.decode(e));var t={};if(e.value)for(var i=0;i<e.value.length;++i){var r=e.value[i].name,s=e.value[i].number||0;t[r&&r.length?r:"NAME"+s]=s}return new yr(e.name&&e.name.length?e.name:"Enum"+w4++,t,Pa(e.options,le.EnumOptions))};yr.prototype.toDescriptor=function(){for(var e=[],t=0,i=Object.keys(this.values);t<i.length;++t)e.push(le.EnumValueDescriptorProto.create({name:i[t],number:this.values[i[t]]}));return le.EnumDescriptorProto.create({name:this.name,value:e,options:Na(this.options,le.EnumOptions)})};var C4=0;Ff.fromDescriptor=function(e){return typeof e.length=="number"&&(e=le.OneofDescriptorProto.decode(e)),new Ff(e.name&&e.name.length?e.name:"oneof"+C4++)};Ff.prototype.toDescriptor=function(){return le.OneofDescriptorProto.create({name:this.name})};var E4=0;su.fromDescriptor=function(e){typeof e.length=="number"&&(e=le.ServiceDescriptorProto.decode(e));var t=new su(e.name&&e.name.length?e.name:"Service"+E4++,Pa(e.options,le.ServiceOptions));if(e.method)for(var i=0;i<e.method.length;++i)t.add(Lf.fromDescriptor(e.method[i]));return t};su.prototype.toDescriptor=function(){for(var e=[],t=0;t<this.methodsArray.length;++t)e.push(this._methodsArray[t].toDescriptor());return le.ServiceDescriptorProto.create({name:this.name,method:e,options:Na(this.options,le.ServiceOptions)})};var S4=0;Lf.fromDescriptor=function(e){return typeof e.length=="number"&&(e=le.MethodDescriptorProto.decode(e)),new Lf(e.name&&e.name.length?e.name:"Method"+S4++,"rpc",e.inputType,e.outputType,!!e.clientStreaming,!!e.serverStreaming,Pa(e.options,le.MethodOptions))};Lf.prototype.toDescriptor=function(){return le.MethodDescriptorProto.create({name:this.name,inputType:this.resolvedRequestType?this.resolvedRequestType.fullName:this.requestType,outputType:this.resolvedResponseType?this.resolvedResponseType.fullName:this.responseType,clientStreaming:this.requestStream,serverStreaming:this.responseStream,options:Na(this.options,le.MethodOptions)})};function T4(n){switch(n){case 1:return"double";case 2:return"float";case 3:return"int64";case 4:return"uint64";case 5:return"int32";case 6:return"fixed64";case 7:return"fixed32";case 8:return"bool";case 9:return"string";case 12:return"bytes";case 13:return"uint32";case 15:return"sfixed32";case 16:return"sfixed64";case 17:return"sint32";case 18:return"sint64"}throw Error("illegal type: "+n)}function x4(n){switch(n){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 13:case 14:case 15:case 16:case 17:case 18:return!0}return!1}function Yv(n,e){switch(n){case"double":return 1;case"float":return 2;case"int64":return 3;case"uint64":return 4;case"int32":return 5;case"fixed64":return 6;case"fixed32":return 7;case"bool":return 8;case"string":return 9;case"bytes":return 12;case"uint32":return 13;case"sfixed32":return 15;case"sfixed64":return 16;case"sint32":return 17;case"sint64":return 18}if(e instanceof yr)return 14;if(e instanceof es)return e.group?10:11;throw Error("illegal type: "+n)}function Pa(n,e){if(n){for(var t=[],i=0,r,s,o;i<e.fieldsArray.length;++i)(s=(r=e._fieldsArray[i]).name)!=="uninterpretedOption"&&n.hasOwnProperty(s)&&(o=n[s],r.resolvedType instanceof yr&&typeof o=="number"&&r.resolvedType.valuesById[o]!==void 0&&(o=r.resolvedType.valuesById[o]),t.push(I4(s),o));return t.length?rn.util.toObject(t):void 0}}function Na(n,e){if(n){for(var t=[],i=0,r=Object.keys(n),s,o;i<r.length;++i)if(o=n[s=r[i]],s!=="default"){var a=e.fields[s];!a&&!(a=e.fields[s=rn.util.camelCase(s)])||t.push(s,o)}return t.length?e.fromObject(rn.util.toObject(t)):void 0}}function _1(n,e){var t=n.fullName.split("."),i=e.fullName.split("."),r=0,s=0,o=i.length-1;if(!(n instanceof ru)&&e instanceof b1)for(;r<t.length&&s<o&&t[r]===i[s];){var a=e.lookup(t[r++],!0);if(a!==null&&a!==e)break;++s}else for(;r<t.length&&s<o&&t[r]===i[s];++r,++s);return i.slice(s).join(".")}function I4(n){return n.substring(0,1)+n.substring(1).replace(/([A-Z])(?=[a-z]|$)/g,function(e,t){return"_"+t.toLowerCase()})}});var E1=E((kZ,A4)=>{A4.exports={nested:{google:{nested:{protobuf:{nested:{Api:{fields:{name:{type:"string",id:1},methods:{rule:"repeated",type:"Method",id:2},options:{rule:"repeated",type:"Option",id:3},version:{type:"string",id:4},sourceContext:{type:"SourceContext",id:5},mixins:{rule:"repeated",type:"Mixin",id:6},syntax:{type:"Syntax",id:7}}},Method:{fields:{name:{type:"string",id:1},requestTypeUrl:{type:"string",id:2},requestStreaming:{type:"bool",id:3},responseTypeUrl:{type:"string",id:4},responseStreaming:{type:"bool",id:5},options:{rule:"repeated",type:"Option",id:6},syntax:{type:"Syntax",id:7}}},Mixin:{fields:{name:{type:"string",id:1},root:{type:"string",id:2}}},SourceContext:{fields:{fileName:{type:"string",id:1}}},Option:{fields:{name:{type:"string",id:1},value:{type:"Any",id:2}}},Syntax:{values:{SYNTAX_PROTO2:0,SYNTAX_PROTO3:1}}}}}}}}});var S1=E((RZ,D4)=>{D4.exports={nested:{google:{nested:{protobuf:{nested:{SourceContext:{fields:{fileName:{type:"string",id:1}}}}}}}}}});var T1=E((MZ,k4)=>{k4.exports={nested:{google:{nested:{protobuf:{nested:{Type:{fields:{name:{type:"string",id:1},fields:{rule:"repeated",type:"Field",id:2},oneofs:{rule:"repeated",type:"string",id:3},options:{rule:"repeated",type:"Option",id:4},sourceContext:{type:"SourceContext",id:5},syntax:{type:"Syntax",id:6}}},Field:{fields:{kind:{type:"Kind",id:1},cardinality:{type:"Cardinality",id:2},number:{type:"int32",id:3},name:{type:"string",id:4},typeUrl:{type:"string",id:6},oneofIndex:{type:"int32",id:7},packed:{type:"bool",id:8},options:{rule:"repeated",type:"Option",id:9},jsonName:{type:"string",id:10},defaultValue:{type:"string",id:11}},nested:{Kind:{values:{TYPE_UNKNOWN:0,TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Cardinality:{values:{CARDINALITY_UNKNOWN:0,CARDINALITY_OPTIONAL:1,CARDINALITY_REQUIRED:2,CARDINALITY_REPEATED:3}}}},Enum:{fields:{name:{type:"string",id:1},enumvalue:{rule:"repeated",type:"EnumValue",id:2},options:{rule:"repeated",type:"Option",id:3},sourceContext:{type:"SourceContext",id:4},syntax:{type:"Syntax",id:5}}},EnumValue:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{rule:"repeated",type:"Option",id:3}}},Option:{fields:{name:{type:"string",id:1},value:{type:"Any",id:2}}},Syntax:{values:{SYNTAX_PROTO2:0,SYNTAX_PROTO3:1}},Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}},SourceContext:{fields:{fileName:{type:"string",id:1}}}}}}}}}});var D1=E(ns=>{"use strict";Object.defineProperty(ns,"__esModule",{value:!0});ns.addCommonProtos=ns.loadProtosWithOptionsSync=ns.loadProtosWithOptions=void 0;var x1=Ie("fs"),I1=Ie("path"),Fa=Nf();function A1(n,e){let t=n.resolvePath;n.resolvePath=(i,r)=>{if(I1.isAbsolute(r))return r;for(let s of e){let o=I1.join(s,r);try{return x1.accessSync(o,x1.constants.R_OK),o}catch{continue}}return process.emitWarning(`${r} not found in any of the include paths ${e}`),t(i,r)}}function R4(n,e){return p(this,null,function*(){let t=new Fa.Root;if(e=e||{},e.includeDirs){if(!Array.isArray(e.includeDirs))return Promise.reject(new Error("The includeDirs option must be an array"));A1(t,e.includeDirs)}let i=yield t.load(n,e);return i.resolveAll(),i})}ns.loadProtosWithOptions=R4;function M4(n,e){let t=new Fa.Root;if(e=e||{},e.includeDirs){if(!Array.isArray(e.includeDirs))throw new Error("The includeDirs option must be an array");A1(t,e.includeDirs)}let i=t.loadSync(n,e);return i.resolveAll(),i}ns.loadProtosWithOptionsSync=M4;function O4(){let n=E1(),e=Qv(),t=S1(),i=T1();Fa.common("api",n.nested.google.nested.protobuf.nested),Fa.common("descriptor",e.nested.google.nested.protobuf.nested),Fa.common("source_context",t.nested.google.nested.protobuf.nested),Fa.common("type",i.nested.google.nested.protobuf.nested)}ns.addCommonProtos=O4});var M1=E((R1,Xv)=>{"use strict";var k1=function(n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var e=null;try{e=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function t(A,f,U){this.low=A|0,this.high=f|0,this.unsigned=!!U}t.prototype.__isLong__,Object.defineProperty(t.prototype,"__isLong__",{value:!0});function i(A){return(A&&A.__isLong__)===!0}function r(A){var f=Math.clz32(A&-A);return A?31-f:f}t.isLong=i;var s={},o={};function a(A,f){var U,Ce,Ge;return f?(A>>>=0,(Ge=0<=A&&A<256)&&(Ce=o[A],Ce)?Ce:(U=l(A,0,!0),Ge&&(o[A]=U),U)):(A|=0,(Ge=-128<=A&&A<128)&&(Ce=s[A],Ce)?Ce:(U=l(A,A<0?-1:0,!1),Ge&&(s[A]=U),U))}t.fromInt=a;function c(A,f){if(isNaN(A))return f?P:O;if(f){if(A<0)return P;if(A>=_)return Lt}else{if(A<=-M)return Fe;if(A+1>=M)return Ct}return A<0?c(-A,f).neg():l(A%y|0,A/y|0,f)}t.fromNumber=c;function l(A,f,U){return new t(A,f,U)}t.fromBits=l;var u=Math.pow;function d(A,f,U){if(A.length===0)throw Error("empty string");if(typeof f=="number"?(U=f,f=!1):f=!!f,A==="NaN"||A==="Infinity"||A==="+Infinity"||A==="-Infinity")return f?P:O;if(U=U||10,U<2||36<U)throw RangeError("radix");var Ce;if((Ce=A.indexOf("-"))>0)throw Error("interior hyphen");if(Ce===0)return d(A.substring(1),f,U).neg();for(var Ge=c(u(U,8)),Re=O,ct=0;ct<A.length;ct+=8){var Ue=Math.min(8,A.length-ct),Qt=parseInt(A.substring(ct,ct+Ue),U);if(Ue<8){var gt=c(u(U,Ue));Re=Re.mul(gt).add(c(Qt))}else Re=Re.mul(Ge),Re=Re.add(c(Qt))}return Re.unsigned=f,Re}t.fromString=d;function h(A,f){return typeof A=="number"?c(A,f):typeof A=="string"?d(A,f):l(A.low,A.high,typeof f=="boolean"?f:A.unsigned)}t.fromValue=h;var m=65536,g=1<<24,y=m*m,_=y*y,M=_/2,T=a(g),O=a(0);t.ZERO=O;var P=a(0,!0);t.UZERO=P;var W=a(1);t.ONE=W;var X=a(1,!0);t.UONE=X;var ue=a(-1);t.NEG_ONE=ue;var Ct=l(-1,2147483647,!1);t.MAX_VALUE=Ct;var Lt=l(-1,-1,!0);t.MAX_UNSIGNED_VALUE=Lt;var Fe=l(0,-2147483648,!1);t.MIN_VALUE=Fe;var I=t.prototype;I.toInt=function(){return this.unsigned?this.low>>>0:this.low},I.toNumber=function(){return this.unsigned?(this.high>>>0)*y+(this.low>>>0):this.high*y+(this.low>>>0)},I.toString=function(f){if(f=f||10,f<2||36<f)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Fe)){var U=c(f),Ce=this.div(U),Ge=Ce.mul(U).sub(this);return Ce.toString(f)+Ge.toInt().toString(f)}else return"-"+this.neg().toString(f);for(var Re=c(u(f,6),this.unsigned),ct=this,Ue="";;){var Qt=ct.div(Re),gt=ct.sub(Qt.mul(Re)).toInt()>>>0,tt=gt.toString(f);if(ct=Qt,ct.isZero())return tt+Ue;for(;tt.length<6;)tt="0"+tt;Ue=""+tt+Ue}},I.getHighBits=function(){return this.high},I.getHighBitsUnsigned=function(){return this.high>>>0},I.getLowBits=function(){return this.low},I.getLowBitsUnsigned=function(){return this.low>>>0},I.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Fe)?64:this.neg().getNumBitsAbs();for(var f=this.high!=0?this.high:this.low,U=31;U>0&&!(f&1<<U);U--);return this.high!=0?U+33:U+1},I.isZero=function(){return this.high===0&&this.low===0},I.eqz=I.isZero,I.isNegative=function(){return!this.unsigned&&this.high<0},I.isPositive=function(){return this.unsigned||this.high>=0},I.isOdd=function(){return(this.low&1)===1},I.isEven=function(){return(this.low&1)===0},I.equals=function(f){return i(f)||(f=h(f)),this.unsigned!==f.unsigned&&this.high>>>31===1&&f.high>>>31===1?!1:this.high===f.high&&this.low===f.low},I.eq=I.equals,I.notEquals=function(f){return!this.eq(f)},I.neq=I.notEquals,I.ne=I.notEquals,I.lessThan=function(f){return this.comp(f)<0},I.lt=I.lessThan,I.lessThanOrEqual=function(f){return this.comp(f)<=0},I.lte=I.lessThanOrEqual,I.le=I.lessThanOrEqual,I.greaterThan=function(f){return this.comp(f)>0},I.gt=I.greaterThan,I.greaterThanOrEqual=function(f){return this.comp(f)>=0},I.gte=I.greaterThanOrEqual,I.ge=I.greaterThanOrEqual,I.compare=function(f){if(i(f)||(f=h(f)),this.eq(f))return 0;var U=this.isNegative(),Ce=f.isNegative();return U&&!Ce?-1:!U&&Ce?1:this.unsigned?f.high>>>0>this.high>>>0||f.high===this.high&&f.low>>>0>this.low>>>0?-1:1:this.sub(f).isNegative()?-1:1},I.comp=I.compare,I.negate=function(){return!this.unsigned&&this.eq(Fe)?Fe:this.not().add(W)},I.neg=I.negate,I.add=function(f){i(f)||(f=h(f));var U=this.high>>>16,Ce=this.high&65535,Ge=this.low>>>16,Re=this.low&65535,ct=f.high>>>16,Ue=f.high&65535,Qt=f.low>>>16,gt=f.low&65535,tt=0,Bt=0,yt=0,Yt=0;return Yt+=Re+gt,yt+=Yt>>>16,Yt&=65535,yt+=Ge+Qt,Bt+=yt>>>16,yt&=65535,Bt+=Ce+Ue,tt+=Bt>>>16,Bt&=65535,tt+=U+ct,tt&=65535,l(yt<<16|Yt,tt<<16|Bt,this.unsigned)},I.subtract=function(f){return i(f)||(f=h(f)),this.add(f.neg())},I.sub=I.subtract,I.multiply=function(f){if(this.isZero())return this;if(i(f)||(f=h(f)),e){var U=e.mul(this.low,this.high,f.low,f.high);return l(U,e.get_high(),this.unsigned)}if(f.isZero())return this.unsigned?P:O;if(this.eq(Fe))return f.isOdd()?Fe:O;if(f.eq(Fe))return this.isOdd()?Fe:O;if(this.isNegative())return f.isNegative()?this.neg().mul(f.neg()):this.neg().mul(f).neg();if(f.isNegative())return this.mul(f.neg()).neg();if(this.lt(T)&&f.lt(T))return c(this.toNumber()*f.toNumber(),this.unsigned);var Ce=this.high>>>16,Ge=this.high&65535,Re=this.low>>>16,ct=this.low&65535,Ue=f.high>>>16,Qt=f.high&65535,gt=f.low>>>16,tt=f.low&65535,Bt=0,yt=0,Yt=0,Go=0;return Go+=ct*tt,Yt+=Go>>>16,Go&=65535,Yt+=Re*tt,yt+=Yt>>>16,Yt&=65535,Yt+=ct*gt,yt+=Yt>>>16,Yt&=65535,yt+=Ge*tt,Bt+=yt>>>16,yt&=65535,yt+=Re*gt,Bt+=yt>>>16,yt&=65535,yt+=ct*Qt,Bt+=yt>>>16,yt&=65535,Bt+=Ce*tt+Ge*gt+Re*Qt+ct*Ue,Bt&=65535,l(Yt<<16|Go,Bt<<16|yt,this.unsigned)},I.mul=I.multiply,I.divide=function(f){if(i(f)||(f=h(f)),f.isZero())throw Error("division by zero");if(e){if(!this.unsigned&&this.high===-2147483648&&f.low===-1&&f.high===-1)return this;var U=(this.unsigned?e.div_u:e.div_s)(this.low,this.high,f.low,f.high);return l(U,e.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?P:O;var Ce,Ge,Re;if(this.unsigned){if(f.unsigned||(f=f.toUnsigned()),f.gt(this))return P;if(f.gt(this.shru(1)))return X;Re=P}else{if(this.eq(Fe)){if(f.eq(W)||f.eq(ue))return Fe;if(f.eq(Fe))return W;var ct=this.shr(1);return Ce=ct.div(f).shl(1),Ce.eq(O)?f.isNegative()?W:ue:(Ge=this.sub(f.mul(Ce)),Re=Ce.add(Ge.div(f)),Re)}else if(f.eq(Fe))return this.unsigned?P:O;if(this.isNegative())return f.isNegative()?this.neg().div(f.neg()):this.neg().div(f).neg();if(f.isNegative())return this.div(f.neg()).neg();Re=O}for(Ge=this;Ge.gte(f);){Ce=Math.max(1,Math.floor(Ge.toNumber()/f.toNumber()));for(var Ue=Math.ceil(Math.log(Ce)/Math.LN2),Qt=Ue<=48?1:u(2,Ue-48),gt=c(Ce),tt=gt.mul(f);tt.isNegative()||tt.gt(Ge);)Ce-=Qt,gt=c(Ce,this.unsigned),tt=gt.mul(f);gt.isZero()&&(gt=W),Re=Re.add(gt),Ge=Ge.sub(tt)}return Re},I.div=I.divide,I.modulo=function(f){if(i(f)||(f=h(f)),e){var U=(this.unsigned?e.rem_u:e.rem_s)(this.low,this.high,f.low,f.high);return l(U,e.get_high(),this.unsigned)}return this.sub(this.div(f).mul(f))},I.mod=I.modulo,I.rem=I.modulo,I.not=function(){return l(~this.low,~this.high,this.unsigned)},I.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},I.clz=I.countLeadingZeros,I.countTrailingZeros=function(){return this.low?r(this.low):r(this.high)+32},I.ctz=I.countTrailingZeros,I.and=function(f){return i(f)||(f=h(f)),l(this.low&f.low,this.high&f.high,this.unsigned)},I.or=function(f){return i(f)||(f=h(f)),l(this.low|f.low,this.high|f.high,this.unsigned)},I.xor=function(f){return i(f)||(f=h(f)),l(this.low^f.low,this.high^f.high,this.unsigned)},I.shiftLeft=function(f){return i(f)&&(f=f.toInt()),(f&=63)===0?this:f<32?l(this.low<<f,this.high<<f|this.low>>>32-f,this.unsigned):l(0,this.low<<f-32,this.unsigned)},I.shl=I.shiftLeft,I.shiftRight=function(f){return i(f)&&(f=f.toInt()),(f&=63)===0?this:f<32?l(this.low>>>f|this.high<<32-f,this.high>>f,this.unsigned):l(this.high>>f-32,this.high>=0?0:-1,this.unsigned)},I.shr=I.shiftRight,I.shiftRightUnsigned=function(f){return i(f)&&(f=f.toInt()),(f&=63)===0?this:f<32?l(this.low>>>f|this.high<<32-f,this.high>>>f,this.unsigned):f===32?l(this.high,0,this.unsigned):l(this.high>>>f-32,0,this.unsigned)},I.shru=I.shiftRightUnsigned,I.shr_u=I.shiftRightUnsigned,I.rotateLeft=function(f){var U;return i(f)&&(f=f.toInt()),(f&=63)===0?this:f===32?l(this.high,this.low,this.unsigned):f<32?(U=32-f,l(this.low<<f|this.high>>>U,this.high<<f|this.low>>>U,this.unsigned)):(f-=32,U=32-f,l(this.high<<f|this.low>>>U,this.low<<f|this.high>>>U,this.unsigned))},I.rotl=I.rotateLeft,I.rotateRight=function(f){var U;return i(f)&&(f=f.toInt()),(f&=63)===0?this:f===32?l(this.high,this.low,this.unsigned):f<32?(U=32-f,l(this.high<<U|this.low>>>f,this.low<<U|this.high>>>f,this.unsigned)):(f-=32,U=32-f,l(this.low<<U|this.high>>>f,this.high<<U|this.low>>>f,this.unsigned))},I.rotr=I.rotateRight,I.toSigned=function(){return this.unsigned?l(this.low,this.high,!1):this},I.toUnsigned=function(){return this.unsigned?this:l(this.low,this.high,!0)},I.toBytes=function(f){return f?this.toBytesLE():this.toBytesBE()},I.toBytesLE=function(){var f=this.high,U=this.low;return[U&255,U>>>8&255,U>>>16&255,U>>>24,f&255,f>>>8&255,f>>>16&255,f>>>24]},I.toBytesBE=function(){var f=this.high,U=this.low;return[f>>>24,f>>>16&255,f>>>8&255,f&255,U>>>24,U>>>16&255,U>>>8&255,U&255]},t.fromBytes=function(f,U,Ce){return Ce?t.fromBytesLE(f,U):t.fromBytesBE(f,U)},t.fromBytesLE=function(f,U){return new t(f[0]|f[1]<<8|f[2]<<16|f[3]<<24,f[4]|f[5]<<8|f[6]<<16|f[7]<<24,U)},t.fromBytesBE=function(f,U){return new t(f[4]<<24|f[5]<<16|f[6]<<8|f[7],f[0]<<24|f[1]<<16|f[2]<<8|f[3],U)};var et=t;return n.default=et,"default"in n?n.default:n}({});typeof define=="function"&&define.amd?define([],function(){return k1}):typeof Xv=="object"&&typeof R1=="object"&&(Xv.exports=k1)});var t_=E(Wt=>{"use strict";Object.defineProperty(Wt,"__esModule",{value:!0});Wt.loadFileDescriptorSetFromObject=Wt.loadFileDescriptorSetFromBuffer=Wt.fromJSON=Wt.loadSync=Wt.load=Wt.isAnyExtension=Wt.Long=void 0;var P4=vA(),qi=Nf(),Jv=C1(),e_=D1(),N4=M1();Wt.Long=N4;function F4(n){return"@type"in n&&typeof n["@type"]=="string"}Wt.isAnyExtension=F4;var N1={longs:String,enums:String,bytes:String,defaults:!0,oneofs:!0,json:!0};function L4(n,e){return n===""?e:n+"."+e}function B4(n){return n instanceof qi.Service||n instanceof qi.Type||n instanceof qi.Enum}function V4(n){return n instanceof qi.Namespace||n instanceof qi.Root}function F1(n,e){let t=L4(e,n.name);return B4(n)?[[t,n]]:V4(n)&&typeof n.nested<"u"?Object.keys(n.nested).map(i=>F1(n.nested[i],t)).reduce((i,r)=>i.concat(r),[]):[]}function O1(n,e){return function(i){return n.toObject(n.decode(i),e)}}function P1(n){return function(t){if(Array.isArray(t))throw new Error(`Failed to serialize message: expected object with ${n.name} structure, got array instead`);let i=n.fromObject(t);return n.encode(i).finish()}}function U4(n,e,t,i){let r=n.resolvedRequestType,s=n.resolvedResponseType;return{path:"/"+e+"/"+n.name,requestStream:!!n.requestStream,responseStream:!!n.responseStream,requestSerialize:P1(r),requestDeserialize:O1(r,t),responseSerialize:P1(s),responseDeserialize:O1(s,t),originalName:P4(n.name),requestType:Zv(r,i),responseType:Zv(s,i)}}function j4(n,e,t,i){let r={};for(let s of n.methodsArray)r[s.name]=U4(s,e,t,i);return r}function Zv(n,e){let t=n.toDescriptor("proto3");return{format:"Protocol Buffer 3 DescriptorProto",type:t.$type.toObject(t,N1),fileDescriptorProtos:e}}function q4(n,e){let t=n.toDescriptor("proto3");return{format:"Protocol Buffer 3 EnumDescriptorProto",type:t.$type.toObject(t,N1),fileDescriptorProtos:e}}function z4(n,e,t,i){if(n instanceof qi.Service)return j4(n,e,t,i);if(n instanceof qi.Type)return Zv(n,i);if(n instanceof qi.Enum)return q4(n,i);throw new Error("Type mismatch in reflection object handling")}function Bf(n,e){let t={};n.resolveAll();let r=n.toDescriptor("proto3").file.map(s=>Buffer.from(Jv.FileDescriptorProto.encode(s).finish()));for(let[s,o]of F1(n,""))t[s]=z4(o,s,e,r);return t}function L1(n,e){e=e||{};let t=qi.Root.fromDescriptor(n);return t.resolveAll(),Bf(t,e)}function G4(n,e){return(0,e_.loadProtosWithOptions)(n,e).then(t=>Bf(t,e))}Wt.load=G4;function W4(n,e){let t=(0,e_.loadProtosWithOptionsSync)(n,e);return Bf(t,e)}Wt.loadSync=W4;function $4(n,e){e=e||{};let t=qi.Root.fromJSON(n);return t.resolveAll(),Bf(t,e)}Wt.fromJSON=$4;function H4(n,e){let t=Jv.FileDescriptorSet.decode(n);return L1(t,e)}Wt.loadFileDescriptorSetFromBuffer=H4;function K4(n,e){let t=Jv.FileDescriptorSet.fromObject(n);return L1(t,e)}Wt.loadFileDescriptorSetFromObject=K4;(0,e_.addCommonProtos)()});var to=E(He=>{"use strict";Object.defineProperty(He,"__esModule",{value:!0});He.setup=He.getChannelzServiceDefinition=He.getChannelzHandlers=He.unregisterChannelzRef=He.registerChannelzSocket=He.registerChannelzServer=He.registerChannelzSubchannel=He.registerChannelzChannel=He.ChannelzCallTracker=He.ChannelzChildrenTracker=He.ChannelzTrace=void 0;var B1=Ie("net"),ou=Pn(),cu=Te(),Q4=Mi(),Y4=sf(),X4=Zb();function n_(n){return{channel_id:n.id,name:n.name}}function o_(n){return{subchannel_id:n.id,name:n.name}}function Z4(n){return{server_id:n.id}}function Uf(n){return{socket_id:n.id,name:n.name}}var V1=32,i_=class{constructor(){this.events=[],this.eventsLogged=0,this.creationTimestamp=new Date}addTrace(e,t,i){let r=new Date;this.events.push({description:t,severity:e,timestamp:r,childChannel:i?.kind==="channel"?i:void 0,childSubchannel:i?.kind==="subchannel"?i:void 0}),this.events.length>=V1*2&&(this.events=this.events.slice(V1)),this.eventsLogged+=1}getTraceMessage(){return{creation_timestamp:br(this.creationTimestamp),num_events_logged:this.eventsLogged,events:this.events.map(e=>({description:e.description,severity:e.severity,timestamp:br(e.timestamp),channel_ref:e.childChannel?n_(e.childChannel):null,subchannel_ref:e.childSubchannel?o_(e.childSubchannel):null}))}}};He.ChannelzTrace=i_;var r_=class{constructor(){this.channelChildren=new Map,this.subchannelChildren=new Map,this.socketChildren=new Map}refChild(e){var t,i,r;switch(e.kind){case"channel":{let s=(t=this.channelChildren.get(e.id))!==null&&t!==void 0?t:{ref:e,count:0};s.count+=1,this.channelChildren.set(e.id,s);break}case"subchannel":{let s=(i=this.subchannelChildren.get(e.id))!==null&&i!==void 0?i:{ref:e,count:0};s.count+=1,this.subchannelChildren.set(e.id,s);break}case"socket":{let s=(r=this.socketChildren.get(e.id))!==null&&r!==void 0?r:{ref:e,count:0};s.count+=1,this.socketChildren.set(e.id,s);break}}}unrefChild(e){switch(e.kind){case"channel":{let t=this.channelChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.channelChildren.delete(e.id):this.channelChildren.set(e.id,t));break}case"subchannel":{let t=this.subchannelChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.subchannelChildren.delete(e.id):this.subchannelChildren.set(e.id,t));break}case"socket":{let t=this.socketChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.socketChildren.delete(e.id):this.socketChildren.set(e.id,t));break}}}getChildLists(){let e=[];for(let{ref:r}of this.channelChildren.values())e.push(r);let t=[];for(let{ref:r}of this.subchannelChildren.values())t.push(r);let i=[];for(let{ref:r}of this.socketChildren.values())i.push(r);return{channels:e,subchannels:t,sockets:i}}};He.ChannelzChildrenTracker=r_;var s_=class{constructor(){this.callsStarted=0,this.callsSucceeded=0,this.callsFailed=0,this.lastCallStartedTimestamp=null}addCallStarted(){this.callsStarted+=1,this.lastCallStartedTimestamp=new Date}addCallSucceeded(){this.callsSucceeded+=1}addCallFailed(){this.callsFailed+=1}};He.ChannelzCallTracker=s_;var J4=1;function jf(){return J4++}var au=[],a_=[],is=[],c_=[];function ej(n,e,t){let i=jf(),r={id:i,name:n,kind:"channel"};return t&&(au[i]={ref:r,getInfo:e}),r}He.registerChannelzChannel=ej;function tj(n,e,t){let i=jf(),r={id:i,name:n,kind:"subchannel"};return t&&(a_[i]={ref:r,getInfo:e}),r}He.registerChannelzSubchannel=tj;function nj(n,e){let t=jf(),i={id:t,kind:"server"};return e&&(is[t]={ref:i,getInfo:n}),i}He.registerChannelzServer=nj;function ij(n,e,t){let i=jf(),r={id:i,name:n,kind:"socket"};return t&&(c_[i]={ref:r,getInfo:e}),r}He.registerChannelzSocket=ij;function rj(n){switch(n.kind){case"channel":delete au[n.id];return;case"subchannel":delete a_[n.id];return;case"server":delete is[n.id];return;case"socket":delete c_[n.id];return}}He.unregisterChannelzRef=rj;function sj(n){let e=Number.parseInt(n,16);return[e/256|0,e%256]}function U1(n){if(n==="")return[];let e=n.split(":").map(i=>sj(i));return[].concat(...e)}function oj(n){if((0,B1.isIPv4)(n))return Buffer.from(Uint8Array.from(n.split(".").map(e=>Number.parseInt(e))));if((0,B1.isIPv6)(n)){let e,t,i=n.indexOf("::");i===-1?(e=n,t=""):(e=n.substring(0,i),t=n.substring(i+2));let r=Buffer.from(U1(e)),s=Buffer.from(U1(t)),o=Buffer.alloc(16-r.length-s.length,0);return Buffer.concat([r,o,s])}else return null}function q1(n){switch(n){case ou.ConnectivityState.CONNECTING:return{state:"CONNECTING"};case ou.ConnectivityState.IDLE:return{state:"IDLE"};case ou.ConnectivityState.READY:return{state:"READY"};case ou.ConnectivityState.SHUTDOWN:return{state:"SHUTDOWN"};case ou.ConnectivityState.TRANSIENT_FAILURE:return{state:"TRANSIENT_FAILURE"};default:return{state:"UNKNOWN"}}}function br(n){if(!n)return null;let e=n.getTime();return{seconds:e/1e3|0,nanos:e%1e3*1e6}}function z1(n){let e=n.getInfo();return{ref:n_(n.ref),data:{target:e.target,state:q1(e.state),calls_started:e.callTracker.callsStarted,calls_succeeded:e.callTracker.callsSucceeded,calls_failed:e.callTracker.callsFailed,last_call_started_timestamp:br(e.callTracker.lastCallStartedTimestamp),trace:e.trace.getTraceMessage()},channel_ref:e.children.channels.map(t=>n_(t)),subchannel_ref:e.children.subchannels.map(t=>o_(t))}}function aj(n,e){let t=Number.parseInt(n.request.channel_id),i=au[t];if(i===void 0){e({code:cu.Status.NOT_FOUND,details:"No channel data found for id "+t});return}e(null,{channel:z1(i)})}function cj(n,e){let t=Number.parseInt(n.request.max_results),i=[],r=Number.parseInt(n.request.start_channel_id);for(;r<au.length;r++){let s=au[r];if(s!==void 0&&(i.push(z1(s)),i.length>=t))break}e(null,{channel:i,end:r>=is.length})}function G1(n){let e=n.getInfo();return{ref:Z4(n.ref),data:{calls_started:e.callTracker.callsStarted,calls_succeeded:e.callTracker.callsSucceeded,calls_failed:e.callTracker.callsFailed,last_call_started_timestamp:br(e.callTracker.lastCallStartedTimestamp),trace:e.trace.getTraceMessage()},listen_socket:e.listenerChildren.sockets.map(t=>Uf(t))}}function lj(n,e){let t=Number.parseInt(n.request.server_id),i=is[t];if(i===void 0){e({code:cu.Status.NOT_FOUND,details:"No server data found for id "+t});return}e(null,{server:G1(i)})}function uj(n,e){let t=Number.parseInt(n.request.max_results),i=[],r=Number.parseInt(n.request.start_server_id);for(;r<is.length;r++){let s=is[r];if(s!==void 0&&(i.push(G1(s)),i.length>=t))break}e(null,{server:i,end:r>=is.length})}function dj(n,e){let t=Number.parseInt(n.request.subchannel_id),i=a_[t];if(i===void 0){e({code:cu.Status.NOT_FOUND,details:"No subchannel data found for id "+t});return}let r=i.getInfo(),s={ref:o_(i.ref),data:{target:r.target,state:q1(r.state),calls_started:r.callTracker.callsStarted,calls_succeeded:r.callTracker.callsSucceeded,calls_failed:r.callTracker.callsFailed,last_call_started_timestamp:br(r.callTracker.lastCallStartedTimestamp),trace:r.trace.getTraceMessage()},socket_ref:r.children.sockets.map(o=>Uf(o))};e(null,{subchannel:s})}function j1(n){var e;return(0,Q4.isTcpSubchannelAddress)(n)?{address:"tcpip_address",tcpip_address:{ip_address:(e=oj(n.host))!==null&&e!==void 0?e:void 0,port:n.port}}:{address:"uds_address",uds_address:{filename:n.path}}}function hj(n,e){var t,i,r,s,o;let a=Number.parseInt(n.request.socket_id),c=c_[a];if(c===void 0){e({code:cu.Status.NOT_FOUND,details:"No socket data found for id "+a});return}let l=c.getInfo(),u=l.security?{model:"tls",tls:{cipher_suite:l.security.cipherSuiteStandardName?"standard_name":"other_name",standard_name:(t=l.security.cipherSuiteStandardName)!==null&&t!==void 0?t:void 0,other_name:(i=l.security.cipherSuiteOtherName)!==null&&i!==void 0?i:void 0,local_certificate:(r=l.security.localCertificate)!==null&&r!==void 0?r:void 0,remote_certificate:(s=l.security.remoteCertificate)!==null&&s!==void 0?s:void 0}}:null,d={ref:Uf(c.ref),local:l.localAddress?j1(l.localAddress):null,remote:l.remoteAddress?j1(l.remoteAddress):null,remote_name:(o=l.remoteName)!==null&&o!==void 0?o:void 0,security:u,data:{keep_alives_sent:l.keepAlivesSent,streams_started:l.streamsStarted,streams_succeeded:l.streamsSucceeded,streams_failed:l.streamsFailed,last_local_stream_created_timestamp:br(l.lastLocalStreamCreatedTimestamp),last_remote_stream_created_timestamp:br(l.lastRemoteStreamCreatedTimestamp),messages_received:l.messagesReceived,messages_sent:l.messagesSent,last_message_received_timestamp:br(l.lastMessageReceivedTimestamp),last_message_sent_timestamp:br(l.lastMessageSentTimestamp),local_flow_control_window:l.localFlowControlWindow?{value:l.localFlowControlWindow}:null,remote_flow_control_window:l.remoteFlowControlWindow?{value:l.remoteFlowControlWindow}:null}};e(null,{socket:d})}function fj(n,e){let t=Number.parseInt(n.request.server_id),i=is[t];if(i===void 0){e({code:cu.Status.NOT_FOUND,details:"No server data found for id "+t});return}let r=Number.parseInt(n.request.start_socket_id),s=Number.parseInt(n.request.max_results),a=i.getInfo().sessionChildren.sockets.sort((u,d)=>u.id-d.id),c=[],l=0;for(;l<a.length&&!(a[l].id>=r&&(c.push(Uf(a[l])),c.length>=s));l++);e(null,{socket_ref:c,end:l>=a.length})}function W1(){return{GetChannel:aj,GetTopChannels:cj,GetServer:lj,GetServers:uj,GetSubchannel:dj,GetSocket:hj,GetServerSockets:fj}}He.getChannelzHandlers=W1;var Vf=null;function $1(){if(Vf)return Vf;let n=t_().loadSync,e=n("channelz.proto",{keepCase:!0,longs:String,enums:String,defaults:!0,oneofs:!0,includeDirs:[`${__dirname}/../../proto`]});return Vf=(0,X4.loadPackageDefinition)(e).grpc.channelz.v1.Channelz.service,Vf}He.getChannelzServiceDefinition=$1;function mj(){(0,Y4.registerAdminService)($1,W1)}He.setup=mj});var H1=E(zf=>{"use strict";Object.defineProperty(zf,"__esModule",{value:!0});zf.Subchannel=void 0;var Be=Pn(),pj=jl(),l_=rt(),qf=Te(),gj=_n(),yj=Mi(),La=to(),bj="subchannel",vj=~(1<<31),u_=class{constructor(e,t,i,r,s){var o;this.channelTarget=e,this.subchannelAddress=t,this.options=i,this.credentials=r,this.connector=s,this.connectivityState=Be.ConnectivityState.IDLE,this.transport=null,this.continueConnecting=!1,this.stateListeners=new Set,this.refcount=0,this.channelzEnabled=!0,this.callTracker=new La.ChannelzCallTracker,this.childrenTracker=new La.ChannelzChildrenTracker,this.streamTracker=new La.ChannelzCallTracker;let a={initialDelay:i["grpc.initial_reconnect_backoff_ms"],maxDelay:i["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new pj.BackoffTimeout(()=>{this.handleBackoffTimer()},a),this.backoffTimeout.unref(),this.subchannelAddressString=(0,yj.subchannelAddressToString)(t),this.keepaliveTime=(o=i["grpc.keepalive_time_ms"])!==null&&o!==void 0?o:-1,i["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzTrace=new La.ChannelzTrace,this.channelzRef=(0,La.registerChannelzSubchannel)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Subchannel created"),this.trace("Subchannel constructed with options "+JSON.stringify(i,void 0,2))}getChannelzInfo(){return{state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists(),target:this.subchannelAddressString}}trace(e){l_.trace(qf.LogVerbosity.DEBUG,bj,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}refTrace(e){l_.trace(qf.LogVerbosity.DEBUG,"subchannel_refcount","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}handleBackoffTimer(){this.continueConnecting?this.transitionToState([Be.ConnectivityState.TRANSIENT_FAILURE],Be.ConnectivityState.CONNECTING):this.transitionToState([Be.ConnectivityState.TRANSIENT_FAILURE],Be.ConnectivityState.IDLE)}startBackoff(){this.backoffTimeout.runOnce()}stopBackoff(){this.backoffTimeout.stop(),this.backoffTimeout.reset()}startConnectingInternal(){let e=this.options;if(e["grpc.keepalive_time_ms"]){let t=Math.min(this.keepaliveTime,vj);e=Object.assign(Object.assign({},e),{"grpc.keepalive_time_ms":t})}this.connector.connect(this.subchannelAddress,this.credentials,e).then(t=>{this.transitionToState([Be.ConnectivityState.CONNECTING],Be.ConnectivityState.READY)?(this.transport=t,this.channelzEnabled&&this.childrenTracker.refChild(t.getChannelzRef()),t.addDisconnectListener(i=>{this.transitionToState([Be.ConnectivityState.READY],Be.ConnectivityState.IDLE),i&&this.keepaliveTime>0&&(this.keepaliveTime*=2,l_.log(qf.LogVerbosity.ERROR,`Connection to ${(0,gj.uriToString)(this.channelTarget)} at ${this.subchannelAddressString} rejected by server because of excess pings. Increasing ping interval to ${this.keepaliveTime} ms`))})):t.shutdown()},t=>{this.transitionToState([Be.ConnectivityState.CONNECTING],Be.ConnectivityState.TRANSIENT_FAILURE,`${t}`)})}transitionToState(e,t,i){var r,s;if(e.indexOf(this.connectivityState)===-1)return!1;this.trace(Be.ConnectivityState[this.connectivityState]+" -> "+Be.ConnectivityState[t]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+Be.ConnectivityState[t]);let o=this.connectivityState;switch(this.connectivityState=t,t){case Be.ConnectivityState.READY:this.stopBackoff();break;case Be.ConnectivityState.CONNECTING:this.startBackoff(),this.startConnectingInternal(),this.continueConnecting=!1;break;case Be.ConnectivityState.TRANSIENT_FAILURE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),(r=this.transport)===null||r===void 0||r.shutdown(),this.transport=null,this.backoffTimeout.isRunning()||process.nextTick(()=>{this.handleBackoffTimer()});break;case Be.ConnectivityState.IDLE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),(s=this.transport)===null||s===void 0||s.shutdown(),this.transport=null;break;default:throw new Error(`Invalid state: unknown ConnectivityState ${t}`)}for(let a of this.stateListeners)a(this,o,t,this.keepaliveTime,i);return!0}ref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount+1)),this.refcount+=1}unref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount-1)),this.refcount-=1,this.refcount===0&&(this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Shutting down"),this.channelzEnabled&&(0,La.unregisterChannelzRef)(this.channelzRef),process.nextTick(()=>{this.transitionToState([Be.ConnectivityState.CONNECTING,Be.ConnectivityState.READY],Be.ConnectivityState.IDLE)}))}unrefIfOneRef(){return this.refcount===1?(this.unref(),!0):!1}createCall(e,t,i,r){if(!this.transport)throw new Error("Cannot create call, subchannel not READY");let s;return this.channelzEnabled?(this.callTracker.addCallStarted(),this.streamTracker.addCallStarted(),s={onCallEnd:o=>{o.code===qf.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}}):s={},this.transport.createCall(e,t,i,r,s)}startConnecting(){process.nextTick(()=>{this.transitionToState([Be.ConnectivityState.IDLE],Be.ConnectivityState.CONNECTING)||this.connectivityState===Be.ConnectivityState.TRANSIENT_FAILURE&&(this.continueConnecting=!0)})}getConnectivityState(){return this.connectivityState}addConnectivityStateListener(e){this.stateListeners.add(e)}removeConnectivityStateListener(e){this.stateListeners.delete(e)}resetBackoff(){process.nextTick(()=>{this.backoffTimeout.reset(),this.transitionToState([Be.ConnectivityState.TRANSIENT_FAILURE],Be.ConnectivityState.CONNECTING)})}getAddress(){return this.subchannelAddressString}getChannelzRef(){return this.channelzRef}getRealSubchannel(){return this}realSubchannelEquals(e){return e.getRealSubchannel()===this}throttleKeepalive(e){e>this.keepaliveTime&&(this.keepaliveTime=e)}};zf.Subchannel=u_});var m_=E(os=>{"use strict";Object.defineProperty(os,"__esModule",{value:!0});os.setup=os.DEFAULT_PORT=void 0;var K1=ki(),Y1=Ie("dns"),X1=Ie("util"),_j=Tb(),d_=Te(),h_=nn(),wj=rt(),Cj=Te(),rs=_n(),Q1=Ie("net"),Ej=jl(),Sj="dns_resolver";function ss(n){wj.trace(Cj.LogVerbosity.DEBUG,Sj,n)}os.DEFAULT_PORT=443;var Tj=3e4,xj=X1.promisify(Y1.resolveTxt),Ij=X1.promisify(Y1.lookup);function Aj(...n){let e=[];for(let t=0;t<Math.max.apply(null,n.map(i=>i.length));t++)for(let i of n)t<i.length&&e.push(i[t]);return e}var f_=class{constructor(e,t,i){var r,s,o;this.target=e,this.listener=t,this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.continueResolving=!1,this.isNextResolutionTimerRunning=!1,this.isServiceConfigEnabled=!0,this.returnedIpResult=!1,ss("Resolver constructed for target "+(0,rs.uriToString)(e));let a=(0,rs.splitHostPort)(e.path);a===null?(this.ipResult=null,this.dnsHostname=null,this.port=null):(0,Q1.isIPv4)(a.host)||(0,Q1.isIPv6)(a.host)?(this.ipResult=[{host:a.host,port:(r=a.port)!==null&&r!==void 0?r:os.DEFAULT_PORT}],this.dnsHostname=null,this.port=null):(this.ipResult=null,this.dnsHostname=a.host,this.port=(s=a.port)!==null&&s!==void 0?s:os.DEFAULT_PORT),this.percentage=Math.random()*100,i["grpc.service_config_disable_resolution"]===1&&(this.isServiceConfigEnabled=!1),this.defaultResolutionError={code:d_.Status.UNAVAILABLE,details:`Name resolution failed for target ${(0,rs.uriToString)(this.target)}`,metadata:new h_.Metadata};let c={initialDelay:i["grpc.initial_reconnect_backoff_ms"],maxDelay:i["grpc.max_reconnect_backoff_ms"]};this.backoff=new Ej.BackoffTimeout(()=>{this.continueResolving&&this.startResolutionWithBackoff()},c),this.backoff.unref(),this.minTimeBetweenResolutionsMs=(o=i["grpc.dns_min_time_between_resolutions_ms"])!==null&&o!==void 0?o:Tj,this.nextResolutionTimer=setTimeout(()=>{},0),clearTimeout(this.nextResolutionTimer)}startResolution(){if(this.ipResult!==null){this.returnedIpResult||(ss("Returning IP address for target "+(0,rs.uriToString)(this.target)),setImmediate(()=>{this.listener.onSuccessfulResolution(this.ipResult,null,null,null,{})}),this.returnedIpResult=!0),this.backoff.stop(),this.backoff.reset(),this.stopNextResolutionTimer();return}if(this.dnsHostname===null)ss("Failed to parse DNS address "+(0,rs.uriToString)(this.target)),setImmediate(()=>{this.listener.onError({code:d_.Status.UNAVAILABLE,details:`Failed to parse DNS address ${(0,rs.uriToString)(this.target)}`,metadata:new h_.Metadata})}),this.stopNextResolutionTimer();else{if(this.pendingLookupPromise!==null)return;ss("Looking up DNS hostname "+this.dnsHostname),this.latestLookupResult=null;let e=this.dnsHostname;this.pendingLookupPromise=Ij(e,{all:!0}),this.pendingLookupPromise.then(t=>{if(this.pendingLookupPromise===null)return;this.pendingLookupPromise=null,this.backoff.reset(),this.backoff.stop();let i=t.filter(o=>o.family===4),r=t.filter(o=>o.family===6);this.latestLookupResult=Aj(r,i).map(o=>({host:o.address,port:+this.port}));let s="["+this.latestLookupResult.map(o=>o.host+":"+o.port).join(",")+"]";if(ss("Resolved addresses for target "+(0,rs.uriToString)(this.target)+": "+s),this.latestLookupResult.length===0){this.listener.onError(this.defaultResolutionError);return}this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})},t=>{this.pendingLookupPromise!==null&&(ss("Resolution error for target "+(0,rs.uriToString)(this.target)+": "+t.message),this.pendingLookupPromise=null,this.stopNextResolutionTimer(),this.listener.onError(this.defaultResolutionError))}),this.isServiceConfigEnabled&&this.pendingTxtPromise===null&&(this.pendingTxtPromise=xj(e),this.pendingTxtPromise.then(t=>{if(this.pendingTxtPromise!==null){this.pendingTxtPromise=null;try{this.latestServiceConfig=(0,_j.extractAndSelectServiceConfig)(t,this.percentage)}catch(i){this.latestServiceConfigError={code:d_.Status.UNAVAILABLE,details:`Parsing service config failed with error ${i.message}`,metadata:new h_.Metadata}}this.latestLookupResult!==null&&this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})}},t=>{}))}}startNextResolutionTimer(){var e,t;clearTimeout(this.nextResolutionTimer),this.nextResolutionTimer=(t=(e=setTimeout(()=>{this.stopNextResolutionTimer(),this.continueResolving&&this.startResolutionWithBackoff()},this.minTimeBetweenResolutionsMs)).unref)===null||t===void 0?void 0:t.call(e),this.isNextResolutionTimerRunning=!0}stopNextResolutionTimer(){clearTimeout(this.nextResolutionTimer),this.isNextResolutionTimerRunning=!1}startResolutionWithBackoff(){this.pendingLookupPromise===null&&(this.continueResolving=!1,this.backoff.runOnce(),this.startNextResolutionTimer(),this.startResolution())}updateResolution(){this.pendingLookupPromise===null&&(this.isNextResolutionTimerRunning||this.backoff.isRunning()?(this.isNextResolutionTimerRunning?ss('resolution update delayed by "min time between resolutions" rate limit'):ss("resolution update delayed by backoff timer until "+this.backoff.getEndTime().toISOString()),this.continueResolving=!0):this.startResolutionWithBackoff())}destroy(){this.continueResolving=!1,this.backoff.reset(),this.backoff.stop(),this.stopNextResolutionTimer(),this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.returnedIpResult=!1}static getDefaultAuthority(e){return e.path}};function Dj(){(0,K1.registerResolver)("dns",f_),(0,K1.registerDefaultScheme)("dns")}os.setup=Dj});var p_=E(Ua=>{"use strict";Object.defineProperty(Ua,"__esModule",{value:!0});Ua.getProxiedConnection=Ua.mapProxyName=void 0;var lu=rt(),Ba=Te(),kj=ki(),Rj=Ie("http"),Mj=Ie("tls"),Oj=rt(),Z1=Mi(),Va=_n(),Pj=Ie("url"),Nj=m_(),Fj="proxy";function as(n){Oj.trace(Ba.LogVerbosity.DEBUG,Fj,n)}function Lj(){let n="",e="";if(process.env.grpc_proxy)e="grpc_proxy",n=process.env.grpc_proxy;else if(process.env.https_proxy)e="https_proxy",n=process.env.https_proxy;else if(process.env.http_proxy)e="http_proxy",n=process.env.http_proxy;else return{};let t;try{t=new Pj.URL(n)}catch{return(0,lu.log)(Ba.LogVerbosity.ERROR,`cannot parse value of "${e}" env var`),{}}if(t.protocol!=="http:")return(0,lu.log)(Ba.LogVerbosity.ERROR,`"${t.protocol}" scheme not supported in proxy URI`),{};let i=null;t.username&&(t.password?((0,lu.log)(Ba.LogVerbosity.INFO,"userinfo found in proxy URI"),i=`${t.username}:${t.password}`):i=t.username);let r=t.hostname,s=t.port;s===""&&(s="80");let o={address:`${r}:${s}`};return i&&(o.creds=i),as("Proxy server "+o.address+" set by environment variable "+e),o}function Bj(){let n=process.env.no_grpc_proxy,e="no_grpc_proxy";return n||(n=process.env.no_proxy,e="no_proxy"),n?(as("No proxy server list set by environment variable "+e),n.split(",")):[]}function Vj(n,e){var t;let i={target:n,extraOptions:{}};if(((t=e["grpc.enable_http_proxy"])!==null&&t!==void 0?t:1)===0||n.scheme==="unix")return i;let r=Lj();if(!r.address)return i;let s=(0,Va.splitHostPort)(n.path);if(!s)return i;let o=s.host;for(let c of Bj())if(c===o)return as("Not using proxy for target in no_proxy list: "+(0,Va.uriToString)(n)),i;let a={"grpc.http_connect_target":(0,Va.uriToString)(n)};return r.creds&&(a["grpc.http_connect_creds"]=r.creds),{target:{scheme:"dns",path:r.address},extraOptions:a}}Ua.mapProxyName=Vj;function Uj(n,e,t){var i;if(!("grpc.http_connect_target"in e))return Promise.resolve({});let r=e["grpc.http_connect_target"],s=(0,Va.parseUri)(r);if(s===null)return Promise.resolve({});let o=(0,Va.splitHostPort)(s.path);if(o===null)return Promise.resolve({});let a=`${o.host}:${(i=o.port)!==null&&i!==void 0?i:Nj.DEFAULT_PORT}`,c={method:"CONNECT",path:a},l={Host:a};(0,Z1.isTcpSubchannelAddress)(n)?(c.host=n.host,c.port=n.port):c.socketPath=n.path,"grpc.http_connect_creds"in e&&(l["Proxy-Authorization"]="Basic "+Buffer.from(e["grpc.http_connect_creds"]).toString("base64")),c.headers=l;let u=(0,Z1.subchannelAddressToString)(n);return as("Using proxy "+u+" to connect to "+c.path),new Promise((d,h)=>{let m=Rj.request(c);m.once("connect",(g,y,_)=>{var M;if(m.removeAllListeners(),y.removeAllListeners(),g.statusCode===200)if(as("Successfully connected to "+c.path+" through proxy "+u),"secureContext"in t){let T=(0,kj.getDefaultAuthority)(s),O=(0,Va.splitHostPort)(T),P=(M=O?.host)!==null&&M!==void 0?M:T,W=Mj.connect(Object.assign({host:P,servername:P,socket:y},t),()=>{as("Successfully established a TLS connection to "+c.path+" through proxy "+u),d({socket:W,realTarget:s})});W.on("error",X=>{as("Failed to establish a TLS connection to "+c.path+" through proxy "+u+" with error "+X.message),h()})}else as("Successfully established a plaintext connection to "+c.path+" through proxy "+u),d({socket:y,realTarget:s});else(0,lu.log)(Ba.LogVerbosity.ERROR,"Failed to connect to "+c.path+" through proxy "+u+" with status "+g.statusCode),h()}),m.once("error",g=>{m.removeAllListeners(),(0,lu.log)(Ba.LogVerbosity.ERROR,"Failed to connect to proxy "+u+" with error "+g.message),h()}),m.end()})}Ua.getProxiedConnection=Uj});var y_=E(Gf=>{"use strict";Object.defineProperty(Gf,"__esModule",{value:!0});Gf.StreamDecoder=void 0;var vr=function(n){return n[n.NO_DATA=0]="NO_DATA",n[n.READING_SIZE=1]="READING_SIZE",n[n.READING_MESSAGE=2]="READING_MESSAGE",n}(vr||{}),g_=class{constructor(){this.readState=vr.NO_DATA,this.readCompressFlag=Buffer.alloc(1),this.readPartialSize=Buffer.alloc(4),this.readSizeRemaining=4,this.readMessageSize=0,this.readPartialMessage=[],this.readMessageRemaining=0}write(e){let t=0,i,r=[];for(;t<e.length;)switch(this.readState){case vr.NO_DATA:this.readCompressFlag=e.slice(t,t+1),t+=1,this.readState=vr.READING_SIZE,this.readPartialSize.fill(0),this.readSizeRemaining=4,this.readMessageSize=0,this.readMessageRemaining=0,this.readPartialMessage=[];break;case vr.READING_SIZE:if(i=Math.min(e.length-t,this.readSizeRemaining),e.copy(this.readPartialSize,4-this.readSizeRemaining,t,t+i),this.readSizeRemaining-=i,t+=i,this.readSizeRemaining===0)if(this.readMessageSize=this.readPartialSize.readUInt32BE(0),this.readMessageRemaining=this.readMessageSize,this.readMessageRemaining>0)this.readState=vr.READING_MESSAGE;else{let s=Buffer.concat([this.readCompressFlag,this.readPartialSize],5);this.readState=vr.NO_DATA,r.push(s)}break;case vr.READING_MESSAGE:if(i=Math.min(e.length-t,this.readMessageRemaining),this.readPartialMessage.push(e.slice(t,t+i)),this.readMessageRemaining-=i,t+=i,this.readMessageRemaining===0){let s=[this.readCompressFlag,this.readPartialSize].concat(this.readPartialMessage),o=Buffer.concat(s,this.readMessageSize+5);this.readState=vr.NO_DATA,r.push(o)}break;default:throw new Error("Unexpected read state")}return r}};Gf.StreamDecoder=g_});var J1=E(Wf=>{"use strict";Object.defineProperty(Wf,"__esModule",{value:!0});Wf.Http2SubchannelCall=void 0;var _r=Ie("http2"),jj=Ie("os"),Pe=Te(),cs=nn(),qj=y_(),zj=rt(),Gj=Te(),Wj="subchannel_call";function $j(n){for(let[e,t]of Object.entries(jj.constants.errno))if(t===n)return e;return"Unknown system error "+n}var b_=class{constructor(e,t,i,r,s){this.http2Stream=e,this.callEventTracker=t,this.listener=i,this.transport=r,this.callId=s,this.decoder=new qj.StreamDecoder,this.isReadFilterPending=!1,this.isPushPending=!1,this.canPush=!1,this.readsClosed=!1,this.statusOutput=!1,this.unpushedReadMessages=[],this.mappedStatusCode=Pe.Status.UNKNOWN,this.finalStatus=null,this.internalError=null,e.on("response",(o,a)=>{let c="";for(let l of Object.keys(o))c+="		"+l+": "+o[l]+`
`;switch(this.trace(`Received server headers:
`+c),o[":status"]){case 400:this.mappedStatusCode=Pe.Status.INTERNAL;break;case 401:this.mappedStatusCode=Pe.Status.UNAUTHENTICATED;break;case 403:this.mappedStatusCode=Pe.Status.PERMISSION_DENIED;break;case 404:this.mappedStatusCode=Pe.Status.UNIMPLEMENTED;break;case 429:case 502:case 503:case 504:this.mappedStatusCode=Pe.Status.UNAVAILABLE;break;default:this.mappedStatusCode=Pe.Status.UNKNOWN}if(a&_r.constants.NGHTTP2_FLAG_END_STREAM)this.handleTrailers(o);else{let l;try{l=cs.Metadata.fromHttp2Headers(o)}catch(u){this.endCall({code:Pe.Status.UNKNOWN,details:u.message,metadata:new cs.Metadata});return}this.listener.onReceiveMetadata(l)}}),e.on("trailers",o=>{this.handleTrailers(o)}),e.on("data",o=>{if(this.statusOutput)return;this.trace("receive HTTP/2 data frame of length "+o.length);let a=this.decoder.write(o);for(let c of a)this.trace("parsed message of length "+c.length),this.callEventTracker.addMessageReceived(),this.tryPush(c)}),e.on("end",()=>{this.readsClosed=!0,this.maybeOutputStatus()}),e.on("close",()=>{process.nextTick(()=>{var o;if(this.trace("HTTP/2 stream closed with code "+e.rstCode),((o=this.finalStatus)===null||o===void 0?void 0:o.code)===Pe.Status.OK)return;let a,c="";switch(e.rstCode){case _r.constants.NGHTTP2_NO_ERROR:if(this.finalStatus!==null)return;a=Pe.Status.INTERNAL,c=`Received RST_STREAM with code ${e.rstCode}`;break;case _r.constants.NGHTTP2_REFUSED_STREAM:a=Pe.Status.UNAVAILABLE,c="Stream refused by server";break;case _r.constants.NGHTTP2_CANCEL:a=Pe.Status.CANCELLED,c="Call cancelled";break;case _r.constants.NGHTTP2_ENHANCE_YOUR_CALM:a=Pe.Status.RESOURCE_EXHAUSTED,c="Bandwidth exhausted or memory limit exceeded";break;case _r.constants.NGHTTP2_INADEQUATE_SECURITY:a=Pe.Status.PERMISSION_DENIED,c="Protocol not secure enough";break;case _r.constants.NGHTTP2_INTERNAL_ERROR:a=Pe.Status.INTERNAL,this.internalError===null?c=`Received RST_STREAM with code ${e.rstCode} (Internal server error)`:this.internalError.code==="ECONNRESET"||this.internalError.code==="ETIMEDOUT"?(a=Pe.Status.UNAVAILABLE,c=this.internalError.message):c=`Received RST_STREAM with code ${e.rstCode} triggered by internal client error: ${this.internalError.message}`;break;default:a=Pe.Status.INTERNAL,c=`Received RST_STREAM with code ${e.rstCode}`}this.endCall({code:a,details:c,metadata:new cs.Metadata,rstCode:e.rstCode})})}),e.on("error",o=>{o.code!=="ERR_HTTP2_STREAM_ERROR"&&(this.trace("Node error event: message="+o.message+" code="+o.code+" errno="+$j(o.errno)+" syscall="+o.syscall),this.internalError=o),this.callEventTracker.onStreamEnd(!1)})}onDisconnect(){this.endCall({code:Pe.Status.UNAVAILABLE,details:"Connection dropped",metadata:new cs.Metadata})}outputStatus(){this.statusOutput||(this.statusOutput=!0,this.trace("ended with status: code="+this.finalStatus.code+' details="'+this.finalStatus.details+'"'),this.callEventTracker.onCallEnd(this.finalStatus),process.nextTick(()=>{this.listener.onReceiveStatus(this.finalStatus)}),this.http2Stream.resume())}trace(e){zj.trace(Gj.LogVerbosity.DEBUG,Wj,"["+this.callId+"] "+e)}endCall(e){(this.finalStatus===null||this.finalStatus.code===Pe.Status.OK)&&(this.finalStatus=e,this.maybeOutputStatus()),this.destroyHttp2Stream()}maybeOutputStatus(){this.finalStatus!==null&&(this.finalStatus.code!==Pe.Status.OK||this.readsClosed&&this.unpushedReadMessages.length===0&&!this.isReadFilterPending&&!this.isPushPending)&&this.outputStatus()}push(e){this.trace("pushing to reader message of length "+(e instanceof Buffer?e.length:null)),this.canPush=!1,this.isPushPending=!0,process.nextTick(()=>{this.isPushPending=!1,!this.statusOutput&&(this.listener.onReceiveMessage(e),this.maybeOutputStatus())})}tryPush(e){this.canPush?(this.http2Stream.pause(),this.push(e)):(this.trace("unpushedReadMessages.push message of length "+e.length),this.unpushedReadMessages.push(e))}handleTrailers(e){this.callEventTracker.onStreamEnd(!0);let t="";for(let c of Object.keys(e))t+="		"+c+": "+e[c]+`
`;this.trace(`Received server trailers:
`+t);let i;try{i=cs.Metadata.fromHttp2Headers(e)}catch{i=new cs.Metadata}let r=i.getMap(),s=this.mappedStatusCode;if(s===Pe.Status.UNKNOWN&&typeof r["grpc-status"]=="string"){let c=Number(r["grpc-status"]);c in Pe.Status&&(s=c,this.trace("received status code "+c+" from server")),i.remove("grpc-status")}let o="";if(typeof r["grpc-message"]=="string"){try{o=decodeURI(r["grpc-message"])}catch{o=r["grpc-message"]}i.remove("grpc-message"),this.trace('received status details string "'+o+'" from server')}let a={code:s,details:o,metadata:i};this.endCall(a)}destroyHttp2Stream(){var e;if(!this.http2Stream.destroyed){let t;((e=this.finalStatus)===null||e===void 0?void 0:e.code)===Pe.Status.OK?t=_r.constants.NGHTTP2_NO_ERROR:t=_r.constants.NGHTTP2_CANCEL,this.trace("close http2 stream with code "+t),this.http2Stream.close(t)}}cancelWithStatus(e,t){this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.endCall({code:e,details:t,metadata:new cs.Metadata})}getStatus(){return this.finalStatus}getPeer(){return this.transport.getPeerName()}getCallNumber(){return this.callId}startRead(){if(this.finalStatus!==null&&this.finalStatus.code!==Pe.Status.OK){this.readsClosed=!0,this.maybeOutputStatus();return}if(this.canPush=!0,this.unpushedReadMessages.length>0){let e=this.unpushedReadMessages.shift();this.push(e);return}this.http2Stream.resume()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length);let i=r=>{process.nextTick(()=>{var s;let o=Pe.Status.UNAVAILABLE;r?.code==="ERR_STREAM_WRITE_AFTER_END"&&(o=Pe.Status.INTERNAL),r&&this.cancelWithStatus(o,`Write error: ${r.message}`),(s=e.callback)===null||s===void 0||s.call(e)})};this.trace("sending data chunk of length "+t.length),this.callEventTracker.addMessageSent();try{this.http2Stream.write(t,i)}catch(r){this.endCall({code:Pe.Status.UNAVAILABLE,details:`Write failed with error ${r.message}`,metadata:new cs.Metadata})}}halfClose(){this.trace("end() called"),this.trace("calling end() on HTTP/2 stream"),this.http2Stream.end()}};Wf.Http2SubchannelCall=b_});var v_=E($f=>{"use strict";Object.defineProperty($f,"__esModule",{value:!0});$f.getNextCallNumber=void 0;var Hj=0;function Kj(){return Hj++}$f.getNextCallNumber=Kj});var nk=E(Kf=>{"use strict";Object.defineProperty(Kf,"__esModule",{value:!0});Kf.Http2SubchannelConnector=void 0;var S_=Ie("http2"),ek=Ie("tls"),__=to(),uu=Te(),Qj=p_(),qa=rt(),tk=ki(),Hf=Mi(),ja=_n(),Yj=Ie("net"),Xj=J1(),Zj=v_(),w_="transport",Jj="transport_flowctrl",eq=ab().version,{HTTP2_HEADER_AUTHORITY:tq,HTTP2_HEADER_CONTENT_TYPE:nq,HTTP2_HEADER_METHOD:iq,HTTP2_HEADER_PATH:rq,HTTP2_HEADER_TE:sq,HTTP2_HEADER_USER_AGENT:oq}=S_.constants,aq=2e4,cq=Buffer.from("too_many_pings","ascii"),C_=class{constructor(e,t,i,r){this.session=e,this.remoteName=r,this.keepaliveTimeMs=-1,this.keepaliveTimeoutMs=aq,this.keepaliveTimerId=null,this.pendingSendKeepalivePing=!1,this.keepaliveTimeoutId=null,this.keepaliveWithoutCalls=!1,this.activeCalls=new Set,this.disconnectListeners=[],this.disconnectHandled=!1,this.channelzEnabled=!0,this.streamTracker=new __.ChannelzCallTracker,this.keepalivesSent=0,this.messagesSent=0,this.messagesReceived=0,this.lastMessageSentTimestamp=null,this.lastMessageReceivedTimestamp=null,this.subchannelAddressString=(0,Hf.subchannelAddressToString)(t),i["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzRef=(0,__.registerChannelzSocket)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.userAgent=[i["grpc.primary_user_agent"],`grpc-node-js/${eq}`,i["grpc.secondary_user_agent"]].filter(s=>s).join(" "),"grpc.keepalive_time_ms"in i&&(this.keepaliveTimeMs=i["grpc.keepalive_time_ms"]),"grpc.keepalive_timeout_ms"in i&&(this.keepaliveTimeoutMs=i["grpc.keepalive_timeout_ms"]),"grpc.keepalive_permit_without_calls"in i?this.keepaliveWithoutCalls=i["grpc.keepalive_permit_without_calls"]===1:this.keepaliveWithoutCalls=!1,e.once("close",()=>{this.trace("session closed"),this.stopKeepalivePings(),this.handleDisconnect()}),e.once("goaway",(s,o,a)=>{let c=!1;s===S_.constants.NGHTTP2_ENHANCE_YOUR_CALM&&a&&a.equals(cq)&&(c=!0),this.trace("connection closed by GOAWAY with code "+s+" and data "+a?.toString()),this.reportDisconnectToOwner(c)}),e.once("error",s=>{this.trace("connection closed with error "+s.message)}),qa.isTracerEnabled(w_)&&(e.on("remoteSettings",s=>{this.trace("new settings received"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(s))}),e.on("localSettings",s=>{this.trace("local settings acknowledged by remote"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(s))})),this.keepaliveWithoutCalls&&this.maybeStartKeepalivePingTimer()}getChannelzInfo(){var e,t,i;let r=this.session.socket,s=r.remoteAddress?(0,Hf.stringToSubchannelAddress)(r.remoteAddress,r.remotePort):null,o=r.localAddress?(0,Hf.stringToSubchannelAddress)(r.localAddress,r.localPort):null,a;if(this.session.encrypted){let l=r,u=l.getCipher(),d=l.getCertificate(),h=l.getPeerCertificate();a={cipherSuiteStandardName:(e=u.standardName)!==null&&e!==void 0?e:null,cipherSuiteOtherName:u.standardName?null:u.name,localCertificate:d&&"raw"in d?d.raw:null,remoteCertificate:h&&"raw"in h?h.raw:null}}else a=null;return{remoteAddress:s,localAddress:o,security:a,remoteName:this.remoteName,streamsStarted:this.streamTracker.callsStarted,streamsSucceeded:this.streamTracker.callsSucceeded,streamsFailed:this.streamTracker.callsFailed,messagesSent:this.messagesSent,messagesReceived:this.messagesReceived,keepAlivesSent:this.keepalivesSent,lastLocalStreamCreatedTimestamp:this.streamTracker.lastCallStartedTimestamp,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:this.lastMessageSentTimestamp,lastMessageReceivedTimestamp:this.lastMessageReceivedTimestamp,localFlowControlWindow:(t=this.session.state.localWindowSize)!==null&&t!==void 0?t:null,remoteFlowControlWindow:(i=this.session.state.remoteWindowSize)!==null&&i!==void 0?i:null}}trace(e){qa.trace(uu.LogVerbosity.DEBUG,w_,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}keepaliveTrace(e){qa.trace(uu.LogVerbosity.DEBUG,"keepalive","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}flowControlTrace(e){qa.trace(uu.LogVerbosity.DEBUG,Jj,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}internalsTrace(e){qa.trace(uu.LogVerbosity.DEBUG,"transport_internals","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}reportDisconnectToOwner(e){this.disconnectHandled||(this.disconnectHandled=!0,this.disconnectListeners.forEach(t=>t(e)))}handleDisconnect(){this.reportDisconnectToOwner(!1),setImmediate(()=>{for(let e of this.activeCalls)e.onDisconnect()})}addDisconnectListener(e){this.disconnectListeners.push(e)}clearKeepaliveTimer(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null)}clearKeepaliveTimeout(){this.keepaliveTimeoutId&&(clearTimeout(this.keepaliveTimeoutId),this.keepaliveTimeoutId=null)}canSendPing(){return this.keepaliveTimeMs>0&&(this.keepaliveWithoutCalls||this.activeCalls.size>0)}maybeSendPing(){var e,t;if(this.clearKeepaliveTimer(),!this.canSendPing()){this.pendingSendKeepalivePing=!0;return}this.channelzEnabled&&(this.keepalivesSent+=1),this.keepaliveTrace("Sending ping with timeout "+this.keepaliveTimeoutMs+"ms"),this.keepaliveTimeoutId||(this.keepaliveTimeoutId=setTimeout(()=>{this.keepaliveTrace("Ping timeout passed without response"),this.handleDisconnect()},this.keepaliveTimeoutMs),(t=(e=this.keepaliveTimeoutId).unref)===null||t===void 0||t.call(e));try{this.session.ping((i,r,s)=>{i&&(this.keepaliveTrace("Ping failed with error "+i.message),this.handleDisconnect()),this.keepaliveTrace("Received ping response"),this.clearKeepaliveTimeout(),this.maybeStartKeepalivePingTimer()})}catch{this.handleDisconnect()}}maybeStartKeepalivePingTimer(){var e,t;this.canSendPing()&&(this.pendingSendKeepalivePing?(this.pendingSendKeepalivePing=!1,this.maybeSendPing()):!this.keepaliveTimerId&&!this.keepaliveTimeoutId&&(this.keepaliveTrace("Starting keepalive timer for "+this.keepaliveTimeMs+"ms"),this.keepaliveTimerId=(t=(e=setTimeout(()=>{this.maybeSendPing()},this.keepaliveTimeMs)).unref)===null||t===void 0?void 0:t.call(e)))}stopKeepalivePings(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null),this.clearKeepaliveTimeout()}removeActiveCall(e){this.activeCalls.delete(e),this.activeCalls.size===0&&this.session.unref()}addActiveCall(e){this.activeCalls.add(e),this.activeCalls.size===1&&(this.session.ref(),this.keepaliveWithoutCalls||this.maybeStartKeepalivePingTimer())}createCall(e,t,i,r,s){let o=e.toHttp2Headers();o[tq]=t,o[oq]=this.userAgent,o[nq]="application/grpc",o[iq]="POST",o[rq]=i,o[sq]="trailers";let a;try{a=this.session.request(o)}catch(u){throw this.handleDisconnect(),u}this.flowControlTrace("local window size: "+this.session.state.localWindowSize+" remote window size: "+this.session.state.remoteWindowSize),this.internalsTrace("session.closed="+this.session.closed+" session.destroyed="+this.session.destroyed+" session.socket.destroyed="+this.session.socket.destroyed);let c,l;return this.channelzEnabled?(this.streamTracker.addCallStarted(),c={addMessageSent:()=>{var u;this.messagesSent+=1,this.lastMessageSentTimestamp=new Date,(u=s.addMessageSent)===null||u===void 0||u.call(s)},addMessageReceived:()=>{var u;this.messagesReceived+=1,this.lastMessageReceivedTimestamp=new Date,(u=s.addMessageReceived)===null||u===void 0||u.call(s)},onCallEnd:u=>{var d;(d=s.onCallEnd)===null||d===void 0||d.call(s,u),this.removeActiveCall(l)},onStreamEnd:u=>{var d;u?this.streamTracker.addCallSucceeded():this.streamTracker.addCallFailed(),(d=s.onStreamEnd)===null||d===void 0||d.call(s,u)}}):c={addMessageSent:()=>{var u;(u=s.addMessageSent)===null||u===void 0||u.call(s)},addMessageReceived:()=>{var u;(u=s.addMessageReceived)===null||u===void 0||u.call(s)},onCallEnd:u=>{var d;(d=s.onCallEnd)===null||d===void 0||d.call(s,u),this.removeActiveCall(l)},onStreamEnd:u=>{var d;(d=s.onStreamEnd)===null||d===void 0||d.call(s,u)}},l=new Xj.Http2SubchannelCall(a,c,r,this,(0,Zj.getNextCallNumber)()),this.addActiveCall(l),l}getChannelzRef(){return this.channelzRef}getPeerName(){return this.subchannelAddressString}shutdown(){this.session.close(),(0,__.unregisterChannelzRef)(this.channelzRef)}},E_=class{constructor(e){this.channelTarget=e,this.session=null,this.isShutdown=!1}trace(e){qa.trace(uu.LogVerbosity.DEBUG,w_,(0,ja.uriToString)(this.channelTarget)+" "+e)}createSession(e,t,i,r){return this.isShutdown?Promise.reject():new Promise((s,o)=>{var a,c,l;let u;r.realTarget?(u=(0,ja.uriToString)(r.realTarget),this.trace("creating HTTP/2 session through proxy to "+(0,ja.uriToString)(r.realTarget))):(u=null,this.trace("creating HTTP/2 session to "+(0,Hf.subchannelAddressToString)(e)));let d=(0,tk.getDefaultAuthority)((a=r.realTarget)!==null&&a!==void 0?a:this.channelTarget),h=t._getConnectionOptions()||{};h.maxSendHeaderBlockLength=Number.MAX_SAFE_INTEGER,"grpc-node.max_session_memory"in i?h.maxSessionMemory=i["grpc-node.max_session_memory"]:h.maxSessionMemory=Number.MAX_SAFE_INTEGER;let m="http://";if("secureContext"in h){if(m="https://",i["grpc.ssl_target_name_override"]){let _=i["grpc.ssl_target_name_override"];h.checkServerIdentity=(M,T)=>(0,ek.checkServerIdentity)(_,T),h.servername=_}else{let _=(l=(c=(0,ja.splitHostPort)(d))===null||c===void 0?void 0:c.host)!==null&&l!==void 0?l:"localhost";h.servername=_}r.socket&&(h.createConnection=(_,M)=>r.socket)}else h.createConnection=(_,M)=>r.socket?r.socket:Yj.connect(e);h=Object.assign(Object.assign(Object.assign({},h),e),{enableTrace:i["grpc-node.tls_enable_trace"]===1});let g=S_.connect(m+d,h);this.session=g;let y="Failed to connect";g.unref(),g.once("connect",()=>{g.removeAllListeners(),s(new C_(g,e,i,u)),this.session=null}),g.once("close",()=>{this.session=null,setImmediate(()=>{o(`${y} (${new Date().toISOString()})`)})}),g.once("error",_=>{y=_.message,this.trace("connection failed with error "+y)})})}connect(e,t,i){var r,s;if(this.isShutdown)return Promise.reject();let o=t._getConnectionOptions()||{};if("secureContext"in o){if(o.ALPNProtocols=["h2"],i["grpc.ssl_target_name_override"]){let a=i["grpc.ssl_target_name_override"];o.checkServerIdentity=(c,l)=>(0,ek.checkServerIdentity)(a,l),o.servername=a}else if("grpc.http_connect_target"in i){let a=(0,tk.getDefaultAuthority)((r=(0,ja.parseUri)(i["grpc.http_connect_target"]))!==null&&r!==void 0?r:{path:"localhost"}),c=(0,ja.splitHostPort)(a);o.servername=(s=c?.host)!==null&&s!==void 0?s:a}i["grpc-node.tls_enable_trace"]&&(o.enableTrace=!0)}return(0,Qj.getProxiedConnection)(e,i,o).then(a=>this.createSession(e,t,i,a))}shutdown(){var e;this.isShutdown=!0,(e=this.session)===null||e===void 0||e.close(),this.session=null}};Kf.Http2SubchannelConnector=E_});var ik=E(za=>{"use strict";Object.defineProperty(za,"__esModule",{value:!0});za.getSubchannelPool=za.SubchannelPool=void 0;var lq=jI(),uq=H1(),dq=Mi(),hq=_n(),fq=nk(),mq=1e4,du=class{constructor(){this.pool=Object.create(null),this.cleanupTimer=null}unrefUnusedSubchannels(){let e=!0;for(let t in this.pool){let r=this.pool[t].filter(s=>!s.subchannel.unrefIfOneRef());r.length>0&&(e=!1),this.pool[t]=r}e&&this.cleanupTimer!==null&&(clearInterval(this.cleanupTimer),this.cleanupTimer=null)}ensureCleanupTask(){var e,t;this.cleanupTimer===null&&(this.cleanupTimer=setInterval(()=>{this.unrefUnusedSubchannels()},mq),(t=(e=this.cleanupTimer).unref)===null||t===void 0||t.call(e))}getOrCreateSubchannel(e,t,i,r){this.ensureCleanupTask();let s=(0,hq.uriToString)(e);if(s in this.pool){let a=this.pool[s];for(let c of a)if((0,dq.subchannelAddressEqual)(t,c.subchannelAddress)&&(0,lq.channelOptionsEqual)(i,c.channelArguments)&&r._equals(c.channelCredentials))return c.subchannel}let o=new uq.Subchannel(e,t,i,r,new fq.Http2SubchannelConnector(e));return s in this.pool||(this.pool[s]=[]),this.pool[s].push({subchannelAddress:t,channelArguments:i,channelCredentials:r,subchannel:o}),o.ref(),o}};za.SubchannelPool=du;var pq=new du;function gq(n){return n?pq:new du}za.getSubchannelPool=gq});var x_=E(Ga=>{"use strict";Object.defineProperty(Ga,"__esModule",{value:!0});Ga.FilterStackFactory=Ga.FilterStack=void 0;var Qf=class{constructor(e){this.filters=e}sendMetadata(e){let t=e;for(let i=0;i<this.filters.length;i++)t=this.filters[i].sendMetadata(t);return t}receiveMetadata(e){let t=e;for(let i=this.filters.length-1;i>=0;i--)t=this.filters[i].receiveMetadata(t);return t}sendMessage(e){let t=e;for(let i=0;i<this.filters.length;i++)t=this.filters[i].sendMessage(t);return t}receiveMessage(e){let t=e;for(let i=this.filters.length-1;i>=0;i--)t=this.filters[i].receiveMessage(t);return t}receiveTrailers(e){let t=e;for(let i=this.filters.length-1;i>=0;i--)t=this.filters[i].receiveTrailers(t);return t}push(e){this.filters.unshift(...e)}getFilters(){return this.filters}};Ga.FilterStack=Qf;var T_=class n{constructor(e){this.factories=e}push(e){this.factories.unshift(...e)}clone(){return new n([...this.factories])}createFilter(){return new Qf(this.factories.map(e=>e.createFilter()))}};Ga.FilterStackFactory=T_});var I_=E(Yf=>{"use strict";Object.defineProperty(Yf,"__esModule",{value:!0});Yf.CompressionAlgorithms=void 0;var rk=function(n){return n[n.identity=0]="identity",n[n.deflate=1]="deflate",n[n.gzip=2]="gzip",n}(rk||(Yf.CompressionAlgorithms=rk={}))});var Zf=E(Xf=>{"use strict";Object.defineProperty(Xf,"__esModule",{value:!0});Xf.BaseFilter=void 0;var A_=class{sendMetadata(e){return p(this,null,function*(){return e})}receiveMetadata(e){return e}sendMessage(e){return p(this,null,function*(){return e})}receiveMessage(e){return p(this,null,function*(){return e})}receiveTrailers(e){return e}};Xf.BaseFilter=A_});var ak=E($a=>{"use strict";Object.defineProperty($a,"__esModule",{value:!0});$a.CompressionFilterFactory=$a.CompressionFilter=void 0;var Jf=Ie("zlib"),ok=I_(),yq=Te(),bq=Zf(),vq=rt(),_q=n=>typeof n=="number"&&typeof ok.CompressionAlgorithms[n]=="string",Wa=class{writeMessage(e,t){return p(this,null,function*(){let i=e;t&&(i=yield this.compressMessage(i));let r=Buffer.allocUnsafe(i.length+5);return r.writeUInt8(t?1:0,0),r.writeUInt32BE(i.length,1),i.copy(r,5),r})}readMessage(e){return p(this,null,function*(){let t=e.readUInt8(0)===1,i=e.slice(5);return t&&(i=yield this.decompressMessage(i)),i})}},no=class extends Wa{compressMessage(e){return p(this,null,function*(){return e})}writeMessage(e,t){return p(this,null,function*(){let i=Buffer.allocUnsafe(e.length+5);return i.writeUInt8(0,0),i.writeUInt32BE(e.length,1),e.copy(i,5),i})}decompressMessage(e){return Promise.reject(new Error('Received compressed message but "grpc-encoding" header was identity'))}},D_=class extends Wa{compressMessage(e){return new Promise((t,i)=>{Jf.deflate(e,(r,s)=>{r?i(r):t(s)})})}decompressMessage(e){return new Promise((t,i)=>{Jf.inflate(e,(r,s)=>{r?i(r):t(s)})})}},k_=class extends Wa{compressMessage(e){return new Promise((t,i)=>{Jf.gzip(e,(r,s)=>{r?i(r):t(s)})})}decompressMessage(e){return new Promise((t,i)=>{Jf.unzip(e,(r,s)=>{r?i(r):t(s)})})}},R_=class extends Wa{constructor(e){super(),this.compressionName=e}compressMessage(e){return Promise.reject(new Error(`Received message compressed with unsupported compression method ${this.compressionName}`))}decompressMessage(e){return Promise.reject(new Error(`Compression method not supported: ${this.compressionName}`))}};function sk(n){switch(n){case"identity":return new no;case"deflate":return new D_;case"gzip":return new k_;default:return new R_(n)}}var em=class extends bq.BaseFilter{constructor(e,t){var i;super(),this.sharedFilterConfig=t,this.sendCompression=new no,this.receiveCompression=new no,this.currentCompressionAlgorithm="identity";let r=e["grpc.default_compression_algorithm"];if(r!==void 0)if(_q(r)){let s=ok.CompressionAlgorithms[r],o=(i=t.serverSupportedEncodingHeader)===null||i===void 0?void 0:i.split(",");(!o||o.includes(s))&&(this.currentCompressionAlgorithm=s,this.sendCompression=sk(this.currentCompressionAlgorithm))}else vq.log(yq.LogVerbosity.ERROR,`Invalid value provided for grpc.default_compression_algorithm option: ${r}`)}sendMetadata(e){return p(this,null,function*(){let t=yield e;return t.set("grpc-accept-encoding","identity,deflate,gzip"),t.set("accept-encoding","identity"),this.currentCompressionAlgorithm==="identity"?t.remove("grpc-encoding"):t.set("grpc-encoding",this.currentCompressionAlgorithm),t})}receiveMetadata(e){let t=e.get("grpc-encoding");if(t.length>0){let r=t[0];typeof r=="string"&&(this.receiveCompression=sk(r))}e.remove("grpc-encoding");let i=e.get("grpc-accept-encoding")[0];return i&&(this.sharedFilterConfig.serverSupportedEncodingHeader=i,i.split(",").includes(this.currentCompressionAlgorithm)||(this.sendCompression=new no,this.currentCompressionAlgorithm="identity")),e.remove("grpc-accept-encoding"),e}sendMessage(e){return p(this,null,function*(){var t;let i=yield e,r;return this.sendCompression instanceof no?r=!1:r=(((t=i.flags)!==null&&t!==void 0?t:0)&2)===0,{message:yield this.sendCompression.writeMessage(i.message,r),flags:i.flags}})}receiveMessage(e){return p(this,null,function*(){return this.receiveCompression.readMessage(yield e)})}};$a.CompressionFilter=em;var M_=class{constructor(e,t){this.options=t,this.sharedFilterConfig={}}createFilter(){return new em(this.options,this.sharedFilterConfig)}};$a.CompressionFilterFactory=M_});var lk=E(Ha=>{"use strict";Object.defineProperty(Ha,"__esModule",{value:!0});Ha.MaxMessageSizeFilterFactory=Ha.MaxMessageSizeFilter=void 0;var wq=Zf(),tm=Te(),ck=nn(),nm=class extends wq.BaseFilter{constructor(e){super(),this.maxSendMessageSize=tm.DEFAULT_MAX_SEND_MESSAGE_LENGTH,this.maxReceiveMessageSize=tm.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,"grpc.max_send_message_length"in e&&(this.maxSendMessageSize=e["grpc.max_send_message_length"]),"grpc.max_receive_message_length"in e&&(this.maxReceiveMessageSize=e["grpc.max_receive_message_length"])}sendMessage(e){return p(this,null,function*(){if(this.maxSendMessageSize===-1)return e;{let t=yield e;if(t.message.length>this.maxSendMessageSize)throw{code:tm.Status.RESOURCE_EXHAUSTED,details:`Sent message larger than max (${t.message.length} vs. ${this.maxSendMessageSize})`,metadata:new ck.Metadata};return t}})}receiveMessage(e){return p(this,null,function*(){if(this.maxReceiveMessageSize===-1)return e;{let t=yield e;if(t.length>this.maxReceiveMessageSize)throw{code:tm.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${t.length} vs. ${this.maxReceiveMessageSize})`,metadata:new ck.Metadata};return t}})}};Ha.MaxMessageSizeFilter=nm;var O_=class{constructor(e){this.options=e}createFilter(){return new nm(this.options)}};Ha.MaxMessageSizeFilterFactory=O_});var im=E(zi=>{"use strict";Object.defineProperty(zi,"__esModule",{value:!0});zi.deadlineToString=zi.getRelativeTimeout=zi.getDeadlineTimeoutString=zi.minDeadline=void 0;function Cq(...n){let e=1/0;for(let t of n){let i=t instanceof Date?t.getTime():t;i<e&&(e=i)}return e}zi.minDeadline=Cq;var Eq=[["m",1],["S",1e3],["M",60*1e3],["H",60*60*1e3]];function Sq(n){let e=new Date().getTime();n instanceof Date&&(n=n.getTime());let t=Math.max(n-e,0);for(let[i,r]of Eq){let s=t/r;if(s<1e8)return String(Math.ceil(s))+i}throw new Error("Deadline is too far in the future")}zi.getDeadlineTimeoutString=Sq;var Tq=2147483647;function xq(n){let e=n instanceof Date?n.getTime():n,t=new Date().getTime(),i=e-t;return i<0?0:i>Tq?1/0:i}zi.getRelativeTimeout=xq;function Iq(n){if(n instanceof Date)return n.toISOString();{let e=new Date(n);return Number.isNaN(e.getTime())?""+n:e.toISOString()}}zi.deadlineToString=Iq});var sm=E(rm=>{"use strict";Object.defineProperty(rm,"__esModule",{value:!0});rm.restrictControlPlaneStatusCode=void 0;var Gi=Te(),Aq=[Gi.Status.OK,Gi.Status.INVALID_ARGUMENT,Gi.Status.NOT_FOUND,Gi.Status.ALREADY_EXISTS,Gi.Status.FAILED_PRECONDITION,Gi.Status.ABORTED,Gi.Status.OUT_OF_RANGE,Gi.Status.DATA_LOSS];function Dq(n,e){return Aq.includes(n)?{code:Gi.Status.INTERNAL,details:`Invalid status from control plane: ${n} ${Gi.Status[n]} ${e}`}:{code:n,details:e}}rm.restrictControlPlaneStatusCode=Dq});var dk=E(cm=>{"use strict";Object.defineProperty(cm,"__esModule",{value:!0});cm.LoadBalancingCall=void 0;var uk=Pn(),om=Te(),kq=im(),am=nn(),hu=$r(),Rq=_n(),Mq=rt(),P_=sm(),Oq=Ie("http2"),Pq="load_balancing_call",N_=class{constructor(e,t,i,r,s,o,a){var c,l;this.channel=e,this.callConfig=t,this.methodName=i,this.host=r,this.credentials=s,this.deadline=o,this.callNumber=a,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.metadata=null,this.listener=null,this.onCallEnded=null;let u=this.methodName.split("/"),d="";u.length>=2&&(d=u[1]);let h=(l=(c=(0,Rq.splitHostPort)(this.host))===null||c===void 0?void 0:c.host)!==null&&l!==void 0?l:"localhost";this.serviceUrl=`https://${h}/${d}`}trace(e){Mq.trace(om.LogVerbosity.DEBUG,Pq,"["+this.callNumber+"] "+e)}outputStatus(e,t){var i,r;if(!this.ended){this.ended=!0,this.trace("ended with status: code="+e.code+' details="'+e.details+'"');let s=Object.assign(Object.assign({},e),{progress:t});(i=this.listener)===null||i===void 0||i.onReceiveStatus(s),(r=this.onCallEnded)===null||r===void 0||r.call(this,s.code)}}doPick(){var e,t;if(this.ended)return;if(!this.metadata)throw new Error("doPick called before start");this.trace("Pick called");let i=this.channel.doPick(this.metadata,this.callConfig.pickInformation),r=i.subchannel?"("+i.subchannel.getChannelzRef().id+") "+i.subchannel.getAddress():""+i.subchannel;switch(this.trace("Pick result: "+hu.PickResultType[i.pickResultType]+" subchannel: "+r+" status: "+((e=i.status)===null||e===void 0?void 0:e.code)+" "+((t=i.status)===null||t===void 0?void 0:t.details)),i.pickResultType){case hu.PickResultType.COMPLETE:this.credentials.generateMetadata({service_url:this.serviceUrl}).then(a=>{var c,l,u;if(this.ended){this.trace("Credentials metadata generation finished after call ended");return}let d=this.metadata.clone();if(d.merge(a),d.get("authorization").length>1&&this.outputStatus({code:om.Status.INTERNAL,details:'"authorization" metadata cannot have multiple values',metadata:new am.Metadata},"PROCESSED"),i.subchannel.getConnectivityState()!==uk.ConnectivityState.READY){this.trace("Picked subchannel "+r+" has state "+uk.ConnectivityState[i.subchannel.getConnectivityState()]+" after getting credentials metadata. Retrying pick"),this.doPick();return}this.deadline!==1/0&&d.set("grpc-timeout",(0,kq.getDeadlineTimeoutString)(this.deadline));try{this.child=i.subchannel.getRealSubchannel().createCall(d,this.host,this.methodName,{onReceiveMetadata:h=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(h)},onReceiveMessage:h=>{this.trace("Received message"),this.listener.onReceiveMessage(h)},onReceiveStatus:h=>{this.trace("Received status"),h.rstCode===Oq.constants.NGHTTP2_REFUSED_STREAM?this.outputStatus(h,"REFUSED"):this.outputStatus(h,"PROCESSED")}})}catch(h){this.trace("Failed to start call on picked subchannel "+r+" with error "+h.message),this.outputStatus({code:om.Status.INTERNAL,details:"Failed to start HTTP/2 stream with error "+h.message,metadata:new am.Metadata},"NOT_STARTED");return}(l=(c=this.callConfig).onCommitted)===null||l===void 0||l.call(c),(u=i.onCallStarted)===null||u===void 0||u.call(i),this.onCallEnded=i.onCallEnded,this.trace("Created child call ["+this.child.getCallNumber()+"]"),this.readPending&&this.child.startRead(),this.pendingMessage&&this.child.sendMessageWithContext(this.pendingMessage.context,this.pendingMessage.message),this.pendingHalfClose&&this.child.halfClose()},a=>{let{code:c,details:l}=(0,P_.restrictControlPlaneStatusCode)(typeof a.code=="number"?a.code:om.Status.UNKNOWN,`Getting metadata from plugin failed with error: ${a.message}`);this.outputStatus({code:c,details:l,metadata:new am.Metadata},"PROCESSED")});break;case hu.PickResultType.DROP:let{code:s,details:o}=(0,P_.restrictControlPlaneStatusCode)(i.status.code,i.status.details);setImmediate(()=>{this.outputStatus({code:s,details:o,metadata:i.status.metadata},"DROP")});break;case hu.PickResultType.TRANSIENT_FAILURE:if(this.metadata.getOptions().waitForReady)this.channel.queueCallForPick(this);else{let{code:a,details:c}=(0,P_.restrictControlPlaneStatusCode)(i.status.code,i.status.details);setImmediate(()=>{this.outputStatus({code:a,details:c,metadata:i.status.metadata},"PROCESSED")})}break;case hu.PickResultType.QUEUE:this.channel.queueCallForPick(this)}}cancelWithStatus(e,t){var i;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),(i=this.child)===null||i===void 0||i.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new am.Metadata},"PROCESSED")}getPeer(){var e,t;return(t=(e=this.child)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.listener=t,this.metadata=e,this.doPick()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.child.sendMessageWithContext(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){throw new Error("Method not implemented.")}getCallNumber(){return this.callNumber}};cm.LoadBalancingCall=N_});var fk=E(um=>{"use strict";Object.defineProperty(um,"__esModule",{value:!0});um.ResolvingCall=void 0;var Ka=Te(),lm=im(),hk=nn(),Nq=rt(),Fq=sm(),Lq="resolving_call",F_=class{constructor(e,t,i,r,s,o){this.channel=e,this.method=t,this.filterStackFactory=r,this.credentials=s,this.callNumber=o,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.readFilterPending=!1,this.writeFilterPending=!1,this.pendingChildStatus=null,this.metadata=null,this.listener=null,this.statusWatchers=[],this.deadlineTimer=setTimeout(()=>{},0),this.filterStack=null,this.deadline=i.deadline,this.host=i.host,i.parentCall&&(i.flags&Ka.Propagate.CANCELLATION&&i.parentCall.on("cancelled",()=>{this.cancelWithStatus(Ka.Status.CANCELLED,"Cancelled by parent call")}),i.flags&Ka.Propagate.DEADLINE&&(this.trace("Propagating deadline from parent: "+i.parentCall.getDeadline()),this.deadline=(0,lm.minDeadline)(this.deadline,i.parentCall.getDeadline()))),this.trace("Created"),this.runDeadlineTimer()}trace(e){Nq.trace(Ka.LogVerbosity.DEBUG,Lq,"["+this.callNumber+"] "+e)}runDeadlineTimer(){clearTimeout(this.deadlineTimer),this.trace("Deadline: "+(0,lm.deadlineToString)(this.deadline));let e=(0,lm.getRelativeTimeout)(this.deadline);if(e!==1/0){this.trace("Deadline will be reached in "+e+"ms");let t=()=>{this.cancelWithStatus(Ka.Status.DEADLINE_EXCEEDED,"Deadline exceeded")};e<=0?process.nextTick(t):this.deadlineTimer=setTimeout(t,e)}}outputStatus(e){if(!this.ended){this.ended=!0,this.filterStack||(this.filterStack=this.filterStackFactory.createFilter()),clearTimeout(this.deadlineTimer);let t=this.filterStack.receiveTrailers(e);this.trace("ended with status: code="+t.code+' details="'+t.details+'"'),this.statusWatchers.forEach(i=>i(t)),process.nextTick(()=>{var i;(i=this.listener)===null||i===void 0||i.onReceiveStatus(t)})}}sendMessageOnChild(e,t){if(!this.child)throw new Error("sendMessageonChild called with child not populated");let i=this.child;this.writeFilterPending=!0,this.filterStack.sendMessage(Promise.resolve({message:t,flags:e.flags})).then(r=>{this.writeFilterPending=!1,i.sendMessageWithContext(e,r.message),this.pendingHalfClose&&i.halfClose()},r=>{this.cancelWithStatus(r.code,r.details)})}getConfig(){if(this.ended)return;if(!this.metadata||!this.listener)throw new Error("getConfig called before start");let e=this.channel.getConfig(this.method,this.metadata);if(e.type==="NONE"){this.channel.queueCallForConfig(this);return}else if(e.type==="ERROR"){this.metadata.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(e.error);return}let t=e.config;if(t.status!==Ka.Status.OK){let{code:i,details:r}=(0,Fq.restrictControlPlaneStatusCode)(t.status,"Failed to route call to method "+this.method);this.outputStatus({code:i,details:r,metadata:new hk.Metadata});return}if(t.methodConfig.timeout){let i=new Date;i.setSeconds(i.getSeconds()+t.methodConfig.timeout.seconds),i.setMilliseconds(i.getMilliseconds()+t.methodConfig.timeout.nanos/1e6),this.deadline=(0,lm.minDeadline)(this.deadline,i),this.runDeadlineTimer()}this.filterStackFactory.push(t.dynamicFilterFactories),this.filterStack=this.filterStackFactory.createFilter(),this.filterStack.sendMetadata(Promise.resolve(this.metadata)).then(i=>{this.child=this.channel.createInnerCall(t,this.method,this.host,this.credentials,this.deadline),this.trace("Created child ["+this.child.getCallNumber()+"]"),this.child.start(i,{onReceiveMetadata:r=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(this.filterStack.receiveMetadata(r))},onReceiveMessage:r=>{this.trace("Received message"),this.readFilterPending=!0,this.filterStack.receiveMessage(r).then(s=>{this.trace("Finished filtering received message"),this.readFilterPending=!1,this.listener.onReceiveMessage(s),this.pendingChildStatus&&this.outputStatus(this.pendingChildStatus)},s=>{this.cancelWithStatus(s.code,s.details)})},onReceiveStatus:r=>{this.trace("Received status"),this.readFilterPending?this.pendingChildStatus=r:this.outputStatus(r)}}),this.readPending&&this.child.startRead(),this.pendingMessage?this.sendMessageOnChild(this.pendingMessage.context,this.pendingMessage.message):this.pendingHalfClose&&this.child.halfClose()},i=>{this.outputStatus(i)})}reportResolverError(e){var t;!((t=this.metadata)===null||t===void 0)&&t.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(e)}cancelWithStatus(e,t){var i;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),(i=this.child)===null||i===void 0||i.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new hk.Metadata})}getPeer(){var e,t;return(t=(e=this.child)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.metadata=e.clone(),this.listener=t,this.getConfig()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.sendMessageOnChild(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child&&!this.writeFilterPending?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){this.credentials=this.credentials.compose(e)}addStatusWatcher(e){this.statusWatchers.push(e)}getCallNumber(){return this.callNumber}};um.ResolvingCall=F_});var mk=E(ls=>{"use strict";Object.defineProperty(ls,"__esModule",{value:!0});ls.RetryingCall=ls.MessageBufferTracker=ls.RetryThrottler=void 0;var dm=Te(),Bq=nn(),Vq=rt(),Uq="retrying_call",B_=class{constructor(e,t,i){this.maxTokens=e,this.tokenRatio=t,i?this.tokens=i.tokens*(e/i.maxTokens):this.tokens=e}addCallSucceeded(){this.tokens=Math.max(this.tokens+this.tokenRatio,this.maxTokens)}addCallFailed(){this.tokens=Math.min(this.tokens-1,0)}canRetryCall(){return this.tokens>this.maxTokens/2}};ls.RetryThrottler=B_;var V_=class{constructor(e,t){this.totalLimit=e,this.limitPerCall=t,this.totalAllocated=0,this.allocatedPerCall=new Map}allocate(e,t){var i;let r=(i=this.allocatedPerCall.get(t))!==null&&i!==void 0?i:0;return this.limitPerCall-r<e||this.totalLimit-this.totalAllocated<e?!1:(this.allocatedPerCall.set(t,r+e),this.totalAllocated+=e,!0)}free(e,t){var i;if(this.totalAllocated<e)throw new Error(`Invalid buffer allocation state: call ${t} freed ${e} > total allocated ${this.totalAllocated}`);this.totalAllocated-=e;let r=(i=this.allocatedPerCall.get(t))!==null&&i!==void 0?i:0;if(r<e)throw new Error(`Invalid buffer allocation state: call ${t} freed ${e} > allocated for call ${r}`);this.allocatedPerCall.set(t,r-e)}freeAll(e){var t;let i=(t=this.allocatedPerCall.get(e))!==null&&t!==void 0?t:0;if(this.totalAllocated<i)throw new Error(`Invalid buffer allocation state: call ${e} allocated ${i} > total allocated ${this.totalAllocated}`);this.totalAllocated-=i,this.allocatedPerCall.delete(e)}};ls.MessageBufferTracker=V_;var L_="grpc-previous-rpc-attempts",U_=class{constructor(e,t,i,r,s,o,a,c,l){if(this.channel=e,this.callConfig=t,this.methodName=i,this.host=r,this.credentials=s,this.deadline=o,this.callNumber=a,this.bufferTracker=c,this.retryThrottler=l,this.listener=null,this.initialMetadata=null,this.underlyingCalls=[],this.writeBuffer=[],this.writeBufferOffset=0,this.readStarted=!1,this.transparentRetryUsed=!1,this.attempts=0,this.hedgingTimer=null,this.committedCallIndex=null,this.initialRetryBackoffSec=0,this.nextRetryBackoffSec=0,t.methodConfig.retryPolicy){this.state="RETRY";let u=t.methodConfig.retryPolicy;this.nextRetryBackoffSec=this.initialRetryBackoffSec=Number(u.initialBackoff.substring(0,u.initialBackoff.length-1))}else t.methodConfig.hedgingPolicy?this.state="HEDGING":this.state="TRANSPARENT_ONLY"}getCallNumber(){return this.callNumber}trace(e){Vq.trace(dm.LogVerbosity.DEBUG,Uq,"["+this.callNumber+"] "+e)}reportStatus(e){this.trace("ended with status: code="+e.code+' details="'+e.details+'"'),this.bufferTracker.freeAll(this.callNumber),this.writeBufferOffset=this.writeBufferOffset+this.writeBuffer.length,this.writeBuffer=[],process.nextTick(()=>{var t;(t=this.listener)===null||t===void 0||t.onReceiveStatus({code:e.code,details:e.details,metadata:e.metadata})})}cancelWithStatus(e,t){this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.reportStatus({code:e,details:t,metadata:new Bq.Metadata});for(let{call:i}of this.underlyingCalls)i.cancelWithStatus(e,t)}getPeer(){return this.committedCallIndex!==null?this.underlyingCalls[this.committedCallIndex].call.getPeer():"unknown"}getBufferEntry(e){var t;return(t=this.writeBuffer[e-this.writeBufferOffset])!==null&&t!==void 0?t:{entryType:"FREED",allocated:!1}}getNextBufferIndex(){return this.writeBufferOffset+this.writeBuffer.length}clearSentMessages(){if(this.state!=="COMMITTED")return;let e=this.underlyingCalls[this.committedCallIndex].nextMessageToSend;for(let t=this.writeBufferOffset;t<e;t++){let i=this.getBufferEntry(t);i.allocated&&this.bufferTracker.free(i.message.message.length,this.callNumber)}this.writeBuffer=this.writeBuffer.slice(e-this.writeBufferOffset),this.writeBufferOffset=e}commitCall(e){if(this.state!=="COMMITTED"&&this.underlyingCalls[e].state!=="COMPLETED"){this.trace("Committing call ["+this.underlyingCalls[e].call.getCallNumber()+"] at index "+e),this.state="COMMITTED",this.committedCallIndex=e;for(let t=0;t<this.underlyingCalls.length;t++)t!==e&&this.underlyingCalls[t].state!=="COMPLETED"&&(this.underlyingCalls[t].state="COMPLETED",this.underlyingCalls[t].call.cancelWithStatus(dm.Status.CANCELLED,"Discarded in favor of other hedged attempt"));this.clearSentMessages()}}commitCallWithMostMessages(){if(this.state==="COMMITTED")return;let e=-1,t=-1;for(let[i,r]of this.underlyingCalls.entries())r.state==="ACTIVE"&&r.nextMessageToSend>e&&(e=r.nextMessageToSend,t=i);t===-1?this.state="TRANSPARENT_ONLY":this.commitCall(t)}isStatusCodeInList(e,t){return e.some(i=>i===t||i.toString().toLowerCase()===dm.Status[t].toLowerCase())}getNextRetryBackoffMs(){var e;let t=(e=this.callConfig)===null||e===void 0?void 0:e.methodConfig.retryPolicy;if(!t)return 0;let i=Math.random()*this.nextRetryBackoffSec*1e3,r=Number(t.maxBackoff.substring(0,t.maxBackoff.length-1));return this.nextRetryBackoffSec=Math.min(this.nextRetryBackoffSec*t.backoffMultiplier,r),i}maybeRetryCall(e,t){if(this.state!=="RETRY"){t(!1);return}let i=this.callConfig.methodConfig.retryPolicy;if(this.attempts>=Math.min(i.maxAttempts,5)){t(!1);return}let r;if(e===null)r=this.getNextRetryBackoffMs();else if(e<0){this.state="TRANSPARENT_ONLY",t(!1);return}else r=e,this.nextRetryBackoffSec=this.initialRetryBackoffSec;setTimeout(()=>{var s,o;if(this.state!=="RETRY"){t(!1);return}(!((o=(s=this.retryThrottler)===null||s===void 0?void 0:s.canRetryCall())!==null&&o!==void 0)||o)&&(t(!0),this.attempts+=1,this.startNewAttempt())},r)}countActiveCalls(){let e=0;for(let t of this.underlyingCalls)t?.state==="ACTIVE"&&(e+=1);return e}handleProcessedStatus(e,t,i){var r,s,o;switch(this.state){case"COMMITTED":case"TRANSPARENT_ONLY":this.commitCall(t),this.reportStatus(e);break;case"HEDGING":if(this.isStatusCodeInList((r=this.callConfig.methodConfig.hedgingPolicy.nonFatalStatusCodes)!==null&&r!==void 0?r:[],e.code)){(s=this.retryThrottler)===null||s===void 0||s.addCallFailed();let a;if(i===null)a=0;else if(i<0){this.state="TRANSPARENT_ONLY",this.commitCall(t),this.reportStatus(e);return}else a=i;setTimeout(()=>{this.maybeStartHedgingAttempt(),this.countActiveCalls()===0&&(this.commitCall(t),this.reportStatus(e))},a)}else this.commitCall(t),this.reportStatus(e);break;case"RETRY":this.isStatusCodeInList(this.callConfig.methodConfig.retryPolicy.retryableStatusCodes,e.code)?((o=this.retryThrottler)===null||o===void 0||o.addCallFailed(),this.maybeRetryCall(i,a=>{a||(this.commitCall(t),this.reportStatus(e))})):(this.commitCall(t),this.reportStatus(e));break}}getPushback(e){let t=e.get("grpc-retry-pushback-ms");if(t.length===0)return null;try{return parseInt(t[0])}catch{return-1}}handleChildStatus(e,t){var i;if(this.underlyingCalls[t].state==="COMPLETED")return;if(this.trace("state="+this.state+" handling status with progress "+e.progress+" from child ["+this.underlyingCalls[t].call.getCallNumber()+"] in state "+this.underlyingCalls[t].state),this.underlyingCalls[t].state="COMPLETED",e.code===dm.Status.OK){(i=this.retryThrottler)===null||i===void 0||i.addCallSucceeded(),this.commitCall(t),this.reportStatus(e);return}if(this.state==="COMMITTED"){this.reportStatus(e);return}let r=this.getPushback(e.metadata);switch(e.progress){case"NOT_STARTED":this.startNewAttempt();break;case"REFUSED":this.transparentRetryUsed?this.handleProcessedStatus(e,t,r):(this.transparentRetryUsed=!0,this.startNewAttempt());break;case"DROP":this.commitCall(t),this.reportStatus(e);break;case"PROCESSED":this.handleProcessedStatus(e,t,r);break}}maybeStartHedgingAttempt(){if(this.state!=="HEDGING"||!this.callConfig.methodConfig.hedgingPolicy)return;let e=this.callConfig.methodConfig.hedgingPolicy;this.attempts>=Math.min(e.maxAttempts,5)||(this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer())}maybeStartHedgingTimer(){var e,t,i;if(this.hedgingTimer&&clearTimeout(this.hedgingTimer),this.state!=="HEDGING"||!this.callConfig.methodConfig.hedgingPolicy)return;let r=this.callConfig.methodConfig.hedgingPolicy;if(this.attempts>=Math.min(r.maxAttempts,5))return;let s=(e=r.hedgingDelay)!==null&&e!==void 0?e:"0s",o=Number(s.substring(0,s.length-1));this.hedgingTimer=setTimeout(()=>{this.maybeStartHedgingAttempt()},o*1e3),(i=(t=this.hedgingTimer).unref)===null||i===void 0||i.call(t)}startNewAttempt(){let e=this.channel.createLoadBalancingCall(this.callConfig,this.methodName,this.host,this.credentials,this.deadline);this.trace("Created child call ["+e.getCallNumber()+"] for attempt "+this.attempts);let t=this.underlyingCalls.length;this.underlyingCalls.push({state:"ACTIVE",call:e,nextMessageToSend:0});let i=this.attempts-1,r=this.initialMetadata.clone();i>0&&r.set(L_,`${i}`);let s=!1;e.start(r,{onReceiveMetadata:o=>{this.trace("Received metadata from child ["+e.getCallNumber()+"]"),this.commitCall(t),s=!0,i>0&&o.set(L_,`${i}`),this.underlyingCalls[t].state==="ACTIVE"&&this.listener.onReceiveMetadata(o)},onReceiveMessage:o=>{this.trace("Received message from child ["+e.getCallNumber()+"]"),this.commitCall(t),this.underlyingCalls[t].state==="ACTIVE"&&this.listener.onReceiveMessage(o)},onReceiveStatus:o=>{this.trace("Received status from child ["+e.getCallNumber()+"]"),!s&&i>0&&o.metadata.set(L_,`${i}`),this.handleChildStatus(o,t)}}),this.sendNextChildMessage(t),this.readStarted&&e.startRead()}start(e,t){this.trace("start called"),this.listener=t,this.initialMetadata=e,this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer()}handleChildWriteCompleted(e){var t,i;let r=this.underlyingCalls[e],s=r.nextMessageToSend;(i=(t=this.getBufferEntry(s)).callback)===null||i===void 0||i.call(t),this.clearSentMessages(),r.nextMessageToSend+=1,this.sendNextChildMessage(e)}sendNextChildMessage(e){let t=this.underlyingCalls[e];if(t.state!=="COMPLETED"&&this.getBufferEntry(t.nextMessageToSend)){let i=this.getBufferEntry(t.nextMessageToSend);switch(i.entryType){case"MESSAGE":t.call.sendMessageWithContext({callback:r=>{this.handleChildWriteCompleted(e)}},i.message.message);break;case"HALF_CLOSE":t.nextMessageToSend+=1,t.call.halfClose();break;case"FREED":break}}}sendMessageWithContext(e,t){var i;this.trace("write() called with message of length "+t.length);let r={message:t,flags:e.flags},s=this.getNextBufferIndex(),o={entryType:"MESSAGE",message:r,allocated:this.bufferTracker.allocate(t.length,this.callNumber)};if(this.writeBuffer.push(o),o.allocated){(i=e.callback)===null||i===void 0||i.call(e);for(let[a,c]of this.underlyingCalls.entries())c.state==="ACTIVE"&&c.nextMessageToSend===s&&c.call.sendMessageWithContext({callback:l=>{this.handleChildWriteCompleted(a)}},t)}else{if(this.commitCallWithMostMessages(),this.committedCallIndex===null)return;let a=this.underlyingCalls[this.committedCallIndex];o.callback=e.callback,a.state==="ACTIVE"&&a.nextMessageToSend===s&&a.call.sendMessageWithContext({callback:c=>{this.handleChildWriteCompleted(this.committedCallIndex)}},t)}}startRead(){this.trace("startRead called"),this.readStarted=!0;for(let e of this.underlyingCalls)e?.state==="ACTIVE"&&e.call.startRead()}halfClose(){this.trace("halfClose called");let e=this.getNextBufferIndex();this.writeBuffer.push({entryType:"HALF_CLOSE",allocated:!1});for(let t of this.underlyingCalls)t?.state==="ACTIVE"&&t.nextMessageToSend===e&&(t.nextMessageToSend+=1,t.call.halfClose())}setCredentials(e){throw new Error("Method not implemented.")}getMethod(){return this.methodName}getHost(){return this.host}};ls.RetryingCall=U_});var fm=E(hm=>{"use strict";Object.defineProperty(hm,"__esModule",{value:!0});hm.BaseSubchannelWrapper=void 0;var j_=class{constructor(e){this.child=e}getConnectivityState(){return this.child.getConnectivityState()}addConnectivityStateListener(e){this.child.addConnectivityStateListener(e)}removeConnectivityStateListener(e){this.child.removeConnectivityStateListener(e)}startConnecting(){this.child.startConnecting()}getAddress(){return this.child.getAddress()}throttleKeepalive(e){this.child.throttleKeepalive(e)}ref(){this.child.ref()}unref(){this.child.unref()}getChannelzRef(){return this.child.getChannelzRef()}getRealSubchannel(){return this.child.getRealSubchannel()}realSubchannelEquals(e){return this.getRealSubchannel()===e.getRealSubchannel()}};hm.BaseSubchannelWrapper=j_});var yk=E(gm=>{"use strict";Object.defineProperty(gm,"__esModule",{value:!0});gm.InternalChannel=void 0;var jq=Qh(),qq=UI(),zq=ik(),pk=$r(),fu=Te(),Gq=x_(),Wq=ak(),gk=ki(),q_=rt(),$q=lk(),Hq=p_(),mm=_n(),Wi=Pn(),mu=to(),Kq=dk(),Qq=im(),Yq=fk(),z_=v_(),Xq=sm(),G_=mk(),Zq=fm(),Jq=2147483647,ez=1e3,tz=30*60*1e3,pm=new Map,nz=1<<24,iz=1<<20,W_=class extends Zq.BaseSubchannelWrapper{constructor(e,t){super(e),this.channel=t,this.refCount=0,this.subchannelStateListener=(i,r,s,o)=>{t.throttleKeepalive(o)},e.addConnectivityStateListener(this.subchannelStateListener)}ref(){this.child.ref(),this.refCount+=1}unref(){this.child.unref(),this.refCount-=1,this.refCount<=0&&(this.child.removeConnectivityStateListener(this.subchannelStateListener),this.channel.removeWrappedSubchannel(this))}},$_=class{constructor(e,t,i){var r,s,o,a,c,l,u,d;if(this.credentials=t,this.options=i,this.connectivityState=Wi.ConnectivityState.IDLE,this.currentPicker=new pk.UnavailablePicker,this.configSelectionQueue=[],this.pickQueue=[],this.connectivityStateWatchers=[],this.configSelector=null,this.currentResolutionError=null,this.wrappedSubchannels=new Set,this.callCount=0,this.idleTimer=null,this.channelzEnabled=!0,this.callTracker=new mu.ChannelzCallTracker,this.childrenTracker=new mu.ChannelzChildrenTracker,typeof e!="string")throw new TypeError("Channel target must be a string");if(!(t instanceof jq.ChannelCredentials))throw new TypeError("Channel credentials must be a ChannelCredentials object");if(i&&typeof i!="object")throw new TypeError("Channel options must be an object");this.originalTarget=e;let h=(0,mm.parseUri)(e);if(h===null)throw new Error(`Could not parse target name "${e}"`);let m=(0,gk.mapUriDefaultScheme)(h);if(m===null)throw new Error(`Could not find a default scheme for target name "${e}"`);this.callRefTimer=setInterval(()=>{},Jq),(s=(r=this.callRefTimer).unref)===null||s===void 0||s.call(r),this.options["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzTrace=new mu.ChannelzTrace,this.channelzRef=(0,mu.registerChannelzChannel)(e,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Channel created"),this.options["grpc.default_authority"]?this.defaultAuthority=this.options["grpc.default_authority"]:this.defaultAuthority=(0,gk.getDefaultAuthority)(m);let g=(0,Hq.mapProxyName)(m,i);this.target=g.target,this.options=Object.assign({},this.options,g.extraOptions),this.subchannelPool=(0,zq.getSubchannelPool)(((o=i["grpc.use_local_subchannel_pool"])!==null&&o!==void 0?o:0)===0),this.retryBufferTracker=new G_.MessageBufferTracker((a=i["grpc.retry_buffer_size"])!==null&&a!==void 0?a:nz,(c=i["grpc.per_rpc_retry_buffer_size"])!==null&&c!==void 0?c:iz),this.keepaliveTime=(l=i["grpc.keepalive_time_ms"])!==null&&l!==void 0?l:-1,this.idleTimeoutMs=Math.max((u=i["grpc.client_idle_timeout_ms"])!==null&&u!==void 0?u:tz,ez);let y={createSubchannel:(M,T)=>{let O=this.subchannelPool.getOrCreateSubchannel(this.target,M,Object.assign({},this.options,T),this.credentials);O.throttleKeepalive(this.keepaliveTime),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Created subchannel or used existing subchannel",O.getChannelzRef());let P=new W_(O,this);return this.wrappedSubchannels.add(P),P},updateState:(M,T)=>{this.currentPicker=T;let O=this.pickQueue.slice();this.pickQueue=[],O.length>0&&this.callRefTimerUnref();for(let P of O)P.doPick();this.updateState(M)},requestReresolution:()=>{throw new Error("Resolving load balancer should never call requestReresolution")},addChannelzChild:M=>{this.channelzEnabled&&this.childrenTracker.refChild(M)},removeChannelzChild:M=>{this.channelzEnabled&&this.childrenTracker.unrefChild(M)}};this.resolvingLoadBalancer=new qq.ResolvingLoadBalancer(this.target,y,i,(M,T)=>{M.retryThrottling?pm.set(this.getTarget(),new G_.RetryThrottler(M.retryThrottling.maxTokens,M.retryThrottling.tokenRatio,pm.get(this.getTarget()))):pm.delete(this.getTarget()),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Address resolution succeeded"),this.configSelector=T,this.currentResolutionError=null,process.nextTick(()=>{let O=this.configSelectionQueue;this.configSelectionQueue=[],O.length>0&&this.callRefTimerUnref();for(let P of O)P.getConfig()})},M=>{this.channelzEnabled&&this.channelzTrace.addTrace("CT_WARNING","Address resolution failed with code "+M.code+' and details "'+M.details+'"'),this.configSelectionQueue.length>0&&this.trace("Name resolution failed with calls queued for config selection"),this.configSelector===null&&(this.currentResolutionError=Object.assign(Object.assign({},(0,Xq.restrictControlPlaneStatusCode)(M.code,M.details)),{metadata:M.metadata}));let T=this.configSelectionQueue;this.configSelectionQueue=[],T.length>0&&this.callRefTimerUnref();for(let O of T)O.reportResolverError(M)}),this.filterStackFactory=new Gq.FilterStackFactory([new $q.MaxMessageSizeFilterFactory(this.options),new Wq.CompressionFilterFactory(this,this.options)]),this.trace("Channel constructed with options "+JSON.stringify(i,void 0,2));let _=new Error;(0,q_.trace)(fu.LogVerbosity.DEBUG,"channel_stacktrace","("+this.channelzRef.id+`) Channel constructed 
`+((d=_.stack)===null||d===void 0?void 0:d.substring(_.stack.indexOf(`
`)+1))),this.lastActivityTimestamp=new Date}getChannelzInfo(){return{target:this.originalTarget,state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists()}}trace(e,t){(0,q_.trace)(t??fu.LogVerbosity.DEBUG,"channel","("+this.channelzRef.id+") "+(0,mm.uriToString)(this.target)+" "+e)}callRefTimerRef(){var e,t,i,r;!((t=(e=this.callRefTimer).hasRef)===null||t===void 0)&&t.call(e)||(this.trace("callRefTimer.ref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),(r=(i=this.callRefTimer).ref)===null||r===void 0||r.call(i))}callRefTimerUnref(){var e,t;(!this.callRefTimer.hasRef||this.callRefTimer.hasRef())&&(this.trace("callRefTimer.unref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),(t=(e=this.callRefTimer).unref)===null||t===void 0||t.call(e))}removeConnectivityStateWatcher(e){let t=this.connectivityStateWatchers.findIndex(i=>i===e);t>=0&&this.connectivityStateWatchers.splice(t,1)}updateState(e){(0,q_.trace)(fu.LogVerbosity.DEBUG,"connectivity_state","("+this.channelzRef.id+") "+(0,mm.uriToString)(this.target)+" "+Wi.ConnectivityState[this.connectivityState]+" -> "+Wi.ConnectivityState[e]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+Wi.ConnectivityState[e]),this.connectivityState=e;let t=this.connectivityStateWatchers.slice();for(let i of t)e!==i.currentState&&(i.timer&&clearTimeout(i.timer),this.removeConnectivityStateWatcher(i),i.callback());e!==Wi.ConnectivityState.TRANSIENT_FAILURE&&(this.currentResolutionError=null)}throttleKeepalive(e){if(e>this.keepaliveTime){this.keepaliveTime=e;for(let t of this.wrappedSubchannels)t.throttleKeepalive(e)}}removeWrappedSubchannel(e){this.wrappedSubchannels.delete(e)}doPick(e,t){return this.currentPicker.pick({metadata:e,extraPickInfo:t})}queueCallForPick(e){this.pickQueue.push(e),this.callRefTimerRef()}getConfig(e,t){return this.resolvingLoadBalancer.exitIdle(),this.configSelector?{type:"SUCCESS",config:this.configSelector(e,t)}:this.currentResolutionError?{type:"ERROR",error:this.currentResolutionError}:{type:"NONE"}}queueCallForConfig(e){this.configSelectionQueue.push(e),this.callRefTimerRef()}enterIdle(){this.resolvingLoadBalancer.destroy(),this.updateState(Wi.ConnectivityState.IDLE),this.currentPicker=new pk.QueuePicker(this.resolvingLoadBalancer),this.idleTimer&&(clearTimeout(this.idleTimer),this.idleTimer=null)}startIdleTimeout(e){var t,i;this.idleTimer=setTimeout(()=>{if(this.callCount>0){this.startIdleTimeout(this.idleTimeoutMs);return}let s=new Date().valueOf()-this.lastActivityTimestamp.valueOf();s>=this.idleTimeoutMs?(this.trace("Idle timer triggered after "+this.idleTimeoutMs+"ms of inactivity"),this.enterIdle()):this.startIdleTimeout(this.idleTimeoutMs-s)},e),(i=(t=this.idleTimer).unref)===null||i===void 0||i.call(t)}maybeStartIdleTimer(){this.connectivityState!==Wi.ConnectivityState.SHUTDOWN&&!this.idleTimer&&this.startIdleTimeout(this.idleTimeoutMs)}onCallStart(){this.channelzEnabled&&this.callTracker.addCallStarted(),this.callCount+=1}onCallEnd(e){this.channelzEnabled&&(e.code===fu.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()),this.callCount-=1,this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()}createLoadBalancingCall(e,t,i,r,s){let o=(0,z_.getNextCallNumber)();return this.trace("createLoadBalancingCall ["+o+'] method="'+t+'"'),new Kq.LoadBalancingCall(this,e,t,i,r,s,o)}createRetryingCall(e,t,i,r,s){let o=(0,z_.getNextCallNumber)();return this.trace("createRetryingCall ["+o+'] method="'+t+'"'),new G_.RetryingCall(this,e,t,i,r,s,o,this.retryBufferTracker,pm.get(this.getTarget()))}createInnerCall(e,t,i,r,s){return this.options["grpc.enable_retries"]===0?this.createLoadBalancingCall(e,t,i,r,s):this.createRetryingCall(e,t,i,r,s)}createResolvingCall(e,t,i,r,s){let o=(0,z_.getNextCallNumber)();this.trace("createResolvingCall ["+o+'] method="'+e+'", deadline='+(0,Qq.deadlineToString)(t));let a={deadline:t,flags:s??fu.Propagate.DEFAULTS,host:i??this.defaultAuthority,parentCall:r},c=new Yq.ResolvingCall(this,e,a,this.filterStackFactory.clone(),this.credentials._getCallCredentials(),o);return this.onCallStart(),c.addStatusWatcher(l=>{this.onCallEnd(l)}),c}close(){this.resolvingLoadBalancer.destroy(),this.updateState(Wi.ConnectivityState.SHUTDOWN),clearInterval(this.callRefTimer),this.idleTimer&&clearTimeout(this.idleTimer),this.channelzEnabled&&(0,mu.unregisterChannelzRef)(this.channelzRef),this.subchannelPool.unrefUnusedSubchannels()}getTarget(){return(0,mm.uriToString)(this.target)}getConnectivityState(e){let t=this.connectivityState;return e&&(this.resolvingLoadBalancer.exitIdle(),this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()),t}watchConnectivityState(e,t,i){if(this.connectivityState===Wi.ConnectivityState.SHUTDOWN)throw new Error("Channel has been shut down");let r=null;if(t!==1/0){let o=t instanceof Date?t:new Date(t),a=new Date;if(t===-1/0||o<=a){process.nextTick(i,new Error("Deadline passed without connectivity state change"));return}r=setTimeout(()=>{this.removeConnectivityStateWatcher(s),i(new Error("Deadline passed without connectivity state change"))},o.getTime()-a.getTime())}let s={currentState:e,callback:i,timer:r};this.connectivityStateWatchers.push(s)}getChannelzRef(){return this.channelzRef}createCall(e,t,i,r,s){if(typeof e!="string")throw new TypeError("Channel#createCall: method must be a string");if(!(typeof t=="number"||t instanceof Date))throw new TypeError("Channel#createCall: deadline must be a number or Date");if(this.connectivityState===Wi.ConnectivityState.SHUTDOWN)throw new Error("Channel has been shut down");return this.createResolvingCall(e,t,i,r,s)}};gm.InternalChannel=$_});var Yb=E(ym=>{"use strict";Object.defineProperty(ym,"__esModule",{value:!0});ym.ChannelImplementation=void 0;var rz=Qh(),sz=yk(),H_=class{constructor(e,t,i){if(typeof e!="string")throw new TypeError("Channel target must be a string");if(!(t instanceof rz.ChannelCredentials))throw new TypeError("Channel credentials must be a ChannelCredentials object");if(i&&typeof i!="object")throw new TypeError("Channel options must be an object");this.internalChannel=new sz.InternalChannel(e,t,i)}close(){this.internalChannel.close()}getTarget(){return this.internalChannel.getTarget()}getConnectivityState(e){return this.internalChannel.getConnectivityState(e)}watchConnectivityState(e,t,i){this.internalChannel.watchConnectivityState(e,t,i)}getChannelzRef(){return this.internalChannel.getChannelzRef()}createCall(e,t,i,r,s){if(typeof e!="string")throw new TypeError("Channel#createCall: method must be a string");if(!(typeof t=="number"||t instanceof Date))throw new TypeError("Channel#createCall: deadline must be a number or Date");return this.internalChannel.createCall(e,t,i,r,s)}};ym.ChannelImplementation=H_});var Ik=E(zn=>{"use strict";Object.defineProperty(zn,"__esModule",{value:!0});zn.Http2ServerCallStream=zn.ServerDuplexStreamImpl=zn.ServerWritableStreamImpl=zn.ServerReadableStreamImpl=zn.ServerUnaryCallImpl=void 0;var Ck=Ie("events"),Qa=Ie("http2"),Y_=Ie("stream"),Ek=Ie("zlib"),Sk=Ie("util"),Ke=Te(),X_=nn(),oz=y_(),Tk=rt(),gu=zh(),xk="server_call",az=(0,Sk.promisify)(Ek.unzip),cz=(0,Sk.promisify)(Ek.inflate);function pu(n){Tk.trace(Ke.LogVerbosity.DEBUG,xk,n)}var lz="grpc-accept-encoding",uz="grpc-encoding",bk="grpc-message",vk="grpc-status",_k="grpc-timeout",dz=/(\d{1,8})\s*([HMSmun])/,hz={H:36e5,M:6e4,S:1e3,m:1,u:.001,n:1e-6},fz={[lz]:"identity,deflate,gzip",[uz]:"identity"},wk={[Qa.constants.HTTP2_HEADER_STATUS]:Qa.constants.HTTP_STATUS_OK,[Qa.constants.HTTP2_HEADER_CONTENT_TYPE]:"application/grpc+proto"},mz={waitForTrailers:!0},K_=class extends Ck.EventEmitter{constructor(e,t,i){super(),this.call=e,this.metadata=t,this.request=i,this.cancelled=!1,this.call.setupSurfaceCall(this)}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}};zn.ServerUnaryCallImpl=K_;var bm=class extends Y_.Readable{constructor(e,t,i,r){super({objectMode:!0}),this.call=e,this.metadata=t,this.deserialize=i,this.cancelled=!1,this.call.setupSurfaceCall(this),this.call.setupReadable(this,r)}_read(e){this.call.consumeUnpushedMessages(this)&&this.call.resume()}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}};zn.ServerReadableStreamImpl=bm;var yu=class extends Y_.Writable{constructor(e,t,i,r){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=i,this.request=r,this.cancelled=!1,this.trailingMetadata=new X_.Metadata,this.call.setupSurfaceCall(this),this.on("error",s=>{this.call.sendError(s),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}_write(e,t,i){try{let r=this.call.serializeMessage(e);if(!this.call.write(r)){this.call.once("drain",i);return}}catch(r){this.emit("error",{details:(0,gu.getErrorMessage)(r),code:Ke.Status.INTERNAL})}i()}_final(e){this.call.sendStatus({code:Ke.Status.OK,details:"OK",metadata:this.trailingMetadata}),e(null)}end(e){return e&&(this.trailingMetadata=e),super.end()}};zn.ServerWritableStreamImpl=yu;var Ya=class extends Y_.Duplex{constructor(e,t,i,r,s){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=i,this.deserialize=r,this.cancelled=!1,this.trailingMetadata=new X_.Metadata,this.call.setupSurfaceCall(this),this.call.setupReadable(this,s),this.on("error",o=>{this.call.sendError(o),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}end(e){return e&&(this.trailingMetadata=e),super.end()}};zn.ServerDuplexStreamImpl=Ya;Ya.prototype._read=bm.prototype._read;Ya.prototype._write=yu.prototype._write;Ya.prototype._final=yu.prototype._final;var Q_=class extends Ck.EventEmitter{constructor(e,t,i){super(),this.stream=e,this.handler=t,this.cancelled=!1,this.deadlineTimer=null,this.statusSent=!1,this.deadline=1/0,this.wantTrailers=!1,this.metadataSent=!1,this.canPush=!1,this.isPushPending=!1,this.bufferedMessages=[],this.messagesToPush=[],this.maxSendMessageSize=Ke.DEFAULT_MAX_SEND_MESSAGE_LENGTH,this.maxReceiveMessageSize=Ke.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,this.stream.once("error",r=>{}),this.stream.once("close",()=>{var r;pu("Request to method "+((r=this.handler)===null||r===void 0?void 0:r.path)+" stream closed with rstCode "+this.stream.rstCode),this.statusSent||(this.cancelled=!0,this.emit("cancelled","cancelled"),this.emit("streamEnd",!1),this.sendStatus({code:Ke.Status.CANCELLED,details:"Cancelled by client",metadata:null}),this.deadlineTimer&&clearTimeout(this.deadlineTimer))}),this.stream.on("drain",()=>{this.emit("drain")}),"grpc.max_send_message_length"in i&&(this.maxSendMessageSize=i["grpc.max_send_message_length"]),"grpc.max_receive_message_length"in i&&(this.maxReceiveMessageSize=i["grpc.max_receive_message_length"])}checkCancelled(){return(this.stream.destroyed||this.stream.closed)&&(this.cancelled=!0),this.cancelled}getDecompressedMessage(e,t){return t==="deflate"?cz(e.subarray(5)):t==="gzip"?az(e.subarray(5)):t==="identity"?e.subarray(5):Promise.reject({code:Ke.Status.UNIMPLEMENTED,details:`Received message compressed with unsupported encoding "${t}"`})}sendMetadata(e){if(this.checkCancelled()||this.metadataSent)return;this.metadataSent=!0;let t=e?e.toHttp2Headers():null,i=Object.assign(Object.assign(Object.assign({},wk),fz),t);this.stream.respond(i,mz)}receiveMetadata(e){let t=X_.Metadata.fromHttp2Headers(e);Tk.isTracerEnabled(xk)&&pu("Request to "+this.handler.path+" received headers "+JSON.stringify(t.toJSON()));let i=t.get(_k);if(i.length>0){let r=i[0].toString().match(dz);if(r===null){let a=new Error("Invalid deadline");return a.code=Ke.Status.OUT_OF_RANGE,this.sendError(a),t}let s=+r[1]*hz[r[2]]|0,o=new Date;this.deadline=o.setMilliseconds(o.getMilliseconds()+s),this.deadlineTimer=setTimeout(pz,s,this),t.remove(_k)}return t.remove(Qa.constants.HTTP2_HEADER_ACCEPT_ENCODING),t.remove(Qa.constants.HTTP2_HEADER_TE),t.remove(Qa.constants.HTTP2_HEADER_CONTENT_TYPE),t.remove("grpc-accept-encoding"),t}receiveUnaryMessage(e){return new Promise((t,i)=>{let{stream:r}=this,s=0,o=this,a=[],c=this.maxReceiveMessageSize;this.stream.on("data",l),this.stream.on("end",u),this.stream.on("error",u);function l(d){if(s+=d.byteLength,c!==-1&&s>c){r.removeListener("data",l),r.removeListener("end",u),r.removeListener("error",u),i({code:Ke.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${s} vs. ${c})`});return}a.push(d)}function u(d){if(r.removeListener("data",l),r.removeListener("end",u),r.removeListener("error",u),d!==void 0){i({code:Ke.Status.INTERNAL,details:d.message});return}if(s===0){i({code:Ke.Status.INTERNAL,details:"received empty unary message"});return}o.emit("receiveMessage");let h=Buffer.concat(a,s),g=h.readUInt8(0)===1?e:"identity",y=o.getDecompressedMessage(h,g);if(Buffer.isBuffer(y)){t(o.deserializeMessageWithInternalError(y));return}y.then(_=>t(o.deserializeMessageWithInternalError(_)),_=>i(_.code?_:{code:Ke.Status.INTERNAL,details:`Received "grpc-encoding" header "${e}" but ${e} decompression failed`}))}})}deserializeMessageWithInternalError(e){return p(this,null,function*(){try{return this.deserializeMessage(e)}catch(t){throw{details:(0,gu.getErrorMessage)(t),code:Ke.Status.INTERNAL}}})}serializeMessage(e){let t=this.handler.serialize(e),i=t.byteLength,r=Buffer.allocUnsafe(i+5);return r.writeUInt8(0,0),r.writeUInt32BE(i,1),t.copy(r,5),r}deserializeMessage(e){return this.handler.deserialize(e)}sendUnaryMessage(e,t,i,r){return p(this,null,function*(){if(!this.checkCancelled()){if(i===void 0&&(i=null),e){!Object.prototype.hasOwnProperty.call(e,"metadata")&&i&&(e.metadata=i),this.sendError(e);return}try{let s=this.serializeMessage(t);this.write(s),this.sendStatus({code:Ke.Status.OK,details:"OK",metadata:i})}catch(s){this.sendError({details:(0,gu.getErrorMessage)(s),code:Ke.Status.INTERNAL})}}})}sendStatus(e){var t,i;if(this.emit("callEnd",e.code),this.emit("streamEnd",e.code===Ke.Status.OK),!this.checkCancelled())if(pu("Request to method "+((t=this.handler)===null||t===void 0?void 0:t.path)+" ended with status code: "+Ke.Status[e.code]+" details: "+e.details),this.deadlineTimer&&clearTimeout(this.deadlineTimer),this.stream.headersSent)this.wantTrailers||(this.wantTrailers=!0,this.stream.once("wantTrailers",()=>{var r;let s=Object.assign({[vk]:e.code,[bk]:encodeURI(e.details)},(r=e.metadata)===null||r===void 0?void 0:r.toHttp2Headers());this.stream.sendTrailers(s),this.statusSent=!0}),this.stream.end());else{let r=Object.assign(Object.assign({[vk]:e.code,[bk]:encodeURI(e.details)},wk),(i=e.metadata)===null||i===void 0?void 0:i.toHttp2Headers());this.stream.respond(r,{endStream:!0}),this.statusSent=!0}}sendError(e){let t={code:Ke.Status.UNKNOWN,details:"message"in e?e.message:"Unknown Error",metadata:"metadata"in e&&e.metadata!==void 0?e.metadata:null};"code"in e&&typeof e.code=="number"&&Number.isInteger(e.code)&&(t.code=e.code,"details"in e&&typeof e.details=="string"&&(t.details=e.details)),this.sendStatus(t)}write(e){if(!this.checkCancelled()){if(this.maxSendMessageSize!==-1&&e.length>this.maxSendMessageSize){this.sendError({code:Ke.Status.RESOURCE_EXHAUSTED,details:`Sent message larger than max (${e.length} vs. ${this.maxSendMessageSize})`});return}return this.sendMetadata(),this.emit("sendMessage"),this.stream.write(e)}}resume(){this.stream.resume()}setupSurfaceCall(e){this.once("cancelled",t=>{e.cancelled=!0,e.emit("cancelled",t)}),this.once("callEnd",t=>e.emit("callEnd",t))}setupReadable(e,t){let i=new oz.StreamDecoder,r=!1,s=!1,o=!1,a=()=>p(this,null,function*(){!o&&r&&!s&&(o=!0,yield this.pushOrBufferMessage(e,null))});this.stream.on("data",c=>p(this,null,function*(){let l=i.write(c);s=!0,this.stream.pause();for(let u of l){if(this.maxReceiveMessageSize!==-1&&u.length>this.maxReceiveMessageSize){this.sendError({code:Ke.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${u.length} vs. ${this.maxReceiveMessageSize})`});return}this.emit("receiveMessage");let h=u.readUInt8(0)===1?t:"identity",m=yield this.getDecompressedMessage(u,h);if(!m)return;yield this.pushOrBufferMessage(e,m)}s=!1,this.stream.resume(),yield a()})),this.stream.once("end",()=>p(this,null,function*(){r=!0,yield a()}))}consumeUnpushedMessages(e){for(this.canPush=!0;this.messagesToPush.length>0;){let t=this.messagesToPush.shift(),i=e.push(t);if(t===null||i===!1){this.canPush=!1;break}}return this.canPush}pushOrBufferMessage(e,t){return p(this,null,function*(){this.isPushPending?this.bufferedMessages.push(t):yield this.pushMessage(e,t)})}pushMessage(e,t){return p(this,null,function*(){if(t===null){pu("Received end of stream"),this.canPush?e.push(null):this.messagesToPush.push(null);return}pu("Received message of length "+t.length),this.isPushPending=!0;try{let i=yield this.deserializeMessage(t);this.canPush?e.push(i)||(this.canPush=!1,this.stream.pause()):this.messagesToPush.push(i)}catch(i){this.bufferedMessages.length=0;let r=(0,gu.getErrorCode)(i);(r===null||r<Ke.Status.OK||r>Ke.Status.UNAUTHENTICATED)&&(r=Ke.Status.INTERNAL),e.emit("error",{details:(0,gu.getErrorMessage)(i),code:r})}this.isPushPending=!1,this.bufferedMessages.length>0&&(yield this.pushMessage(e,this.bufferedMessages.shift()))})}getPeer(){var e;let t=(e=this.stream.session)===null||e===void 0?void 0:e.socket;return t?.remoteAddress?t.remotePort?`${t.remoteAddress}:${t.remotePort}`:t.remoteAddress:"unknown"}getDeadline(){return this.deadline}getPath(){return this.handler.path}};zn.Http2ServerCallStream=Q_;function pz(n){let e=new Error("Deadline exceeded");e.code=Ke.Status.DEADLINE_EXCEEDED,n.sendError(e),n.cancelled=!0,n.emit("cancelled","deadline")}});var e0=E(vm=>{"use strict";Object.defineProperty(vm,"__esModule",{value:!0});vm.ServerCredentials=void 0;var Ak=_b(),bu=class{static createInsecure(){return new Z_}static createSsl(e,t,i=!1){if(e!==null&&!Buffer.isBuffer(e))throw new TypeError("rootCerts must be null or a Buffer");if(!Array.isArray(t))throw new TypeError("keyCertPairs must be an array");if(typeof i!="boolean")throw new TypeError("checkClientCertificate must be a boolean");let r=[],s=[];for(let o=0;o<t.length;o++){let a=t[o];if(a===null||typeof a!="object")throw new TypeError(`keyCertPair[${o}] must be an object`);if(!Buffer.isBuffer(a.private_key))throw new TypeError(`keyCertPair[${o}].private_key must be a Buffer`);if(!Buffer.isBuffer(a.cert_chain))throw new TypeError(`keyCertPair[${o}].cert_chain must be a Buffer`);r.push(a.cert_chain),s.push(a.private_key)}return new J_({ca:e||(0,Ak.getDefaultRootsData)()||void 0,cert:r,key:s,requestCert:i,ciphers:Ak.CIPHER_SUITES})}};vm.ServerCredentials=bu;var Z_=class extends bu{_isSecure(){return!1}_getSettings(){return null}},J_=class extends bu{constructor(e){super(),this.options=e}_isSecure(){return!0}_getSettings(){return this.options}}});var Rk=E(Cm=>{"use strict";Object.defineProperty(Cm,"__esModule",{value:!0});Cm.Server=void 0;var us=Ie("http2"),wr=Te(),io=Ik(),gz=e0(),Dk=ki(),_m=rt(),fi=Mi(),yz=_n(),pn=to(),wm=~(1<<31),bz=~(1<<31),vz=2e4,{HTTP2_HEADER_PATH:kk}=us.constants,_z="server";function wz(){}function t0(n){return{code:wr.Status.UNIMPLEMENTED,details:`The server does not implement the method ${n}`}}function Cz(n,e){let t=t0(e);switch(n){case"unary":return(i,r)=>{r(t,null)};case"clientStream":return(i,r)=>{r(t,null)};case"serverStream":return i=>{i.emit("error",t)};case"bidi":return i=>{i.emit("error",t)};default:throw new Error(`Invalid handlerType ${n}`)}}var n0=class{constructor(e){var t,i,r,s;this.http2ServerList=[],this.handlers=new Map,this.sessions=new Map,this.started=!1,this.shutdown=!1,this.serverAddressString="null",this.channelzEnabled=!0,this.channelzTrace=new pn.ChannelzTrace,this.callTracker=new pn.ChannelzCallTracker,this.listenerChildrenTracker=new pn.ChannelzChildrenTracker,this.sessionChildrenTracker=new pn.ChannelzChildrenTracker,this.options=e??{},this.options["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzRef=(0,pn.registerChannelzServer)(()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Server created"),this.maxConnectionAgeMs=(t=this.options["grpc.max_connection_age_ms"])!==null&&t!==void 0?t:wm,this.maxConnectionAgeGraceMs=(i=this.options["grpc.max_connection_age_grace_ms"])!==null&&i!==void 0?i:wm,this.keepaliveTimeMs=(r=this.options["grpc.keepalive_time_ms"])!==null&&r!==void 0?r:bz,this.keepaliveTimeoutMs=(s=this.options["grpc.keepalive_timeout_ms"])!==null&&s!==void 0?s:vz,this.trace("Server constructed")}getChannelzInfo(){return{trace:this.channelzTrace,callTracker:this.callTracker,listenerChildren:this.listenerChildrenTracker.getChildLists(),sessionChildren:this.sessionChildrenTracker.getChildLists()}}getChannelzSessionInfoGetter(e){return()=>{var t,i,r;let s=this.sessions.get(e),o=e.socket,a=o.remoteAddress?(0,fi.stringToSubchannelAddress)(o.remoteAddress,o.remotePort):null,c=o.localAddress?(0,fi.stringToSubchannelAddress)(o.localAddress,o.localPort):null,l;if(e.encrypted){let d=o,h=d.getCipher(),m=d.getCertificate(),g=d.getPeerCertificate();l={cipherSuiteStandardName:(t=h.standardName)!==null&&t!==void 0?t:null,cipherSuiteOtherName:h.standardName?null:h.name,localCertificate:m&&"raw"in m?m.raw:null,remoteCertificate:g&&"raw"in g?g.raw:null}}else l=null;return{remoteAddress:a,localAddress:c,security:l,remoteName:null,streamsStarted:s.streamTracker.callsStarted,streamsSucceeded:s.streamTracker.callsSucceeded,streamsFailed:s.streamTracker.callsFailed,messagesSent:s.messagesSent,messagesReceived:s.messagesReceived,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:s.streamTracker.lastCallStartedTimestamp,lastMessageSentTimestamp:s.lastMessageSentTimestamp,lastMessageReceivedTimestamp:s.lastMessageReceivedTimestamp,localFlowControlWindow:(i=e.state.localWindowSize)!==null&&i!==void 0?i:null,remoteFlowControlWindow:(r=e.state.remoteWindowSize)!==null&&r!==void 0?r:null}}}trace(e){_m.trace(wr.LogVerbosity.DEBUG,_z,"("+this.channelzRef.id+") "+e)}addProtoService(){throw new Error("Not implemented. Use addService() instead")}addService(e,t){if(e===null||typeof e!="object"||t===null||typeof t!="object")throw new Error("addService() requires two objects as arguments");let i=Object.keys(e);if(i.length===0)throw new Error("Cannot add an empty service to a server");i.forEach(r=>{let s=e[r],o;s.requestStream?s.responseStream?o="bidi":o="clientStream":s.responseStream?o="serverStream":o="unary";let a=t[r],c;if(a===void 0&&typeof s.originalName=="string"&&(a=t[s.originalName]),a!==void 0?c=a.bind(t):c=Cz(o,r),this.register(s.path,c,s.responseSerialize,s.requestDeserialize,o)===!1)throw new Error(`Method handler for ${s.path} already provided.`)})}removeService(e){if(e===null||typeof e!="object")throw new Error("removeService() requires object as argument");Object.keys(e).forEach(i=>{let r=e[i];this.unregister(r.path)})}bind(e,t){throw new Error("Not implemented. Use bindAsync() instead")}bindAsync(e,t,i){if(this.started===!0)throw new Error("server is already started");if(this.shutdown)throw new Error("bindAsync called after shutdown");if(typeof e!="string")throw new TypeError("port must be a string");if(t===null||!(t instanceof gz.ServerCredentials))throw new TypeError("creds must be a ServerCredentials object");if(typeof i!="function")throw new TypeError("callback must be a function");let r=(0,yz.parseUri)(e);if(r===null)throw new Error(`Could not parse port "${e}"`);let s=(0,Dk.mapUriDefaultScheme)(r);if(s===null)throw new Error(`Could not get a default scheme for port "${e}"`);let o={maxSendHeaderBlockLength:Number.MAX_SAFE_INTEGER};"grpc-node.max_session_memory"in this.options?o.maxSessionMemory=this.options["grpc-node.max_session_memory"]:o.maxSessionMemory=Number.MAX_SAFE_INTEGER,"grpc.max_concurrent_streams"in this.options&&(o.settings={maxConcurrentStreams:this.options["grpc.max_concurrent_streams"]});let a=(m,g)=>{process.nextTick(()=>i(m,g))},c=()=>{let m;if(t._isSecure()){let g=Object.assign(o,t._getSettings());g.enableTrace=this.options["grpc-node.tls_enable_trace"]===1,m=us.createSecureServer(g),m.on("secureConnection",y=>{y.on("error",_=>{this.trace("An incoming TLS connection closed with error: "+_.message)})})}else m=us.createServer(o);return m.setTimeout(0,wz),this._setupHandlers(m),m},l=(m,g,y)=>m.length===0?Promise.resolve({port:g,count:y}):Promise.all(m.map(_=>{this.trace("Attempting to bind "+(0,fi.subchannelAddressToString)(_));let M;(0,fi.isTcpSubchannelAddress)(_)?M={host:_.host,port:g}:M=_;let T=c();return new Promise((O,P)=>{let W=X=>{this.trace("Failed to bind "+(0,fi.subchannelAddressToString)(_)+" with error "+X.message),O(X)};T.once("error",W),T.listen(M,()=>{if(this.shutdown){T.close(),O(new Error("bindAsync failed because server is shutdown"));return}let X=T.address(),ue;typeof X=="string"?ue={path:X}:ue={host:X.address,port:X.port};let Ct=(0,pn.registerChannelzSocket)((0,fi.subchannelAddressToString)(ue),()=>({localAddress:ue,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(Ct),this.http2ServerList.push({server:T,channelzRef:Ct}),this.trace("Successfully bound "+(0,fi.subchannelAddressToString)(ue)),O("port"in ue?ue.port:g),T.removeListener("error",W)})})})).then(_=>{let M=0;for(let T of _)if(typeof T=="number"&&(M+=1,T!==g))throw new Error("Invalid state: multiple port numbers added from single address");return{port:g,count:M+y}}),u=m=>{if(m.length===0)return Promise.resolve({port:0,count:0});let g=m[0],y=c();return new Promise((_,M)=>{let T=O=>{this.trace("Failed to bind "+(0,fi.subchannelAddressToString)(g)+" with error "+O.message),_(u(m.slice(1)))};y.once("error",T),y.listen(g,()=>{if(this.shutdown){y.close(),_({port:0,count:0});return}let O=y.address(),P={host:O.address,port:O.port},W=(0,pn.registerChannelzSocket)((0,fi.subchannelAddressToString)(P),()=>({localAddress:P,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(W),this.http2ServerList.push({server:y,channelzRef:W}),this.trace("Successfully bound "+(0,fi.subchannelAddressToString)(P)),_(l(m.slice(1),O.port,1)),y.removeListener("error",T)})})},d={onSuccessfulResolution:(m,g,y)=>{if(d.onSuccessfulResolution=()=>{},this.shutdown&&a(new Error("bindAsync failed because server is shutdown"),0),m.length===0){a(new Error(`No addresses resolved for port ${e}`),0);return}let _;(0,fi.isTcpSubchannelAddress)(m[0])?m[0].port===0?_=u(m):_=l(m,m[0].port,0):_=l(m,1,0),_.then(M=>{if(M.count===0){let T=`No address added out of total ${m.length} resolved`;_m.log(wr.LogVerbosity.ERROR,T),a(new Error(T),0)}else M.count<m.length&&_m.log(wr.LogVerbosity.INFO,`WARNING Only ${M.count} addresses added out of total ${m.length} resolved`),a(null,M.port)},M=>{let T=`No address added out of total ${m.length} resolved`;_m.log(wr.LogVerbosity.ERROR,T),a(new Error(T),0)})},onError:m=>{a(new Error(m.details),0)}};(0,Dk.createResolver)(s,d,this.options).updateResolution()}forceShutdown(){for(let{server:e,channelzRef:t}of this.http2ServerList)e.listening&&e.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(t),(0,pn.unregisterChannelzRef)(t))});this.started=!1,this.shutdown=!0,this.sessions.forEach((e,t)=>{t.destroy(us.constants.NGHTTP2_CANCEL)}),this.sessions.clear(),this.channelzEnabled&&(0,pn.unregisterChannelzRef)(this.channelzRef)}register(e,t,i,r,s){return this.handlers.has(e)?!1:(this.handlers.set(e,{func:t,serialize:i,deserialize:r,type:s,path:e}),!0)}unregister(e){return this.handlers.delete(e)}start(){if(this.http2ServerList.length===0||this.http2ServerList.every(({server:e})=>e.listening!==!0))throw new Error("server must be bound in order to start");if(this.started===!0)throw new Error("server is already started");this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Starting"),this.started=!0}tryShutdown(e){let t=s=>{this.channelzEnabled&&(0,pn.unregisterChannelzRef)(this.channelzRef),e(s)},i=0;function r(){i--,i===0&&t()}this.started=!1,this.shutdown=!0;for(let{server:s,channelzRef:o}of this.http2ServerList)s.listening&&(i++,s.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(o),(0,pn.unregisterChannelzRef)(o)),r()}));this.sessions.forEach((s,o)=>{o.closed||(i+=1,o.close(r))}),i===0&&t()}addHttp2Port(){throw new Error("Not yet implemented")}getChannelzRef(){return this.channelzRef}_verifyContentType(e,t){let i=t[us.constants.HTTP2_HEADER_CONTENT_TYPE];return typeof i!="string"||!i.startsWith("application/grpc")?(e.respond({[us.constants.HTTP2_HEADER_STATUS]:us.constants.HTTP_STATUS_UNSUPPORTED_MEDIA_TYPE},{endStream:!0}),!1):!0}_retrieveHandler(e){this.trace("Received call to method "+e+" at address "+this.serverAddressString);let t=this.handlers.get(e);return t===void 0?(this.trace("No handler registered for method "+e+". Sending UNIMPLEMENTED status."),null):t}_respondWithError(e,t,i=null){let r=new io.Http2ServerCallStream(t,null,this.options);e.code===void 0&&(e.code=wr.Status.INTERNAL),this.channelzEnabled&&(this.callTracker.addCallFailed(),i?.streamTracker.addCallFailed()),r.sendError(e)}_channelzHandler(e,t){let i=this.sessions.get(e.session);if(this.callTracker.addCallStarted(),i?.streamTracker.addCallStarted(),!this._verifyContentType(e,t)){this.callTracker.addCallFailed(),i?.streamTracker.addCallFailed();return}let r=t[kk],s=this._retrieveHandler(r);if(!s){this._respondWithError(t0(r),e,i);return}let o=new io.Http2ServerCallStream(e,s,this.options);o.once("callEnd",a=>{a===wr.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}),i&&(o.once("streamEnd",a=>{a?i.streamTracker.addCallSucceeded():i.streamTracker.addCallFailed()}),o.on("sendMessage",()=>{i.messagesSent+=1,i.lastMessageSentTimestamp=new Date}),o.on("receiveMessage",()=>{i.messagesReceived+=1,i.lastMessageReceivedTimestamp=new Date})),this._runHandlerForCall(o,s,t)||(this.callTracker.addCallFailed(),i?.streamTracker.addCallFailed(),o.sendError({code:wr.Status.INTERNAL,details:`Unknown handler type: ${s.type}`}))}_streamHandler(e,t){if(this._verifyContentType(e,t)!==!0)return;let i=t[kk],r=this._retrieveHandler(i);if(!r){this._respondWithError(t0(i),e,null);return}let s=new io.Http2ServerCallStream(e,r,this.options);this._runHandlerForCall(s,r,t)||s.sendError({code:wr.Status.INTERNAL,details:`Unknown handler type: ${r.type}`})}_runHandlerForCall(e,t,i){var r;let s=e.receiveMetadata(i),o=(r=s.get("grpc-encoding")[0])!==null&&r!==void 0?r:"identity";s.remove("grpc-encoding");let{type:a}=t;if(a==="unary")Ez(e,t,s,o);else if(a==="clientStream")Sz(e,t,s,o);else if(a==="serverStream")Tz(e,t,s,o);else if(a==="bidi")xz(e,t,s,o);else return!1;return!0}_setupHandlers(e){if(e===null)return;let t=e.address(),i="null";t&&(typeof t=="string"?i=t:i=t.address+":"+t.port),this.serverAddressString=i;let r=this.channelzEnabled?this._channelzHandler:this._streamHandler;e.on("stream",r.bind(this)),e.on("session",s=>{var o,a,c,l,u;if(!this.started){s.destroy();return}let d=(0,pn.registerChannelzSocket)((o=s.socket.remoteAddress)!==null&&o!==void 0?o:"unknown",this.getChannelzSessionInfoGetter(s),this.channelzEnabled),h={ref:d,streamTracker:new pn.ChannelzCallTracker,messagesSent:0,messagesReceived:0,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null};this.sessions.set(s,h);let m=s.socket.remoteAddress;this.channelzEnabled&&(this.channelzTrace.addTrace("CT_INFO","Connection established by client "+m),this.sessionChildrenTracker.refChild(d));let g=null,y=null,_=!1;if(this.maxConnectionAgeMs!==wm){let T=this.maxConnectionAgeMs/10,O=Math.random()*T*2-T;g=(c=(a=setTimeout(()=>{var P,W;_=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by max connection age from "+m);try{s.goaway(us.constants.NGHTTP2_NO_ERROR,~(1<<31),Buffer.from("max_age"))}catch{s.destroy();return}s.close(),this.maxConnectionAgeGraceMs!==wm&&(y=(W=(P=setTimeout(()=>{s.destroy()},this.maxConnectionAgeGraceMs)).unref)===null||W===void 0?void 0:W.call(P))},this.maxConnectionAgeMs+O)).unref)===null||c===void 0?void 0:c.call(a)}let M=(u=(l=setInterval(()=>{var T,O;let P=(O=(T=setTimeout(()=>{_=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by keepalive timeout from "+m),s.close()},this.keepaliveTimeoutMs)).unref)===null||O===void 0?void 0:O.call(T);try{s.ping((W,X,ue)=>{clearTimeout(P)})}catch{s.destroy()}},this.keepaliveTimeMs)).unref)===null||u===void 0?void 0:u.call(l);s.on("close",()=>{this.channelzEnabled&&(_||this.channelzTrace.addTrace("CT_INFO","Connection dropped by client "+m),this.sessionChildrenTracker.unrefChild(d),(0,pn.unregisterChannelzRef)(d)),g&&clearTimeout(g),y&&clearTimeout(y),M&&clearTimeout(M),this.sessions.delete(s)})})}};Cm.Server=n0;function Ez(n,e,t,i){return p(this,null,function*(){try{let r=yield n.receiveUnaryMessage(i);if(r===void 0||n.cancelled)return;let s=new io.ServerUnaryCallImpl(n,t,r);e.func(s,(o,a,c,l)=>{n.sendUnaryMessage(o,a,c,l)})}catch(r){n.sendError(r)}})}function Sz(n,e,t,i){let r=new io.ServerReadableStreamImpl(n,t,e.deserialize,i);function s(o,a,c,l){r.destroy(),n.sendUnaryMessage(o,a,c,l)}n.cancelled||(r.on("error",s),e.func(r,s))}function Tz(n,e,t,i){return p(this,null,function*(){try{let r=yield n.receiveUnaryMessage(i);if(r===void 0||n.cancelled)return;let s=new io.ServerWritableStreamImpl(n,t,e.serialize,r);e.func(s)}catch(r){n.sendError(r)}})}function xz(n,e,t,i){let r=new io.ServerDuplexStreamImpl(n,t,e.serialize,e.deserialize,i);n.cancelled||e.func(r)}});var Mk=E(Em=>{"use strict";Object.defineProperty(Em,"__esModule",{value:!0});Em.StatusBuilder=void 0;var i0=class{constructor(){this.code=null,this.details=null,this.metadata=null}withCode(e){return this.code=e,this}withDetails(e){return this.details=e,this}withMetadata(e){return this.metadata=e,this}build(){let e={};return this.code!==null&&(e.code=this.code),this.details!==null&&(e.details=this.details),this.metadata!==null&&(e.metadata=this.metadata),e}};Em.StatusBuilder=i0});var r0=E(ds=>{"use strict";Object.defineProperty(ds,"__esModule",{value:!0});ds.isDuration=ds.durationToMs=ds.msToDuration=void 0;function Iz(n){return{seconds:n/1e3|0,nanos:n%1e3*1e6|0}}ds.msToDuration=Iz;function Az(n){return n.seconds*1e3+n.nanos/1e6|0}ds.durationToMs=Az;function Dz(n){return typeof n.seconds=="number"&&typeof n.nanos=="number"}ds.isDuration=Dz});var h0=E(hs=>{"use strict";var s0;Object.defineProperty(hs,"__esModule",{value:!0});hs.setup=hs.OutlierDetectionLoadBalancer=hs.OutlierDetectionLoadBalancingConfig=void 0;var Tm=Pn(),Pk=Te(),ro=r0(),Nk=f0(),Fk=qr(),kz=nf(),Rz=$r(),Ok=Mi(),Mz=fm(),Oz=rt(),Pz="outlier_detection";function At(n){Oz.trace(Pk.LogVerbosity.DEBUG,Pz,n)}var d0="outlier_detection",Nz=((s0=process.env.GRPC_EXPERIMENTAL_ENABLE_OUTLIER_DETECTION)!==null&&s0!==void 0?s0:"true")==="true",Fz={stdev_factor:1900,enforcement_percentage:100,minimum_hosts:5,request_volume:100},Lz={threshold:85,enforcement_percentage:100,minimum_hosts:5,request_volume:50};function Xa(n,e,t,i){if(e in n&&typeof n[e]!==t){let r=i?`${i}.${e}`:e;throw new Error(`outlier detection config ${r} parse error: expected ${t}, got ${typeof n[e]}`)}}function o0(n,e,t){let i=t?`${t}.${e}`:e;if(e in n){if(!(0,ro.isDuration)(n[e]))throw new Error(`outlier detection config ${i} parse error: expected Duration, got ${typeof n[e]}`);if(!(n[e].seconds>=0&&n[e].seconds<=315576e6&&n[e].nanos>=0&&n[e].nanos<=999999999))throw new Error(`outlier detection config ${i} parse error: values out of range for non-negative Duaration`)}}function Sm(n,e,t){let i=t?`${t}.${e}`:e;if(Xa(n,e,"number",t),e in n&&!(n[e]>=0&&n[e]<=100))throw new Error(`outlier detection config ${i} parse error: value out of range for percentage (0-100)`)}var vu=class n{constructor(e,t,i,r,s,o,a){if(this.childPolicy=a,a.length>0&&a[0].getLoadBalancerName()==="pick_first")throw new Error("outlier_detection LB policy cannot have a pick_first child policy");this.intervalMs=e??1e4,this.baseEjectionTimeMs=t??3e4,this.maxEjectionTimeMs=i??3e5,this.maxEjectionPercent=r??10,this.successRateEjection=s?Object.assign(Object.assign({},Fz),s):null,this.failurePercentageEjection=o?Object.assign(Object.assign({},Lz),o):null}getLoadBalancerName(){return d0}toJsonObject(){return{interval:(0,ro.msToDuration)(this.intervalMs),base_ejection_time:(0,ro.msToDuration)(this.baseEjectionTimeMs),max_ejection_time:(0,ro.msToDuration)(this.maxEjectionTimeMs),max_ejection_percent:this.maxEjectionPercent,success_rate_ejection:this.successRateEjection,failure_percentage_ejection:this.failurePercentageEjection,child_policy:this.childPolicy.map(e=>e.toJsonObject())}}getIntervalMs(){return this.intervalMs}getBaseEjectionTimeMs(){return this.baseEjectionTimeMs}getMaxEjectionTimeMs(){return this.maxEjectionTimeMs}getMaxEjectionPercent(){return this.maxEjectionPercent}getSuccessRateEjectionConfig(){return this.successRateEjection}getFailurePercentageEjectionConfig(){return this.failurePercentageEjection}getChildPolicy(){return this.childPolicy}copyWithChildPolicy(e){return new n(this.intervalMs,this.baseEjectionTimeMs,this.maxEjectionTimeMs,this.maxEjectionPercent,this.successRateEjection,this.failurePercentageEjection,e)}static createFromJson(e){var t;if(o0(e,"interval"),o0(e,"base_ejection_time"),o0(e,"max_ejection_time"),Sm(e,"max_ejection_percent"),"success_rate_ejection"in e){if(typeof e.success_rate_ejection!="object")throw new Error("outlier detection config success_rate_ejection must be an object");Xa(e.success_rate_ejection,"stdev_factor","number","success_rate_ejection"),Sm(e.success_rate_ejection,"enforcement_percentage","success_rate_ejection"),Xa(e.success_rate_ejection,"minimum_hosts","number","success_rate_ejection"),Xa(e.success_rate_ejection,"request_volume","number","success_rate_ejection")}if("failure_percentage_ejection"in e){if(typeof e.failure_percentage_ejection!="object")throw new Error("outlier detection config failure_percentage_ejection must be an object");Sm(e.failure_percentage_ejection,"threshold","failure_percentage_ejection"),Sm(e.failure_percentage_ejection,"enforcement_percentage","failure_percentage_ejection"),Xa(e.failure_percentage_ejection,"minimum_hosts","number","failure_percentage_ejection"),Xa(e.failure_percentage_ejection,"request_volume","number","failure_percentage_ejection")}return new n(e.interval?(0,ro.durationToMs)(e.interval):null,e.base_ejection_time?(0,ro.durationToMs)(e.base_ejection_time):null,e.max_ejection_time?(0,ro.durationToMs)(e.max_ejection_time):null,(t=e.max_ejection_percent)!==null&&t!==void 0?t:null,e.success_rate_ejection,e.failure_percentage_ejection,e.child_policy.map(Fk.validateLoadBalancingConfig))}};hs.OutlierDetectionLoadBalancingConfig=vu;var c0=class extends Mz.BaseSubchannelWrapper{constructor(e,t){super(e),this.mapEntry=t,this.stateListeners=[],this.ejected=!1,this.refCount=0,this.childSubchannelState=e.getConnectivityState(),e.addConnectivityStateListener((i,r,s,o)=>{if(this.childSubchannelState=s,!this.ejected)for(let a of this.stateListeners)a(this,r,s,o)})}getConnectivityState(){return this.ejected?Tm.ConnectivityState.TRANSIENT_FAILURE:this.childSubchannelState}addConnectivityStateListener(e){this.stateListeners.push(e)}removeConnectivityStateListener(e){let t=this.stateListeners.indexOf(e);t>-1&&this.stateListeners.splice(t,1)}ref(){this.child.ref(),this.refCount+=1}unref(){if(this.child.unref(),this.refCount-=1,this.refCount<=0&&this.mapEntry){let e=this.mapEntry.subchannelWrappers.indexOf(this);e>=0&&this.mapEntry.subchannelWrappers.splice(e,1)}}eject(){this.ejected=!0;for(let e of this.stateListeners)e(this,this.childSubchannelState,Tm.ConnectivityState.TRANSIENT_FAILURE,-1)}uneject(){this.ejected=!1;for(let e of this.stateListeners)e(this,Tm.ConnectivityState.TRANSIENT_FAILURE,this.childSubchannelState,-1)}getMapEntry(){return this.mapEntry}getWrappedSubchannel(){return this.child}};function a0(){return{success:0,failure:0}}var l0=class{constructor(){this.activeBucket=a0(),this.inactiveBucket=a0()}addSuccess(){this.activeBucket.success+=1}addFailure(){this.activeBucket.failure+=1}switchBuckets(){this.inactiveBucket=this.activeBucket,this.activeBucket=a0()}getLastSuccesses(){return this.inactiveBucket.success}getLastFailures(){return this.inactiveBucket.failure}},u0=class{constructor(e,t){this.wrappedPicker=e,this.countCalls=t}pick(e){let t=this.wrappedPicker.pick(e);if(t.pickResultType===Rz.PickResultType.COMPLETE){let i=t.subchannel,r=i.getMapEntry();if(r){let s=t.onCallEnded;return this.countCalls&&(s=o=>{var a;o===Pk.Status.OK?r.counter.addSuccess():r.counter.addFailure(),(a=t.onCallEnded)===null||a===void 0||a.call(t,o)}),Object.assign(Object.assign({},t),{subchannel:i.getWrappedSubchannel(),onCallEnded:s})}else return Object.assign(Object.assign({},t),{subchannel:i.getWrappedSubchannel()})}else return t}},xm=class{constructor(e){this.addressMap=new Map,this.latestConfig=null,this.timerStartTime=null,this.childBalancer=new kz.ChildLoadBalancerHandler((0,Nk.createChildChannelControlHelper)(e,{createSubchannel:(t,i)=>{let r=e.createSubchannel(t,i),s=this.addressMap.get((0,Ok.subchannelAddressToString)(t)),o=new c0(r,s);return s?.currentEjectionTimestamp!==null&&o.eject(),s?.subchannelWrappers.push(o),o},updateState:(t,i)=>{t===Tm.ConnectivityState.READY?e.updateState(t,new u0(i,this.isCountingEnabled())):e.updateState(t,i)}})),this.ejectionTimer=setInterval(()=>{},0),clearInterval(this.ejectionTimer)}isCountingEnabled(){return this.latestConfig!==null&&(this.latestConfig.getSuccessRateEjectionConfig()!==null||this.latestConfig.getFailurePercentageEjectionConfig()!==null)}getCurrentEjectionPercent(){let e=0;for(let t of this.addressMap.values())t.currentEjectionTimestamp!==null&&(e+=1);return e*100/this.addressMap.size}runSuccessRateCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getSuccessRateEjectionConfig();if(!t)return;At("Running success rate check");let i=t.request_volume,r=0,s=[];for(let[d,h]of this.addressMap){let m=h.counter.getLastSuccesses(),g=h.counter.getLastFailures();At("Stats for "+d+": successes="+m+" failures="+g+" targetRequestVolume="+i),m+g>=i&&(r+=1,s.push(m/(m+g)))}if(At("Found "+r+" success rate candidates; currentEjectionPercent="+this.getCurrentEjectionPercent()+" successRates=["+s+"]"),r<t.minimum_hosts)return;let o=s.reduce((d,h)=>d+h)/s.length,a=0;for(let d of s){let h=d-o;a+=h*h}let c=a/s.length,l=Math.sqrt(c),u=o-l*(t.stdev_factor/1e3);At("stdev="+l+" ejectionThreshold="+u);for(let[d,h]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let m=h.counter.getLastSuccesses(),g=h.counter.getLastFailures();if(m+g<i)continue;let y=m/(m+g);if(At("Checking candidate "+d+" successRate="+y),y<u){let _=Math.random()*100;At("Candidate "+d+" randomNumber="+_+" enforcement_percentage="+t.enforcement_percentage),_<t.enforcement_percentage&&(At("Ejecting candidate "+d),this.eject(h,e))}}}runFailurePercentageCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getFailurePercentageEjectionConfig();if(!t)return;At("Running failure percentage check. threshold="+t.threshold+" request volume threshold="+t.request_volume);let i=0;for(let r of this.addressMap.values()){let s=r.counter.getLastSuccesses(),o=r.counter.getLastFailures();s+o>=t.request_volume&&(i+=1)}if(!(i<t.minimum_hosts))for(let[r,s]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let o=s.counter.getLastSuccesses(),a=s.counter.getLastFailures();if(At("Candidate successes="+o+" failures="+a),o+a<t.request_volume)continue;if(a*100/(a+o)>t.threshold){let l=Math.random()*100;At("Candidate "+r+" randomNumber="+l+" enforcement_percentage="+t.enforcement_percentage),l<t.enforcement_percentage&&(At("Ejecting candidate "+r),this.eject(s,e))}}}eject(e,t){e.currentEjectionTimestamp=new Date,e.ejectionTimeMultiplier+=1;for(let i of e.subchannelWrappers)i.eject()}uneject(e){e.currentEjectionTimestamp=null;for(let t of e.subchannelWrappers)t.uneject()}switchAllBuckets(){for(let e of this.addressMap.values())e.counter.switchBuckets()}startTimer(e){var t,i;this.ejectionTimer=setTimeout(()=>this.runChecks(),e),(i=(t=this.ejectionTimer).unref)===null||i===void 0||i.call(t)}runChecks(){let e=new Date;if(At("Ejection timer running"),this.switchAllBuckets(),!!this.latestConfig){this.timerStartTime=e,this.startTimer(this.latestConfig.getIntervalMs()),this.runSuccessRateCheck(e),this.runFailurePercentageCheck(e);for(let[t,i]of this.addressMap.entries())if(i.currentEjectionTimestamp===null)i.ejectionTimeMultiplier>0&&(i.ejectionTimeMultiplier-=1);else{let r=this.latestConfig.getBaseEjectionTimeMs(),s=this.latestConfig.getMaxEjectionTimeMs(),o=new Date(i.currentEjectionTimestamp.getTime());o.setMilliseconds(o.getMilliseconds()+Math.min(r*i.ejectionTimeMultiplier,Math.max(r,s))),o<new Date&&(At("Unejecting "+t),this.uneject(i))}}}updateAddressList(e,t,i){if(!(t instanceof vu))return;let r=new Set;for(let o of e)r.add((0,Ok.subchannelAddressToString)(o));for(let o of r)this.addressMap.has(o)||(At("Adding map entry for "+o),this.addressMap.set(o,{counter:new l0,currentEjectionTimestamp:null,ejectionTimeMultiplier:0,subchannelWrappers:[]}));for(let o of this.addressMap.keys())r.has(o)||(At("Removing map entry for "+o),this.addressMap.delete(o));let s=(0,Fk.getFirstUsableConfig)(t.getChildPolicy(),!0);if(this.childBalancer.updateAddressList(e,s,i),t.getSuccessRateEjectionConfig()||t.getFailurePercentageEjectionConfig())if(this.timerStartTime){At("Previous timer existed. Replacing timer"),clearTimeout(this.ejectionTimer);let o=t.getIntervalMs()-(new Date().getTime()-this.timerStartTime.getTime());this.startTimer(o)}else At("Starting new timer"),this.timerStartTime=new Date,this.startTimer(t.getIntervalMs()),this.switchAllBuckets();else{At("Counting disabled. Cancelling timer."),this.timerStartTime=null,clearTimeout(this.ejectionTimer);for(let o of this.addressMap.values())this.uneject(o),o.ejectionTimeMultiplier=0}this.latestConfig=t}exitIdle(){this.childBalancer.exitIdle()}resetBackoff(){this.childBalancer.resetBackoff()}destroy(){clearTimeout(this.ejectionTimer),this.childBalancer.destroy()}getTypeName(){return d0}};hs.OutlierDetectionLoadBalancer=xm;function Bz(){Nz&&(0,Nk.registerLoadBalancerType)(d0,xm,vu)}hs.setup=Bz});var f0=E(ee=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0});ee.OutlierDetectionLoadBalancingConfig=ee.BaseSubchannelWrapper=ee.registerAdminService=ee.FilterStackFactory=ee.BaseFilter=ee.PickResultType=ee.QueuePicker=ee.UnavailablePicker=ee.ChildLoadBalancerHandler=ee.subchannelAddressToString=ee.validateLoadBalancingConfig=ee.getFirstUsableConfig=ee.registerLoadBalancerType=ee.createChildChannelControlHelper=ee.BackoffTimeout=ee.durationToMs=ee.uriToString=ee.createResolver=ee.registerResolver=ee.log=ee.trace=void 0;var Lk=rt();Object.defineProperty(ee,"trace",{enumerable:!0,get:function(){return Lk.trace}});Object.defineProperty(ee,"log",{enumerable:!0,get:function(){return Lk.log}});var Bk=ki();Object.defineProperty(ee,"registerResolver",{enumerable:!0,get:function(){return Bk.registerResolver}});Object.defineProperty(ee,"createResolver",{enumerable:!0,get:function(){return Bk.createResolver}});var Vz=_n();Object.defineProperty(ee,"uriToString",{enumerable:!0,get:function(){return Vz.uriToString}});var Uz=r0();Object.defineProperty(ee,"durationToMs",{enumerable:!0,get:function(){return Uz.durationToMs}});var jz=jl();Object.defineProperty(ee,"BackoffTimeout",{enumerable:!0,get:function(){return jz.BackoffTimeout}});var Im=qr();Object.defineProperty(ee,"createChildChannelControlHelper",{enumerable:!0,get:function(){return Im.createChildChannelControlHelper}});Object.defineProperty(ee,"registerLoadBalancerType",{enumerable:!0,get:function(){return Im.registerLoadBalancerType}});Object.defineProperty(ee,"getFirstUsableConfig",{enumerable:!0,get:function(){return Im.getFirstUsableConfig}});Object.defineProperty(ee,"validateLoadBalancingConfig",{enumerable:!0,get:function(){return Im.validateLoadBalancingConfig}});var qz=Mi();Object.defineProperty(ee,"subchannelAddressToString",{enumerable:!0,get:function(){return qz.subchannelAddressToString}});var zz=nf();Object.defineProperty(ee,"ChildLoadBalancerHandler",{enumerable:!0,get:function(){return zz.ChildLoadBalancerHandler}});var m0=$r();Object.defineProperty(ee,"UnavailablePicker",{enumerable:!0,get:function(){return m0.UnavailablePicker}});Object.defineProperty(ee,"QueuePicker",{enumerable:!0,get:function(){return m0.QueuePicker}});Object.defineProperty(ee,"PickResultType",{enumerable:!0,get:function(){return m0.PickResultType}});var Gz=Zf();Object.defineProperty(ee,"BaseFilter",{enumerable:!0,get:function(){return Gz.BaseFilter}});var Wz=x_();Object.defineProperty(ee,"FilterStackFactory",{enumerable:!0,get:function(){return Wz.FilterStackFactory}});var $z=sf();Object.defineProperty(ee,"registerAdminService",{enumerable:!0,get:function(){return $z.registerAdminService}});var Hz=fm();Object.defineProperty(ee,"BaseSubchannelWrapper",{enumerable:!0,get:function(){return Hz.BaseSubchannelWrapper}});var Kz=h0();Object.defineProperty(ee,"OutlierDetectionLoadBalancingConfig",{enumerable:!0,get:function(){return Kz.OutlierDetectionLoadBalancingConfig}})});var Vk=E(Am=>{"use strict";Object.defineProperty(Am,"__esModule",{value:!0});Am.setup=void 0;var Qz=ki(),p0=class{constructor(e,t,i){this.listener=t,this.addresses=[],this.hasReturnedResult=!1;let r;e.authority===""?r="/"+e.path:r=e.path,this.addresses=[{path:r}]}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(this.listener.onSuccessfulResolution,this.addresses,null,null,null,{}))}destroy(){}static getDefaultAuthority(e){return"localhost"}};function Yz(){(0,Qz.registerResolver)("unix",p0)}Am.setup=Yz});var Gk=E(Rm=>{"use strict";Object.defineProperty(Rm,"__esModule",{value:!0});Rm.setup=void 0;var Uk=Ie("net"),Dm=Te(),g0=nn(),jk=ki(),qk=_n(),Xz=rt(),Zz="ip_resolver";function zk(n){Xz.trace(Dm.LogVerbosity.DEBUG,Zz,n)}var y0="ipv4",b0="ipv6",Jz=443,km=class{constructor(e,t,i){var r;this.listener=t,this.addresses=[],this.error=null,this.hasReturnedResult=!1,zk("Resolver constructed for target "+(0,qk.uriToString)(e));let s=[];if(!(e.scheme===y0||e.scheme===b0)){this.error={code:Dm.Status.UNAVAILABLE,details:`Unrecognized scheme ${e.scheme} in IP resolver`,metadata:new g0.Metadata};return}let o=e.path.split(",");for(let a of o){let c=(0,qk.splitHostPort)(a);if(c===null){this.error={code:Dm.Status.UNAVAILABLE,details:`Failed to parse ${e.scheme} address ${a}`,metadata:new g0.Metadata};return}if(e.scheme===y0&&!(0,Uk.isIPv4)(c.host)||e.scheme===b0&&!(0,Uk.isIPv6)(c.host)){this.error={code:Dm.Status.UNAVAILABLE,details:`Failed to parse ${e.scheme} address ${a}`,metadata:new g0.Metadata};return}s.push({host:c.host,port:(r=c.port)!==null&&r!==void 0?r:Jz})}this.addresses=s,zk("Parsed "+e.scheme+" address list "+this.addresses)}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(()=>{this.error?this.listener.onError(this.error):this.listener.onSuccessfulResolution(this.addresses,null,null,null,{})}))}destroy(){this.hasReturnedResult=!1}static getDefaultAuthority(e){return e.path.split(",")[0]}};function e3(){(0,jk.registerResolver)(y0,km),(0,jk.registerResolver)(b0,km)}Rm.setup=e3});var Hk=E($i=>{"use strict";Object.defineProperty($i,"__esModule",{value:!0});$i.setup=$i.PickFirstLoadBalancer=$i.shuffled=$i.PickFirstLoadBalancingConfig=void 0;var Wk=qr(),$t=Pn(),Mm=$r(),t3=rt(),n3=Te(),i3="pick_first";function v0(n){t3.trace(n3.LogVerbosity.DEBUG,i3,n)}var _u="pick_first",r3=250,wu=class n{constructor(e){this.shuffleAddressList=e}getLoadBalancerName(){return _u}toJsonObject(){return{[_u]:{shuffleAddressList:this.shuffleAddressList}}}getShuffleAddressList(){return this.shuffleAddressList}static createFromJson(e){if("shuffleAddressList"in e&&typeof e.shuffleAddressList!="boolean")throw new Error("pick_first config field shuffleAddressList must be a boolean if provided");return new n(e.shuffleAddressList===!0)}};$i.PickFirstLoadBalancingConfig=wu;var _0=class{constructor(e){this.subchannel=e}pick(e){return{pickResultType:Mm.PickResultType.COMPLETE,subchannel:this.subchannel,status:null,onCallStarted:null,onCallEnded:null}}};function $k(n){let e=n.slice();for(let t=e.length-1;t>1;t--){let i=Math.floor(Math.random()*(t+1)),r=e[t];e[t]=e[i],e[i]=r}return e}$i.shuffled=$k;var Om=class{constructor(e){this.channelControlHelper=e,this.children=[],this.currentState=$t.ConnectivityState.IDLE,this.currentSubchannelIndex=0,this.currentPick=null,this.subchannelStateListener=(t,i,r,s,o)=>{this.onSubchannelStateUpdate(t,i,r,o)},this.triedAllSubchannels=!1,this.stickyTransientFailureMode=!1,this.requestedResolutionSinceLastUpdate=!1,this.lastError=null,this.latestAddressList=null,this.connectionDelayTimeout=setTimeout(()=>{},0),clearTimeout(this.connectionDelayTimeout)}allChildrenHaveReportedTF(){return this.children.every(e=>e.hasReportedTransientFailure)}calculateAndReportNewState(){this.currentPick?this.updateState($t.ConnectivityState.READY,new _0(this.currentPick)):this.children.length===0?this.updateState($t.ConnectivityState.IDLE,new Mm.QueuePicker(this)):this.stickyTransientFailureMode?this.updateState($t.ConnectivityState.TRANSIENT_FAILURE,new Mm.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState($t.ConnectivityState.CONNECTING,new Mm.QueuePicker(this))}requestReresolution(){this.requestedResolutionSinceLastUpdate=!0,this.channelControlHelper.requestReresolution()}maybeEnterStickyTransientFailureMode(){if(this.allChildrenHaveReportedTF()&&(this.requestedResolutionSinceLastUpdate||this.requestReresolution(),!this.stickyTransientFailureMode)){this.stickyTransientFailureMode=!0;for(let{subchannel:e}of this.children)e.startConnecting();this.calculateAndReportNewState()}}removeCurrentPick(){if(this.currentPick!==null){let e=this.currentPick;this.currentPick=null,e.unref(),e.removeConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.removeChannelzChild(e.getChannelzRef())}}onSubchannelStateUpdate(e,t,i,r){var s;if(!((s=this.currentPick)===null||s===void 0)&&s.realSubchannelEquals(e)){i!==$t.ConnectivityState.READY&&(this.removeCurrentPick(),this.calculateAndReportNewState(),this.requestReresolution());return}for(let[o,a]of this.children.entries())if(e.realSubchannelEquals(a.subchannel)){i===$t.ConnectivityState.READY&&this.pickSubchannel(a.subchannel),i===$t.ConnectivityState.TRANSIENT_FAILURE&&(a.hasReportedTransientFailure=!0,r&&(this.lastError=r),this.maybeEnterStickyTransientFailureMode(),o===this.currentSubchannelIndex&&this.startNextSubchannelConnecting(o+1)),a.subchannel.startConnecting();return}}startNextSubchannelConnecting(e){if(clearTimeout(this.connectionDelayTimeout),!this.triedAllSubchannels){for(let[t,i]of this.children.entries())if(t>=e){let r=i.subchannel.getConnectivityState();if(r===$t.ConnectivityState.IDLE||r===$t.ConnectivityState.CONNECTING){this.startConnecting(t);return}}this.triedAllSubchannels=!0,this.maybeEnterStickyTransientFailureMode()}}startConnecting(e){var t,i;clearTimeout(this.connectionDelayTimeout),this.currentSubchannelIndex=e,this.children[e].subchannel.getConnectivityState()===$t.ConnectivityState.IDLE&&(v0("Start connecting to subchannel with address "+this.children[e].subchannel.getAddress()),process.nextTick(()=>{var r;(r=this.children[e])===null||r===void 0||r.subchannel.startConnecting()})),this.connectionDelayTimeout=(i=(t=setTimeout(()=>{this.startNextSubchannelConnecting(e+1)},r3)).unref)===null||i===void 0?void 0:i.call(t)}pickSubchannel(e){this.currentPick&&e.realSubchannelEquals(this.currentPick)||(v0("Pick subchannel with address "+e.getAddress()),this.stickyTransientFailureMode=!1,this.currentPick!==null&&(this.currentPick.unref(),this.channelControlHelper.removeChannelzChild(this.currentPick.getChannelzRef()),this.currentPick.removeConnectivityStateListener(this.subchannelStateListener)),this.currentPick=e,e.ref(),this.channelControlHelper.addChannelzChild(e.getChannelzRef()),this.resetSubchannelList(),clearTimeout(this.connectionDelayTimeout),this.calculateAndReportNewState())}updateState(e,t){v0($t.ConnectivityState[this.currentState]+" -> "+$t.ConnectivityState[e]),this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.children)this.currentPick&&e.subchannel.realSubchannelEquals(this.currentPick)||e.subchannel.removeConnectivityStateListener(this.subchannelStateListener),e.subchannel.unref(),this.channelControlHelper.removeChannelzChild(e.subchannel.getChannelzRef());this.currentSubchannelIndex=0,this.children=[],this.triedAllSubchannels=!1,this.requestedResolutionSinceLastUpdate=!1}connectToAddressList(e){let t=e.map(i=>({subchannel:this.channelControlHelper.createSubchannel(i,{}),hasReportedTransientFailure:!1}));for(let{subchannel:i}of t)i.ref(),this.channelControlHelper.addChannelzChild(i.getChannelzRef());this.resetSubchannelList(),this.children=t;for(let{subchannel:i}of this.children)if(i.addConnectivityStateListener(this.subchannelStateListener),i.getConnectivityState()===$t.ConnectivityState.READY){this.pickSubchannel(i);return}for(let i of this.children)i.subchannel.getConnectivityState()===$t.ConnectivityState.TRANSIENT_FAILURE&&(i.hasReportedTransientFailure=!0);this.startNextSubchannelConnecting(0),this.calculateAndReportNewState()}updateAddressList(e,t){t instanceof wu&&(t.getShuffleAddressList()&&(e=$k(e)),this.latestAddressList=e,this.connectToAddressList(e))}exitIdle(){this.currentState===$t.ConnectivityState.IDLE&&this.latestAddressList&&this.connectToAddressList(this.latestAddressList)}resetBackoff(){}destroy(){this.resetSubchannelList(),this.removeCurrentPick()}getTypeName(){return _u}};$i.PickFirstLoadBalancer=Om;function s3(){(0,Wk.registerLoadBalancerType)(_u,Om,wu),(0,Wk.registerDefaultLoadBalancerType)(_u)}$i.setup=s3});var Qk=E(Za=>{"use strict";Object.defineProperty(Za,"__esModule",{value:!0});Za.setup=Za.RoundRobinLoadBalancer=void 0;var o3=qr(),Ht=Pn(),Pm=$r(),a3=Mi(),c3=rt(),l3=Te(),u3="round_robin";function Kk(n){c3.trace(l3.LogVerbosity.DEBUG,u3,n)}var Nm="round_robin",w0=class n{getLoadBalancerName(){return Nm}constructor(){}toJsonObject(){return{[Nm]:{}}}static createFromJson(e){return new n}},C0=class{constructor(e,t=0){this.subchannelList=e,this.nextIndex=t}pick(e){let t=this.subchannelList[this.nextIndex];return this.nextIndex=(this.nextIndex+1)%this.subchannelList.length,{pickResultType:Pm.PickResultType.COMPLETE,subchannel:t,status:null,onCallStarted:null,onCallEnded:null}}peekNextSubchannel(){return this.subchannelList[this.nextIndex]}},Fm=class{constructor(e){this.channelControlHelper=e,this.subchannels=[],this.currentState=Ht.ConnectivityState.IDLE,this.currentReadyPicker=null,this.lastError=null,this.subchannelStateListener=(t,i,r,s,o)=>{this.calculateAndUpdateState(),(r===Ht.ConnectivityState.TRANSIENT_FAILURE||r===Ht.ConnectivityState.IDLE)&&(o&&(this.lastError=o),this.channelControlHelper.requestReresolution(),t.startConnecting())}}countSubchannelsWithState(e){return this.subchannels.filter(t=>t.getConnectivityState()===e).length}calculateAndUpdateState(){if(this.countSubchannelsWithState(Ht.ConnectivityState.READY)>0){let e=this.subchannels.filter(i=>i.getConnectivityState()===Ht.ConnectivityState.READY),t=0;this.currentReadyPicker!==null&&(t=e.indexOf(this.currentReadyPicker.peekNextSubchannel()),t<0&&(t=0)),this.updateState(Ht.ConnectivityState.READY,new C0(e,t))}else this.countSubchannelsWithState(Ht.ConnectivityState.CONNECTING)>0?this.updateState(Ht.ConnectivityState.CONNECTING,new Pm.QueuePicker(this)):this.countSubchannelsWithState(Ht.ConnectivityState.TRANSIENT_FAILURE)>0?this.updateState(Ht.ConnectivityState.TRANSIENT_FAILURE,new Pm.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(Ht.ConnectivityState.IDLE,new Pm.QueuePicker(this))}updateState(e,t){Kk(Ht.ConnectivityState[this.currentState]+" -> "+Ht.ConnectivityState[e]),e===Ht.ConnectivityState.READY?this.currentReadyPicker=t:this.currentReadyPicker=null,this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.subchannels)e.removeConnectivityStateListener(this.subchannelStateListener),e.unref(),this.channelControlHelper.removeChannelzChild(e.getChannelzRef());this.subchannels=[]}updateAddressList(e,t){this.resetSubchannelList(),Kk("Connect to address list "+e.map(i=>(0,a3.subchannelAddressToString)(i))),this.subchannels=e.map(i=>this.channelControlHelper.createSubchannel(i,{}));for(let i of this.subchannels){i.ref(),i.addConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.addChannelzChild(i.getChannelzRef());let r=i.getConnectivityState();(r===Ht.ConnectivityState.IDLE||r===Ht.ConnectivityState.TRANSIENT_FAILURE)&&i.startConnecting()}this.calculateAndUpdateState()}exitIdle(){for(let e of this.subchannels)e.startConnecting()}resetBackoff(){}destroy(){this.resetSubchannelList()}getTypeName(){return Nm}};Za.RoundRobinLoadBalancer=Fm;function d3(){(0,o3.registerLoadBalancerType)(Nm,Fm,w0)}Za.setup=d3});var Jk=E(G=>{"use strict";Object.defineProperty(G,"__esModule",{value:!0});G.experimental=G.addAdminServicesToServer=G.getChannelzHandlers=G.getChannelzServiceDefinition=G.InterceptorConfigurationError=G.InterceptingCall=G.RequesterBuilder=G.ListenerBuilder=G.StatusBuilder=G.getClientChannel=G.ServerCredentials=G.Server=G.setLogVerbosity=G.setLogger=G.load=G.loadObject=G.CallCredentials=G.ChannelCredentials=G.waitForClientReady=G.closeClient=G.Channel=G.makeGenericClientConstructor=G.makeClientConstructor=G.loadPackageDefinition=G.Client=G.compressionAlgorithms=G.propagate=G.connectivityState=G.status=G.logVerbosity=G.Metadata=G.credentials=void 0;var Lm=bb();Object.defineProperty(G,"CallCredentials",{enumerable:!0,get:function(){return Lm.CallCredentials}});var h3=Yb();Object.defineProperty(G,"Channel",{enumerable:!0,get:function(){return h3.ChannelImplementation}});var f3=I_();Object.defineProperty(G,"compressionAlgorithms",{enumerable:!0,get:function(){return f3.CompressionAlgorithms}});var m3=Pn();Object.defineProperty(G,"connectivityState",{enumerable:!0,get:function(){return m3.ConnectivityState}});var Bm=Qh();Object.defineProperty(G,"ChannelCredentials",{enumerable:!0,get:function(){return Bm.ChannelCredentials}});var Yk=Qb();Object.defineProperty(G,"Client",{enumerable:!0,get:function(){return Yk.Client}});var E0=Te();Object.defineProperty(G,"logVerbosity",{enumerable:!0,get:function(){return E0.LogVerbosity}});Object.defineProperty(G,"status",{enumerable:!0,get:function(){return E0.Status}});Object.defineProperty(G,"propagate",{enumerable:!0,get:function(){return E0.Propagate}});var Xk=rt(),S0=Zb();Object.defineProperty(G,"loadPackageDefinition",{enumerable:!0,get:function(){return S0.loadPackageDefinition}});Object.defineProperty(G,"makeClientConstructor",{enumerable:!0,get:function(){return S0.makeClientConstructor}});Object.defineProperty(G,"makeGenericClientConstructor",{enumerable:!0,get:function(){return S0.makeClientConstructor}});var p3=nn();Object.defineProperty(G,"Metadata",{enumerable:!0,get:function(){return p3.Metadata}});var g3=Rk();Object.defineProperty(G,"Server",{enumerable:!0,get:function(){return g3.Server}});var y3=e0();Object.defineProperty(G,"ServerCredentials",{enumerable:!0,get:function(){return y3.ServerCredentials}});var b3=Mk();Object.defineProperty(G,"StatusBuilder",{enumerable:!0,get:function(){return b3.StatusBuilder}});G.credentials={combineChannelCredentials:(n,...e)=>e.reduce((t,i)=>t.compose(i),n),combineCallCredentials:(n,...e)=>e.reduce((t,i)=>t.compose(i),n),createInsecure:Bm.ChannelCredentials.createInsecure,createSsl:Bm.ChannelCredentials.createSsl,createFromSecureContext:Bm.ChannelCredentials.createFromSecureContext,createFromMetadataGenerator:Lm.CallCredentials.createFromMetadataGenerator,createFromGoogleCredential:Lm.CallCredentials.createFromGoogleCredential,createEmpty:Lm.CallCredentials.createEmpty};var v3=n=>n.close();G.closeClient=v3;var _3=(n,e,t)=>n.waitForReady(e,t);G.waitForClientReady=_3;var w3=(n,e)=>{throw new Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")};G.loadObject=w3;var C3=(n,e,t)=>{throw new Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")};G.load=C3;var E3=n=>{Xk.setLogger(n)};G.setLogger=E3;var S3=n=>{Xk.setLoggerVerbosity(n)};G.setLogVerbosity=S3;var T3=n=>Yk.Client.prototype.getChannel.call(n);G.getClientChannel=T3;var Vm=$b();Object.defineProperty(G,"ListenerBuilder",{enumerable:!0,get:function(){return Vm.ListenerBuilder}});Object.defineProperty(G,"RequesterBuilder",{enumerable:!0,get:function(){return Vm.RequesterBuilder}});Object.defineProperty(G,"InterceptingCall",{enumerable:!0,get:function(){return Vm.InterceptingCall}});Object.defineProperty(G,"InterceptorConfigurationError",{enumerable:!0,get:function(){return Vm.InterceptorConfigurationError}});var Zk=to();Object.defineProperty(G,"getChannelzServiceDefinition",{enumerable:!0,get:function(){return Zk.getChannelzServiceDefinition}});Object.defineProperty(G,"getChannelzHandlers",{enumerable:!0,get:function(){return Zk.getChannelzHandlers}});var x3=sf();Object.defineProperty(G,"addAdminServicesToServer",{enumerable:!0,get:function(){return x3.addAdminServicesToServer}});var I3=f0();G.experimental=I3;var A3=m_(),D3=Vk(),k3=Gk(),R3=Hk(),M3=Qk(),O3=h0(),P3=to();A3.setup(),D3.setup(),k3.setup(),R3.setup(),M3.setup(),O3.setup(),P3.setup()});var DT=(()=>{let e=class e{constructor(i,r){this._renderer=i,this._elementRef=r,this.onChange=s=>{},this.onTouched=()=>{}}setProperty(i,r){this._renderer.setProperty(this._elementRef.nativeElement,i,r)}registerOnTouched(i){this.onTouched=i}registerOnChange(i){this.onChange=i}setDisabledState(i){this.setProperty("disabled",i)}};e.\u0275fac=function(r){return new(r||e)(z(rr),z(nt))},e.\u0275dir=Me({type:e});let n=e;return n})(),th=(()=>{let e=class e extends DT{};e.\u0275fac=(()=>{let i;return function(s){return(i||(i=Ko(e)))(s||e)}})(),e.\u0275dir=Me({type:e,features:[Ot]});let n=e;return n})(),ml=new J(""),iF={provide:ml,useExisting:Bs(()=>Zg),multi:!0},Zg=(()=>{let e=class e extends th{writeValue(i){this.setProperty("checked",i)}};e.\u0275fac=(()=>{let i;return function(s){return(i||(i=Ko(e)))(s||e)}})(),e.\u0275dir=Me({type:e,selectors:[["input","type","checkbox","formControlName",""],["input","type","checkbox","formControl",""],["input","type","checkbox","ngModel",""]],hostBindings:function(r,s){r&1&&ce("change",function(a){return s.onChange(a.target.checked)})("blur",function(){return s.onTouched()})},features:[ni([iF]),Ot]});let n=e;return n})(),rF={provide:ml,useExisting:Bs(()=>Ti),multi:!0};function sF(){let n=jg()?jg().getUserAgent():"";return/android (\d+)/.test(n.toLowerCase())}var oF=new J(""),Ti=(()=>{let e=class e extends DT{constructor(i,r,s){super(i,r),this._compositionMode=s,this._composing=!1,this._compositionMode==null&&(this._compositionMode=!sF())}writeValue(i){let r=i??"";this.setProperty("value",r)}_handleInput(i){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(i)}_compositionStart(){this._composing=!0}_compositionEnd(i){this._composing=!1,this._compositionMode&&this.onChange(i)}};e.\u0275fac=function(r){return new(r||e)(z(rr),z(nt),z(oF,8))},e.\u0275dir=Me({type:e,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(r,s){r&1&&ce("input",function(a){return s._handleInput(a.target.value)})("blur",function(){return s.onTouched()})("compositionstart",function(){return s._compositionStart()})("compositionend",function(a){return s._compositionEnd(a.target.value)})},features:[ni([rF]),Ot]});let n=e;return n})();var kT=new J(""),RT=new J("");function MT(n){return n!=null}function OT(n){return nT(n)?Yn(n):n}function PT(n){let e={};return n.forEach(t=>{e=t!=null?he(he({},e),t):e}),Object.keys(e).length===0?null:e}function NT(n,e){return e.map(t=>t(n))}function aF(n){return!n.validate}function FT(n){return n.map(e=>aF(e)?e:t=>e.validate(t))}function cF(n){if(!n)return null;let e=n.filter(MT);return e.length==0?null:function(t){return PT(NT(t,e))}}function Jg(n){return n!=null?cF(FT(n)):null}function lF(n){if(!n)return null;let e=n.filter(MT);return e.length==0?null:function(t){let i=NT(t,e).map(OT);return VS(i).pipe(Ae(PT))}}function ey(n){return n!=null?lF(FT(n)):null}function wT(n,e){return n===null?[e]:Array.isArray(n)?[...n,e]:[n,e]}function uF(n){return n._rawValidators}function dF(n){return n._rawAsyncValidators}function Xg(n){return n?Array.isArray(n)?n:[n]:[]}function Yd(n,e){return Array.isArray(n)?n.includes(e):n===e}function CT(n,e){let t=Xg(e);return Xg(n).forEach(r=>{Yd(t,r)||t.push(r)}),t}function ET(n,e){return Xg(e).filter(t=>!Yd(n,t))}var Xd=class{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(e){this._rawValidators=e||[],this._composedValidatorFn=Jg(this._rawValidators)}_setAsyncValidators(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=ey(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(e){this._onDestroyCallbacks.push(e)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(e=>e()),this._onDestroyCallbacks=[]}reset(e=void 0){this.control&&this.control.reset(e)}hasError(e,t){return this.control?this.control.hasError(e,t):!1}getError(e,t){return this.control?this.control.getError(e,t):null}},ta=class extends Xd{get formDirective(){return null}get path(){return null}},fl=class extends Xd{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}},Zd=class{constructor(e){this._cd=e}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}},hF={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},qQ=In(he({},hF),{"[class.ng-submitted]":"isSubmitted"}),Fr=(()=>{let e=class e extends Zd{constructor(i){super(i)}};e.\u0275fac=function(r){return new(r||e)(z(fl,2))},e.\u0275dir=Me({type:e,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(r,s){r&2&&kn("ng-untouched",s.isUntouched)("ng-touched",s.isTouched)("ng-pristine",s.isPristine)("ng-dirty",s.isDirty)("ng-valid",s.isValid)("ng-invalid",s.isInvalid)("ng-pending",s.isPending)},features:[Ot]});let n=e;return n})(),nh=(()=>{let e=class e extends Zd{constructor(i){super(i)}};e.\u0275fac=function(r){return new(r||e)(z(ta,10))},e.\u0275dir=Me({type:e,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(r,s){r&2&&kn("ng-untouched",s.isUntouched)("ng-touched",s.isTouched)("ng-pristine",s.isPristine)("ng-dirty",s.isDirty)("ng-valid",s.isValid)("ng-invalid",s.isInvalid)("ng-pending",s.isPending)("ng-submitted",s.isSubmitted)},features:[Ot]});let n=e;return n})();var ul="VALID",Qd="INVALID",ea="PENDING",dl="DISABLED";function LT(n){return(ih(n)?n.validators:n)||null}function fF(n){return Array.isArray(n)?Jg(n):n||null}function BT(n,e){return(ih(e)?e.asyncValidators:n)||null}function mF(n){return Array.isArray(n)?ey(n):n||null}function ih(n){return n!=null&&!Array.isArray(n)&&typeof n=="object"}function pF(n,e,t){let i=n.controls;if(!(e?Object.keys(i):i).length)throw new Ho(1e3,"");if(!i[t])throw new Ho(1001,"")}function gF(n,e,t){n._forEachChild((i,r)=>{if(t[r]===void 0)throw new Ho(1002,"")})}var Jd=class{constructor(e,t){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._assignValidators(e),this._assignAsyncValidators(t)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get valid(){return this.status===ul}get invalid(){return this.status===Qd}get pending(){return this.status==ea}get disabled(){return this.status===dl}get enabled(){return this.status!==dl}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._assignValidators(e)}setAsyncValidators(e){this._assignAsyncValidators(e)}addValidators(e){this.setValidators(CT(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(CT(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(ET(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(ET(e,this._rawAsyncValidators))}hasValidator(e){return Yd(this._rawValidators,e)}hasAsyncValidator(e){return Yd(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){this.touched=!0,this._parent&&!e.onlySelf&&this._parent.markAsTouched(e)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(e=>e.markAllAsTouched())}markAsUntouched(e={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(t=>{t.markAsUntouched({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}markAsDirty(e={}){this.pristine=!1,this._parent&&!e.onlySelf&&this._parent.markAsDirty(e)}markAsPristine(e={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(t=>{t.markAsPristine({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}markAsPending(e={}){this.status=ea,e.emitEvent!==!1&&this.statusChanges.emit(this.status),this._parent&&!e.onlySelf&&this._parent.markAsPending(e)}disable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=dl,this.errors=null,this._forEachChild(i=>{i.disable(In(he({},e),{onlySelf:!0}))}),this._updateValue(),e.emitEvent!==!1&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(In(he({},e),{skipPristineCheck:t})),this._onDisabledChange.forEach(i=>i(!0))}enable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=ul,this._forEachChild(i=>{i.enable(In(he({},e),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors(In(he({},e),{skipPristineCheck:t})),this._onDisabledChange.forEach(i=>i(!1))}_updateAncestors(e){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(e){this._parent=e}getRawValue(){return this.value}updateValueAndValidity(e={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===ul||this.status===ea)&&this._runAsyncValidator(e.emitEvent)),e.emitEvent!==!1&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(e)}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?dl:ul}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e){if(this.asyncValidator){this.status=ea,this._hasOwnPendingAsyncValidator=!0;let t=OT(this.asyncValidator(this));this._asyncValidationSubscription=t.subscribe(i=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(i,{emitEvent:e})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(e,t={}){this.errors=e,this._updateControlsErrors(t.emitEvent!==!1)}get(e){let t=e;return t==null||(Array.isArray(t)||(t=t.split(".")),t.length===0)?null:t.reduce((i,r)=>i&&i._find(r),this)}getError(e,t){let i=t?this.get(t):this;return i&&i.errors?i.errors[e]:null}hasError(e,t){return!!this.getError(e,t)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(e)}_initObservables(){this.valueChanges=new Dn,this.statusChanges=new Dn}_calculateStatus(){return this._allControlsDisabled()?dl:this.errors?Qd:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(ea)?ea:this._anyControlsHaveStatus(Qd)?Qd:ul}_anyControlsHaveStatus(e){return this._anyControls(t=>t.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e={}){this.pristine=!this._anyControlsDirty(),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}_updateTouched(e={}){this.touched=this._anyControlsTouched(),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){ih(e)&&e.updateOn!=null&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){let t=this._parent&&this._parent.dirty;return!e&&!!t&&!this._parent._anyControlsDirty()}_find(e){return null}_assignValidators(e){this._rawValidators=Array.isArray(e)?e.slice():e,this._composedValidatorFn=fF(this._rawValidators)}_assignAsyncValidators(e){this._rawAsyncValidators=Array.isArray(e)?e.slice():e,this._composedAsyncValidatorFn=mF(this._rawAsyncValidators)}},eh=class extends Jd{constructor(e,t,i){super(LT(t),BT(i,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(e,t){return this.controls[e]?this.controls[e]:(this.controls[e]=t,t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange),t)}addControl(e,t,i={}){this.registerControl(e,t),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}removeControl(e,t={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}setControl(e,t,i={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],t&&this.registerControl(e,t),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}contains(e){return this.controls.hasOwnProperty(e)&&this.controls[e].enabled}setValue(e,t={}){gF(this,!0,e),Object.keys(e).forEach(i=>{pF(this,!0,i),this.controls[i].setValue(e[i],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){e!=null&&(Object.keys(e).forEach(i=>{let r=this.controls[i];r&&r.patchValue(e[i],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e={},t={}){this._forEachChild((i,r)=>{i.reset(e?e[r]:null,{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this._reduceChildren({},(e,t,i)=>(e[i]=t.getRawValue(),e))}_syncPendingControls(){let e=this._reduceChildren(!1,(t,i)=>i._syncPendingControls()?!0:t);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){Object.keys(this.controls).forEach(t=>{let i=this.controls[t];i&&e(i,t)})}_setUpControls(){this._forEachChild(e=>{e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(e){for(let[t,i]of Object.entries(this.controls))if(this.contains(t)&&e(i))return!0;return!1}_reduceValue(){let e={};return this._reduceChildren(e,(t,i,r)=>((i.enabled||this.disabled)&&(t[r]=i.value),t))}_reduceChildren(e,t){let i=e;return this._forEachChild((r,s)=>{i=t(i,r,s)}),i}_allControlsDisabled(){for(let e of Object.keys(this.controls))if(this.controls[e].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(e){return this.controls.hasOwnProperty(e)?this.controls[e]:null}};var ty=new J("CallSetDisabledState",{providedIn:"root",factory:()=>ny}),ny="always";function yF(n,e){return[...e.path,n]}function VT(n,e,t=ny){UT(n,e),e.valueAccessor.writeValue(n.value),(n.disabled||t==="always")&&e.valueAccessor.setDisabledState?.(n.disabled),vF(n,e),wF(n,e),_F(n,e),bF(n,e)}function ST(n,e){n.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(e)})}function bF(n,e){if(e.valueAccessor.setDisabledState){let t=i=>{e.valueAccessor.setDisabledState(i)};n.registerOnDisabledChange(t),e._registerOnDestroy(()=>{n._unregisterOnDisabledChange(t)})}}function UT(n,e){let t=uF(n);e.validator!==null?n.setValidators(wT(t,e.validator)):typeof t=="function"&&n.setValidators([t]);let i=dF(n);e.asyncValidator!==null?n.setAsyncValidators(wT(i,e.asyncValidator)):typeof i=="function"&&n.setAsyncValidators([i]);let r=()=>n.updateValueAndValidity();ST(e._rawValidators,r),ST(e._rawAsyncValidators,r)}function vF(n,e){e.valueAccessor.registerOnChange(t=>{n._pendingValue=t,n._pendingChange=!0,n._pendingDirty=!0,n.updateOn==="change"&&jT(n,e)})}function _F(n,e){e.valueAccessor.registerOnTouched(()=>{n._pendingTouched=!0,n.updateOn==="blur"&&n._pendingChange&&jT(n,e),n.updateOn!=="submit"&&n.markAsTouched()})}function jT(n,e){n._pendingDirty&&n.markAsDirty(),n.setValue(n._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(n._pendingValue),n._pendingChange=!1}function wF(n,e){let t=(i,r)=>{e.valueAccessor.writeValue(i),r&&e.viewToModelUpdate(i)};n.registerOnChange(t),e._registerOnDestroy(()=>{n._unregisterOnChange(t)})}function CF(n,e){n==null,UT(n,e)}function EF(n,e){if(!n.hasOwnProperty("model"))return!1;let t=n.model;return t.isFirstChange()?!0:!Object.is(e,t.currentValue)}function SF(n){return Object.getPrototypeOf(n.constructor)===th}function TF(n,e){n._syncPendingControls(),e.forEach(t=>{let i=t.control;i.updateOn==="submit"&&i._pendingChange&&(t.viewToModelUpdate(i._pendingValue),i._pendingChange=!1)})}function xF(n,e){if(!e)return null;Array.isArray(e);let t,i,r;return e.forEach(s=>{s.constructor===Ti?t=s:SF(s)?i=s:r=s}),r||i||t||null}var IF={provide:ta,useExisting:Bs(()=>pl)},hl=Promise.resolve(),pl=(()=>{let e=class e extends ta{constructor(i,r,s){super(),this.callSetDisabledState=s,this.submitted=!1,this._directives=new Set,this.ngSubmit=new Dn,this.form=new eh({},Jg(i),ey(r))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(i){hl.then(()=>{let r=this._findContainer(i.path);i.control=r.registerControl(i.name,i.control),VT(i.control,i,this.callSetDisabledState),i.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(i)})}getControl(i){return this.form.get(i.path)}removeControl(i){hl.then(()=>{let r=this._findContainer(i.path);r&&r.removeControl(i.name),this._directives.delete(i)})}addFormGroup(i){hl.then(()=>{let r=this._findContainer(i.path),s=new eh({});CF(s,i),r.registerControl(i.name,s),s.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(i){hl.then(()=>{let r=this._findContainer(i.path);r&&r.removeControl(i.name)})}getFormGroup(i){return this.form.get(i.path)}updateModel(i,r){hl.then(()=>{this.form.get(i.path).setValue(r)})}setValue(i){this.control.setValue(i)}onSubmit(i){return this.submitted=!0,TF(this.form,this._directives),this.ngSubmit.emit(i),i?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(i=void 0){this.form.reset(i),this.submitted=!1}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.form._updateOn=this.options.updateOn)}_findContainer(i){return i.pop(),i.length?this.form.get(i):this.form}};e.\u0275fac=function(r){return new(r||e)(z(kT,10),z(RT,10),z(ty,8))},e.\u0275dir=Me({type:e,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(r,s){r&1&&ce("submit",function(a){return s.onSubmit(a)})("reset",function(){return s.onReset()})},inputs:{options:[Ye.None,"ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[ni([IF]),Ot]});let n=e;return n})();function TT(n,e){let t=n.indexOf(e);t>-1&&n.splice(t,1)}function xT(n){return typeof n=="object"&&n!==null&&Object.keys(n).length===2&&"value"in n&&"disabled"in n}var AF=class extends Jd{constructor(e=null,t,i){super(LT(t),BT(i,t)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(e),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),ih(t)&&(t.nonNullable||t.initialValueIsDefault)&&(xT(e)?this.defaultValue=e.value:this.defaultValue=e)}setValue(e,t={}){this.value=this._pendingValue=e,this._onChange.length&&t.emitModelToViewChange!==!1&&this._onChange.forEach(i=>i(this.value,t.emitViewToModelChange!==!1)),this.updateValueAndValidity(t)}patchValue(e,t={}){this.setValue(e,t)}reset(e=this.defaultValue,t={}){this._applyFormState(e),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){TT(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){TT(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(e){xT(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}};var DF={provide:fl,useExisting:Bs(()=>cr)},IT=Promise.resolve(),cr=(()=>{let e=class e extends fl{constructor(i,r,s,o,a,c){super(),this._changeDetectorRef=a,this.callSetDisabledState=c,this.control=new AF,this._registered=!1,this.name="",this.update=new Dn,this._parent=i,this._setValidators(r),this._setAsyncValidators(s),this.valueAccessor=xF(this,o)}ngOnChanges(i){if(this._checkForErrors(),!this._registered||"name"in i){if(this._registered&&(this._checkName(),this.formDirective)){let r=i.name.previousValue;this.formDirective.removeControl({name:r,path:this._getPath(r)})}this._setUpControl()}"isDisabled"in i&&this._updateDisabled(i),EF(i,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(i){this.viewModel=i,this.update.emit(i)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!!(this.options&&this.options.standalone)}_setUpStandalone(){VT(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),!this._isStandalone()&&this.name}_updateValue(i){IT.then(()=>{this.control.setValue(i,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(i){let r=i.isDisabled.currentValue,s=r!==0&&Ei(r);IT.then(()=>{s&&!this.control.disabled?this.control.disable():!s&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(i){return this._parent?yF(i,this._parent):[i]}};e.\u0275fac=function(r){return new(r||e)(z(ta,9),z(kT,10),z(RT,10),z(ml,10),z(Xo,8),z(ty,8))},e.\u0275dir=Me({type:e,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[Ye.None,"disabled","isDisabled"],model:[Ye.None,"ngModel","model"],options:[Ye.None,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[ni([DF]),Ot,sl]});let n=e;return n})(),rh=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275dir=Me({type:e,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]});let n=e;return n})();var kF={provide:ml,useExisting:Bs(()=>na),multi:!0};function qT(n,e){return n==null?`${e}`:(e&&typeof e=="object"&&(e="Object"),`${n}: ${e}`.slice(0,50))}function RF(n){return n.split(":")[0]}var na=(()=>{let e=class e extends th{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(i){this._compareWith=i}writeValue(i){this.value=i;let r=this._getOptionId(i),s=qT(r,i);this.setProperty("value",s)}registerOnChange(i){this.onChange=r=>{this.value=this._getOptionValue(r),i(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(i){for(let r of this._optionMap.keys())if(this._compareWith(this._optionMap.get(r),i))return r;return null}_getOptionValue(i){let r=RF(i);return this._optionMap.has(r)?this._optionMap.get(r):i}};e.\u0275fac=(()=>{let i;return function(s){return(i||(i=Ko(e)))(s||e)}})(),e.\u0275dir=Me({type:e,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(r,s){r&1&&ce("change",function(a){return s.onChange(a.target.value)})("blur",function(){return s.onTouched()})},inputs:{compareWith:"compareWith"},features:[ni([kF]),Ot]});let n=e;return n})(),sh=(()=>{let e=class e{constructor(i,r,s){this._element=i,this._renderer=r,this._select=s,this._select&&(this.id=this._select._registerOption())}set ngValue(i){this._select!=null&&(this._select._optionMap.set(this.id,i),this._setElementValue(qT(this.id,i)),this._select.writeValue(this._select.value))}set value(i){this._setElementValue(i),this._select&&this._select.writeValue(this._select.value)}_setElementValue(i){this._renderer.setProperty(this._element.nativeElement,"value",i)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}};e.\u0275fac=function(r){return new(r||e)(z(nt),z(rr),z(na,9))},e.\u0275dir=Me({type:e,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}});let n=e;return n})(),MF={provide:ml,useExisting:Bs(()=>zT),multi:!0};function AT(n,e){return n==null?`${e}`:(typeof e=="string"&&(e=`'${e}'`),e&&typeof e=="object"&&(e="Object"),`${n}: ${e}`.slice(0,50))}function OF(n){return n.split(":")[0]}var zT=(()=>{let e=class e extends th{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(i){this._compareWith=i}writeValue(i){this.value=i;let r;if(Array.isArray(i)){let s=i.map(o=>this._getOptionId(o));r=(o,a)=>{o._setSelected(s.indexOf(a.toString())>-1)}}else r=(s,o)=>{s._setSelected(!1)};this._optionMap.forEach(r)}registerOnChange(i){this.onChange=r=>{let s=[],o=r.selectedOptions;if(o!==void 0){let a=o;for(let c=0;c<a.length;c++){let l=a[c],u=this._getOptionValue(l.value);s.push(u)}}else{let a=r.options;for(let c=0;c<a.length;c++){let l=a[c];if(l.selected){let u=this._getOptionValue(l.value);s.push(u)}}}this.value=s,i(s)}}_registerOption(i){let r=(this._idCounter++).toString();return this._optionMap.set(r,i),r}_getOptionId(i){for(let r of this._optionMap.keys())if(this._compareWith(this._optionMap.get(r)._value,i))return r;return null}_getOptionValue(i){let r=OF(i);return this._optionMap.has(r)?this._optionMap.get(r)._value:i}};e.\u0275fac=(()=>{let i;return function(s){return(i||(i=Ko(e)))(s||e)}})(),e.\u0275dir=Me({type:e,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(r,s){r&1&&ce("change",function(a){return s.onChange(a.target)})("blur",function(){return s.onTouched()})},inputs:{compareWith:"compareWith"},features:[ni([MF]),Ot]});let n=e;return n})(),oh=(()=>{let e=class e{constructor(i,r,s){this._element=i,this._renderer=r,this._select=s,this._select&&(this.id=this._select._registerOption(this))}set ngValue(i){this._select!=null&&(this._value=i,this._setElementValue(AT(this.id,i)),this._select.writeValue(this._select.value))}set value(i){this._select?(this._value=i,this._setElementValue(AT(this.id,i)),this._select.writeValue(this._select.value)):this._setElementValue(i)}_setElementValue(i){this._renderer.setProperty(this._element.nativeElement,"value",i)}_setSelected(i){this._renderer.setProperty(this._element.nativeElement,"selected",i)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}};e.\u0275fac=function(r){return new(r||e)(z(nt),z(rr),z(zT,9))},e.\u0275dir=Me({type:e,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}});let n=e;return n})();var PF=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=se({type:e}),e.\u0275inj=re({});let n=e;return n})();var GT=(()=>{let e=class e{static withConfig(i){return{ngModule:e,providers:[{provide:ty,useValue:i.callSetDisabledState??ny}]}}};e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=se({type:e}),e.\u0275inj=re({imports:[PF]});let n=e;return n})();var NF="firebase",FF="10.11.0";Ut(NF,FF,"app");var hn=new qd("ANGULARFIRE2_VERSION");function lh(n,e,t){if(e){if(e.length===1)return e[0];let s=e.filter(o=>o.app===t);if(s.length===1)return s[0]}return t.container.getProvider(n).getImmediate({optional:!0})}var gl=(n,e)=>{let t=e?[e]:Kd(),i=[];return t.forEach(r=>{r.container.getProvider(n).instances.forEach(o=>{i.includes(o)||i.push(o)})}),i},ii=class{constructor(){return gl(LF)}},LF="app-check";function ia(){}var ch=class{zone;delegate;constructor(e,t=FS){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,i){let r=this.zone,s=function(o){r.runGuarded(()=>{e.apply(this,[o])})};return this.delegate.schedule(s,t,i)}},iy=class{zone;task=null;constructor(e){this.zone=e}call(e,t){let i=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",ia,{},ia,ia)),t.pipe(Lg({next:i,complete:i,error:i})).subscribe(e).add(i)}unscheduleTask(){setTimeout(()=>{this.task!=null&&this.task.state==="scheduled"&&(this.task.invoke(),this.task=null)},10)}},xi=(()=>{class n{ngZone;outsideAngular;insideAngular;constructor(t){this.ngZone=t,this.outsideAngular=t.runOutsideAngular(()=>new ch(Zone.current)),this.insideAngular=t.run(()=>new ch(Zone.current,Md)),globalThis.\u0275AngularFireScheduler||=this}static \u0275fac=function(i){return new(i||n)(C(ae))};static \u0275prov=ie({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function uh(){let n=globalThis.\u0275AngularFireScheduler;if(!n)throw new Error(`Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using
provideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).`);return n}function BF(n){return uh().ngZone.runOutsideAngular(()=>n())}function qs(n){return uh().ngZone.run(()=>n())}function Zt(n){return VF(uh())(n)}function VF(n){return function(t){return t=t.lift(new iy(n.ngZone)),t.pipe(Ls(n.outsideAngular),Or(n.insideAngular))}}var UF=(n,e)=>function(){let i=arguments;return e&&setTimeout(()=>{e.state==="scheduled"&&e.invoke()},10),qs(()=>n.apply(void 0,i))},Jt=(n,e)=>function(){let t,i=arguments;for(let s=0;s<arguments.length;s++)typeof i[s]=="function"&&(e&&(t||=qs(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",ia,{},ia,ia))),i[s]=UF(i[s],t));let r=BF(()=>n.apply(this,i));if(!e)if(r instanceof un){let s=uh();return r.pipe(Ls(s.outsideAngular),Or(s.insideAngular))}else return qs(()=>r);return r instanceof un?r.pipe(Zt):r instanceof Promise?qs(()=>new Promise((s,o)=>r.then(a=>qs(()=>s(a)),a=>qs(()=>o(a))))):typeof r=="function"&&t?function(){return setTimeout(()=>{t&&t.state==="scheduled"&&t.invoke()},10),r.apply(this,arguments)}:qs(()=>r)};var lr=class{constructor(e){return e}},zs=class{constructor(){return Kd()}};function jF(n){return n&&n.length===1?n[0]:new lr(ll())}var ry=new J("angularfire2._apps"),qF={provide:lr,useFactory:jF,deps:[[new dn,ry]]},zF={provide:zs,deps:[[new dn,ry]]};function GF(n){return(e,t)=>{let i=e.runOutsideAngular(()=>n(t));return new lr(i)}}var WF=(()=>{class n{constructor(t){Ut("angularfire",hn.full,"core"),Ut("angularfire",hn.full,"app"),Ut("angular",zd.full,t.toString())}static \u0275fac=function(i){return new(i||n)(C(Ci))};static \u0275mod=se({type:n});static \u0275inj=re({providers:[qF,zF]})}return n})();function $T(n,...e){return{ngModule:WF,providers:[{provide:ry,useFactory:GF(n),multi:!0,deps:[ae,Vt,xi,...e]}]}}var HT=Jt(_T,!0);var $F=new Map,HF={activated:!1,tokenObservers:[]},KF={initialized:!1,enabled:!1};function ri(n){return $F.get(n)||Object.assign({},HF)}function ZT(){return KF}var QF="https://content-firebaseappcheck.googleapis.com/v1";var YF="exchangeDebugToken",KT={OFFSET_DURATION:5*60*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3},yY=24*60*60*1e3;var oy=class{constructor(e,t,i,r,s){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=i,this.lowerBound=r,this.upperBound=s,this.pending=null,this.nextErrorWaitInterval=r,r>s)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){return p(this,null,function*(){this.stop();try{this.pending=new $g,this.pending.promise.catch(t=>{}),yield XF(this.getNextRun(e)),this.pending.resolve(),yield this.pending.promise,this.pending=new $g,this.pending.promise.catch(t=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}};function XF(n){return new Promise(e=>{setTimeout(e,n)})}var ZF={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"},Lr=new bT("appCheck","AppCheck",ZF);function JT(n){if(!ri(n).activated)throw Lr.create("use-before-activation",{appName:n.name})}function ex(i,r){return p(this,arguments,function*({url:n,body:e},t){let s={"Content-Type":"application/json"},o=t.getImmediate({optional:!0});if(o){let m=yield o.getHeartbeatsHeader();m&&(s["X-Firebase-Client"]=m)}let a={method:"POST",body:JSON.stringify(e),headers:s},c;try{c=yield fetch(n,a)}catch(m){throw Lr.create("fetch-network-error",{originalErrorMessage:m?.message})}if(c.status!==200)throw Lr.create("fetch-status-error",{httpStatus:c.status});let l;try{l=yield c.json()}catch(m){throw Lr.create("fetch-parse-error",{originalErrorMessage:m?.message})}let u=l.ttl.match(/^([\d.]+)(s)$/);if(!u||!u[2]||isNaN(Number(u[1])))throw Lr.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${l.ttl}`});let d=Number(u[1])*1e3,h=Date.now();return{token:l.token,expireTimeMillis:h+d,issuedAtTimeMillis:h}})}function tx(n,e){let{projectId:t,appId:i,apiKey:r}=n.options;return{url:`${QF}/projects/${t}/apps/${i}:${YF}?key=${r}`,body:{debug_token:e}}}var JF="firebase-app-check-database",e2=1,ay="firebase-app-check-store";var dh=null;function t2(){return dh||(dh=new Promise((n,e)=>{try{let t=indexedDB.open(JF,e2);t.onsuccess=i=>{n(i.target.result)},t.onerror=i=>{var r;e(Lr.create("storage-open",{originalErrorMessage:(r=i.target.error)===null||r===void 0?void 0:r.message}))},t.onupgradeneeded=i=>{let r=i.target.result;switch(i.oldVersion){case 0:r.createObjectStore(ay,{keyPath:"compositeKey"})}}}catch(t){e(Lr.create("storage-open",{originalErrorMessage:t?.message}))}}),dh)}function n2(n,e){return i2(r2(n),e)}function i2(n,e){return p(this,null,function*(){let i=(yield t2()).transaction(ay,"readwrite"),s=i.objectStore(ay).put({compositeKey:n,value:e});return new Promise((o,a)=>{s.onsuccess=c=>{o()},i.onerror=c=>{var l;a(Lr.create("storage-set",{originalErrorMessage:(l=c.target.error)===null||l===void 0?void 0:l.message}))}})})}function r2(n){return`${n.options.appId}-${n.name}`}var cy=new Hd("@firebase/app-check");function sy(n,e){return $d()?n2(n,e).catch(t=>{cy.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function nx(){return ZT().enabled}function ix(){return p(this,null,function*(){let n=ZT();if(n.enabled&&n.token)return n.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}var s2={error:"UNKNOWN_ERROR"};function o2(n){return mT.encodeString(JSON.stringify(n),!1)}function ly(n,e=!1){return p(this,null,function*(){let t=n.app;JT(t);let i=ri(t),r=i.token,s;if(r&&!yl(r)&&(i.token=void 0,r=void 0),!r){let c=yield i.cachedTokenPromise;c&&(yl(c)?r=c:yield sy(t,void 0))}if(!e&&r&&yl(r))return{token:r.token};let o=!1;if(nx()){i.exchangeTokenPromise||(i.exchangeTokenPromise=ex(tx(t,yield ix()),n.heartbeatServiceProvider).finally(()=>{i.exchangeTokenPromise=void 0}),o=!0);let c=yield i.exchangeTokenPromise;return yield sy(t,c),i.token=c,{token:c.token}}try{i.exchangeTokenPromise||(i.exchangeTokenPromise=i.provider.getToken().finally(()=>{i.exchangeTokenPromise=void 0}),o=!0),r=yield ri(t).exchangeTokenPromise}catch(c){c.code==="appCheck/throttled"?cy.warn(c.message):cy.error(c),s=c}let a;return r?s?yl(r)?a={token:r.token,internalError:s}:a=YT(s):(a={token:r.token},i.token=r,yield sy(t,r)):a=YT(s),o&&u2(t,a),a})}function a2(n){return p(this,null,function*(){let e=n.app;JT(e);let{provider:t}=ri(e);if(nx()){let i=yield ix(),{token:r}=yield ex(tx(e,i),n.heartbeatServiceProvider);return{token:r}}else{let{token:i}=yield t.getToken();return{token:i}}})}function c2(n,e,t,i){let{app:r}=n,s=ri(r),o={next:t,error:i,type:e};if(s.tokenObservers=[...s.tokenObservers,o],s.token&&yl(s.token)){let a=s.token;Promise.resolve().then(()=>{t({token:a.token}),QT(n)}).catch(()=>{})}s.cachedTokenPromise.then(()=>QT(n))}function rx(n,e){let t=ri(n),i=t.tokenObservers.filter(r=>r.next!==e);i.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=i}function QT(n){let{app:e}=n,t=ri(e),i=t.tokenRefresher;i||(i=l2(n),t.tokenRefresher=i),!i.isRunning()&&t.isTokenAutoRefreshEnabled&&i.start()}function l2(n){let{app:e}=n;return new oy(()=>p(this,null,function*(){let t=ri(e),i;if(t.token?i=yield ly(n,!0):i=yield ly(n),i.error)throw i.error;if(i.internalError)throw i.internalError}),()=>!0,()=>{let t=ri(e);if(t.token){let i=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5,r=t.token.expireTimeMillis-5*60*1e3;return i=Math.min(i,r),Math.max(0,i-Date.now())}else return 0},KT.RETRIAL_MIN_WAIT,KT.RETRIAL_MAX_WAIT)}function u2(n,e){let t=ri(n).tokenObservers;for(let i of t)try{i.type==="EXTERNAL"&&e.error!=null?i.error(e.error):i.next(e)}catch{}}function yl(n){return n.expireTimeMillis-Date.now()>0}function YT(n){return{token:o2(s2),error:n}}var uy=class{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){let{tokenObservers:e}=ri(this.app);for(let t of e)rx(this.app,t.next);return Promise.resolve()}};function d2(n,e){return new uy(n,e)}function h2(n){return{getToken:e=>ly(n,e),getLimitedUseToken:()=>a2(n),addTokenListener:e=>c2(n,"INTERNAL",e),removeTokenListener:e=>rx(n.app,e)}}var f2="@firebase/app-check",m2="0.8.3";var p2="app-check",XT="app-check-internal";function g2(){cl(new js(p2,n=>{let e=n.getProvider("app").getImmediate(),t=n.getProvider("heartbeat");return d2(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(XT).initialize()})),cl(new js(XT,n=>{let e=n.getProvider("app-check").getImmediate();return h2(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),Ut(f2,m2)}g2();var y2=["localhost","0.0.0.0","127.0.0.1"],DY=typeof window<"u"&&y2.includes(window.location.hostname);var b2="firebase",v2="10.11.0";Xt.registerVersion(b2,v2,"app-compat");var _2=["ngOnDestroy"],ax=(n,e,t,i={})=>new Proxy(n,{get:(r,s)=>t.runOutsideAngular(()=>{if(n[s])return i?.spy?.get&&i.spy.get(s,n[s]),n[s];if(_2.indexOf(s)>-1)return()=>{};let o=e.toPromise().then(a=>{let c=a?.[s];return typeof c=="function"?c.bind(a):c?.then?c.then(l=>t.run(()=>l)):t.run(()=>c)});return new Proxy(()=>{},{get:(a,c)=>o[c],apply:(a,c,l)=>o.then(u=>{let d=u?.(...l);return i?.spy?.apply&&i.spy.apply(s,l,d),d})})})});var hh=class{constructor(e){return e}},ra=new J("angularfire2.app.options"),sa=new J("angularfire2.app.name");function bl(n,e,t){let i=typeof t=="string"&&t||"[DEFAULT]",r=typeof t=="object"&&t||{};r.name=r.name||i;let o=Xt.apps.filter(a=>a&&a.name===r.name)[0]||e.runOutsideAngular(()=>Xt.initializeApp(n,r));try{if(JSON.stringify(n)!==JSON.stringify(o.options)){let a=!!module.hot;w2("error",`${o.name} Firebase App already initialized with different options${a?", you may need to reload as Firebase is not HMR aware.":"."}`)}}catch{}return new hh(o)}var w2=(n,...e)=>{Ug()&&typeof console<"u"&&console[n](...e)},C2={provide:hh,useFactory:bl,deps:[ra,ae,[new dn,sa]]},cx=(()=>{class n{static initializeApp(t,i){return{ngModule:n,providers:[{provide:ra,useValue:t},{provide:sa,useValue:i}]}}constructor(t){Xt.registerVersion("angularfire",hn.full,"core"),Xt.registerVersion("angularfire",hn.full,"app-compat"),Xt.registerVersion("angular",zd.full,t.toString())}static \u0275fac=function(i){return new(i||n)(C(Ci))};static \u0275mod=se({type:n});static \u0275inj=re({providers:[C2]})}return n})();function fh(n,e,t,i,r){let[,s,o]=globalThis.\u0275AngularfireInstanceCache.find(a=>a[0]===n)||[];if(s)return E2(r,o)||(ox("error",`${e} was already initialized on the ${t} Firebase App with different settings.${S2?" You may need to reload as Firebase is not HMR aware.":""}`),ox("warn",{is:r,was:o})),s;{let a=i();return globalThis.\u0275AngularfireInstanceCache.push([n,a,r]),a}}function E2(n,e){try{return n.toString()===e.toString()}catch{return n===e}}var S2=typeof module<"u"&&!!module.hot,ox=(n,...e)=>{Ug()&&typeof console<"u"&&console[n](...e)};globalThis.\u0275AngularfireInstanceCache||=[];var dy=new J("angularfire2.auth.use-emulator"),hy=new J("angularfire2.auth.settings"),fy=new J("angularfire2.auth.tenant-id"),my=new J("angularfire2.auth.langugage-code"),py=new J("angularfire2.auth.use-device-language"),gy=new J("angularfire.auth.persistence"),yy=(n,e,t,i,r,s,o,a)=>fh(`${n.name}.auth`,"AngularFireAuth",n.name,()=>{let c=e.runOutsideAngular(()=>n.auth());if(t&&c.useEmulator(...t),i&&(c.tenantId=i),c.languageCode=r,s&&c.useDeviceLanguage(),o)for(let[l,u]of Object.entries(o))c.settings[l]=u;return a&&c.setPersistence(a),c},[t,i,r,s,o,a]),ur=(()=>{class n{authState;idToken;user;idTokenResult;credential;constructor(t,i,r,s,o,a,c,l,u,d,h,m){let g=new We,y=An(void 0).pipe(Or(o.outsideAngular),Nr(()=>s.runOutsideAngular(()=>import("./chunk-5TLOMVCH.mjs"))),Ae(()=>bl(t,s,i)),Ae(_=>yy(_,s,a,l,u,d,c,h)),Pd({bufferSize:1,refCount:!1}));if(Gd(r))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=An(null);else{y.pipe(jS()).subscribe();let _=y.pipe(Nr(O=>O.getRedirectResult().then(P=>P,()=>null)),Zt,Pd({bufferSize:1,refCount:!1})),M=y.pipe(Nr(O=>new un(P=>({unsubscribe:s.runOutsideAngular(()=>O.onAuthStateChanged(W=>P.next(W),W=>P.error(W),()=>P.complete()))})))),T=y.pipe(Nr(O=>new un(P=>({unsubscribe:s.runOutsideAngular(()=>O.onIdTokenChanged(W=>P.next(W),W=>P.error(W),()=>P.complete()))}))));this.authState=_.pipe(Fg(M),Ls(o.outsideAngular),Or(o.insideAngular)),this.user=_.pipe(Fg(T),Ls(o.outsideAngular),Or(o.insideAngular)),this.idToken=this.user.pipe(Nr(O=>O?Yn(O.getIdToken()):An(null))),this.idTokenResult=this.user.pipe(Nr(O=>O?Yn(O.getIdTokenResult()):An(null))),this.credential=Od(_,g,this.authState.pipe(Xn(O=>!O))).pipe(Ae(O=>O?.user?O:null),Ls(o.outsideAngular),Or(o.insideAngular))}return ax(this,y,s,{spy:{apply:(_,M,T)=>{(_.startsWith("signIn")||_.startsWith("createUser"))&&T.then(O=>g.next(O))}}})}static \u0275fac=function(i){return new(i||n)(C(ra),C(sa,8),C(Ci),C(ae),C(xi),C(dy,8),C(hy,8),C(fy,8),C(my,8),C(py,8),C(gy,8),C(ii,8))};static \u0275prov=ie({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})(),lx=(()=>{class n{constructor(){Xt.registerVersion("angularfire",hn.full,"auth-compat")}static \u0275fac=function(i){return new(i||n)};static \u0275mod=se({type:n});static \u0275inj=re({providers:[ur]})}return n})();import{inspect as N3,TextEncoder as F3,TextDecoder as L3}from"util";import{randomBytes as B3}from"crypto";var T2=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},oi={},V,Vy=Vy||{},Z=T2||self;function Ah(n){var e=typeof n;return e=e!="object"?e:n?Array.isArray(n)?"array":e:"null",e=="array"||e=="object"&&typeof n.length=="number"}function Ml(n){var e=typeof n;return e=="object"&&n!=null||e=="function"}function x2(n){return Object.prototype.hasOwnProperty.call(n,by)&&n[by]||(n[by]=++I2)}var by="closure_uid_"+(1e9*Math.random()>>>0),I2=0;function A2(n,e,t){return n.call.apply(n.bind,arguments)}function D2(n,e,t){if(!n)throw Error();if(2<arguments.length){var i=Array.prototype.slice.call(arguments,2);return function(){var r=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(r,i),n.apply(e,r)}}return function(){return n.apply(e,arguments)}}function jt(n,e,t){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?jt=A2:jt=D2,jt.apply(null,arguments)}function ph(n,e){var t=Array.prototype.slice.call(arguments,1);return function(){var i=t.slice();return i.push.apply(i,arguments),n.apply(this,i)}}function Tt(n,e){function t(){}t.prototype=e.prototype,n.$=e.prototype,n.prototype=new t,n.prototype.constructor=n,n.ac=function(i,r,s){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return e.prototype[r].apply(i,o)}}function Br(){this.s=this.s,this.o=this.o}var k2=0;Br.prototype.s=!1;Br.prototype.sa=function(){!this.s&&(this.s=!0,this.N(),k2!=0)&&x2(this)};Br.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var Cx=Array.prototype.indexOf?function(n,e){return Array.prototype.indexOf.call(n,e,void 0)}:function(n,e){if(typeof n=="string")return typeof e!="string"||e.length!=1?-1:n.indexOf(e,0);for(let t=0;t<n.length;t++)if(t in n&&n[t]===e)return t;return-1};function Uy(n){let e=n.length;if(0<e){let t=Array(e);for(let i=0;i<e;i++)t[i]=n[i];return t}return[]}function ux(n,e){for(let t=1;t<arguments.length;t++){let i=arguments[t];if(Ah(i)){let r=n.length||0,s=i.length||0;n.length=r+s;for(let o=0;o<s;o++)n[r+o]=i[o]}else n.push(i)}}function qt(n,e){this.type=n,this.g=this.target=e,this.defaultPrevented=!1}qt.prototype.h=function(){this.defaultPrevented=!0};var R2=function(){if(!Z.addEventListener||!Object.defineProperty)return!1;var n=!1,e=Object.defineProperty({},"passive",{get:function(){n=!0}});try{let t=()=>{};Z.addEventListener("test",t,e),Z.removeEventListener("test",t,e)}catch{}return n}();function Sl(n){return/^[\s\xa0]*$/.test(n)}function Dh(){var n=Z.navigator;return n&&(n=n.userAgent)?n:""}function Ii(n){return Dh().indexOf(n)!=-1}function jy(n){return jy[" "](n),n}jy[" "]=function(){};function M2(n,e){var t=_L;return Object.prototype.hasOwnProperty.call(t,n)?t[n]:t[n]=e(n)}var O2=Ii("Opera"),la=Ii("Trident")||Ii("MSIE"),Ex=Ii("Edge"),Ey=Ex||la,Sx=Ii("Gecko")&&!(Dh().toLowerCase().indexOf("webkit")!=-1&&!Ii("Edge"))&&!(Ii("Trident")||Ii("MSIE"))&&!Ii("Edge"),P2=Dh().toLowerCase().indexOf("webkit")!=-1&&!Ii("Edge");function Tx(){var n=Z.document;return n?n.documentMode:void 0}var Sy;e:{if(gh="",yh=function(){var n=Dh();if(Sx)return/rv:([^\);]+)(\)|;)/.exec(n);if(Ex)return/Edge\/([\d\.]+)/.exec(n);if(la)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n);if(P2)return/WebKit\/(\S+)/.exec(n);if(O2)return/(?:Version)[ \/]?(\S+)/.exec(n)}(),yh&&(gh=yh?yh[1]:""),la&&(bh=Tx(),bh!=null&&bh>parseFloat(gh))){Sy=String(bh);break e}Sy=gh}var gh,yh,bh,Ty;Z.document&&la?(vy=Tx(),Ty=vy||parseInt(Sy,10)||void 0):Ty=void 0;var vy,N2=Ty;function Tl(n,e){if(qt.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var t=this.type=n.type,i=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=e,e=n.relatedTarget){if(Sx){e:{try{jy(e.nodeName);var r=!0;break e}catch{}r=!1}r||(e=null)}}else t=="mouseover"?e=n.fromElement:t=="mouseout"&&(e=n.toElement);this.relatedTarget=e,i?(this.clientX=i.clientX!==void 0?i.clientX:i.pageX,this.clientY=i.clientY!==void 0?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0):(this.clientX=n.clientX!==void 0?n.clientX:n.pageX,this.clientY=n.clientY!==void 0?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType=typeof n.pointerType=="string"?n.pointerType:F2[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&Tl.$.h.call(this)}}Tt(Tl,qt);var F2={2:"touch",3:"pen",4:"mouse"};Tl.prototype.h=function(){Tl.$.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var Ol="closure_listenable_"+(1e6*Math.random()|0),L2=0;function B2(n,e,t,i,r){this.listener=n,this.proxy=null,this.src=e,this.type=t,this.capture=!!i,this.la=r,this.key=++L2,this.fa=this.ia=!1}function kh(n){n.fa=!0,n.listener=null,n.proxy=null,n.src=null,n.la=null}function qy(n,e,t){for(let i in n)e.call(t,n[i],i,n)}function V2(n,e){for(let t in n)e.call(void 0,n[t],t,n)}function xx(n){let e={};for(let t in n)e[t]=n[t];return e}var dx="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Ix(n,e){let t,i;for(let r=1;r<arguments.length;r++){i=arguments[r];for(t in i)n[t]=i[t];for(let s=0;s<dx.length;s++)t=dx[s],Object.prototype.hasOwnProperty.call(i,t)&&(n[t]=i[t])}}function Rh(n){this.src=n,this.g={},this.h=0}Rh.prototype.add=function(n,e,t,i,r){var s=n.toString();n=this.g[s],n||(n=this.g[s]=[],this.h++);var o=Iy(n,e,i,r);return-1<o?(e=n[o],t||(e.ia=!1)):(e=new B2(e,this.src,s,!!i,r),e.ia=t,n.push(e)),e};function xy(n,e){var t=e.type;if(t in n.g){var i=n.g[t],r=Cx(i,e),s;(s=0<=r)&&Array.prototype.splice.call(i,r,1),s&&(kh(e),n.g[t].length==0&&(delete n.g[t],n.h--))}}function Iy(n,e,t,i){for(var r=0;r<n.length;++r){var s=n[r];if(!s.fa&&s.listener==e&&s.capture==!!t&&s.la==i)return r}return-1}var zy="closure_lm_"+(1e6*Math.random()|0),_y={};function Ax(n,e,t,i,r){if(i&&i.once)return kx(n,e,t,i,r);if(Array.isArray(e)){for(var s=0;s<e.length;s++)Ax(n,e[s],t,i,r);return null}return t=$y(t),n&&n[Ol]?n.O(e,t,Ml(i)?!!i.capture:!!i,r):Dx(n,e,t,!1,i,r)}function Dx(n,e,t,i,r,s){if(!e)throw Error("Invalid event type");var o=Ml(r)?!!r.capture:!!r,a=Wy(n);if(a||(n[zy]=a=new Rh(n)),t=a.add(e,t,i,o,s),t.proxy)return t;if(i=U2(),t.proxy=i,i.src=n,i.listener=t,n.addEventListener)R2||(r=o),r===void 0&&(r=!1),n.addEventListener(e.toString(),i,r);else if(n.attachEvent)n.attachEvent(Mx(e.toString()),i);else if(n.addListener&&n.removeListener)n.addListener(i);else throw Error("addEventListener and attachEvent are unavailable.");return t}function U2(){function n(t){return e.call(n.src,n.listener,t)}let e=j2;return n}function kx(n,e,t,i,r){if(Array.isArray(e)){for(var s=0;s<e.length;s++)kx(n,e[s],t,i,r);return null}return t=$y(t),n&&n[Ol]?n.P(e,t,Ml(i)?!!i.capture:!!i,r):Dx(n,e,t,!0,i,r)}function Rx(n,e,t,i,r){if(Array.isArray(e))for(var s=0;s<e.length;s++)Rx(n,e[s],t,i,r);else i=Ml(i)?!!i.capture:!!i,t=$y(t),n&&n[Ol]?(n=n.i,e=String(e).toString(),e in n.g&&(s=n.g[e],t=Iy(s,t,i,r),-1<t&&(kh(s[t]),Array.prototype.splice.call(s,t,1),s.length==0&&(delete n.g[e],n.h--)))):n&&(n=Wy(n))&&(e=n.g[e.toString()],n=-1,e&&(n=Iy(e,t,i,r)),(t=-1<n?e[n]:null)&&Gy(t))}function Gy(n){if(typeof n!="number"&&n&&!n.fa){var e=n.src;if(e&&e[Ol])xy(e.i,n);else{var t=n.type,i=n.proxy;e.removeEventListener?e.removeEventListener(t,i,n.capture):e.detachEvent?e.detachEvent(Mx(t),i):e.addListener&&e.removeListener&&e.removeListener(i),(t=Wy(e))?(xy(t,n),t.h==0&&(t.src=null,e[zy]=null)):kh(n)}}}function Mx(n){return n in _y?_y[n]:_y[n]="on"+n}function j2(n,e){if(n.fa)n=!0;else{e=new Tl(e,this);var t=n.listener,i=n.la||n.src;n.ia&&Gy(n),n=t.call(i,e)}return n}function Wy(n){return n=n[zy],n instanceof Rh?n:null}var wy="__closure_events_fn_"+(1e9*Math.random()>>>0);function $y(n){return typeof n=="function"?n:(n[wy]||(n[wy]=function(e){return n.handleEvent(e)}),n[wy])}function St(){Br.call(this),this.i=new Rh(this),this.S=this,this.J=null}Tt(St,Br);St.prototype[Ol]=!0;St.prototype.removeEventListener=function(n,e,t,i){Rx(this,n,e,t,i)};function Nt(n,e){var t,i=n.J;if(i)for(t=[];i;i=i.J)t.push(i);if(n=n.S,i=e.type||e,typeof e=="string")e=new qt(e,n);else if(e instanceof qt)e.target=e.target||n;else{var r=e;e=new qt(i,n),Ix(e,r)}if(r=!0,t)for(var s=t.length-1;0<=s;s--){var o=e.g=t[s];r=vh(o,i,!0,e)&&r}if(o=e.g=n,r=vh(o,i,!0,e)&&r,r=vh(o,i,!1,e)&&r,t)for(s=0;s<t.length;s++)o=e.g=t[s],r=vh(o,i,!1,e)&&r}St.prototype.N=function(){if(St.$.N.call(this),this.i){var n=this.i,e;for(e in n.g){for(var t=n.g[e],i=0;i<t.length;i++)kh(t[i]);delete n.g[e],n.h--}}this.J=null};St.prototype.O=function(n,e,t,i){return this.i.add(String(n),e,!1,t,i)};St.prototype.P=function(n,e,t,i){return this.i.add(String(n),e,!0,t,i)};function vh(n,e,t,i){if(e=n.i.g[String(e)],!e)return!0;e=e.concat();for(var r=!0,s=0;s<e.length;++s){var o=e[s];if(o&&!o.fa&&o.capture==t){var a=o.listener,c=o.la||o.src;o.ia&&xy(n.i,o),r=a.call(c,i)!==!1&&r}}return r&&!i.defaultPrevented}var Hy=Z.JSON.stringify,Ay=class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}};function q2(){var n=Ky;let e=null;return n.g&&(e=n.g,n.g=n.g.next,n.g||(n.h=null),e.next=null),e}var Dy=class{constructor(){this.h=this.g=null}add(e,t){let i=Ox.get();i.set(e,t),this.h?this.h.next=i:this.g=i,this.h=i}},Ox=new Ay(()=>new ky,n=>n.reset()),ky=class{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}};function z2(n){var e=1;n=n.split(":");let t=[];for(;0<e&&n.length;)t.push(n.shift()),e--;return n.length&&t.push(n.join(":")),t}function G2(n){Z.setTimeout(()=>{throw n},0)}var xl,Il=!1,Ky=new Dy,Px=()=>{let n=Z.Promise.resolve(void 0);xl=()=>{n.then(W2)}},W2=()=>{for(var n;n=q2();){try{n.h.call(n.g)}catch(t){G2(t)}var e=Ox;e.j(n),100>e.h&&(e.h++,n.next=e.g,e.g=n)}Il=!1};function Mh(n,e){St.call(this),this.h=n||1,this.g=e||Z,this.j=jt(this.qb,this),this.l=Date.now()}Tt(Mh,St);V=Mh.prototype;V.ga=!1;V.T=null;V.qb=function(){if(this.ga){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-n):(this.T&&(this.g.clearTimeout(this.T),this.T=null),Nt(this,"tick"),this.ga&&(Qy(this),this.start()))}};V.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function Qy(n){n.ga=!1,n.T&&(n.g.clearTimeout(n.T),n.T=null)}V.N=function(){Mh.$.N.call(this),Qy(this),delete this.g};function Yy(n,e,t){if(typeof n=="function")t&&(n=jt(n,t));else if(n&&typeof n.handleEvent=="function")n=jt(n.handleEvent,n);else throw Error("Invalid listener argument");return 2147483647<Number(e)?-1:Z.setTimeout(n,e||0)}function Nx(n){n.g=Yy(()=>{n.g=null,n.i&&(n.i=!1,Nx(n))},n.j);let e=n.h;n.h=null,n.m.apply(null,e)}var Ry=class extends Br{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:Nx(this)}N(){super.N(),this.g&&(Z.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}};function Al(n){Br.call(this),this.h=n,this.g={}}Tt(Al,Br);var hx=[];function Fx(n,e,t,i){Array.isArray(t)||(t&&(hx[0]=t.toString()),t=hx);for(var r=0;r<t.length;r++){var s=Ax(e,t[r],i||n.handleEvent,!1,n.h||n);if(!s)break;n.g[s.key]=s}}function Lx(n){qy(n.g,function(e,t){this.g.hasOwnProperty(t)&&Gy(e)},n),n.g={}}Al.prototype.N=function(){Al.$.N.call(this),Lx(this)};Al.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function Oh(){this.g=!0}Oh.prototype.Ea=function(){this.g=!1};function $2(n,e,t,i,r,s){n.info(function(){if(n.g)if(s)for(var o="",a=s.split("&"),c=0;c<a.length;c++){var l=a[c].split("=");if(1<l.length){var u=l[0];l=l[1];var d=u.split("_");o=2<=d.length&&d[1]=="type"?o+(u+"="+l+"&"):o+(u+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+i+") [attempt "+r+"]: "+e+`
`+t+`
`+o})}function H2(n,e,t,i,r,s,o){n.info(function(){return"XMLHTTP RESP ("+i+") [ attempt "+r+"]: "+e+`
`+t+`
`+s+" "+o})}function aa(n,e,t,i){n.info(function(){return"XMLHTTP TEXT ("+e+"): "+Q2(n,t)+(i?" "+i:"")})}function K2(n,e){n.info(function(){return"TIMEOUT: "+e})}Oh.prototype.info=function(){};function Q2(n,e){if(!n.g)return e;if(!e)return null;try{var t=JSON.parse(e);if(t){for(n=0;n<t.length;n++)if(Array.isArray(t[n])){var i=t[n];if(!(2>i.length)){var r=i[1];if(Array.isArray(r)&&!(1>r.length)){var s=r[0];if(s!="noop"&&s!="stop"&&s!="close")for(var o=1;o<r.length;o++)r[o]=""}}}}return Hy(t)}catch{return e}}var Hs={},fx=null;function Ph(){return fx=fx||new St}Hs.Ta="serverreachability";function Bx(n){qt.call(this,Hs.Ta,n)}Tt(Bx,qt);function Dl(n){let e=Ph();Nt(e,new Bx(e))}Hs.STAT_EVENT="statevent";function Vx(n,e){qt.call(this,Hs.STAT_EVENT,n),this.stat=e}Tt(Vx,qt);function en(n){let e=Ph();Nt(e,new Vx(e,n))}Hs.Ua="timingevent";function Ux(n,e){qt.call(this,Hs.Ua,n),this.size=e}Tt(Ux,qt);function Pl(n,e){if(typeof n!="function")throw Error("Fn must not be null and must be a function");return Z.setTimeout(function(){n()},e)}var Nh={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},jx={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function Xy(){}Xy.prototype.h=null;function mx(n){return n.h||(n.h=n.i())}function qx(){}var Nl={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function Zy(){qt.call(this,"d")}Tt(Zy,qt);function Jy(){qt.call(this,"c")}Tt(Jy,qt);var My;function Fh(){}Tt(Fh,Xy);Fh.prototype.g=function(){return new XMLHttpRequest};Fh.prototype.i=function(){return{}};My=new Fh;function Fl(n,e,t,i){this.l=n,this.j=e,this.m=t,this.W=i||1,this.U=new Al(this),this.P=Y2,n=Ey?125:void 0,this.V=new Mh(n),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new zx}function zx(){this.i=null,this.g="",this.h=!1}var Y2=45e3,Gx={},Oy={};V=Fl.prototype;V.setTimeout=function(n){this.P=n};function Py(n,e,t){n.L=1,n.A=Bh(hr(e)),n.u=t,n.S=!0,Wx(n,null)}function Wx(n,e){n.G=Date.now(),Ll(n),n.B=hr(n.A);var t=n.B,i=n.W;Array.isArray(i)||(i=[String(i)]),Jx(t.i,"t",i),n.o=0,t=n.l.J,n.h=new zx,n.g=_I(n.l,t?e:null,!n.u),0<n.O&&(n.M=new Ry(jt(n.Pa,n,n.g),n.O)),Fx(n.U,n.g,"readystatechange",n.nb),e=n.I?xx(n.I):{},n.u?(n.v||(n.v="POST"),e["Content-Type"]="application/x-www-form-urlencoded",n.g.ha(n.B,n.v,n.u,e)):(n.v="GET",n.g.ha(n.B,n.v,null,e)),Dl(),$2(n.j,n.v,n.B,n.m,n.W,n.u)}V.nb=function(n){n=n.target;let e=this.M;e&&Ai(n)==3?e.l():this.Pa(n)};V.Pa=function(n){try{if(n==this.g)e:{let u=Ai(this.g);var e=this.g.Ia();let d=this.g.da();if(!(3>u)&&(u!=3||Ey||this.g&&(this.h.h||this.g.ja()||bx(this.g)))){this.J||u!=4||e==7||(e==8||0>=d?Dl(3):Dl(2)),Lh(this);var t=this.g.da();this.ca=t;t:if($x(this)){var i=bx(this.g);n="";var r=i.length,s=Ai(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Gs(this),El(this);var o="";break t}this.h.i=new Z.TextDecoder}for(e=0;e<r;e++)this.h.h=!0,n+=this.h.i.decode(i[e],{stream:s&&e==r-1});i.length=0,this.h.g+=n,this.o=0,o=this.h.g}else o=this.g.ja();if(this.i=t==200,H2(this.j,this.v,this.B,this.m,this.W,u,t),this.i){if(this.aa&&!this.K){t:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Sl(a)){var l=a;break t}}l=null}if(t=l)aa(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Ny(this,t);else{this.i=!1,this.s=3,en(12),Gs(this),El(this);break e}}this.S?(Hx(this,u,o),Ey&&this.i&&u==3&&(Fx(this.U,this.V,"tick",this.mb),this.V.start())):(aa(this.j,this.m,o,null),Ny(this,o)),u==4&&Gs(this),this.i&&!this.J&&(u==4?gI(this.l,this):(this.i=!1,Ll(this)))}else yL(this.g),t==400&&0<o.indexOf("Unknown SID")?(this.s=3,en(12)):(this.s=0,en(13)),Gs(this),El(this)}}}catch{}finally{}};function $x(n){return n.g?n.v=="GET"&&n.L!=2&&n.l.Ha:!1}function Hx(n,e,t){let i=!0,r;for(;!n.J&&n.o<t.length;)if(r=X2(n,t),r==Oy){e==4&&(n.s=4,en(14),i=!1),aa(n.j,n.m,null,"[Incomplete Response]");break}else if(r==Gx){n.s=4,en(15),aa(n.j,n.m,t,"[Invalid Chunk]"),i=!1;break}else aa(n.j,n.m,r,null),Ny(n,r);$x(n)&&n.o!=0&&(n.h.g=n.h.g.slice(n.o),n.o=0),e!=4||t.length!=0||n.h.h||(n.s=1,en(16),i=!1),n.i=n.i&&i,i?0<t.length&&!n.ba&&(n.ba=!0,e=n.l,e.g==n&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+t.length),sb(e),e.M=!0,en(11))):(aa(n.j,n.m,t,"[Invalid Chunked Response]"),Gs(n),El(n))}V.mb=function(){if(this.g){var n=Ai(this.g),e=this.g.ja();this.o<e.length&&(Lh(this),Hx(this,n,e),this.i&&n!=4&&Ll(this))}};function X2(n,e){var t=n.o,i=e.indexOf(`
`,t);return i==-1?Oy:(t=Number(e.substring(t,i)),isNaN(t)?Gx:(i+=1,i+t>e.length?Oy:(e=e.slice(i,i+t),n.o=i+t,e)))}V.cancel=function(){this.J=!0,Gs(this)};function Ll(n){n.Y=Date.now()+n.P,Kx(n,n.P)}function Kx(n,e){if(n.C!=null)throw Error("WatchDog timer not null");n.C=Pl(jt(n.lb,n),e)}function Lh(n){n.C&&(Z.clearTimeout(n.C),n.C=null)}V.lb=function(){this.C=null;let n=Date.now();0<=n-this.Y?(K2(this.j,this.B),this.L!=2&&(Dl(),en(17)),Gs(this),this.s=2,El(this)):Kx(this,this.Y-n)};function El(n){n.l.H==0||n.J||gI(n.l,n)}function Gs(n){Lh(n);var e=n.M;e&&typeof e.sa=="function"&&e.sa(),n.M=null,Qy(n.V),Lx(n.U),n.g&&(e=n.g,n.g=null,e.abort(),e.sa())}function Ny(n,e){try{var t=n.l;if(t.H!=0&&(t.g==n||Fy(t.i,n))){if(!n.K&&Fy(t.i,n)&&t.H==3){try{var i=t.Ja.g.parse(e)}catch{i=null}if(Array.isArray(i)&&i.length==3){var r=i;if(r[0]==0){e:if(!t.u){if(t.g)if(t.g.G+3e3<n.G)Sh(t),jh(t);else break e;rb(t),en(18)}}else t.Fa=r[1],0<t.Fa-t.V&&37500>r[2]&&t.G&&t.A==0&&!t.v&&(t.v=Pl(jt(t.ib,t),6e3));if(1>=nI(t.i)&&t.oa){try{t.oa()}catch{}t.oa=void 0}}else Ws(t,11)}else if((n.K||t.g==n)&&Sh(t),!Sl(e))for(r=t.Ja.g.parse(e),e=0;e<r.length;e++){let l=r[e];if(t.V=l[0],l=l[1],t.H==2)if(l[0]=="c"){t.K=l[1],t.pa=l[2];let u=l[3];u!=null&&(t.ra=u,t.l.info("VER="+t.ra));let d=l[4];d!=null&&(t.Ga=d,t.l.info("SVER="+t.Ga));let h=l[5];h!=null&&typeof h=="number"&&0<h&&(i=1.5*h,t.L=i,t.l.info("backChannelRequestTimeoutMs_="+i)),i=t;let m=n.g;if(m){let g=m.g?m.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(g){var s=i.i;s.g||g.indexOf("spdy")==-1&&g.indexOf("quic")==-1&&g.indexOf("h2")==-1||(s.j=s.l,s.g=new Set,s.h&&(eb(s,s.h),s.h=null))}if(i.F){let y=m.g?m.g.getResponseHeader("X-HTTP-Session-Id"):null;y&&(i.Da=y,qe(i.I,i.F,y))}}t.H=3,t.h&&t.h.Ba(),t.ca&&(t.S=Date.now()-n.G,t.l.info("Handshake RTT: "+t.S+"ms")),i=t;var o=n;if(i.wa=vI(i,i.J?i.pa:null,i.Y),o.K){iI(i.i,o);var a=o,c=i.L;c&&a.setTimeout(c),a.C&&(Lh(a),Ll(a)),i.g=o}else mI(i);0<t.j.length&&qh(t)}else l[0]!="stop"&&l[0]!="close"||Ws(t,7);else t.H==3&&(l[0]=="stop"||l[0]=="close"?l[0]=="stop"?Ws(t,7):ib(t):l[0]!="noop"&&t.h&&t.h.Aa(l),t.A=0)}}Dl(4)}catch{}}function Z2(n){if(n.Z&&typeof n.Z=="function")return n.Z();if(typeof Map<"u"&&n instanceof Map||typeof Set<"u"&&n instanceof Set)return Array.from(n.values());if(typeof n=="string")return n.split("");if(Ah(n)){for(var e=[],t=n.length,i=0;i<t;i++)e.push(n[i]);return e}e=[],t=0;for(i in n)e[t++]=n[i];return e}function J2(n){if(n.ta&&typeof n.ta=="function")return n.ta();if(!n.Z||typeof n.Z!="function"){if(typeof Map<"u"&&n instanceof Map)return Array.from(n.keys());if(!(typeof Set<"u"&&n instanceof Set)){if(Ah(n)||typeof n=="string"){var e=[];n=n.length;for(var t=0;t<n;t++)e.push(t);return e}e=[],t=0;for(let i in n)e[t++]=i;return e}}}function Qx(n,e){if(n.forEach&&typeof n.forEach=="function")n.forEach(e,void 0);else if(Ah(n)||typeof n=="string")Array.prototype.forEach.call(n,e,void 0);else for(var t=J2(n),i=Z2(n),r=i.length,s=0;s<r;s++)e.call(void 0,i[s],t&&t[s],n)}var Yx=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function eL(n,e){if(n){n=n.split("&");for(var t=0;t<n.length;t++){var i=n[t].indexOf("="),r=null;if(0<=i){var s=n[t].substring(0,i);r=n[t].substring(i+1)}else s=n[t];e(s,r?decodeURIComponent(r.replace(/\+/g," ")):"")}}}function $s(n){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,n instanceof $s){this.h=n.h,Ch(this,n.j),this.s=n.s,this.g=n.g,Eh(this,n.m),this.l=n.l;var e=n.i,t=new kl;t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),px(this,t),this.o=n.o}else n&&(e=String(n).match(Yx))?(this.h=!1,Ch(this,e[1]||"",!0),this.s=wl(e[2]||""),this.g=wl(e[3]||"",!0),Eh(this,e[4]),this.l=wl(e[5]||"",!0),px(this,e[6]||"",!0),this.o=wl(e[7]||"")):(this.h=!1,this.i=new kl(null,this.h))}$s.prototype.toString=function(){var n=[],e=this.j;e&&n.push(Cl(e,gx,!0),":");var t=this.g;return(t||e=="file")&&(n.push("//"),(e=this.s)&&n.push(Cl(e,gx,!0),"@"),n.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t=this.m,t!=null&&n.push(":",String(t))),(t=this.l)&&(this.g&&t.charAt(0)!="/"&&n.push("/"),n.push(Cl(t,t.charAt(0)=="/"?iL:nL,!0))),(t=this.i.toString())&&n.push("?",t),(t=this.o)&&n.push("#",Cl(t,sL)),n.join("")};function hr(n){return new $s(n)}function Ch(n,e,t){n.j=t?wl(e,!0):e,n.j&&(n.j=n.j.replace(/:$/,""))}function Eh(n,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);n.m=e}else n.m=null}function px(n,e,t){e instanceof kl?(n.i=e,oL(n.i,n.h)):(t||(e=Cl(e,rL)),n.i=new kl(e,n.h))}function qe(n,e,t){n.i.set(e,t)}function Bh(n){return qe(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function wl(n,e){return n?e?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function Cl(n,e,t){return typeof n=="string"?(n=encodeURI(n).replace(e,tL),t&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function tL(n){return n=n.charCodeAt(0),"%"+(n>>4&15).toString(16)+(n&15).toString(16)}var gx=/[#\/\?@]/g,nL=/[#\?:]/g,iL=/[#\?]/g,rL=/[#\?@]/g,sL=/#/g;function kl(n,e){this.h=this.g=null,this.i=n||null,this.j=!!e}function Vr(n){n.g||(n.g=new Map,n.h=0,n.i&&eL(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}V=kl.prototype;V.add=function(n,e){Vr(this),this.i=null,n=ua(this,n);var t=this.g.get(n);return t||this.g.set(n,t=[]),t.push(e),this.h+=1,this};function Xx(n,e){Vr(n),e=ua(n,e),n.g.has(e)&&(n.i=null,n.h-=n.g.get(e).length,n.g.delete(e))}function Zx(n,e){return Vr(n),e=ua(n,e),n.g.has(e)}V.forEach=function(n,e){Vr(this),this.g.forEach(function(t,i){t.forEach(function(r){n.call(e,r,i,this)},this)},this)};V.ta=function(){Vr(this);let n=Array.from(this.g.values()),e=Array.from(this.g.keys()),t=[];for(let i=0;i<e.length;i++){let r=n[i];for(let s=0;s<r.length;s++)t.push(e[i])}return t};V.Z=function(n){Vr(this);let e=[];if(typeof n=="string")Zx(this,n)&&(e=e.concat(this.g.get(ua(this,n))));else{n=Array.from(this.g.values());for(let t=0;t<n.length;t++)e=e.concat(n[t])}return e};V.set=function(n,e){return Vr(this),this.i=null,n=ua(this,n),Zx(this,n)&&(this.h-=this.g.get(n).length),this.g.set(n,[e]),this.h+=1,this};V.get=function(n,e){return n?(n=this.Z(n),0<n.length?String(n[0]):e):e};function Jx(n,e,t){Xx(n,e),0<t.length&&(n.i=null,n.g.set(ua(n,e),Uy(t)),n.h+=t.length)}V.toString=function(){if(this.i)return this.i;if(!this.g)return"";let n=[],e=Array.from(this.g.keys());for(var t=0;t<e.length;t++){var i=e[t];let s=encodeURIComponent(String(i)),o=this.Z(i);for(i=0;i<o.length;i++){var r=s;o[i]!==""&&(r+="="+encodeURIComponent(String(o[i]))),n.push(r)}}return this.i=n.join("&")};function ua(n,e){return e=String(e),n.j&&(e=e.toLowerCase()),e}function oL(n,e){e&&!n.j&&(Vr(n),n.i=null,n.g.forEach(function(t,i){var r=i.toLowerCase();i!=r&&(Xx(this,i),Jx(this,r,t))},n)),n.j=e}var aL=class{constructor(n,e){this.g=n,this.map=e}};function eI(n){this.l=n||cL,Z.PerformanceNavigationTiming?(n=Z.performance.getEntriesByType("navigation"),n=0<n.length&&(n[0].nextHopProtocol=="hq"||n[0].nextHopProtocol=="h2")):n=!!(Z.g&&Z.g.Ka&&Z.g.Ka()&&Z.g.Ka().dc),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var cL=10;function tI(n){return n.h?!0:n.g?n.g.size>=n.j:!1}function nI(n){return n.h?1:n.g?n.g.size:0}function Fy(n,e){return n.h?n.h==e:n.g?n.g.has(e):!1}function eb(n,e){n.g?n.g.add(e):n.h=e}function iI(n,e){n.h&&n.h==e?n.h=null:n.g&&n.g.has(e)&&n.g.delete(e)}eI.prototype.cancel=function(){if(this.i=rI(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let n of this.g.values())n.cancel();this.g.clear()}};function rI(n){if(n.h!=null)return n.i.concat(n.h.F);if(n.g!=null&&n.g.size!==0){let e=n.i;for(let t of n.g.values())e=e.concat(t.F);return e}return Uy(n.i)}var lL=class{stringify(n){return Z.JSON.stringify(n,void 0)}parse(n){return Z.JSON.parse(n,void 0)}};function uL(){this.g=new lL}function dL(n,e,t){let i=t||"";try{Qx(n,function(r,s){let o=r;Ml(r)&&(o=Hy(r)),e.push(i+s+"="+encodeURIComponent(o))})}catch(r){throw e.push(i+"type="+encodeURIComponent("_badmap")),r}}function hL(n,e){let t=new Oh;if(Z.Image){let i=new Image;i.onload=ph(_h,t,i,"TestLoadImage: loaded",!0,e),i.onerror=ph(_h,t,i,"TestLoadImage: error",!1,e),i.onabort=ph(_h,t,i,"TestLoadImage: abort",!1,e),i.ontimeout=ph(_h,t,i,"TestLoadImage: timeout",!1,e),Z.setTimeout(function(){i.ontimeout&&i.ontimeout()},1e4),i.src=n}else e(!1)}function _h(n,e,t,i,r){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,r(i)}catch{}}function Bl(n){this.l=n.ec||null,this.j=n.ob||!1}Tt(Bl,Xy);Bl.prototype.g=function(){return new Vh(this.l,this.j)};Bl.prototype.i=function(n){return function(){return n}}({});function Vh(n,e){St.call(this),this.F=n,this.u=e,this.m=void 0,this.readyState=tb,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Tt(Vh,St);var tb=0;V=Vh.prototype;V.open=function(n,e){if(this.readyState!=tb)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=e,this.readyState=1,Rl(this)};V.send=function(n){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(e.body=n),(this.F||Z).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))};V.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Vl(this)),this.readyState=tb};V.$a=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,Rl(this)),this.g&&(this.readyState=3,Rl(this),this.g)))if(this.responseType==="arraybuffer")n.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(typeof Z.ReadableStream<"u"&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;sI(this)}else n.text().then(this.Za.bind(this),this.ka.bind(this))};function sI(n){n.j.read().then(n.Xa.bind(n)).catch(n.ka.bind(n))}V.Xa=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var e=n.value?n.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!n.done}))&&(this.response=this.responseText+=e)}n.done?Vl(this):Rl(this),this.readyState==3&&sI(this)}};V.Za=function(n){this.g&&(this.response=this.responseText=n,Vl(this))};V.Ya=function(n){this.g&&(this.response=n,Vl(this))};V.ka=function(){this.g&&Vl(this)};function Vl(n){n.readyState=4,n.l=null,n.j=null,n.A=null,Rl(n)}V.setRequestHeader=function(n,e){this.v.append(n,e)};V.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""};V.getAllResponseHeaders=function(){if(!this.h)return"";let n=[],e=this.h.entries();for(var t=e.next();!t.done;)t=t.value,n.push(t[0]+": "+t[1]),t=e.next();return n.join(`\r
`)};function Rl(n){n.onreadystatechange&&n.onreadystatechange.call(n)}Object.defineProperty(Vh.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(n){this.m=n?"include":"same-origin"}});var fL=Z.JSON.parse;function it(n){St.call(this),this.headers=new Map,this.u=n||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=oI,this.L=this.M=!1}Tt(it,St);var oI="",mL=/^https?$/i,pL=["POST","PUT"];V=it.prototype;V.Oa=function(n){this.M=n};V.ha=function(n,e,t,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+n);e=e?e.toUpperCase():"GET",this.I=n,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():My.g(),this.C=this.u?mx(this.u):mx(My),this.g.onreadystatechange=jt(this.La,this);try{this.G=!0,this.g.open(e,String(n),!0),this.G=!1}catch(s){yx(this,s);return}if(n=t||"",t=new Map(this.headers),i)if(Object.getPrototypeOf(i)===Object.prototype)for(var r in i)t.set(r,i[r]);else if(typeof i.keys=="function"&&typeof i.get=="function")for(let s of i.keys())t.set(s,i.get(s));else throw Error("Unknown input type for opt_headers: "+String(i));i=Array.from(t.keys()).find(s=>s.toLowerCase()=="content-type"),r=Z.FormData&&n instanceof Z.FormData,!(0<=Cx(pL,e))||i||r||t.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[s,o]of t)this.g.setRequestHeader(s,o);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{lI(this),0<this.B&&((this.L=gL(this.g))?(this.g.timeout=this.B,this.g.ontimeout=jt(this.ua,this)):this.A=Yy(this.ua,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(s){yx(this,s)}};function gL(n){return la&&typeof n.timeout=="number"&&n.ontimeout!==void 0}V.ua=function(){typeof Vy<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Nt(this,"timeout"),this.abort(8))};function yx(n,e){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=e,n.m=5,aI(n),Uh(n)}function aI(n){n.F||(n.F=!0,Nt(n,"complete"),Nt(n,"error"))}V.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,Nt(this,"complete"),Nt(this,"abort"),Uh(this))};V.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Uh(this,!0)),it.$.N.call(this)};V.La=function(){this.s||(this.G||this.v||this.l?cI(this):this.kb())};V.kb=function(){cI(this)};function cI(n){if(n.h&&typeof Vy<"u"&&(!n.C[1]||Ai(n)!=4||n.da()!=2)){if(n.v&&Ai(n)==4)Yy(n.La,0,n);else if(Nt(n,"readystatechange"),Ai(n)==4){n.h=!1;try{let o=n.da();e:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var t;if(!(t=e)){var i;if(i=o===0){var r=String(n.I).match(Yx)[1]||null;!r&&Z.self&&Z.self.location&&(r=Z.self.location.protocol.slice(0,-1)),i=!mL.test(r?r.toLowerCase():"")}t=i}if(t)Nt(n,"complete"),Nt(n,"success");else{n.m=6;try{var s=2<Ai(n)?n.g.statusText:""}catch{s=""}n.j=s+" ["+n.da()+"]",aI(n)}}finally{Uh(n)}}}}function Uh(n,e){if(n.g){lI(n);let t=n.g,i=n.C[0]?()=>{}:null;n.g=null,n.C=null,e||Nt(n,"ready");try{t.onreadystatechange=i}catch{}}}function lI(n){n.g&&n.L&&(n.g.ontimeout=null),n.A&&(Z.clearTimeout(n.A),n.A=null)}V.isActive=function(){return!!this.g};function Ai(n){return n.g?n.g.readyState:0}V.da=function(){try{return 2<Ai(this)?this.g.status:-1}catch{return-1}};V.ja=function(){try{return this.g?this.g.responseText:""}catch{return""}};V.Wa=function(n){if(this.g){var e=this.g.responseText;return n&&e.indexOf(n)==0&&(e=e.substring(n.length)),fL(e)}};function bx(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.K){case oI:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch{return null}}function yL(n){let e={};n=(n.g&&2<=Ai(n)&&n.g.getAllResponseHeaders()||"").split(`\r
`);for(let i=0;i<n.length;i++){if(Sl(n[i]))continue;var t=z2(n[i]);let r=t[0];if(t=t[1],typeof t!="string")continue;t=t.trim();let s=e[r]||[];e[r]=s,s.push(t)}V2(e,function(i){return i.join(", ")})}V.Ia=function(){return this.m};V.Sa=function(){return typeof this.j=="string"?this.j:String(this.j)};function uI(n){let e="";return qy(n,function(t,i){e+=i,e+=":",e+=t,e+=`\r
`}),e}function nb(n,e,t){e:{for(i in t){var i=!1;break e}i=!0}i||(t=uI(t),typeof n=="string"?t!=null&&encodeURIComponent(String(t)):qe(n,e,t))}function vl(n,e,t){return t&&t.internalChannelParams&&t.internalChannelParams[n]||e}function dI(n){this.Ga=0,this.j=[],this.l=new Oh,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=vl("failFast",!1,n),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=vl("baseRetryDelayMs",5e3,n),this.hb=vl("retryDelaySeedMs",1e4,n),this.eb=vl("forwardChannelMaxRetries",2,n),this.xa=vl("forwardChannelRequestTimeoutMs",2e4,n),this.va=n&&n.xmlHttpFactory||void 0,this.Ha=n&&n.useFetchStreams||!1,this.L=void 0,this.J=n&&n.supportsCrossDomainXhr||!1,this.K="",this.i=new eI(n&&n.concurrentRequestLimit),this.Ja=new uL,this.P=n&&n.fastHandshake||!1,this.O=n&&n.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=n&&n.bc||!1,n&&n.Ea&&this.l.Ea(),n&&n.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&n&&n.detectBufferingProxy||!1,this.qa=void 0,n&&n.longPollingTimeout&&0<n.longPollingTimeout&&(this.qa=n.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}V=dI.prototype;V.ra=8;V.H=1;function ib(n){if(hI(n),n.H==3){var e=n.W++,t=hr(n.I);if(qe(t,"SID",n.K),qe(t,"RID",e),qe(t,"TYPE","terminate"),Ul(n,t),e=new Fl(n,n.l,e),e.L=2,e.A=Bh(hr(t)),t=!1,Z.navigator&&Z.navigator.sendBeacon)try{t=Z.navigator.sendBeacon(e.A.toString(),"")}catch{}!t&&Z.Image&&(new Image().src=e.A,t=!0),t||(e.g=_I(e.l,null),e.g.ha(e.A)),e.G=Date.now(),Ll(e)}bI(n)}function jh(n){n.g&&(sb(n),n.g.cancel(),n.g=null)}function hI(n){jh(n),n.u&&(Z.clearTimeout(n.u),n.u=null),Sh(n),n.i.cancel(),n.m&&(typeof n.m=="number"&&Z.clearTimeout(n.m),n.m=null)}function qh(n){if(!tI(n.i)&&!n.m){n.m=!0;var e=n.Na;xl||Px(),Il||(xl(),Il=!0),Ky.add(e,n),n.C=0}}function bL(n,e){return nI(n.i)>=n.i.j-(n.m?1:0)?!1:n.m?(n.j=e.F.concat(n.j),!0):n.H==1||n.H==2||n.C>=(n.cb?0:n.eb)?!1:(n.m=Pl(jt(n.Na,n,e),yI(n,n.C)),n.C++,!0)}V.Na=function(n){if(this.m)if(this.m=null,this.H==1){if(!n){this.W=Math.floor(1e5*Math.random()),n=this.W++;let r=new Fl(this,this.l,n),s=this.s;if(this.U&&(s?(s=xx(s),Ix(s,this.U)):s=this.U),this.o!==null||this.O||(r.I=s,s=null),this.P)e:{for(var e=0,t=0;t<this.j.length;t++){t:{var i=this.j[t];if("__data__"in i.map&&(i=i.map.__data__,typeof i=="string")){i=i.length;break t}i=void 0}if(i===void 0)break;if(e+=i,4096<e){e=t;break e}if(e===4096||t===this.j.length-1){e=t+1;break e}}e=1e3}else e=1e3;e=fI(this,r,e),t=hr(this.I),qe(t,"RID",n),qe(t,"CVER",22),this.F&&qe(t,"X-HTTP-Session-Id",this.F),Ul(this,t),s&&(this.O?e="headers="+encodeURIComponent(String(uI(s)))+"&"+e:this.o&&nb(t,this.o,s)),eb(this.i,r),this.bb&&qe(t,"TYPE","init"),this.P?(qe(t,"$req",e),qe(t,"SID","null"),r.aa=!0,Py(r,t,null)):Py(r,t,e),this.H=2}}else this.H==3&&(n?vx(this,n):this.j.length==0||tI(this.i)||vx(this))};function vx(n,e){var t;e?t=e.m:t=n.W++;let i=hr(n.I);qe(i,"SID",n.K),qe(i,"RID",t),qe(i,"AID",n.V),Ul(n,i),n.o&&n.s&&nb(i,n.o,n.s),t=new Fl(n,n.l,t,n.C+1),n.o===null&&(t.I=n.s),e&&(n.j=e.F.concat(n.j)),e=fI(n,t,1e3),t.setTimeout(Math.round(.5*n.xa)+Math.round(.5*n.xa*Math.random())),eb(n.i,t),Py(t,i,e)}function Ul(n,e){n.na&&qy(n.na,function(t,i){qe(e,i,t)}),n.h&&Qx({},function(t,i){qe(e,i,t)})}function fI(n,e,t){t=Math.min(n.j.length,t);var i=n.h?jt(n.h.Va,n.h,n):null;e:{var r=n.j;let s=-1;for(;;){let o=["count="+t];s==-1?0<t?(s=r[0].g,o.push("ofs="+s)):s=0:o.push("ofs="+s);let a=!0;for(let c=0;c<t;c++){let l=r[c].g,u=r[c].map;if(l-=s,0>l)s=Math.max(0,r[c].g-100),a=!1;else try{dL(u,o,"req"+l+"_")}catch{i&&i(u)}}if(a){i=o.join("&");break e}}}return n=n.j.splice(0,t),e.F=n,i}function mI(n){if(!n.g&&!n.u){n.ba=1;var e=n.Ma;xl||Px(),Il||(xl(),Il=!0),Ky.add(e,n),n.A=0}}function rb(n){return n.g||n.u||3<=n.A?!1:(n.ba++,n.u=Pl(jt(n.Ma,n),yI(n,n.A)),n.A++,!0)}V.Ma=function(){if(this.u=null,pI(this),this.ca&&!(this.M||this.g==null||0>=this.S)){var n=2*this.S;this.l.info("BP detection timer enabled: "+n),this.B=Pl(jt(this.jb,this),n)}};V.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,en(10),jh(this),pI(this))};function sb(n){n.B!=null&&(Z.clearTimeout(n.B),n.B=null)}function pI(n){n.g=new Fl(n,n.l,"rpc",n.ba),n.o===null&&(n.g.I=n.s),n.g.O=0;var e=hr(n.wa);qe(e,"RID","rpc"),qe(e,"SID",n.K),qe(e,"AID",n.V),qe(e,"CI",n.G?"0":"1"),!n.G&&n.qa&&qe(e,"TO",n.qa),qe(e,"TYPE","xmlhttp"),Ul(n,e),n.o&&n.s&&nb(e,n.o,n.s),n.L&&n.g.setTimeout(n.L);var t=n.g;n=n.pa,t.L=1,t.A=Bh(hr(e)),t.u=null,t.S=!0,Wx(t,n)}V.ib=function(){this.v!=null&&(this.v=null,jh(this),rb(this),en(19))};function Sh(n){n.v!=null&&(Z.clearTimeout(n.v),n.v=null)}function gI(n,e){var t=null;if(n.g==e){Sh(n),sb(n),n.g=null;var i=2}else if(Fy(n.i,e))t=e.F,iI(n.i,e),i=1;else return;if(n.H!=0){if(e.i)if(i==1){t=e.u?e.u.length:0,e=Date.now()-e.G;var r=n.C;i=Ph(),Nt(i,new Ux(i,t)),qh(n)}else mI(n);else if(r=e.s,r==3||r==0&&0<e.ca||!(i==1&&bL(n,e)||i==2&&rb(n)))switch(t&&0<t.length&&(e=n.i,e.i=e.i.concat(t)),r){case 1:Ws(n,5);break;case 4:Ws(n,10);break;case 3:Ws(n,6);break;default:Ws(n,2)}}}function yI(n,e){let t=n.ab+Math.floor(Math.random()*n.hb);return n.isActive()||(t*=2),t*e}function Ws(n,e){if(n.l.info("Error code "+e),e==2){var t=null;n.h&&(t=null);var i=jt(n.pb,n);t||(t=new $s("//www.google.com/images/cleardot.gif"),Z.location&&Z.location.protocol=="http"||Ch(t,"https"),Bh(t)),hL(t.toString(),i)}else en(2);n.H=0,n.h&&n.h.za(e),bI(n),hI(n)}V.pb=function(n){n?(this.l.info("Successfully pinged google.com"),en(2)):(this.l.info("Failed to ping google.com"),en(1))};function bI(n){if(n.H=0,n.ma=[],n.h){let e=rI(n.i);(e.length!=0||n.j.length!=0)&&(ux(n.ma,e),ux(n.ma,n.j),n.i.i.length=0,Uy(n.j),n.j.length=0),n.h.ya()}}function vI(n,e,t){var i=t instanceof $s?hr(t):new $s(t);if(i.g!="")e&&(i.g=e+"."+i.g),Eh(i,i.m);else{var r=Z.location;i=r.protocol,e=e?e+"."+r.hostname:r.hostname,r=+r.port;var s=new $s(null);i&&Ch(s,i),e&&(s.g=e),r&&Eh(s,r),t&&(s.l=t),i=s}return t=n.F,e=n.Da,t&&e&&qe(i,t,e),qe(i,"VER",n.ra),Ul(n,i),i}function _I(n,e,t){if(e&&!n.J)throw Error("Can't create secondary domain capable XhrIo object.");return e=n.Ha&&!n.va?new it(new Bl({ob:t})):new it(n.va),e.Oa(n.J),e}V.isActive=function(){return!!this.h&&this.h.isActive(this)};function wI(){}V=wI.prototype;V.Ba=function(){};V.Aa=function(){};V.za=function(){};V.ya=function(){};V.isActive=function(){return!0};V.Va=function(){};function Th(){if(la&&!(10<=Number(N2)))throw Error("Environmental error: no available transport.")}Th.prototype.g=function(n,e){return new vn(n,e)};function vn(n,e){St.call(this),this.g=new dI(e),this.l=n,this.h=e&&e.messageUrlParams||null,n=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(n?n["X-WebChannel-Content-Type"]=e.messageContentType:n={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(n?n["X-WebChannel-Client-Profile"]=e.Ca:n={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=n,(n=e&&e.cc)&&!Sl(n)&&(this.g.o=n),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Sl(e)&&(this.g.F=e,n=this.h,n!==null&&e in n&&(n=this.h,e in n&&delete n[e])),this.j=new da(this)}Tt(vn,St);vn.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var n=this.g,e=this.l,t=this.h||void 0;en(0),n.Y=e,n.na=t||{},n.G=n.aa,n.I=vI(n,null,n.Y),qh(n)};vn.prototype.close=function(){ib(this.g)};vn.prototype.u=function(n){var e=this.g;if(typeof n=="string"){var t={};t.__data__=n,n=t}else this.v&&(t={},t.__data__=Hy(n),n=t);e.j.push(new aL(e.fb++,n)),e.H==3&&qh(e)};vn.prototype.N=function(){this.g.h=null,delete this.j,ib(this.g),delete this.g,vn.$.N.call(this)};function CI(n){Zy.call(this),n.__headers__&&(this.headers=n.__headers__,this.statusCode=n.__status__,delete n.__headers__,delete n.__status__);var e=n.__sm__;if(e){e:{for(let t in e){n=t;break e}n=void 0}(this.i=n)&&(n=this.i,e=e!==null&&n in e?e[n]:void 0),this.data=e}else this.data=n}Tt(CI,Zy);function EI(){Jy.call(this),this.status=1}Tt(EI,Jy);function da(n){this.g=n}Tt(da,wI);da.prototype.Ba=function(){Nt(this.g,"a")};da.prototype.Aa=function(n){Nt(this.g,new CI(n))};da.prototype.za=function(n){Nt(this.g,new EI)};da.prototype.ya=function(){Nt(this.g,"b")};function vL(){this.blockSize=-1}function si(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}Tt(si,vL);si.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0};function Cy(n,e,t){t||(t=0);var i=Array(16);if(typeof e=="string")for(var r=0;16>r;++r)i[r]=e.charCodeAt(t++)|e.charCodeAt(t++)<<8|e.charCodeAt(t++)<<16|e.charCodeAt(t++)<<24;else for(r=0;16>r;++r)i[r]=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;e=n.g[0],t=n.g[1],r=n.g[2];var s=n.g[3],o=e+(s^t&(r^s))+i[0]+3614090360&4294967295;e=t+(o<<7&4294967295|o>>>25),o=s+(r^e&(t^r))+i[1]+3905402710&4294967295,s=e+(o<<12&4294967295|o>>>20),o=r+(t^s&(e^t))+i[2]+606105819&4294967295,r=s+(o<<17&4294967295|o>>>15),o=t+(e^r&(s^e))+i[3]+3250441966&4294967295,t=r+(o<<22&4294967295|o>>>10),o=e+(s^t&(r^s))+i[4]+4118548399&4294967295,e=t+(o<<7&4294967295|o>>>25),o=s+(r^e&(t^r))+i[5]+1200080426&4294967295,s=e+(o<<12&4294967295|o>>>20),o=r+(t^s&(e^t))+i[6]+2821735955&4294967295,r=s+(o<<17&4294967295|o>>>15),o=t+(e^r&(s^e))+i[7]+4249261313&4294967295,t=r+(o<<22&4294967295|o>>>10),o=e+(s^t&(r^s))+i[8]+1770035416&4294967295,e=t+(o<<7&4294967295|o>>>25),o=s+(r^e&(t^r))+i[9]+2336552879&4294967295,s=e+(o<<12&4294967295|o>>>20),o=r+(t^s&(e^t))+i[10]+4294925233&4294967295,r=s+(o<<17&4294967295|o>>>15),o=t+(e^r&(s^e))+i[11]+2304563134&4294967295,t=r+(o<<22&4294967295|o>>>10),o=e+(s^t&(r^s))+i[12]+1804603682&4294967295,e=t+(o<<7&4294967295|o>>>25),o=s+(r^e&(t^r))+i[13]+4254626195&4294967295,s=e+(o<<12&4294967295|o>>>20),o=r+(t^s&(e^t))+i[14]+2792965006&4294967295,r=s+(o<<17&4294967295|o>>>15),o=t+(e^r&(s^e))+i[15]+1236535329&4294967295,t=r+(o<<22&4294967295|o>>>10),o=e+(r^s&(t^r))+i[1]+4129170786&4294967295,e=t+(o<<5&4294967295|o>>>27),o=s+(t^r&(e^t))+i[6]+3225465664&4294967295,s=e+(o<<9&4294967295|o>>>23),o=r+(e^t&(s^e))+i[11]+643717713&4294967295,r=s+(o<<14&4294967295|o>>>18),o=t+(s^e&(r^s))+i[0]+3921069994&4294967295,t=r+(o<<20&4294967295|o>>>12),o=e+(r^s&(t^r))+i[5]+3593408605&4294967295,e=t+(o<<5&4294967295|o>>>27),o=s+(t^r&(e^t))+i[10]+38016083&4294967295,s=e+(o<<9&4294967295|o>>>23),o=r+(e^t&(s^e))+i[15]+3634488961&4294967295,r=s+(o<<14&4294967295|o>>>18),o=t+(s^e&(r^s))+i[4]+3889429448&4294967295,t=r+(o<<20&4294967295|o>>>12),o=e+(r^s&(t^r))+i[9]+568446438&4294967295,e=t+(o<<5&4294967295|o>>>27),o=s+(t^r&(e^t))+i[14]+3275163606&4294967295,s=e+(o<<9&4294967295|o>>>23),o=r+(e^t&(s^e))+i[3]+4107603335&4294967295,r=s+(o<<14&4294967295|o>>>18),o=t+(s^e&(r^s))+i[8]+1163531501&4294967295,t=r+(o<<20&4294967295|o>>>12),o=e+(r^s&(t^r))+i[13]+2850285829&4294967295,e=t+(o<<5&4294967295|o>>>27),o=s+(t^r&(e^t))+i[2]+4243563512&4294967295,s=e+(o<<9&4294967295|o>>>23),o=r+(e^t&(s^e))+i[7]+1735328473&4294967295,r=s+(o<<14&4294967295|o>>>18),o=t+(s^e&(r^s))+i[12]+2368359562&4294967295,t=r+(o<<20&4294967295|o>>>12),o=e+(t^r^s)+i[5]+4294588738&4294967295,e=t+(o<<4&4294967295|o>>>28),o=s+(e^t^r)+i[8]+2272392833&4294967295,s=e+(o<<11&4294967295|o>>>21),o=r+(s^e^t)+i[11]+1839030562&4294967295,r=s+(o<<16&4294967295|o>>>16),o=t+(r^s^e)+i[14]+4259657740&4294967295,t=r+(o<<23&4294967295|o>>>9),o=e+(t^r^s)+i[1]+2763975236&4294967295,e=t+(o<<4&4294967295|o>>>28),o=s+(e^t^r)+i[4]+1272893353&4294967295,s=e+(o<<11&4294967295|o>>>21),o=r+(s^e^t)+i[7]+4139469664&4294967295,r=s+(o<<16&4294967295|o>>>16),o=t+(r^s^e)+i[10]+3200236656&4294967295,t=r+(o<<23&4294967295|o>>>9),o=e+(t^r^s)+i[13]+681279174&4294967295,e=t+(o<<4&4294967295|o>>>28),o=s+(e^t^r)+i[0]+3936430074&4294967295,s=e+(o<<11&4294967295|o>>>21),o=r+(s^e^t)+i[3]+3572445317&4294967295,r=s+(o<<16&4294967295|o>>>16),o=t+(r^s^e)+i[6]+76029189&4294967295,t=r+(o<<23&4294967295|o>>>9),o=e+(t^r^s)+i[9]+3654602809&4294967295,e=t+(o<<4&4294967295|o>>>28),o=s+(e^t^r)+i[12]+3873151461&4294967295,s=e+(o<<11&4294967295|o>>>21),o=r+(s^e^t)+i[15]+530742520&4294967295,r=s+(o<<16&4294967295|o>>>16),o=t+(r^s^e)+i[2]+3299628645&4294967295,t=r+(o<<23&4294967295|o>>>9),o=e+(r^(t|~s))+i[0]+4096336452&4294967295,e=t+(o<<6&4294967295|o>>>26),o=s+(t^(e|~r))+i[7]+1126891415&4294967295,s=e+(o<<10&4294967295|o>>>22),o=r+(e^(s|~t))+i[14]+2878612391&4294967295,r=s+(o<<15&4294967295|o>>>17),o=t+(s^(r|~e))+i[5]+4237533241&4294967295,t=r+(o<<21&4294967295|o>>>11),o=e+(r^(t|~s))+i[12]+1700485571&4294967295,e=t+(o<<6&4294967295|o>>>26),o=s+(t^(e|~r))+i[3]+2399980690&4294967295,s=e+(o<<10&4294967295|o>>>22),o=r+(e^(s|~t))+i[10]+4293915773&4294967295,r=s+(o<<15&4294967295|o>>>17),o=t+(s^(r|~e))+i[1]+2240044497&4294967295,t=r+(o<<21&4294967295|o>>>11),o=e+(r^(t|~s))+i[8]+1873313359&4294967295,e=t+(o<<6&4294967295|o>>>26),o=s+(t^(e|~r))+i[15]+4264355552&4294967295,s=e+(o<<10&4294967295|o>>>22),o=r+(e^(s|~t))+i[6]+2734768916&4294967295,r=s+(o<<15&4294967295|o>>>17),o=t+(s^(r|~e))+i[13]+1309151649&4294967295,t=r+(o<<21&4294967295|o>>>11),o=e+(r^(t|~s))+i[4]+4149444226&4294967295,e=t+(o<<6&4294967295|o>>>26),o=s+(t^(e|~r))+i[11]+3174756917&4294967295,s=e+(o<<10&4294967295|o>>>22),o=r+(e^(s|~t))+i[2]+718787259&4294967295,r=s+(o<<15&4294967295|o>>>17),o=t+(s^(r|~e))+i[9]+3951481745&4294967295,n.g[0]=n.g[0]+e&4294967295,n.g[1]=n.g[1]+(r+(o<<21&4294967295|o>>>11))&4294967295,n.g[2]=n.g[2]+r&4294967295,n.g[3]=n.g[3]+s&4294967295}si.prototype.j=function(n,e){e===void 0&&(e=n.length);for(var t=e-this.blockSize,i=this.m,r=this.h,s=0;s<e;){if(r==0)for(;s<=t;)Cy(this,n,s),s+=this.blockSize;if(typeof n=="string"){for(;s<e;)if(i[r++]=n.charCodeAt(s++),r==this.blockSize){Cy(this,i),r=0;break}}else for(;s<e;)if(i[r++]=n[s++],r==this.blockSize){Cy(this,i),r=0;break}}this.h=r,this.i+=e};si.prototype.l=function(){var n=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);n[0]=128;for(var e=1;e<n.length-8;++e)n[e]=0;var t=8*this.i;for(e=n.length-8;e<n.length;++e)n[e]=t&255,t/=256;for(this.j(n),n=Array(16),e=t=0;4>e;++e)for(var i=0;32>i;i+=8)n[t++]=this.g[e]>>>i&255;return n};function De(n,e){this.h=e;for(var t=[],i=!0,r=n.length-1;0<=r;r--){var s=n[r]|0;i&&s==e||(t[r]=s,i=!1)}this.g=t}var _L={};function ob(n){return-128<=n&&128>n?M2(n,function(e){return new De([e|0],0>e?-1:0)}):new De([n|0],0>n?-1:0)}function Di(n){if(isNaN(n)||!isFinite(n))return ca;if(0>n)return Pt(Di(-n));for(var e=[],t=1,i=0;n>=t;i++)e[i]=n/t|0,t*=Ly;return new De(e,0)}function SI(n,e){if(n.length==0)throw Error("number format error: empty string");if(e=e||10,2>e||36<e)throw Error("radix out of range: "+e);if(n.charAt(0)=="-")return Pt(SI(n.substring(1),e));if(0<=n.indexOf("-"))throw Error('number format error: interior "-" character');for(var t=Di(Math.pow(e,8)),i=ca,r=0;r<n.length;r+=8){var s=Math.min(8,n.length-r),o=parseInt(n.substring(r,r+s),e);8>s?(s=Di(Math.pow(e,s)),i=i.R(s).add(Di(o))):(i=i.R(t),i=i.add(Di(o)))}return i}var Ly=4294967296,ca=ob(0),By=ob(1),_x=ob(16777216);V=De.prototype;V.ea=function(){if(Mn(this))return-Pt(this).ea();for(var n=0,e=1,t=0;t<this.g.length;t++){var i=this.D(t);n+=(0<=i?i:Ly+i)*e,e*=Ly}return n};V.toString=function(n){if(n=n||10,2>n||36<n)throw Error("radix out of range: "+n);if(dr(this))return"0";if(Mn(this))return"-"+Pt(this).toString(n);for(var e=Di(Math.pow(n,6)),t=this,i="";;){var r=Ih(t,e).g;t=xh(t,r.R(e));var s=((0<t.g.length?t.g[0]:t.h)>>>0).toString(n);if(t=r,dr(t))return s+i;for(;6>s.length;)s="0"+s;i=s+i}};V.D=function(n){return 0>n?0:n<this.g.length?this.g[n]:this.h};function dr(n){if(n.h!=0)return!1;for(var e=0;e<n.g.length;e++)if(n.g[e]!=0)return!1;return!0}function Mn(n){return n.h==-1}V.X=function(n){return n=xh(this,n),Mn(n)?-1:dr(n)?0:1};function Pt(n){for(var e=n.g.length,t=[],i=0;i<e;i++)t[i]=~n.g[i];return new De(t,~n.h).add(By)}V.abs=function(){return Mn(this)?Pt(this):this};V.add=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],i=0,r=0;r<=e;r++){var s=i+(this.D(r)&65535)+(n.D(r)&65535),o=(s>>>16)+(this.D(r)>>>16)+(n.D(r)>>>16);i=o>>>16,s&=65535,o&=65535,t[r]=o<<16|s}return new De(t,t[t.length-1]&-2147483648?-1:0)};function xh(n,e){return n.add(Pt(e))}V.R=function(n){if(dr(this)||dr(n))return ca;if(Mn(this))return Mn(n)?Pt(this).R(Pt(n)):Pt(Pt(this).R(n));if(Mn(n))return Pt(this.R(Pt(n)));if(0>this.X(_x)&&0>n.X(_x))return Di(this.ea()*n.ea());for(var e=this.g.length+n.g.length,t=[],i=0;i<2*e;i++)t[i]=0;for(i=0;i<this.g.length;i++)for(var r=0;r<n.g.length;r++){var s=this.D(i)>>>16,o=this.D(i)&65535,a=n.D(r)>>>16,c=n.D(r)&65535;t[2*i+2*r]+=o*c,wh(t,2*i+2*r),t[2*i+2*r+1]+=s*c,wh(t,2*i+2*r+1),t[2*i+2*r+1]+=o*a,wh(t,2*i+2*r+1),t[2*i+2*r+2]+=s*a,wh(t,2*i+2*r+2)}for(i=0;i<e;i++)t[i]=t[2*i+1]<<16|t[2*i];for(i=e;i<2*e;i++)t[i]=0;return new De(t,0)};function wh(n,e){for(;(n[e]&65535)!=n[e];)n[e+1]+=n[e]>>>16,n[e]&=65535,e++}function _l(n,e){this.g=n,this.h=e}function Ih(n,e){if(dr(e))throw Error("division by zero");if(dr(n))return new _l(ca,ca);if(Mn(n))return e=Ih(Pt(n),e),new _l(Pt(e.g),Pt(e.h));if(Mn(e))return e=Ih(n,Pt(e)),new _l(Pt(e.g),e.h);if(30<n.g.length){if(Mn(n)||Mn(e))throw Error("slowDivide_ only works with positive integers.");for(var t=By,i=e;0>=i.X(n);)t=wx(t),i=wx(i);var r=oa(t,1),s=oa(i,1);for(i=oa(i,2),t=oa(t,2);!dr(i);){var o=s.add(i);0>=o.X(n)&&(r=r.add(t),s=o),i=oa(i,1),t=oa(t,1)}return e=xh(n,r.R(e)),new _l(r,e)}for(r=ca;0<=n.X(e);){for(t=Math.max(1,Math.floor(n.ea()/e.ea())),i=Math.ceil(Math.log(t)/Math.LN2),i=48>=i?1:Math.pow(2,i-48),s=Di(t),o=s.R(e);Mn(o)||0<o.X(n);)t-=i,s=Di(t),o=s.R(e);dr(s)&&(s=By),r=r.add(s),n=xh(n,o)}return new _l(r,n)}V.gb=function(n){return Ih(this,n).h};V.and=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],i=0;i<e;i++)t[i]=this.D(i)&n.D(i);return new De(t,this.h&n.h)};V.or=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],i=0;i<e;i++)t[i]=this.D(i)|n.D(i);return new De(t,this.h|n.h)};V.xor=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],i=0;i<e;i++)t[i]=this.D(i)^n.D(i);return new De(t,this.h^n.h)};function wx(n){for(var e=n.g.length+1,t=[],i=0;i<e;i++)t[i]=n.D(i)<<1|n.D(i-1)>>>31;return new De(t,n.h)}function oa(n,e){var t=e>>5;e%=32;for(var i=n.g.length-t,r=[],s=0;s<i;s++)r[s]=0<e?n.D(s+t)>>>e|n.D(s+t+1)<<32-e:n.D(s+t);return new De(r,n.h)}Th.prototype.createWebChannel=Th.prototype.g;vn.prototype.send=vn.prototype.u;vn.prototype.open=vn.prototype.m;vn.prototype.close=vn.prototype.close;Nh.NO_ERROR=0;Nh.TIMEOUT=8;Nh.HTTP_ERROR=6;jx.COMPLETE="complete";qx.EventType=Nl;Nl.OPEN="a";Nl.CLOSE="b";Nl.ERROR="c";Nl.MESSAGE="d";St.prototype.listen=St.prototype.O;it.prototype.listenOnce=it.prototype.P;it.prototype.getLastError=it.prototype.Sa;it.prototype.getLastErrorCode=it.prototype.Ia;it.prototype.getStatus=it.prototype.da;it.prototype.getResponseJson=it.prototype.Wa;it.prototype.getResponseText=it.prototype.ja;it.prototype.send=it.prototype.ha;it.prototype.setWithCredentials=it.prototype.Oa;si.prototype.digest=si.prototype.l;si.prototype.reset=si.prototype.reset;si.prototype.update=si.prototype.j;De.prototype.add=De.prototype.add;De.prototype.multiply=De.prototype.R;De.prototype.modulo=De.prototype.gb;De.prototype.compare=De.prototype.X;De.prototype.toNumber=De.prototype.ea;De.prototype.toString=De.prototype.toString;De.prototype.getBits=De.prototype.D;De.fromNumber=Di;De.fromString=SI;var eX=oi.createWebChannelTransport=function(){return new Th},tX=oi.getStatEventTarget=function(){return Ph()},nX=oi.ErrorCode=Nh,iX=oi.EventType=jx,rX=oi.Event=Hs,sX=oi.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},oX=oi.FetchXmlHttpFactory=Bl,aX=oi.WebChannel=qx,cX=oi.XhrIo=it,TI=oi.Md5=si,Ks=oi.Integer=De;var po=Mg(Jk(),1),uM=Mg(t_(),1);var eR="@firebase/firestore",tR="4.6.0";var wt=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};wt.UNAUTHENTICATED=new wt(null);wt.GOOGLE_CREDENTIALS=new wt("google-credentials-uid");wt.FIRST_PARTY=new wt("first-party-uid");wt.MOCK_USER=new wt("mock-user");var V3="10.11.0";var Mc=V3;function U3(n){Mc=n}function j3(n){return N3(n,{depth:100})}var _s=new Hd("@firebase/firestore");function oc(){return _s.logLevel}function PC(n){_s.setLogLevel(n)}function R(n,...e){if(_s.logLevel<=Si.DEBUG){let t=e.map(NC);_s.debug(`Firestore (${Mc}): ${n}`,...t)}}function Ze(n,...e){if(_s.logLevel<=Si.ERROR){let t=e.map(NC);_s.error(`Firestore (${Mc}): ${n}`,...t)}}function Wn(n,...e){if(_s.logLevel<=Si.WARN){let t=e.map(NC);_s.warn(`Firestore (${Mc}): ${n}`,...t)}}function NC(n){if(typeof n=="string")return n;try{return j3(n)}catch{return n}}function j(n="Unexpected state"){let e=`FIRESTORE (${Mc}) INTERNAL ASSERTION FAILED: `+n;throw Ze(e),new Error(e)}function $(n,e){n||j()}function dM(n,e){n||j()}function B(n,e){return n}var v={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},x=class extends yT{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var ht=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var Ym=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},P0=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(wt.UNAUTHENTICATED))}shutdown(){}},N0=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},F0=class{constructor(e){this.authProvider=e,this.currentUser=wt.UNAUTHENTICATED,this.tokenCounter=0,this.forceRefresh=!1,this.auth=null}start(e,t){let i=this.tokenCounter,r=c=>this.tokenCounter!==i?(i=this.tokenCounter,t(c)):Promise.resolve(),s=new ht;this.tokenListener=()=>{this.tokenCounter++,this.currentUser=this.getUser(),s.resolve(),s=new ht,e.enqueueRetryable(()=>r(this.currentUser))};let o=()=>{let c=s;e.enqueueRetryable(()=>p(this,null,function*(){yield c.promise,yield r(this.currentUser)}))},a=c=>{R("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.auth.addAuthTokenListener(this.tokenListener),o()};this.authProvider.onInit(c=>a(c)),setTimeout(()=>{if(!this.auth){let c=this.authProvider.getImmediate({optional:!0});c?a(c):(R("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new ht)}},0),o()}getToken(){let e=this.tokenCounter,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(i=>this.tokenCounter!==e?(R("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):i?($(typeof i.accessToken=="string"),new Ym(i.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.tokenListener)}getUser(){let e=this.auth&&this.auth.getUid();return $(e===null||typeof e=="string"),new wt(e)}},L0=class{constructor(e,t,i){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=i,this.type="FirstParty",this.user=wt.FIRST_PARTY,this._headers=new Map}getAuthToken(){return this.authTokenFactory?this.authTokenFactory():null}get headers(){this._headers.set("X-Goog-AuthUser",this.sessionIndex);let e=this.getAuthToken();return e&&this._headers.set("Authorization",e),this.iamToken&&this._headers.set("X-Goog-Iam-Authorization-Token",this.iamToken),this._headers}},B0=class{constructor(e,t,i){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=i}getToken(){return Promise.resolve(new L0(this.sessionIndex,this.iamToken,this.authTokenFactory))}start(e,t){e.enqueueRetryable(()=>t(wt.FIRST_PARTY))}shutdown(){}invalidateToken(){}},V0=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},U0=class{constructor(e){this.appCheckProvider=e,this.forceRefresh=!1,this.appCheck=null,this.latestAppCheckToken=null}start(e,t){let i=s=>{s.error!=null&&R("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.latestAppCheckToken;return this.latestAppCheckToken=s.token,R("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.tokenListener=s=>{e.enqueueRetryable(()=>i(s))};let r=s=>{R("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.tokenListener)};this.appCheckProvider.onInit(s=>r(s)),setTimeout(()=>{if(!this.appCheck){let s=this.appCheckProvider.getImmediate({optional:!0});s?r(s):R("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?($(typeof t.token=="string"),this.latestAppCheckToken=t.token,new V0(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.tokenListener)}};function q3(n){if(!n)return new P0;switch(n.type){case"firstParty":return new B0(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new x(v.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}function z3(n){return B3(n)}var Xm=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,i="",r=20;for(;i.length<r;){let s=z3(40);for(let o=0;o<s.length;++o)i.length<r&&s[o]<t&&(i+=e.charAt(s[o]%e.length))}return i}};function te(n,e){return n<e?-1:n>e?1:0}function go(n,e,t){return n.length!==e.length?!1:n.every((i,r)=>t(i,e[r]))}function hM(n){return n+"\0"}var nR=-62135596800,iR=1e6,Je=class n{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new x(v.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new x(v.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<nR)throw new x(v.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new x(v.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),i=Math.floor((e-t*1e3)*iR);return new n(t,i)}toDate(){return new Date(this.toMillis())}toMillis(){return this.seconds*1e3+this.nanoseconds/iR}_compareTo(e){return this.seconds===e.seconds?te(this.nanoseconds,e.nanoseconds):te(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds-nR,t=String(e).padStart(12,"0"),i=String(this.nanoseconds).padStart(9,"0");return t+"."+i}};var Q=class n{constructor(e){this.timestamp=e}static fromTimestamp(e){return new n(e)}static min(){return new n(new Je(0,0))}static max(){return new n(new Je(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return this.timestamp.seconds*1e6+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var rR="__name__",Zm=class n{constructor(e,t,i){t===void 0?t=0:t>e.length&&j(),i===void 0?i=e.length-t:i>e.length-t&&j(),this.segments=e,this.offset=t,this.len=i}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(i=>{t.push(i)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,i=this.limit();t<i;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let i=Math.min(e.length,t.length);for(let r=0;r<i;r++){let s=e.get(r),o=t.get(r);if(s<o)return-1;if(s>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}},_e=class n extends Zm{construct(e,t,i){return new n(e,t,i)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let i of e){if(i.indexOf("//")>=0)throw new x(v.INVALID_ARGUMENT,`Invalid segment (${i}). Paths must not contain // in them.`);t.push(...i.split("/").filter(r=>r.length>0))}return new n(t)}static emptyPath(){return new n([])}},G3=/^[_a-zA-Z][_a-zA-Z0-9]*$/,mt=class n extends Zm{construct(e,t,i){return new n(e,t,i)}static isValidIdentifier(e){return G3.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===rR}static keyField(){return new n([rR])}static fromServerFormat(e){let t=[],i="",r=0,s=()=>{if(i.length===0)throw new x(v.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(i),i=""},o=!1;for(;r<e.length;){let a=e[r];if(a==="\\"){if(r+1===e.length)throw new x(v.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let c=e[r+1];if(!(c==="\\"||c==="."||c==="`"))throw new x(v.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);i+=c,r+=2}else a==="`"?(o=!o,r++):a==="."&&!o?(s(),r++):(i+=a,r++)}if(s(),o)throw new x(v.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var L=class n{constructor(e){this.path=e}static fromPath(e){return new n(_e.fromString(e))}static fromName(e){return new n(_e.fromString(e).popFirst(5))}static empty(){return new n(_e.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&_e.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return _e.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2===0}static fromSegments(e){return new n(new _e(e.slice()))}};var pc=-1,W3=0,j0=(()=>{class n{constructor(t,i,r,s){this.indexId=t,this.collectionGroup=i,this.fields=r,this.indexState=s}}return n.UNKNOWN_ID=-1,n})();function FC(n){return n.fields.find(e=>e.kind===2)}function yo(n){return n.fields.filter(e=>e.kind!==2)}function $3(n){let e=yo(n);return e.length===0?0:e[e.length-1].kind}function H3(n){return`id=${n.indexId}|cg=${n.collectionGroup}|f=${n.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")}`}var hc=class{constructor(e,t){this.fieldPath=e,this.kind=t}};var Pu=class n{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new n(W3,$n.min())}};function fM(n,e){let t=n.toTimestamp().seconds,i=n.toTimestamp().nanoseconds+1,r=Q.fromTimestamp(i===1e9?new Je(t+1,0):new Je(t,i));return new $n(r,L.empty(),e)}function mM(n){return new $n(n.readTime,n.key,pc)}var $n=class n{constructor(e,t,i){this.readTime=e,this.documentKey=t,this.largestBatchId=i}static min(){return new n(Q.min(),L.empty(),pc)}static max(){return new n(Q.max(),L.empty(),pc)}};function LC(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0||(t=L.comparator(n.documentKey,e.documentKey),t!==0)?t:te(n.largestBatchId,e.largestBatchId)}var pM="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Jm=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function ks(n){return p(this,null,function*(){if(n.code===v.FAILED_PRECONDITION&&n.message===pM)R("LocalStore","Unexpectedly lost primary lease");else throw n})}var b=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&j(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((i,r)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(i,r)},this.catchCallback=s=>{this.wrapFailure(t,s).next(i,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,i)=>{t(e)})}static reject(e){return new n((t,i)=>{i(e)})}static waitFor(e){return new n((t,i)=>{let r=0,s=0,o=!1;e.forEach(a=>{++r,a.next(()=>{++s,o&&s===r&&t()},c=>i(c))}),o=!0,s===r&&t()})}static or(e){let t=n.resolve(!1);for(let i of e)t=t.next(r=>r?n.resolve(r):i());return t}static forEach(e,t){let i=[];return e.forEach((r,s)=>{i.push(t.call(this,r,s))}),this.waitFor(i)}static mapArray(e,t){return new n((i,r)=>{let s=e.length,o=new Array(s),a=0;for(let c=0;c<s;c++){let l=c;t(e[l]).next(u=>{o[l]=u,++a,a===s&&i(o)},u=>r(u))}})}static doWhile(e,t){return new n((i,r)=>{let s=()=>{e()===!0?t().next(()=>{s()},r):i()};s()})}};var En="SimpleDb",K3=3,ep=class n{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.completionDeferred=new ht,this.transaction.oncomplete=()=>{this.completionDeferred.resolve()},this.transaction.onabort=()=>{t.error?this.completionDeferred.reject(new mo(e,t.error)):this.completionDeferred.resolve()},this.transaction.onerror=i=>{let r=BC(i.target.error);this.completionDeferred.reject(new mo(e,r))}}static open(e,t,i,r){try{return new n(t,e.transaction(r,i))}catch(s){throw new mo(t,s)}}get completionPromise(){return this.completionDeferred.promise}abort(e){e&&this.completionDeferred.reject(e),this.aborted||(R(En,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}maybeCommit(){let e=this.transaction;!this.aborted&&typeof e.commit=="function"&&e.commit()}store(e){let t=this.transaction.objectStore(e);return new z0(t)}},Er=class n{constructor(e,t,i){this.name=e,this.version=t,this.schemaConverter=i,n.getIOSVersion(al())===12.2&&Ze("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return R(En,"Removing database:",e),oo(window.indexedDB.deleteDatabase(e)).toPromise()}static isAvailable(){if(!$d())return!1;if(n.isMockPersistence())return!0;let e=al(),t=n.getIOSVersion(e),i=0<t&&t<10,r=n.getAndroidVersion(e),s=0<r&&r<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||i||s)}static isMockPersistence(){var e;return typeof process<"u"&&((e=process.env)===null||e===void 0?void 0:e.USE_MOCK_PERSISTENCE)==="YES"}static getStore(e,t){return e.store(t)}static getIOSVersion(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),i=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(i)}static getAndroidVersion(e){let t=e.match(/Android ([\d.]+)/i),i=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(i)}ensureDb(e){return p(this,null,function*(){return this.db||(R(En,"Opening database:",this.name),this.db=yield new Promise((t,i)=>{let r=indexedDB.open(this.name,this.version);r.onsuccess=s=>{let o=s.target.result;t(o)},r.onblocked=()=>{i(new mo(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=s=>{let o=s.target.error;o.name==="VersionError"?i(new x(v.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?i(new x(v.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):i(new mo(e,o))},r.onupgradeneeded=s=>{R(En,'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let o=s.target.result;this.schemaConverter.createOrUpgrade(o,r.transaction,s.oldVersion,this.version).next(()=>{R(En,"Database upgrade to version "+this.version+" complete")})}})),this.versionchangelistener&&(this.db.onversionchange=t=>this.versionchangelistener(t)),this.db})}setVersionChangeListener(e){this.versionchangelistener=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,i,r){return p(this,null,function*(){let s=t==="readonly",o=0;for(;;){++o;try{this.db=yield this.ensureDb(e);let a=ep.open(this.db,e,s?"readonly":"readwrite",i),c=r(a).next(l=>(a.maybeCommit(),l)).catch(l=>(a.abort(l),b.reject(l))).toPromise();return c.catch(()=>{}),yield a.completionPromise,c}catch(a){let c=a,l=c.name!=="FirebaseError"&&o<K3;if(R(En,"Transaction failed with error:",c.message,"Retrying:",l),this.close(),!l)return Promise.reject(c)}}})}close(){this.db&&this.db.close(),this.db=void 0}},q0=class{constructor(e){this.dbCursor=e,this.shouldStop=!1,this.nextKey=null}get isDone(){return this.shouldStop}get skipToKey(){return this.nextKey}set cursor(e){this.dbCursor=e}done(){this.shouldStop=!0}skip(e){this.nextKey=e}delete(){return oo(this.dbCursor.delete())}},mo=class extends x{constructor(e,t){super(v.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}};function Rs(n){return n.name==="IndexedDbTransactionError"}var z0=class{constructor(e){this.store=e}put(e,t){let i;return t!==void 0?(R(En,"PUT",this.store.name,e,t),i=this.store.put(t,e)):(R(En,"PUT",this.store.name,"<auto-key>",e),i=this.store.put(e)),oo(i)}add(e){R(En,"ADD",this.store.name,e,e);let t=this.store.add(e);return oo(t)}get(e){let t=this.store.get(e);return oo(t).next(i=>(i===void 0&&(i=null),R(En,"GET",this.store.name,e,i),i))}delete(e){R(En,"DELETE",this.store.name,e);let t=this.store.delete(e);return oo(t)}count(){R(En,"COUNT",this.store.name);let e=this.store.count();return oo(e)}loadAll(e,t){let i=this.options(e,t),r=i.index?this.store.index(i.index):this.store;if(typeof r.getAll=="function"){let s=r.getAll(i.range);return new b((o,a)=>{s.onerror=c=>{a(c.target.error)},s.onsuccess=c=>{o(c.target.result)}})}else{let s=this.cursor(i),o=[];return this.iterateCursor(s,(a,c)=>{o.push(c)}).next(()=>o)}}loadFirst(e,t){let i=this.store.getAll(e,t===null?void 0:t);return new b((r,s)=>{i.onerror=o=>{s(o.target.error)},i.onsuccess=o=>{r(o.target.result)}})}deleteAll(e,t){R(En,"DELETE ALL",this.store.name);let i=this.options(e,t);i.keysOnly=!1;let r=this.cursor(i);return this.iterateCursor(r,(s,o,a)=>a.delete())}iterate(e,t){let i;t?i=e:(i={},t=e);let r=this.cursor(i);return this.iterateCursor(r,t)}iterateSerial(e){let t=this.cursor({});return new b((i,r)=>{t.onerror=s=>{let o=BC(s.target.error);r(o)},t.onsuccess=s=>{let o=s.target.result;if(!o){i();return}e(o.primaryKey,o.value).next(a=>{a?o.continue():i()})}})}iterateCursor(e,t){let i=[];return new b((r,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{let a=o.target.result;if(!a){r();return}let c=new q0(a),l=t(a.primaryKey,a.value,c);if(l instanceof b){let u=l.catch(d=>(c.done(),b.reject(d)));i.push(u)}c.isDone?r():c.skipToKey===null?a.continue():a.continue(c.skipToKey)}}).next(()=>b.waitFor(i))}options(e,t){let i;return e!==void 0&&(typeof e=="string"?i=e:t=e),{index:i,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let i=this.store.index(e.index);return e.keysOnly?i.openKeyCursor(e.range,t):i.openCursor(e.range,t)}else return this.store.openCursor(e.range,t)}};function oo(n){return new b((e,t)=>{n.onsuccess=i=>{let r=i.target.result;e(r)},n.onerror=i=>{let r=BC(i.target.error);t(r)}})}var sR=!1;function BC(n){let e=Er.getIOSVersion(al());if(e>=12.2&&e<13){let t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){let i=new x("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return sR||(sR=!0,setTimeout(()=>{throw i},0)),i}}return n}var Au="IndexBackfiller",Q3=15*1e3,Y3=60*1e3,X3=50,G0=class{constructor(e,t){this.asyncQueue=e,this.backfiller=t,this.task=null}start(){this.schedule(Q3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}schedule(e){R(Au,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,()=>p(this,null,function*(){this.task=null;try{let t=yield this.backfiller.backfill();R(Au,`Documents written: ${t}`)}catch(t){Rs(t)?R(Au,"Ignoring IndexedDB error during index backfill: ",t):yield ks(t)}yield this.schedule(Y3)}))}},W0=class{constructor(e,t){this.localStore=e,this.persistence=t}backfill(){return p(this,arguments,function*(e=X3){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.writeIndexEntries(t,e))})}writeIndexEntries(e,t){let i=new Set,r=t,s=!0;return b.doWhile(()=>s===!0&&r>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o===null||i.has(o))s=!1;else return R(Au,`Processing collection: ${o}`),this.writeEntriesForCollectionGroup(e,o,r).next(a=>{r-=a,i.add(o)})})).next(()=>t-r)}writeEntriesForCollectionGroup(e,t,i){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(r=>this.localStore.localDocuments.getNextDocuments(e,t,r,i).next(s=>{let o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.getNewOffset(r,s)).next(a=>(R(Au,`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}getNewOffset(e,t){let i=e;return t.changes.forEach((r,s)=>{let o=mM(s);LC(o,i)>0&&(i=o)}),new $n(i.readTime,i.documentKey,Math.max(t.batchId,e.largestBatchId))}};var Sn=(()=>{class n{constructor(t,i){this.previousValue=t,i&&(i.sequenceNumberHandler=r=>this.setPreviousValue(r),this.writeNewSequenceNumber=r=>i.writeSequenceNumber(r))}setPreviousValue(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(t),t}}n.INVALID=-1;return n})(),fc="",$0="",gM="",yM="";function on(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=oR(e)),e=Z3(n.get(t),e);return oR(e)}function Z3(n,e){let t=e,i=n.length;for(let r=0;r<i;r++){let s=n.charAt(r);switch(s){case"\0":t+=fc+gM;break;case fc:t+=fc+yM;break;default:t+=s}}return t}function oR(n){return n+fc+$0}function Ki(n){let e=n.length;if($(e>=2),e===2)return $(n.charAt(0)===fc&&n.charAt(1)===$0),_e.emptyPath();let t=e-2,i=[],r="";for(let s=0;s<e;){let o=n.indexOf(fc,s);switch((o<0||o>t)&&j(),n.charAt(o+1)){case $0:let c=n.substring(s,o),l;r.length===0?l=c:(r+=c,l=r,r=""),i.push(l);break;case gM:r+=n.substring(s,o),r+="\0";break;case yM:r+=n.substring(s,o+1);break;default:j()}s=o+2}return new _e(i)}var ao="remoteDocuments";var sd="owner",Ja="owner",od="mutationQueues",J3="userId",mi="mutations",bM="batchId",ho="userMutationsIndex",vM=["userId","batchId"];function e6(n){return[n]}function Gm(n,e){return[n,on(e)]}function _M(n,e,t){return[n,on(e),t]}var t6={},Oc="documentMutations",qp="remoteDocumentsV14",n6=["prefixPath","collectionGroup","readTime","documentId"],Wm="documentKeyIndex",i6=["prefixPath","collectionGroup","documentId"],wM="collectionGroupIndex",r6=["collectionGroup","readTime","prefixPath","documentId"],ad="remoteDocumentGlobal",H0="remoteDocumentGlobalKey",Pc="targets",s6="targetId",CM="queryTargetsIndex",o6=["canonicalId","targetId"],Nc="targetDocuments",a6=["targetId","path"],VC="documentTargetsIndex",c6=["path","targetId"],tp="targetGlobalKey",ko="targetGlobal",Nu="collectionParents",l6=["collectionId","parent"],gc="clientMetadata",u6="clientId",zp="bundles",d6="bundleId",Gp="namedQueries",h6="name",UC="indexConfiguration",f6="indexId",K0="collectionGroupIndex",m6="collectionGroup",Wp="indexState",p6=["indexId","uid"],EM="sequenceNumberIndex",g6=["uid","sequenceNumber"],$p="indexEntries",y6=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],SM="documentKeyIndex",b6=["indexId","uid","orderedDocumentKey"],Hp="documentOverlays",v6=["userId","collectionPath","documentId"],Q0="collectionPathOverlayIndex",_6=["userId","collectionPath","largestBatchId"],TM="collectionGroupOverlayIndex",w6=["userId","collectionGroup","largestBatchId"],C6=[od,mi,Oc,ao,Pc,sd,ko,Nc],E6=C6,S6=[...E6,gc],T6=[...S6,ad],x6=[...T6,Nu],xM=[...x6,zp,Gp],I6=[...xM,Hp],IM=[od,mi,Oc,qp,Pc,sd,ko,Nc,gc,ad,Nu,zp,Gp,Hp],AM=IM,DM=[...AM,UC,Wp,$p],A6=DM;function D6(n){if(n===16)return A6;if(n===15)return DM;if(n===14)return AM;if(n===13)return IM;if(n===12)return I6;if(n===11)return xM;j()}var Fu=class extends Jm{constructor(e,t){super(),this.simpleDbTransaction=e,this.currentSequenceNumber=t}};function Rt(n,e){let t=B(n);return Er.getStore(t.simpleDbTransaction,e)}function aR(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Ro(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function kM(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var ze=class n{constructor(e,t){this.comparator=e,this.root=t||Du.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Du.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Du.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let i=this.comparator(e,t.key);if(i===0)return t.value;i<0?t=t.left:i>0&&(t=t.right)}return null}indexOf(e){let t=0,i=this.root;for(;!i.isEmpty();){let r=this.comparator(e,i.key);if(r===0)return t+i.left.size;r<0?i=i.left:(t+=i.left.size+1,i=i.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,i)=>(e(t,i),!1))}toString(){let e=[];return this.inorderTraversal((t,i)=>(e.push(`${t}:${i}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new uc(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new uc(this.root,e,this.comparator,!1)}getReverseIterator(){return new uc(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new uc(this.root,e,this.comparator,!0)}},uc=class{constructor(e,t,i,r){this.isReverse=r,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?i(e.key,t):1,t&&r&&(s*=-1),s<0)this.isReverse?e=e.left:e=e.right;else if(s===0){this.nodeStack.push(e);break}else this.nodeStack.push(e),this.isReverse?e=e.right:e=e.left}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},Du=(()=>{class n{constructor(t,i,r,s,o){this.key=t,this.value=i,this.color=r??n.RED,this.left=s??n.EMPTY,this.right=o??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,i,r,s,o){return new n(t??this.key,i??this.value,r??this.color,s??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,i,r){let s=this,o=r(t,s.key);return o<0?s=s.copy(null,null,null,s.left.insert(t,i,r),null):o===0?s=s.copy(null,i,null,null,null):s=s.copy(null,null,null,null,s.right.insert(t,i,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let t=this;return!t.left.isRed()&&!t.left.left.isRed()&&(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,i){let r,s=this;if(i(t,s.key)<0)!s.left.isEmpty()&&!s.left.isRed()&&!s.left.left.isRed()&&(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,i),null);else{if(s.left.isRed()&&(s=s.rotateRight()),!s.right.isEmpty()&&!s.right.isRed()&&!s.right.left.isRed()&&(s=s.moveRedRight()),i(t,s.key)===0){if(s.right.isEmpty())return n.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,i))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){let t=this.left.copy(null,null,!this.left.color,null,null),i=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,i)}checkMaxDepth(){let t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw j();let t=this.left.check();if(t!==this.right.check())throw j();return t+(this.isRed()?0:1)}}return n.EMPTY=null,n.RED=!0,n.BLACK=!1,n})(),Y0=class{constructor(){this.size=0}get key(){throw j()}get value(){throw j()}get color(){throw j()}get left(){throw j()}get right(){throw j()}copy(e,t,i,r,s){return this}insert(e,t,i){return new Du(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};Du.EMPTY=new Y0;var Ne=class n{constructor(e){this.comparator=e,this.data=new ze(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,i)=>(e(t),!1))}forEachInRange(e,t){let i=this.data.getIteratorFrom(e[0]);for(;i.hasNext();){let r=i.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let i;for(t!==void 0?i=this.data.getIteratorFrom(t):i=this.data.getIterator();i.hasNext();){let r=i.getNext();if(!e(r.key))return}}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new np(this.data.getIterator())}getIteratorFrom(e){return new np(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(i=>{t=t.add(i)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),i=e.data.getIterator();for(;t.hasNext();){let r=t.getNext().key,s=i.getNext().key;if(this.comparator(r,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},np=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function k6(n,e,t,i,r){let s=n.getIterator(),o=e.getIterator(),a=ec(s),c=ec(o);for(;a||c;){let l=!1,u=!1;if(a&&c){let d=t(a,c);d<0?u=!0:d>0&&(l=!0)}else a!=null?u=!0:l=!0;l?(i(c),c=ec(o)):u?(r(a),a=ec(s)):(a=ec(s),c=ec(o))}}function ec(n){return n.hasNext()?n.getNext():void 0}var Tn=class n{constructor(e){this.fields=e,e.sort(mt.comparator)}static empty(){return new n([])}unionWith(e){let t=new Ne(mt.comparator);for(let i of this.fields)t=t.add(i);for(let i of e)t=t.add(i);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return go(this.fields,e.fields,(t,i)=>t.isEqual(i))}};function R6(n){return Buffer.from(n,"base64").toString("binary")}function M6(n){return Buffer.from(n,"binary").toString("base64")}function RM(){return!0}var kt=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=R6(e);return new n(t)}static fromUint8Array(e){let t=O6(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return M6(this.binaryString)}toUint8Array(){return P6(this.binaryString)}approximateByteSize(){return this.binaryString.length*2}compareTo(e){return te(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};kt.EMPTY_BYTE_STRING=new kt("");function O6(n){let e="";for(let t=0;t<n.length;++t)e+=String.fromCharCode(n[t]);return e}function P6(n){let e=new Uint8Array(n.length);for(let t=0;t<n.length;t++)e[t]=n.charCodeAt(t);return e}var N6=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Sr(n){if($(!!n),typeof n=="string"){let e=0,t=N6.exec(n);if($(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}let i=new Date(n);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}else{let e=ot(n.seconds),t=ot(n.nanos);return{seconds:e,nanos:t}}}function ot(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function ws(n){return typeof n=="string"?kt.fromBase64String(n):kt.fromUint8Array(n)}var MM="server_timestamp",OM="__type__",PM="__previous_value__",NM="__local_write_time__";function Kp(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[OM])===null||t===void 0?void 0:t.stringValue)===MM}function F6(n,e){let t={fields:{[OM]:{stringValue:MM},[NM]:{timestampValue:{seconds:n.seconds,nanos:n.nanoseconds}}}};return e&&Kp(e)&&(e=jC(e)),e&&(t.fields[PM]=e),{mapValue:t}}function jC(n){let e=n.mapValue.fields[PM];return Kp(e)?jC(e):e}function Lu(n){let e=Sr(n.mapValue.fields[NM].timestampValue);return new Je(e.seconds,e.nanos)}var X0=class{constructor(e,t,i,r,s,o,a,c,l){this.databaseId=e,this.appId=t,this.persistenceKey=i,this.host=r,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=c,this.useFetchStreams=l}},Z0="(default)",Cs=class n{constructor(e,t){this.projectId=e,this.database=t||Z0}static empty(){return new n("","")}get isDefaultDatabase(){return this.database===Z0}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};function L6(n,e){if(!Object.prototype.hasOwnProperty.apply(n.options,["projectId"]))throw new x(v.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Cs(n.options.projectId,e)}var vs=-1;function cd(n){return n==null}function Bu(n){return n===0&&1/n===-1/0}function FM(n){return typeof n=="number"&&Number.isInteger(n)&&!Bu(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}var LM="__max__",ys={mapValue:{fields:{__type__:{stringValue:LM}}}},$m={nullValue:"NULL_VALUE"};function bo(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Kp(n)?4:BM(n)?9007199254740991:10:j()}function pi(n,e){if(n===e)return!0;let t=bo(n),i=bo(e);if(t!==i)return!1;switch(t){case 0:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Lu(n).isEqual(Lu(e));case 3:return B6(n,e);case 5:return n.stringValue===e.stringValue;case 6:return U6(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return V6(n,e);case 2:return j6(n,e);case 9:return go(n.arrayValue.values||[],e.arrayValue.values||[],pi);case 10:return q6(n,e);case 9007199254740991:return!0;default:return j()}}function B6(n,e){if(typeof n.timestampValue=="string"&&typeof e.timestampValue=="string"&&n.timestampValue.length===e.timestampValue.length)return n.timestampValue===e.timestampValue;let t=Sr(n.timestampValue),i=Sr(e.timestampValue);return t.seconds===i.seconds&&t.nanos===i.nanos}function V6(n,e){return ot(n.geoPointValue.latitude)===ot(e.geoPointValue.latitude)&&ot(n.geoPointValue.longitude)===ot(e.geoPointValue.longitude)}function U6(n,e){return ws(n.bytesValue).isEqual(ws(e.bytesValue))}function j6(n,e){if("integerValue"in n&&"integerValue"in e)return ot(n.integerValue)===ot(e.integerValue);if("doubleValue"in n&&"doubleValue"in e){let t=ot(n.doubleValue),i=ot(e.doubleValue);return t===i?Bu(t)===Bu(i):isNaN(t)&&isNaN(i)}return!1}function q6(n,e){let t=n.mapValue.fields||{},i=e.mapValue.fields||{};if(aR(t)!==aR(i))return!1;for(let r in t)if(t.hasOwnProperty(r)&&(i[r]===void 0||!pi(t[r],i[r])))return!1;return!0}function Vu(n,e){return(n.values||[]).find(t=>pi(t,e))!==void 0}function Es(n,e){if(n===e)return 0;let t=bo(n),i=bo(e);if(t!==i)return te(t,i);switch(t){case 0:case 9007199254740991:return 0;case 1:return te(n.booleanValue,e.booleanValue);case 2:return z6(n,e);case 3:return cR(n.timestampValue,e.timestampValue);case 4:return cR(Lu(n),Lu(e));case 5:return te(n.stringValue,e.stringValue);case 6:return $6(n.bytesValue,e.bytesValue);case 7:return G6(n.referenceValue,e.referenceValue);case 8:return W6(n.geoPointValue,e.geoPointValue);case 9:return H6(n.arrayValue,e.arrayValue);case 10:return K6(n.mapValue,e.mapValue);default:throw j()}}function z6(n,e){let t=ot(n.integerValue||n.doubleValue),i=ot(e.integerValue||e.doubleValue);return t<i?-1:t>i?1:t===i?0:isNaN(t)?isNaN(i)?0:-1:1}function cR(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return te(n,e);let t=Sr(n),i=Sr(e),r=te(t.seconds,i.seconds);return r!==0?r:te(t.nanos,i.nanos)}function G6(n,e){let t=n.split("/"),i=e.split("/");for(let r=0;r<t.length&&r<i.length;r++){let s=te(t[r],i[r]);if(s!==0)return s}return te(t.length,i.length)}function W6(n,e){let t=te(ot(n.latitude),ot(e.latitude));return t!==0?t:te(ot(n.longitude),ot(e.longitude))}function $6(n,e){let t=ws(n),i=ws(e);return t.compareTo(i)}function H6(n,e){let t=n.values||[],i=e.values||[];for(let r=0;r<t.length&&r<i.length;++r){let s=Es(t[r],i[r]);if(s)return s}return te(t.length,i.length)}function K6(n,e){if(n===ys.mapValue&&e===ys.mapValue)return 0;if(n===ys.mapValue)return 1;if(e===ys.mapValue)return-1;let t=n.fields||{},i=Object.keys(t),r=e.fields||{},s=Object.keys(r);i.sort(),s.sort();for(let o=0;o<i.length&&o<s.length;++o){let a=te(i[o],s[o]);if(a!==0)return a;let c=Es(t[i[o]],r[s[o]]);if(c!==0)return c}return te(i.length,s.length)}function yc(n){return qC(n)}function qC(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?Y6(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?Q6(n.bytesValue):"referenceValue"in n?Z6(n.referenceValue):"geoPointValue"in n?X6(n.geoPointValue):"arrayValue"in n?e5(n.arrayValue):"mapValue"in n?J6(n.mapValue):j()}function Q6(n){return ws(n).toBase64()}function Y6(n){let e=Sr(n);return`time(${e.seconds},${e.nanos})`}function X6(n){return`geo(${n.latitude},${n.longitude})`}function Z6(n){return L.fromName(n).toString()}function J6(n){let e=Object.keys(n.fields||{}).sort(),t="{",i=!0;for(let r of e)i?i=!1:t+=",",t+=`${r}:${qC(n.fields[r])}`;return t+"}"}function e5(n){let e="[",t=!0;for(let i of n.values||[])t?t=!1:e+=",",e+=qC(i);return e+"]"}function vo(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function J0(n){return!!n&&"integerValue"in n}function t5(n){return!!n&&"doubleValue"in n}function n5(n){return J0(n)||t5(n)}function Uu(n){return!!n&&"arrayValue"in n}function lR(n){return!!n&&"nullValue"in n}function uR(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Hm(n){return!!n&&"mapValue"in n}function ku(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return Ro(n.mapValue.fields,(t,i)=>e.mapValue.fields[t]=ku(i)),e}else if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=ku(n.arrayValue.values[t]);return e}else return Object.assign({},n)}function BM(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===LM}function i5(n){return"nullValue"in n?$m:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?vo(Cs.empty(),L.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?{mapValue:{}}:j()}function r5(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?vo(Cs.empty(),L.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?{mapValue:{}}:"mapValue"in n?ys:j()}function dR(n,e){let t=Es(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function hR(n,e){let t=Es(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}var Kt=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let i=0;i<e.length-1;++i)if(t=(t.mapValue.fields||{})[e.get(i)],!Hm(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){let i=this.getFieldsMap(e.popLast());i[e.lastSegment()]=ku(t)}setAll(e){let t=mt.emptyPath(),i={},r=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){let c=this.getFieldsMap(t);this.applyChanges(c,i,r),i={},r=[],t=a.popLast()}o?i[a.lastSegment()]=ku(o):r.push(a.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,i,r)}delete(e){let t=this.field(e.popLast());Hm(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return pi(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let i=0;i<e.length;++i){let r=t.mapValue.fields[e.get(i)];(!Hm(r)||!r.mapValue.fields)&&(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(i)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,i){Ro(t,(r,s)=>e[r]=s);for(let r of i)delete e[r]}clone(){return new n(ku(this.value))}};function VM(n){let e=[];return Ro(n.fields,(t,i)=>{let r=new mt([t]);if(Hm(i)){let o=VM(i.mapValue).fields;if(o.length===0)e.push(r);else for(let a of o)e.push(r.child(a))}else e.push(r)}),new Tn(e)}var _t=class n{constructor(e,t,i,r,s,o,a){this.key=e,this.documentType=t,this.version=i,this.readTime=r,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new n(e,0,Q.min(),Q.min(),Q.min(),Kt.empty(),0)}static newFoundDocument(e,t,i,r){return new n(e,1,t,Q.min(),i,r,0)}static newNoDocument(e,t){return new n(e,2,t,Q.min(),Q.min(),Kt.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,Q.min(),Q.min(),Kt.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(Q.min())&&(this.documentType===2||this.documentType===0)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Kt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Kt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Q.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};function s5(n,e,t){let i=e.data.field(n),r=t.data.field(n);return i!==null&&r!==null?Es(i,r):j()}var Zi=class{constructor(e,t){this.position=e,this.inclusive=t}};function UM(n,e,t){let i=0;for(let r=0;r<n.position.length;r++){let s=e[r],o=n.position[r];if(s.field.isKeyField())i=L.comparator(L.fromName(o.referenceValue),t.key);else{let a=t.data.field(s.field);i=Es(o,a)}if(s.dir==="desc"&&(i=i*-1),i!==0)break}return i}function o5(n,e,t){let i=UM(n,e,t);return n.inclusive?i>=0:i>0}function a5(n,e,t){let i=UM(n,e,t);return n.inclusive?i<=0:i<0}function fR(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++){let i=n.position[t],r=e.position[t];if(!pi(i,r))return!1}return!0}var _o=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function c5(n){return n.field.canonicalString()+n.dir}function l5(n){return`${n.field.canonicalString()} (${n.dir})`}function u5(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var ip=class{},ge=class n extends ip{constructor(e,t,i){super(),this.field=e,this.op=t,this.value=i}static create(e,t,i){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,i):new nw(e,t,i):t==="array-contains"?new sw(e,i):t==="in"?new rp(e,i):t==="not-in"?new ow(e,i):t==="array-contains-any"?new aw(e,i):new n(e,t,i)}static createKeyFieldInFilter(e,t,i){return t==="in"?new iw(e,i):new rw(e,i)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(Es(t,this.value)):t!==null&&bo(this.value)===bo(t)&&this.matchesComparison(Es(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return j()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},ke=class n extends ip{constructor(e,t){super(),this.filters=e,this.op=t,this.memoizedFlattenedFilters=null}static create(e,t){return new n(e,t)}matches(e){return bc(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.memoizedFlattenedFilters!==null?this.memoizedFlattenedFilters:(this.memoizedFlattenedFilters=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[]),this.memoizedFlattenedFilters)}getFilters(){return Object.assign([],this.filters)}};function bc(n){return n.op==="and"}function ew(n){return n.op==="or"}function zC(n){return jM(n)&&bc(n)}function jM(n){for(let e of n.filters)if(e instanceof ke)return!1;return!0}function tw(n){if(n instanceof ge)return n.field.canonicalString()+n.op.toString()+yc(n.value);if(zC(n))return n.filters.map(e=>tw(e)).join(",");{let e=n.filters.map(t=>tw(t)).join(",");return`${n.op}(${e})`}}function qM(n,e){if(n instanceof ge)return d5(n,e);if(n instanceof ke)return h5(n,e);j()}function d5(n,e){return e instanceof ge&&n.op===e.op&&n.field.isEqual(e.field)&&pi(n.value,e.value)}function h5(n,e){return e instanceof ke&&n.op===e.op&&n.filters.length===e.filters.length?n.filters.reduce((i,r,s)=>i&&qM(r,e.filters[s]),!0):!1}function zM(n,e){let t=n.filters.concat(e);return ke.create(t,n.op)}function GM(n){return n instanceof ge?m5(n):n instanceof ke?f5(n):"Filter"}function f5(n){return n.op.toString()+" {"+n.getFilters().map(GM).join(" ,")+"}"}function m5(n){return`${n.field.canonicalString()} ${n.op} ${yc(n.value)}`}var nw=class extends ge{constructor(e,t,i){super(e,t,i),this.key=L.fromName(i.referenceValue)}matches(e){let t=L.comparator(e.key,this.key);return this.matchesComparison(t)}},iw=class extends ge{constructor(e,t){super(e,"in",t),this.keys=WM("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},rw=class extends ge{constructor(e,t){super(e,"not-in",t),this.keys=WM("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function WM(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(i=>L.fromName(i.referenceValue))}var sw=class extends ge{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return Uu(t)&&Vu(t.arrayValue,this.value)}},rp=class extends ge{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&Vu(this.value.arrayValue,t)}},ow=class extends ge{constructor(e,t){super(e,"not-in",t)}matches(e){if(Vu(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&!Vu(this.value.arrayValue,t)}},aw=class extends ge{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!Uu(t)||!t.arrayValue.values?!1:t.arrayValue.values.some(i=>Vu(this.value.arrayValue,i))}};var cw=class{constructor(e,t=null,i=[],r=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=i,this.filters=r,this.limit=s,this.startAt=o,this.endAt=a,this.memoizedCanonicalId=null}};function lw(n,e=null,t=[],i=[],r=null,s=null,o=null){return new cw(n,e,t,i,r,s,o)}function wo(n){let e=B(n);if(e.memoizedCanonicalId===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(i=>tw(i)).join(","),t+="|ob:",t+=e.orderBy.map(i=>c5(i)).join(","),cd(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(i=>yc(i)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(i=>yc(i)).join(",")),e.memoizedCanonicalId=t}return e.memoizedCanonicalId}function p5(n){let e=n.path.canonicalString();return n.collectionGroup!==null&&(e+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(e+=`, filters: [${n.filters.map(t=>GM(t)).join(", ")}]`),cd(n.limit)||(e+=", limit: "+n.limit),n.orderBy.length>0&&(e+=`, orderBy: [${n.orderBy.map(t=>l5(t)).join(", ")}]`),n.startAt&&(e+=", startAt: ",e+=n.startAt.inclusive?"b:":"a:",e+=n.startAt.position.map(t=>yc(t)).join(",")),n.endAt&&(e+=", endAt: ",e+=n.endAt.inclusive?"a:":"b:",e+=n.endAt.position.map(t=>yc(t)).join(",")),`Target(${e})`}function ld(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!u5(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!qM(n.filters[t],e.filters[t]))return!1;return n.collectionGroup!==e.collectionGroup||!n.path.isEqual(e.path)||!fR(n.startAt,e.startAt)?!1:fR(n.endAt,e.endAt)}function sp(n){return L.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function Qp(n,e){return n.filters.filter(t=>t instanceof ge&&t.field.isEqual(e))}function g5(n,e){let t=FC(e);if(t===void 0)return null;for(let i of Qp(n,t.fieldPath))switch(i.op){case"array-contains-any":return i.value.arrayValue.values||[];case"array-contains":return[i.value]}return null}function y5(n,e){let t=new Map;for(let i of yo(e))for(let r of Qp(n,i.fieldPath))switch(r.op){case"==":case"in":t.set(i.fieldPath.canonicalString(),r.value);break;case"not-in":case"!=":return t.set(i.fieldPath.canonicalString(),r.value),Array.from(t.values())}return null}function b5(n,e){let t=[],i=!0;for(let r of yo(e)){let s=r.kind===0?$M(n,r.fieldPath,n.startAt):HM(n,r.fieldPath,n.startAt);t.push(s.value),i&&(i=s.inclusive)}return new Zi(t,i)}function v5(n,e){let t=[],i=!0;for(let r of yo(e)){let s=r.kind===0?HM(n,r.fieldPath,n.endAt):$M(n,r.fieldPath,n.endAt);t.push(s.value),i&&(i=s.inclusive)}return new Zi(t,i)}function $M(n,e,t){let i=$m,r=!0;for(let s of Qp(n,e)){let o=$m,a=!0;switch(s.op){case"<":case"<=":o=i5(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,a=!1;break;case"!=":case"not-in":o=$m;break}dR({value:i,inclusive:r},{value:o,inclusive:a})<0&&(i=o,r=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let a=t.position[s];dR({value:i,inclusive:r},{value:a,inclusive:t.inclusive})<0&&(i=a,r=t.inclusive);break}}return{value:i,inclusive:r}}function HM(n,e,t){let i=ys,r=!0;for(let s of Qp(n,e)){let o=ys,a=!0;switch(s.op){case">=":case">":o=r5(s.value),a=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,a=!1;break;case"!=":case"not-in":o=ys;break}hR({value:i,inclusive:r},{value:o,inclusive:a})>0&&(i=o,r=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let a=t.position[s];hR({value:i,inclusive:r},{value:a,inclusive:t.inclusive})>0&&(i=a,r=t.inclusive);break}}return{value:i,inclusive:r}}function _5(n){let e=new Ne(mt.comparator),t=!1;for(let i of n.filters)for(let r of i.getFlattenedFilters())r.field.isKeyField()||(r.op==="array-contains"||r.op==="array-contains-any"?t=!0:e=e.add(r.field));for(let i of n.orderBy)i.field.isKeyField()||(e=e.add(i.field));return e.size+(t?1:0)}function w5(n){return n.limit!==null}var gi=class{constructor(e,t=null,i=[],r=[],s=null,o="F",a=null,c=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=i,this.filters=r,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=c,this.memoizedNormalizedOrderBy=null,this.memoizedTarget=null,this.memoizedAggregateTarget=null,this.startAt,this.endAt}};function KM(n,e,t,i,r,s,o,a){return new gi(n,e,t,i,r,s,o,a)}function Fc(n){return new gi(n)}function C5(n,e){return new gi(e,null,n.explicitOrderBy.slice(),n.filters.slice(),n.limit,n.limitType,n.startAt,n.endAt)}function mR(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function E5(n){let e=new Ne(mt.comparator);return n.filters.forEach(t=>{t.getFlattenedFilters().forEach(r=>{r.isInequality()&&(e=e.add(r.field))})}),e}function S5(n){return new gi(_e.emptyPath(),n)}function T5(n){return L.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function GC(n){return n.collectionGroup!==null}function vc(n){let e=B(n);if(e.memoizedNormalizedOrderBy===null){e.memoizedNormalizedOrderBy=[];let t=new Set;for(let s of e.explicitOrderBy)e.memoizedNormalizedOrderBy.push(s),t.add(s.field.canonicalString());let i=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";E5(e).forEach(s=>{!t.has(s.canonicalString())&&!s.isKeyField()&&e.memoizedNormalizedOrderBy.push(new _o(s,i))}),t.has(mt.keyField().canonicalString())||e.memoizedNormalizedOrderBy.push(new _o(mt.keyField(),i))}return e.memoizedNormalizedOrderBy}function an(n){let e=B(n);return e.memoizedTarget||(e.memoizedTarget=x5(e,vc(n))),e.memoizedTarget}function x5(n,e){if(n.limitType==="F")return lw(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(r=>{let s=r.dir==="desc"?"asc":"desc";return new _o(r.field,s)});let t=n.endAt?new Zi(n.endAt.position,n.endAt.inclusive):null,i=n.startAt?new Zi(n.startAt.position,n.startAt.inclusive):null;return lw(n.path,n.collectionGroup,e,n.filters,n.limit,t,i)}}function WC(n,e){let t=n.filters.concat([e]);return new gi(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function I5(n,e){let t=n.explicitOrderBy.concat([e]);return new gi(n.path,n.collectionGroup,t,n.filters.slice(),n.limit,n.limitType,n.startAt,n.endAt)}function op(n,e,t){return new gi(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function A5(n,e){return new gi(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),n.limit,n.limitType,e,n.endAt)}function D5(n,e){return new gi(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),n.limit,n.limitType,n.startAt,e)}function ud(n,e){return ld(an(n),an(e))&&n.limitType===e.limitType}function QM(n){return`${wo(an(n))}|lt:${n.limitType}`}function ac(n){return`Query(target=${p5(an(n))}; limitType=${n.limitType})`}function dd(n,e){return e.isFoundDocument()&&k5(n,e)&&R5(n,e)&&M5(n,e)&&O5(n,e)}function k5(n,e){let t=e.key.path;return n.collectionGroup!==null?e.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(t):L.isDocumentKey(n.path)?n.path.isEqual(t):n.path.isImmediateParentOf(t)}function R5(n,e){for(let t of vc(n))if(!t.field.isKeyField()&&e.data.field(t.field)===null)return!1;return!0}function M5(n,e){for(let t of n.filters)if(!t.matches(e))return!1;return!0}function O5(n,e){return!(n.startAt&&!a5(n.startAt,vc(n),e)||n.endAt&&!o5(n.endAt,vc(n),e))}function YM(n){return n.collectionGroup||(n.path.length%2===1?n.path.lastSegment():n.path.get(n.path.length-2))}function XM(n){return(e,t)=>{let i=!1;for(let r of vc(n)){let s=P5(r,e,t);if(s!==0)return s;i=i||r.field.isKeyField()}return 0}}function P5(n,e,t){let i=n.field.isKeyField()?L.comparator(e.key,t.key):s5(n.field,e,t);switch(n.dir){case"asc":return i;case"desc":return-1*i;default:return j()}}var Ji=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),i=this.inner[t];if(i!==void 0){for(let[r,s]of i)if(this.equalsFn(r,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let i=this.mapKeyFn(e),r=this.inner[i];if(r===void 0){this.inner[i]=[[e,t]],this.innerSize++;return}for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e)){r[s]=[e,t];return}r.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),i=this.inner[t];if(i===void 0)return!1;for(let r=0;r<i.length;r++)if(this.equalsFn(i[r][0],e))return i.length===1?delete this.inner[t]:i.splice(r,1),this.innerSize--,!0;return!1}forEach(e){Ro(this.inner,(t,i)=>{for(let[r,s]of i)e(r,s)})}isEmpty(){return kM(this.inner)}size(){return this.innerSize}};var N5=new ze(L.comparator);function gn(){return N5}var ZM=new ze(L.comparator);function xu(...n){let e=ZM;for(let t of n)e=e.insert(t.key,t);return e}function F5(){return ju()}function JM(n){let e=ZM;return n.forEach((t,i)=>e=e.insert(t,i.overlayedDocument)),e}function Qi(){return ju()}function eO(){return ju()}function ju(){return new Ji(n=>n.toString(),(n,e)=>n.isEqual(e))}var L5=new ze(L.comparator);function B5(){return L5}var V5=new Ne(L.comparator);function ne(...n){let e=V5;for(let t of n)e=e.add(t);return e}var U5=new Ne(te);function $C(){return U5}function tO(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Bu(e)?"-0":e}}function nO(n){return{integerValue:""+n}}function iO(n,e){return FM(e)?nO(e):tO(n,e)}var _c=class{constructor(){this._=void 0}};function j5(n,e,t){return n instanceof Ss?F6(t,e):n instanceof Tr?sO(n,e):n instanceof xr?oO(n,e):G5(n,e)}function q5(n,e,t){return n instanceof Tr?sO(n,e):n instanceof xr?oO(n,e):t}function rO(n,e){return n instanceof Ts?n5(e)?e:{integerValue:0}:null}function z5(n,e){return n instanceof Tr&&e instanceof Tr||n instanceof xr&&e instanceof xr?go(n.elements,e.elements,pi):n instanceof Ts&&e instanceof Ts?pi(n.operand,e.operand):n instanceof Ss&&e instanceof Ss}var Ss=class extends _c{},Tr=class extends _c{constructor(e){super(),this.elements=e}};function sO(n,e){let t=aO(e);for(let i of n.elements)t.some(r=>pi(r,i))||t.push(i);return{arrayValue:{values:t}}}var xr=class extends _c{constructor(e){super(),this.elements=e}};function oO(n,e){let t=aO(e);for(let i of n.elements)t=t.filter(r=>!pi(r,i));return{arrayValue:{values:t}}}var Ts=class extends _c{constructor(e,t){super(),this.serializer=e,this.operand=t}};function G5(n,e){let t=rO(n,e),i=pR(t)+pR(n.operand);return J0(t)&&J0(n.operand)?nO(i):tO(n.serializer,i)}function pR(n){return ot(n.integerValue||n.doubleValue)}function aO(n){return Uu(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}var Co=class{constructor(e,t){this.field=e,this.transform=t}};function W5(n,e){return n.field.isEqual(e.field)&&z5(n.transform,e.transform)}function $5(n,e){return n===void 0&&e===void 0?!0:n&&e?go(n,e,(t,i)=>W5(t,i)):!1}var uw=class{constructor(e,t){this.version=e,this.transformResults=t}},st=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function Yp(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists!==void 0?n.exists===e.isFoundDocument():!0}var wc=class{};function cO(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Is(n.key,st.none()):new xs(n.key,n.data,st.none());{let t=n.data,i=Kt.empty(),r=new Ne(mt.comparator);for(let s of e.fields)if(!r.has(s)){let o=t.field(s);o===null&&s.length>1&&(s=s.popLast(),o=t.field(s)),o===null?i.delete(s):i.set(s,o),r=r.add(s)}return new yi(n.key,i,new Tn(r.toArray()),st.none())}}function H5(n,e,t){n instanceof xs?Q5(n,e,t):n instanceof yi?X5(n,e,t):J5(n,e,t)}function Ru(n,e,t,i){return n instanceof xs?Y5(n,e,t,i):n instanceof yi?Z5(n,e,t,i):e9(n,e,t)}function K5(n,e){let t=null;for(let i of n.fieldTransforms){let r=e.data.field(i.field),s=rO(i.transform,r||null);s!=null&&(t===null&&(t=Kt.empty()),t.set(i.field,s))}return t||null}function gR(n,e){return n.type!==e.type||!n.key.isEqual(e.key)||!n.precondition.isEqual(e.precondition)||!$5(n.fieldTransforms,e.fieldTransforms)?!1:n.type===0?n.value.isEqual(e.value):n.type===1?n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask):!0}var xs=class extends wc{constructor(e,t,i,r=[]){super(),this.key=e,this.value=t,this.precondition=i,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}};function Q5(n,e,t){let i=n.value.clone(),r=uO(n.fieldTransforms,e,t.transformResults);i.setAll(r),e.convertToFoundDocument(t.version,i).setHasCommittedMutations()}function Y5(n,e,t,i){if(!Yp(n.precondition,e))return t;let r=n.value.clone(),s=dO(n.fieldTransforms,i,e);return r.setAll(s),e.convertToFoundDocument(e.version,r).setHasLocalMutations(),null}var yi=class extends wc{constructor(e,t,i,r,s=[]){super(),this.key=e,this.data=t,this.fieldMask=i,this.precondition=r,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function X5(n,e,t){if(!Yp(n.precondition,e)){e.convertToUnknownDocument(t.version);return}let i=uO(n.fieldTransforms,e,t.transformResults),r=e.data;r.setAll(lO(n)),r.setAll(i),e.convertToFoundDocument(t.version,r).setHasCommittedMutations()}function Z5(n,e,t,i){if(!Yp(n.precondition,e))return t;let r=dO(n.fieldTransforms,i,e),s=e.data;return s.setAll(lO(n)),s.setAll(r),e.convertToFoundDocument(e.version,s).setHasLocalMutations(),t===null?null:t.unionWith(n.fieldMask.fields).unionWith(n.fieldTransforms.map(o=>o.field))}function lO(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let i=n.data.field(t);e.set(t,i)}}),e}function uO(n,e,t){let i=new Map;$(n.length===t.length);for(let r=0;r<t.length;r++){let s=n[r],o=s.transform,a=e.data.field(s.field);i.set(s.field,q5(o,a,t[r]))}return i}function dO(n,e,t){let i=new Map;for(let r of n){let s=r.transform,o=t.data.field(r.field);i.set(r.field,j5(s,o,e))}return i}var Is=class extends wc{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}};function J5(n,e,t){e.convertToNoDocument(t.version).setHasCommittedMutations()}function e9(n,e,t){return Yp(n.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):t}var qu=class extends wc{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var zu=class{constructor(e,t,i,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=i,this.mutations=r}applyToRemoteDocument(e,t){let i=t.mutationResults;for(let r=0;r<this.mutations.length;r++){let s=this.mutations[r];if(s.key.isEqual(e.key)){let o=i[r];H5(s,e,o)}}}applyToLocalView(e,t){for(let i of this.baseMutations)i.key.isEqual(e.key)&&(t=Ru(i,e,t,this.localWriteTime));for(let i of this.mutations)i.key.isEqual(e.key)&&(t=Ru(i,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let i=eO();return this.mutations.forEach(r=>{let s=e.get(r.key),o=s.overlayedDocument,a=this.applyToLocalView(o,s.mutatedFields);a=t.has(r.key)?null:a;let c=cO(o,a);c!==null&&i.set(r.key,c),o.isValidDocument()||o.convertToNoDocument(Q.min())}),i}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),ne())}isEqual(e){return this.batchId===e.batchId&&go(this.mutations,e.mutations,(t,i)=>gR(t,i))&&go(this.baseMutations,e.baseMutations,(t,i)=>gR(t,i))}},dw=class n{constructor(e,t,i,r){this.batch=e,this.commitVersion=t,this.mutationResults=i,this.docVersions=r}static from(e,t,i){$(e.mutations.length===i.length);let r=B5(),s=e.mutations;for(let o=0;o<s.length;o++)r=r.insert(s[o].key,i[o].version);return new n(e,t,i,r)}};var Gu=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var hw=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var Dt=function(n){return n[n.OK=0]="OK",n[n.CANCELLED=1]="CANCELLED",n[n.UNKNOWN=2]="UNKNOWN",n[n.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",n[n.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",n[n.NOT_FOUND=5]="NOT_FOUND",n[n.ALREADY_EXISTS=6]="ALREADY_EXISTS",n[n.PERMISSION_DENIED=7]="PERMISSION_DENIED",n[n.UNAUTHENTICATED=16]="UNAUTHENTICATED",n[n.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",n[n.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",n[n.ABORTED=10]="ABORTED",n[n.OUT_OF_RANGE=11]="OUT_OF_RANGE",n[n.UNIMPLEMENTED=12]="UNIMPLEMENTED",n[n.INTERNAL=13]="INTERNAL",n[n.UNAVAILABLE=14]="UNAVAILABLE",n[n.DATA_LOSS=15]="DATA_LOSS",n}(Dt||{});function hO(n){switch(n){case v.OK:return j();case v.CANCELLED:case v.UNKNOWN:case v.DEADLINE_EXCEEDED:case v.RESOURCE_EXHAUSTED:case v.INTERNAL:case v.UNAVAILABLE:case v.UNAUTHENTICATED:return!1;case v.INVALID_ARGUMENT:case v.NOT_FOUND:case v.ALREADY_EXISTS:case v.PERMISSION_DENIED:case v.FAILED_PRECONDITION:case v.ABORTED:case v.OUT_OF_RANGE:case v.UNIMPLEMENTED:case v.DATA_LOSS:return!0;default:return j()}}function t9(n){return hO(n)&&n!==v.ABORTED}function Km(n){if(n===void 0)return Ze("GRPC error has no .code"),v.UNKNOWN;switch(n){case Dt.OK:return v.OK;case Dt.CANCELLED:return v.CANCELLED;case Dt.UNKNOWN:return v.UNKNOWN;case Dt.DEADLINE_EXCEEDED:return v.DEADLINE_EXCEEDED;case Dt.RESOURCE_EXHAUSTED:return v.RESOURCE_EXHAUSTED;case Dt.INTERNAL:return v.INTERNAL;case Dt.UNAVAILABLE:return v.UNAVAILABLE;case Dt.UNAUTHENTICATED:return v.UNAUTHENTICATED;case Dt.INVALID_ARGUMENT:return v.INVALID_ARGUMENT;case Dt.NOT_FOUND:return v.NOT_FOUND;case Dt.ALREADY_EXISTS:return v.ALREADY_EXISTS;case Dt.PERMISSION_DENIED:return v.PERMISSION_DENIED;case Dt.FAILED_PRECONDITION:return v.FAILED_PRECONDITION;case Dt.ABORTED:return v.ABORTED;case Dt.OUT_OF_RANGE:return v.OUT_OF_RANGE;case Dt.UNIMPLEMENTED:return v.UNIMPLEMENTED;case Dt.DATA_LOSS:return v.DATA_LOSS;default:return j()}}var fw=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var T0=null;function fO(){return new F3}function n9(){return new L3("utf-8")}var i9=new Ks([4294967295,4294967295],0);function yR(n){let e=fO().encode(n),t=new TI;return t.update(e),new Uint8Array(t.digest())}function bR(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),i=e.getUint32(4,!0),r=e.getUint32(8,!0),s=e.getUint32(12,!0),o=new Ks([t,i],0),a=new Ks([r,s],0);return[o,a]}var mw=class n{constructor(e,t,i){if(this.bitmap=e,this.padding=t,this.hashCount=i,t<0||t>=8)throw new fo(`Invalid padding: ${t}`);if(i<0)throw new fo(`Invalid hash count: ${i}`);if(e.length>0&&this.hashCount===0)throw new fo(`Invalid hash count: ${i}`);if(e.length===0&&t!==0)throw new fo(`Invalid padding when bitmap length is 0: ${t}`);this.bitCount=e.length*8-t,this.bitCountInInteger=Ks.fromNumber(this.bitCount)}getBitIndex(e,t,i){let r=e.add(t.multiply(Ks.fromNumber(i)));return r.compare(i9)===1&&(r=new Ks([r.getBits(0),r.getBits(1)],0)),r.modulo(this.bitCountInInteger).toNumber()}isBitSet(e){let t=this.bitmap[Math.floor(e/8)],i=e%8;return(t&1<<i)!==0}mightContain(e){if(this.bitCount===0)return!1;let t=yR(e),[i,r]=bR(t);for(let s=0;s<this.hashCount;s++){let o=this.getBitIndex(i,r,s);if(!this.isBitSet(o))return!1}return!0}static create(e,t,i){let r=e%8===0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new n(s,r,t);return i.forEach(a=>o.insert(a)),o}insert(e){if(this.bitCount===0)return;let t=yR(e),[i,r]=bR(t);for(let s=0;s<this.hashCount;s++){let o=this.getBitIndex(i,r,s);this.setBit(o)}}setBit(e){let t=Math.floor(e/8),i=e%8;this.bitmap[t]|=1<<i}},fo=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var Wu=class n{constructor(e,t,i,r,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=i,this.documentUpdates=r,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,i){let r=new Map;return r.set(e,$u.createSynthesizedTargetChangeForCurrentChange(e,t,i)),new n(Q.min(),r,new ze(te),gn(),ne())}},$u=class n{constructor(e,t,i,r,s){this.resumeToken=e,this.current=t,this.addedDocuments=i,this.modifiedDocuments=r,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,i){return new n(i,t,ne(),ne(),ne())}};var mc=class{constructor(e,t,i,r){this.updatedTargetIds=e,this.removedTargetIds=t,this.key=i,this.newDoc=r}},ap=class{constructor(e,t){this.targetId=e,this.existenceFilter=t}},cp=class{constructor(e,t,i=kt.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=i,this.cause=r}},lp=class{constructor(){this.pendingResponses=0,this.documentChanges=_R(),this._resumeToken=kt.EMPTY_BYTE_STRING,this._current=!1,this._hasPendingChanges=!0}get current(){return this._current}get resumeToken(){return this._resumeToken}get isPending(){return this.pendingResponses!==0}get hasPendingChanges(){return this._hasPendingChanges}updateResumeToken(e){e.approximateByteSize()>0&&(this._hasPendingChanges=!0,this._resumeToken=e)}toTargetChange(){let e=ne(),t=ne(),i=ne();return this.documentChanges.forEach((r,s)=>{switch(s){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:i=i.add(r);break;default:j()}}),new $u(this._resumeToken,this._current,e,t,i)}clearPendingChanges(){this._hasPendingChanges=!1,this.documentChanges=_R()}addDocumentChange(e,t){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(e,t)}removeDocumentChange(e){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(e)}recordPendingTargetRequest(){this.pendingResponses+=1}recordTargetResponse(){this.pendingResponses-=1,$(this.pendingResponses>=0)}markCurrent(){this._hasPendingChanges=!0,this._current=!0}},r9="WatchChangeAggregator",pw=class{constructor(e){this.metadataProvider=e,this.targetStates=new Map,this.pendingDocumentUpdates=gn(),this.pendingDocumentTargetMapping=vR(),this.pendingTargetResets=new ze(te)}handleDocumentChange(e){for(let t of e.updatedTargetIds)e.newDoc&&e.newDoc.isFoundDocument()?this.addDocumentToTarget(t,e.newDoc):this.removeDocumentFromTarget(t,e.key,e.newDoc);for(let t of e.removedTargetIds)this.removeDocumentFromTarget(t,e.key,e.newDoc)}handleTargetChange(e){this.forEachTarget(e,t=>{let i=this.ensureTargetState(t);switch(e.state){case 0:this.isActiveTarget(t)&&i.updateResumeToken(e.resumeToken);break;case 1:i.recordTargetResponse(),i.isPending||i.clearPendingChanges(),i.updateResumeToken(e.resumeToken);break;case 2:i.recordTargetResponse(),i.isPending||this.removeTarget(t);break;case 3:this.isActiveTarget(t)&&(i.markCurrent(),i.updateResumeToken(e.resumeToken));break;case 4:this.isActiveTarget(t)&&(this.resetTarget(t),i.updateResumeToken(e.resumeToken));break;default:j()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.targetStates.forEach((i,r)=>{this.isActiveTarget(r)&&t(r)})}handleExistenceFilter(e){let t=e.targetId,i=e.existenceFilter.count,r=this.targetDataForActiveTarget(t);if(r){let s=r.target;if(sp(s))if(i===0){let o=new L(s.path);this.removeDocumentFromTarget(t,o,_t.newNoDocument(o,Q.min()))}else $(i===1);else{let o=this.getCurrentDocumentCountForTarget(t);if(o!==i){let a=this.parseBloomFilter(e),c=a?this.applyBloomFilter(a,e,o):1;if(c!==0){this.resetTarget(t);let l=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.pendingTargetResets=this.pendingTargetResets.insert(t,l)}T0?.notifyOnExistenceFilterMismatch(s9(o,e.existenceFilter,this.metadataProvider.getDatabaseId(),a,c))}}}}parseBloomFilter(e){let t=e.existenceFilter.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:i="",padding:r=0},hashCount:s=0}=t,o;try{o=ws(i).toUint8Array()}catch(c){if(c instanceof fw)return Wn("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}let a;try{a=new mw(o,r,s)}catch(c){return c instanceof fo?Wn("BloomFilter error: ",c):Wn("Applying bloom filter failed: ",c),null}return a.bitCount===0?null:a}applyBloomFilter(e,t,i){let r=t.existenceFilter.count,s=this.filterRemovedDocuments(e,t.targetId);return r===i-s?0:2}filterRemovedDocuments(e,t){let i=this.metadataProvider.getRemoteKeysForTarget(t),r=0;return i.forEach(s=>{let o=this.metadataProvider.getDatabaseId(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.removeDocumentFromTarget(t,s,null),r++)}),r}createRemoteEvent(e){let t=new Map;this.targetStates.forEach((s,o)=>{let a=this.targetDataForActiveTarget(o);if(a){if(s.current&&sp(a.target)){let c=new L(a.target.path);this.pendingDocumentUpdates.get(c)===null&&!this.targetContainsDocument(o,c)&&this.removeDocumentFromTarget(o,c,_t.newNoDocument(c,e))}s.hasPendingChanges&&(t.set(o,s.toTargetChange()),s.clearPendingChanges())}});let i=ne();this.pendingDocumentTargetMapping.forEach((s,o)=>{let a=!0;o.forEachWhile(c=>{let l=this.targetDataForActiveTarget(c);return l&&l.purpose!=="TargetPurposeLimboResolution"?(a=!1,!1):!0}),a&&(i=i.add(s))}),this.pendingDocumentUpdates.forEach((s,o)=>o.setReadTime(e));let r=new Wu(e,t,this.pendingTargetResets,this.pendingDocumentUpdates,i);return this.pendingDocumentUpdates=gn(),this.pendingDocumentTargetMapping=vR(),this.pendingTargetResets=new ze(te),r}addDocumentToTarget(e,t){if(!this.isActiveTarget(e))return;let i=this.targetContainsDocument(e,t.key)?2:0;this.ensureTargetState(e).addDocumentChange(t.key,i),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t.key,t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t.key,this.ensureDocumentTargetMapping(t.key).add(e))}removeDocumentFromTarget(e,t,i){if(!this.isActiveTarget(e))return;let r=this.ensureTargetState(e);this.targetContainsDocument(e,t)?r.addDocumentChange(t,1):r.removeDocumentChange(t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,this.ensureDocumentTargetMapping(t).delete(e)),i&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t,i))}removeTarget(e){this.targetStates.delete(e)}getCurrentDocumentCountForTarget(e){let i=this.ensureTargetState(e).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(e).size+i.addedDocuments.size-i.removedDocuments.size}recordPendingTargetRequest(e){this.ensureTargetState(e).recordPendingTargetRequest()}ensureTargetState(e){let t=this.targetStates.get(e);return t||(t=new lp,this.targetStates.set(e,t)),t}ensureDocumentTargetMapping(e){let t=this.pendingDocumentTargetMapping.get(e);return t||(t=new Ne(te),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e,t)),t}isActiveTarget(e){let t=this.targetDataForActiveTarget(e)!==null;return t||R(r9,"Detected inactive target",e),t}targetDataForActiveTarget(e){let t=this.targetStates.get(e);return t&&t.isPending?null:this.metadataProvider.getTargetDataForTarget(e)}resetTarget(e){this.targetStates.set(e,new lp),this.metadataProvider.getRemoteKeysForTarget(e).forEach(i=>{this.removeDocumentFromTarget(e,i,null)})}targetContainsDocument(e,t){return this.metadataProvider.getRemoteKeysForTarget(e).has(t)}};function vR(){return new ze(L.comparator)}function _R(){return new ze(L.comparator)}function s9(n,e,t,i,r){var s,o,a,c,l,u;let d={localCacheCount:n,existenceFilterCount:e.count,databaseId:t.database,projectId:t.projectId},h=e.unchangedNames;return h&&(d.bloomFilter={applied:r===0,hashCount:(s=h?.hashCount)!==null&&s!==void 0?s:0,bitmapLength:(c=(a=(o=h?.bits)===null||o===void 0?void 0:o.bitmap)===null||a===void 0?void 0:a.length)!==null&&c!==void 0?c:0,padding:(u=(l=h?.bits)===null||l===void 0?void 0:l.padding)!==null&&u!==void 0?u:0,mightContain:m=>{var g;return(g=i?.mightContain(m))!==null&&g!==void 0?g:!1}}),d}var o9=(()=>{let n={};return n.asc="ASCENDING",n.desc="DESCENDING",n})(),a9=(()=>{let n={};return n["<"]="LESS_THAN",n["<="]="LESS_THAN_OR_EQUAL",n[">"]="GREATER_THAN",n[">="]="GREATER_THAN_OR_EQUAL",n["=="]="EQUAL",n["!="]="NOT_EQUAL",n["array-contains"]="ARRAY_CONTAINS",n.in="IN",n["not-in"]="NOT_IN",n["array-contains-any"]="ARRAY_CONTAINS_ANY",n})(),c9=(()=>{let n={};return n.and="AND",n.or="OR",n})();var gw=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function l9(n){let e=n.code===void 0?v.UNKNOWN:Km(n.code);return new x(e,n.message||"")}function yw(n,e){return n.useProto3Json||cd(e)?e:{value:e}}function u9(n){let e;return typeof n=="object"?e=n.value:e=n,cd(e)?null:e}function Cc(n,e){if(n.useProto3Json){let i=new Date(e.seconds*1e3).toISOString().replace(/\.\d*/,"").replace("Z",""),r=("000000000"+e.nanoseconds).slice(-9);return`${i}.${r}Z`}else return{seconds:""+e.seconds,nanos:e.nanoseconds}}function d9(n){let e=Sr(n);return new Je(e.seconds,e.nanos)}function mO(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function h9(n,e){return n.useProto3Json?($(e===void 0||typeof e=="string"),kt.fromBase64String(e||"")):($(e===void 0||e instanceof Buffer||e instanceof Uint8Array),kt.fromUint8Array(e||new Uint8Array))}function f9(n,e){return Cc(n,e.toTimestamp())}function ft(n){return $(!!n),Q.fromTimestamp(d9(n))}function HC(n,e){return bw(n,e).canonicalString()}function bw(n,e){let t=m9(n).child("documents");return e===void 0?t:t.child(e)}function pO(n){let e=_e.fromString(n);return $(TO(e)),e}function Hu(n,e){return HC(n.databaseId,e.path)}function Yi(n,e){let t=pO(e);if(t.get(1)!==n.databaseId.projectId)throw new x(v.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new x(v.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new L(bO(t))}function gO(n,e){return HC(n.databaseId,e)}function yO(n){let e=pO(n);return e.length===4?_e.emptyPath():bO(e)}function vw(n){return new _e(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function m9(n){return new _e(["projects",n.projectId,"databases",n.database])}function bO(n){return $(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function wR(n,e,t){return{name:Hu(n,e),fields:t.value.mapValue.fields}}function p9(n,e){return{name:Hu(n,e.key),fields:e.data.value.mapValue.fields,updateTime:Cc(n,e.version.toTimestamp()),createTime:Cc(n,e.createTime.toTimestamp())}}function vO(n,e,t){let i=Yi(n,e.name),r=ft(e.updateTime),s=e.createTime?ft(e.createTime):Q.min(),o=new Kt({mapValue:{fields:e.fields}}),a=_t.newFoundDocument(i,r,s,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function g9(n,e){$(!!e.found),e.found.name,e.found.updateTime;let t=Yi(n,e.found.name),i=ft(e.found.updateTime),r=e.found.createTime?ft(e.found.createTime):Q.min(),s=new Kt({mapValue:{fields:e.found.fields}});return _t.newFoundDocument(t,i,r,s)}function y9(n,e){$(!!e.missing),$(!!e.readTime);let t=Yi(n,e.missing),i=ft(e.readTime);return _t.newNoDocument(t,i)}function b9(n,e){return"found"in e?g9(n,e):"missing"in e?y9(n,e):j()}function v9(n,e){let t;if("targetChange"in e){e.targetChange;let i=_9(e.targetChange.targetChangeType||"NO_CHANGE"),r=e.targetChange.targetIds||[],s=h9(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&l9(o);t=new cp(i,r,s,a||null)}else if("documentChange"in e){e.documentChange;let i=e.documentChange;i.document,i.document.name,i.document.updateTime;let r=Yi(n,i.document.name),s=ft(i.document.updateTime),o=i.document.createTime?ft(i.document.createTime):Q.min(),a=new Kt({mapValue:{fields:i.document.fields}}),c=_t.newFoundDocument(r,s,o,a),l=i.targetIds||[],u=i.removedTargetIds||[];t=new mc(l,u,c.key,c)}else if("documentDelete"in e){e.documentDelete;let i=e.documentDelete;i.document;let r=Yi(n,i.document),s=i.readTime?ft(i.readTime):Q.min(),o=_t.newNoDocument(r,s),a=i.removedTargetIds||[];t=new mc([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;let i=e.documentRemove;i.document;let r=Yi(n,i.document),s=i.removedTargetIds||[];t=new mc([],s,r,null)}else if("filter"in e){e.filter;let i=e.filter;i.targetId;let{count:r=0,unchangedNames:s}=i,o=new hw(r,s),a=i.targetId;t=new ap(a,o)}else return j();return t}function _9(n){return n==="NO_CHANGE"?0:n==="ADD"?1:n==="REMOVE"?2:n==="CURRENT"?3:n==="RESET"?4:j()}function w9(n){if(!("targetChange"in n))return Q.min();let e=n.targetChange;return e.targetIds&&e.targetIds.length||!e.readTime?Q.min():ft(e.readTime)}function Ku(n,e){let t;if(e instanceof xs)t={update:wR(n,e.key,e.value)};else if(e instanceof Is)t={delete:Hu(n,e.key)};else if(e instanceof yi)t={update:wR(n,e.key,e.data),updateMask:eG(e.fieldMask)};else if(e instanceof qu)t={verify:Hu(n,e.key)};else return j();return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(i=>x9(n,i))),e.precondition.isNone||(t.currentDocument=C9(n,e.precondition)),t}function _w(n,e){let t=e.currentDocument?E9(e.currentDocument):st.none(),i=e.updateTransforms?e.updateTransforms.map(r=>I9(n,r)):[];if(e.update){e.update.name;let r=Yi(n,e.update.name),s=new Kt({mapValue:{fields:e.update.fields}});if(e.updateMask){let o=tG(e.updateMask);return new yi(r,s,o,t,i)}else return new xs(r,s,t,i)}else if(e.delete){let r=Yi(n,e.delete);return new Is(r,t)}else if(e.verify){let r=Yi(n,e.verify);return new qu(r,t)}else return j()}function C9(n,e){return e.updateTime!==void 0?{updateTime:f9(n,e.updateTime)}:e.exists!==void 0?{exists:e.exists}:j()}function E9(n){return n.updateTime!==void 0?st.updateTime(ft(n.updateTime)):n.exists!==void 0?st.exists(n.exists):st.none()}function S9(n,e){let t=n.updateTime?ft(n.updateTime):ft(e);return t.isEqual(Q.min())&&(t=ft(e)),new uw(t,n.transformResults||[])}function T9(n,e){return n&&n.length>0?($(e!==void 0),n.map(t=>S9(t,e))):[]}function x9(n,e){let t=e.transform;if(t instanceof Ss)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(t instanceof Tr)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:t.elements}};if(t instanceof xr)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:t.elements}};if(t instanceof Ts)return{fieldPath:e.field.canonicalString(),increment:t.operand};throw j()}function I9(n,e){let t=null;if("setToServerValue"in e)$(e.setToServerValue==="REQUEST_TIME"),t=new Ss;else if("appendMissingElements"in e){let r=e.appendMissingElements.values||[];t=new Tr(r)}else if("removeAllFromArray"in e){let r=e.removeAllFromArray.values||[];t=new xr(r)}else"increment"in e?t=new Ts(n,e.increment):j();let i=mt.fromServerFormat(e.fieldPath);return new Co(i,t)}function _O(n,e){return{documents:[gO(n,e.path)]}}function A9(n){let e=n.documents.length;$(e===1);let t=n.documents[0];return an(Fc(yO(t)))}function wO(n,e){let t={structuredQuery:{}},i=e.path,r;e.collectionGroup!==null?(r=i,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(r=i.popLast(),t.structuredQuery.from=[{collectionId:i.lastSegment()}]),t.parent=gO(n,r);let s=O9(e.filters);s&&(t.structuredQuery.where=s);let o=N9(e.orderBy);o&&(t.structuredQuery.orderBy=o);let a=yw(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=L9(e.startAt)),e.endAt&&(t.structuredQuery.endAt=B9(e.endAt)),{queryTarget:t,parent:r}}function CO(n){let e=yO(n.parent),t=n.structuredQuery,i=t.from?t.from.length:0,r=null;if(i>0){$(i===1);let u=t.from[0];u.allDescendants?r=u.collectionId:e=e.child(u.collectionId)}let s=[];t.where&&(s=P9(t.where));let o=[];t.orderBy&&(o=F9(t.orderBy));let a=null;t.limit&&(a=u9(t.limit));let c=null;t.startAt&&(c=V9(t.startAt));let l=null;return t.endAt&&(l=U9(t.endAt)),KM(e,r,o,s,a,"F",c,l)}function D9(n){return an(CO(n))}function k9(n,e){let t=R9(e.purpose);return t==null?null:{"goog-listen-tags":t}}function R9(n){switch(n){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return j()}}function M9(n,e){let t,i=e.target;if(sp(i)?t={documents:_O(n,i)}:t={query:wO(n,i).queryTarget},t.targetId=e.targetId,e.resumeToken.approximateByteSize()>0){t.resumeToken=mO(n,e.resumeToken);let r=yw(n,e.expectedCount);r!==null&&(t.expectedCount=r)}else if(e.snapshotVersion.compareTo(Q.min())>0){t.readTime=Cc(n,e.snapshotVersion.toTimestamp());let r=yw(n,e.expectedCount);r!==null&&(t.expectedCount=r)}return t}function O9(n){if(n.length!==0)return SO(ke.create(n,"and"))}function P9(n){let e=EO(n);return e instanceof ke&&zC(e)?e.getFilters():[e]}function EO(n){return n.unaryFilter!==void 0?X9(n):n.fieldFilter!==void 0?Z9(n):n.compositeFilter!==void 0?J9(n):j()}function N9(n){if(n.length!==0)return n.map(e=>H9(e))}function F9(n){return n.map(e=>K9(e))}function L9(n){return{before:n.inclusive,values:n.position}}function B9(n){return{before:!n.inclusive,values:n.position}}function V9(n){let e=!!n.before,t=n.values||[];return new Zi(t,e)}function U9(n){let e=!n.before,t=n.values||[];return new Zi(t,e)}function j9(n){return o9[n]}function q9(n){switch(n){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}function z9(n){return a9[n]}function G9(n){return c9[n]}function W9(n){switch(n){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return j();default:return j()}}function $9(n){switch(n){case"AND":return"and";case"OR":return"or";default:return j()}}function cc(n){return{fieldPath:n.canonicalString()}}function dc(n){return mt.fromServerFormat(n.fieldPath)}function H9(n){return{field:cc(n.field),direction:j9(n.dir)}}function K9(n){return new _o(dc(n.field),q9(n.direction))}function SO(n){return n instanceof ge?Y9(n):n instanceof ke?Q9(n):j()}function Q9(n){let e=n.getFilters().map(t=>SO(t));return e.length===1?e[0]:{compositeFilter:{op:G9(n.op),filters:e}}}function Y9(n){if(n.op==="=="){if(uR(n.value))return{unaryFilter:{field:cc(n.field),op:"IS_NAN"}};if(lR(n.value))return{unaryFilter:{field:cc(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(uR(n.value))return{unaryFilter:{field:cc(n.field),op:"IS_NOT_NAN"}};if(lR(n.value))return{unaryFilter:{field:cc(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:cc(n.field),op:z9(n.op),value:n.value}}}function X9(n){switch(n.unaryFilter.op){case"IS_NAN":let e=dc(n.unaryFilter.field);return ge.create(e,"==",{doubleValue:NaN});case"IS_NULL":let t=dc(n.unaryFilter.field);return ge.create(t,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let i=dc(n.unaryFilter.field);return ge.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let r=dc(n.unaryFilter.field);return ge.create(r,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return j();default:return j()}}function Z9(n){return ge.create(dc(n.fieldFilter.field),W9(n.fieldFilter.op),n.fieldFilter.value)}function J9(n){return ke.create(n.compositeFilter.filters.map(e=>EO(e)),$9(n.compositeFilter.op))}function eG(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function tG(n){let e=n.fieldPaths||[];return new Tn(e.map(t=>mt.fromServerFormat(t)))}function TO(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var Ec=class n{constructor(e,t,i,r,s=Q.min(),o=Q.min(),a=kt.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=t,this.purpose=i,this.sequenceNumber=r,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=c}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var up=class{constructor(e){this.remoteSerializer=e}};function nG(n,e){let t;if(e.document)t=vO(n.remoteSerializer,e.document,!!e.hasCommittedMutations);else if(e.noDocument){let i=L.fromSegments(e.noDocument.path),r=So(e.noDocument.readTime);t=_t.newNoDocument(i,r),e.hasCommittedMutations&&t.setHasCommittedMutations()}else if(e.unknownDocument){let i=L.fromSegments(e.unknownDocument.path),r=So(e.unknownDocument.version);t=_t.newUnknownDocument(i,r)}else return j();return e.readTime&&t.setReadTime(iG(e.readTime)),t}function CR(n,e){let t=e.key,i={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Xp(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())i.document=p9(n.remoteSerializer,e);else if(e.isNoDocument())i.noDocument={path:t.path.toArray(),readTime:Eo(e.version)};else if(e.isUnknownDocument())i.unknownDocument={path:t.path.toArray(),version:Eo(e.version)};else return j();return i}function Xp(n){let e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function iG(n){let e=new Je(n[0],n[1]);return Q.fromTimestamp(e)}function Eo(n){let e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function So(n){let e=new Je(n.seconds,n.nanoseconds);return Q.fromTimestamp(e)}function rG(n,e,t){let i=t.baseMutations.map(s=>Ku(n.remoteSerializer,s)),r=t.mutations.map(s=>Ku(n.remoteSerializer,s));return{userId:e,batchId:t.batchId,localWriteTimeMs:t.localWriteTime.toMillis(),baseMutations:i,mutations:r}}function co(n,e){let t=(e.baseMutations||[]).map(s=>_w(n.remoteSerializer,s));for(let s=0;s<e.mutations.length-1;++s){let o=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){let c=e.mutations[s+1];o.updateTransforms=c.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}let i=e.mutations.map(s=>_w(n.remoteSerializer,s)),r=Je.fromMillis(e.localWriteTimeMs);return new zu(e.batchId,r,t,i)}function Iu(n){let e=So(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?So(n.lastLimboFreeSnapshotVersion):Q.min(),i;return sG(n.query)?i=A9(n.query):i=D9(n.query),new Ec(i,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,kt.fromBase64String(n.resumeToken))}function xO(n,e){let t=Eo(e.snapshotVersion),i=Eo(e.lastLimboFreeSnapshotVersion),r;sp(e.target)?r=_O(n.remoteSerializer,e.target):r=wO(n.remoteSerializer,e.target).queryTarget;let s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:wo(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:i,query:r}}function sG(n){return n.documents!==void 0}function oG(n){return{id:n.bundleId,createTime:So(n.createTime),version:n.version}}function aG(n){return{bundleId:n.id,createTime:Eo(ft(n.createTime)),version:n.version}}function cG(n){return{name:n.name,query:KC(n.bundledQuery),readTime:So(n.readTime)}}function lG(n){return{name:n.name,readTime:Eo(ft(n.readTime)),bundledQuery:n.bundledQuery}}function KC(n){let e=CO({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?op(e,e.limit,"L"):e}function uG(n){return{name:n.name,query:KC(n.bundledQuery),readTime:ft(n.readTime)}}function dG(n){return{id:n.id,version:n.version,createTime:ft(n.createTime)}}function x0(n,e){return new Gu(e.largestBatchId,_w(n.remoteSerializer,e.overlayMutation))}function hG(n,e,t){let[i,r,s]=IO(e,t.mutation.key);return{userId:e,collectionPath:r,documentId:s,collectionGroup:t.mutation.key.getCollectionGroup(),largestBatchId:t.largestBatchId,overlayMutation:Ku(n.remoteSerializer,t.mutation)}}function IO(n,e){let t=e.path.lastSegment(),i=on(e.path.popLast());return[n,i,t]}function fG(n){return{indexId:n.indexId,collectionGroup:n.collectionGroup,fields:n.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])}}function mG(n,e){let t=e?new Pu(e.sequenceNumber,new $n(So(e.readTime),new L(Ki(e.documentKey)),e.largestBatchId)):Pu.empty(),i=n.fields.map(([r,s])=>new hc(mt.fromServerFormat(r),s));return new j0(n.indexId,n.collectionGroup,i,t)}function ER(n,e,t,i){return{indexId:n,uid:e,sequenceNumber:t,readTime:Eo(i.readTime),documentKey:on(i.documentKey.path),largestBatchId:i.largestBatchId}}var ww=class{getBundleMetadata(e,t){return SR(e).get(t).next(i=>{if(i)return oG(i)})}saveBundleMetadata(e,t){return SR(e).put(aG(t))}getNamedQuery(e,t){return TR(e).get(t).next(i=>{if(i)return cG(i)})}saveNamedQuery(e,t){return TR(e).put(lG(t))}};function SR(n){return Rt(n,zp)}function TR(n){return Rt(n,Gp)}var dp=class n{constructor(e,t){this.serializer=e,this.userId=t}static forUser(e,t){let i=t.uid||"";return new n(e,i)}getOverlay(e,t){return Cu(e).get(IO(this.userId,t)).next(i=>i?x0(this.serializer,i):null)}getOverlays(e,t){let i=Qi();return b.forEach(t,r=>this.getOverlay(e,r).next(s=>{s!==null&&i.set(r,s)})).next(()=>i)}saveOverlays(e,t,i){let r=[];return i.forEach((s,o)=>{let a=new Gu(t,o);r.push(this.saveOverlay(e,a))}),b.waitFor(r)}removeOverlaysForBatchId(e,t,i){let r=new Set;t.forEach(o=>r.add(on(o.getCollectionPath())));let s=[];return r.forEach(o=>{let a=IDBKeyRange.bound([this.userId,o,i],[this.userId,o,i+1],!1,!0);s.push(Cu(e).deleteAll(Q0,a))}),b.waitFor(s)}getOverlaysForCollection(e,t,i){let r=Qi(),s=on(t),o=IDBKeyRange.bound([this.userId,s,i],[this.userId,s,Number.POSITIVE_INFINITY],!0);return Cu(e).loadAll(Q0,o).next(a=>{for(let c of a){let l=x0(this.serializer,c);r.set(l.getKey(),l)}return r})}getOverlaysForCollectionGroup(e,t,i,r){let s=Qi(),o,a=IDBKeyRange.bound([this.userId,t,i],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Cu(e).iterate({index:TM,range:a},(c,l,u)=>{let d=x0(this.serializer,l);s.size()<r||d.largestBatchId===o?(s.set(d.getKey(),d),o=d.largestBatchId):u.done()}).next(()=>s)}saveOverlay(e,t){return Cu(e).put(hG(this.serializer,this.userId,t))}};function Cu(n){return Rt(n,Hp)}var pG=5,gG=10,yG=13,xR=15,bG=20,vG=25,_G=30,wG=37,CG=45,EG=50,SG=55,TG=60,xG=2,Cr=class{constructor(){}writeIndexValue(e,t){this.writeIndexValueAux(e,t),t.writeInfinity()}writeIndexValueAux(e,t){if("nullValue"in e)this.writeValueTypeLabel(t,pG);else if("booleanValue"in e)this.writeValueTypeLabel(t,gG),t.writeNumber(e.booleanValue?1:0);else if("integerValue"in e)this.writeValueTypeLabel(t,xR),t.writeNumber(ot(e.integerValue));else if("doubleValue"in e){let i=ot(e.doubleValue);isNaN(i)?this.writeValueTypeLabel(t,yG):(this.writeValueTypeLabel(t,xR),Bu(i)?t.writeNumber(0):t.writeNumber(i))}else if("timestampValue"in e){let i=e.timestampValue;this.writeValueTypeLabel(t,bG),typeof i=="string"&&(i=Sr(i)),t.writeString(`${i.seconds||""}`),t.writeNumber(i.nanos||0)}else if("stringValue"in e)this.writeIndexString(e.stringValue,t),this.writeTruncationMarker(t);else if("bytesValue"in e)this.writeValueTypeLabel(t,_G),t.writeBytes(ws(e.bytesValue)),this.writeTruncationMarker(t);else if("referenceValue"in e)this.writeIndexEntityRef(e.referenceValue,t);else if("geoPointValue"in e){let i=e.geoPointValue;this.writeValueTypeLabel(t,CG),t.writeNumber(i.latitude||0),t.writeNumber(i.longitude||0)}else"mapValue"in e?BM(e)?this.writeValueTypeLabel(t,Number.MAX_SAFE_INTEGER):(this.writeIndexMap(e.mapValue,t),this.writeTruncationMarker(t)):"arrayValue"in e?(this.writeIndexArray(e.arrayValue,t),this.writeTruncationMarker(t)):j()}writeIndexString(e,t){this.writeValueTypeLabel(t,vG),this.writeUnlabeledIndexString(e,t)}writeUnlabeledIndexString(e,t){t.writeString(e)}writeIndexMap(e,t){let i=e.fields||{};this.writeValueTypeLabel(t,SG);for(let r of Object.keys(i))this.writeIndexString(r,t),this.writeIndexValueAux(i[r],t)}writeIndexArray(e,t){let i=e.values||[];this.writeValueTypeLabel(t,EG);for(let r of i)this.writeIndexValueAux(r,t)}writeIndexEntityRef(e,t){this.writeValueTypeLabel(t,wG),L.fromName(e).path.forEach(r=>{this.writeValueTypeLabel(t,TG),this.writeUnlabeledIndexString(r,t)})}writeValueTypeLabel(e,t){e.writeNumber(t)}writeTruncationMarker(e){e.writeNumber(xG)}};Cr.INSTANCE=new Cr;var IR="\uD800",AR="\uDBFF",tc=0,DR=255,kR=1,nc=255,RR=255,MR=0,IG=64,AG=8,DG=1024;function kG(n){let e=new DataView(new ArrayBuffer(8));return e.setFloat64(0,n,!1),new Uint8Array(e.buffer)}function RG(n){if(n===0)return 8;let e=0;return n>>4||(e+=4,n=n<<4),n>>6||(e+=2,n=n<<2),n>>7||(e+=1),e}function MG(n){let e=0;for(let t=0;t<8;++t){let i=RG(n[t]&255);if(e+=i,i!==8)break}return e}function OR(n){let e=IG-MG(n);return Math.ceil(e/AG)}var Cw=class{constructor(){this.buffer=new Uint8Array(DG),this.position=0}writeBytesAscending(e){let t=e[Symbol.iterator](),i=t.next();for(;!i.done;)this.writeByteAscending(i.value),i=t.next();this.writeSeparatorAscending()}writeBytesDescending(e){let t=e[Symbol.iterator](),i=t.next();for(;!i.done;)this.writeByteDescending(i.value),i=t.next();this.writeSeparatorDescending()}writeUtf8Ascending(e){for(let t of e){let i=t.charCodeAt(0);if(i<128)this.writeByteAscending(i);else if(i<2048)this.writeByteAscending(960|i>>>6),this.writeByteAscending(128|63&i);else if(t<IR||AR<t)this.writeByteAscending(480|i>>>12),this.writeByteAscending(128|63&i>>>6),this.writeByteAscending(128|63&i);else{let r=t.codePointAt(0);this.writeByteAscending(240|r>>>18),this.writeByteAscending(128|63&r>>>12),this.writeByteAscending(128|63&r>>>6),this.writeByteAscending(128|63&r)}}this.writeSeparatorAscending()}writeUtf8Descending(e){for(let t of e){let i=t.charCodeAt(0);if(i<128)this.writeByteDescending(i);else if(i<2048)this.writeByteDescending(960|i>>>6),this.writeByteDescending(128|63&i);else if(t<IR||AR<t)this.writeByteDescending(480|i>>>12),this.writeByteDescending(128|63&i>>>6),this.writeByteDescending(128|63&i);else{let r=t.codePointAt(0);this.writeByteDescending(240|r>>>18),this.writeByteDescending(128|63&r>>>12),this.writeByteDescending(128|63&r>>>6),this.writeByteDescending(128|63&r)}}this.writeSeparatorDescending()}writeNumberAscending(e){let t=this.toOrderedBits(e),i=OR(t);this.ensureAvailable(1+i),this.buffer[this.position++]=i&255;for(let r=t.length-i;r<t.length;++r)this.buffer[this.position++]=t[r]&255}writeNumberDescending(e){let t=this.toOrderedBits(e),i=OR(t);this.ensureAvailable(1+i),this.buffer[this.position++]=~(i&255);for(let r=t.length-i;r<t.length;++r)this.buffer[this.position++]=~(t[r]&255)}writeInfinityAscending(){this.writeEscapedByteAscending(nc),this.writeEscapedByteAscending(RR)}writeInfinityDescending(){this.writeEscapedByteDescending(nc),this.writeEscapedByteDescending(RR)}reset(){this.position=0}seed(e){this.ensureAvailable(e.length),this.buffer.set(e,this.position),this.position+=e.length}encodedBytes(){return this.buffer.slice(0,this.position)}toOrderedBits(e){let t=kG(e),i=(t[0]&128)!==0;t[0]^=i?255:128;for(let r=1;r<t.length;++r)t[r]^=i?255:0;return t}writeByteAscending(e){let t=e&255;t===tc?(this.writeEscapedByteAscending(tc),this.writeEscapedByteAscending(DR)):t===nc?(this.writeEscapedByteAscending(nc),this.writeEscapedByteAscending(MR)):this.writeEscapedByteAscending(t)}writeByteDescending(e){let t=e&255;t===tc?(this.writeEscapedByteDescending(tc),this.writeEscapedByteDescending(DR)):t===nc?(this.writeEscapedByteDescending(nc),this.writeEscapedByteDescending(MR)):this.writeEscapedByteDescending(e)}writeSeparatorAscending(){this.writeEscapedByteAscending(tc),this.writeEscapedByteAscending(kR)}writeSeparatorDescending(){this.writeEscapedByteDescending(tc),this.writeEscapedByteDescending(kR)}writeEscapedByteAscending(e){this.ensureAvailable(1),this.buffer[this.position++]=e}writeEscapedByteDescending(e){this.ensureAvailable(1),this.buffer[this.position++]=~e}ensureAvailable(e){let t=e+this.position;if(t<=this.buffer.length)return;let i=this.buffer.length*2;i<t&&(i=t);let r=new Uint8Array(i);r.set(this.buffer),this.buffer=r}},Ew=class{constructor(e){this.orderedCode=e}writeBytes(e){this.orderedCode.writeBytesAscending(e)}writeString(e){this.orderedCode.writeUtf8Ascending(e)}writeNumber(e){this.orderedCode.writeNumberAscending(e)}writeInfinity(){this.orderedCode.writeInfinityAscending()}},Sw=class{constructor(e){this.orderedCode=e}writeBytes(e){this.orderedCode.writeBytesDescending(e)}writeString(e){this.orderedCode.writeUtf8Descending(e)}writeNumber(e){this.orderedCode.writeNumberDescending(e)}writeInfinity(){this.orderedCode.writeInfinityDescending()}},lo=class{constructor(){this.orderedCode=new Cw,this.ascending=new Ew(this.orderedCode),this.descending=new Sw(this.orderedCode)}seed(e){this.orderedCode.seed(e)}forKind(e){return e===0?this.ascending:this.descending}encodedBytes(){return this.orderedCode.encodedBytes()}reset(){this.orderedCode.reset()}};var uo=class n{constructor(e,t,i,r){this.indexId=e,this.documentKey=t,this.arrayValue=i,this.directionalValue=r}successor(){let e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,i=new Uint8Array(t);return i.set(this.directionalValue,0),t!==e?i.set([0],this.directionalValue.length):++i[i.length-1],new n(this.indexId,this.documentKey,this.arrayValue,i)}};function fs(n,e){let t=n.indexId-e.indexId;return t!==0||(t=PR(n.arrayValue,e.arrayValue),t!==0)||(t=PR(n.directionalValue,e.directionalValue),t!==0)?t:L.comparator(n.documentKey,e.documentKey)}function PR(n,e){for(let t=0;t<n.length&&t<e.length;++t){let i=n[t]-e[t];if(i!==0)return i}return n.length-e.length}var hp=class{constructor(e){this.inequalityFilters=new Ne((t,i)=>mt.comparator(t.field,i.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.orderBys=e.orderBy,this.equalityFilters=[];for(let t of e.filters){let i=t;i.isInequality()?this.inequalityFilters=this.inequalityFilters.add(i):this.equalityFilters.push(i)}}get hasMultipleInequality(){return this.inequalityFilters.size>1}servedByIndex(e){if($(e.collectionGroup===this.collectionId),this.hasMultipleInequality)return!1;let t=FC(e);if(t!==void 0&&!this.hasMatchingEqualityFilter(t))return!1;let i=yo(e),r=new Set,s=0,o=0;for(;s<i.length&&this.hasMatchingEqualityFilter(i[s]);++s)r=r.add(i[s].fieldPath.canonicalString());if(s===i.length)return!0;if(this.inequalityFilters.size>0){let a=this.inequalityFilters.getIterator().getNext();if(!r.has(a.field.canonicalString())){let c=i[s];if(!this.matchesFilter(a,c)||!this.matchesOrderBy(this.orderBys[o++],c))return!1}++s}for(;s<i.length;++s){let a=i[s];if(o>=this.orderBys.length||!this.matchesOrderBy(this.orderBys[o++],a))return!1}return!0}buildTargetIndex(){if(this.hasMultipleInequality)return null;let e=new Ne(mt.comparator),t=[];for(let i of this.equalityFilters){if(i.field.isKeyField())continue;if(i.op==="array-contains"||i.op==="array-contains-any")t.push(new hc(i.field,2));else{if(e.has(i.field))continue;e=e.add(i.field),t.push(new hc(i.field,0))}}for(let i of this.orderBys)i.field.isKeyField()||e.has(i.field)||(e=e.add(i.field),t.push(new hc(i.field,i.dir==="asc"?0:1)));return new j0(j0.UNKNOWN_ID,this.collectionId,t,Pu.empty())}hasMatchingEqualityFilter(e){for(let t of this.equalityFilters)if(this.matchesFilter(t,e))return!0;return!1}matchesFilter(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;let i=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===i}matchesOrderBy(e,t){return e.field.isEqual(t.fieldPath)?t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc":!1}};function AO(n){var e,t;if($(n instanceof ge||n instanceof ke),n instanceof ge)if(n instanceof rp){let r=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(s=>ge.create(n.field,"==",s)))||[];return ke.create(r,"or")}else return n;let i=n.filters.map(r=>AO(r));return ke.create(i,n.op)}function OG(n){if(n.getFilters().length===0)return[];let e=Tw(AO(n));return $(DO(e)),QC(e)||YC(e)?[e]:e.getFilters()}function QC(n){return n instanceof ge}function YC(n){return n instanceof ke&&zC(n)}function DO(n){return QC(n)||YC(n)||PG(n)}function PG(n){if(n instanceof ke&&ew(n)){for(let e of n.getFilters())if(!QC(e)&&!YC(e))return!1;return!0}return!1}function Tw(n){if($(n instanceof ge||n instanceof ke),n instanceof ge)return n;if(n.filters.length===1)return Tw(n.filters[0]);let e=n.filters.map(i=>Tw(i)),t=ke.create(e,n.op);return t=fp(t),DO(t)?t:($(t instanceof ke),$(bc(t)),$(t.filters.length>1),t.filters.reduce((i,r)=>XC(i,r)))}function XC(n,e){$(n instanceof ge||n instanceof ke),$(e instanceof ge||e instanceof ke);let t;return n instanceof ge?e instanceof ge?t=NG(n,e):t=NR(n,e):e instanceof ge?t=NR(e,n):t=FG(n,e),fp(t)}function NG(n,e){return ke.create([n,e],"and")}function FG(n,e){if($(n.filters.length>0&&e.filters.length>0),bc(n)&&bc(e))return zM(n,e.getFilters());let t=ew(n)?n:e,i=ew(n)?e:n,r=t.filters.map(s=>XC(s,i));return ke.create(r,"or")}function NR(n,e){if(bc(e))return zM(e,n.getFilters());{let t=e.filters.map(i=>XC(n,i));return ke.create(t,"or")}}function fp(n){if($(n instanceof ge||n instanceof ke),n instanceof ge)return n;let e=n.getFilters();if(e.length===1)return fp(e[0]);if(jM(n))return n;let t=e.map(r=>fp(r)),i=[];return t.forEach(r=>{r instanceof ge?i.push(r):r instanceof ke&&(r.op===n.op?i.push(...r.filters):i.push(r))}),i.length===1?i[0]:ke.create(i,n.op)}var xw=class{constructor(){this.collectionParentIndex=new Qu}addToCollectionParentIndex(e,t){return this.collectionParentIndex.add(t),b.resolve()}getCollectionParents(e,t){return b.resolve(this.collectionParentIndex.getEntries(t))}addFieldIndex(e,t){return b.resolve()}deleteFieldIndex(e,t){return b.resolve()}deleteAllFieldIndexes(e){return b.resolve()}createTargetIndexes(e,t){return b.resolve()}getDocumentsMatchingTarget(e,t){return b.resolve(null)}getIndexType(e,t){return b.resolve(0)}getFieldIndexes(e,t){return b.resolve([])}getNextCollectionGroupToUpdate(e){return b.resolve(null)}getMinOffset(e,t){return b.resolve($n.min())}getMinOffsetFromCollectionGroup(e,t){return b.resolve($n.min())}updateCollectionGroup(e,t,i){return b.resolve()}updateIndexEntries(e,t){return b.resolve()}},Qu=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),i=e.popLast(),r=this.index[t]||new Ne(_e.comparator),s=!r.has(i);return this.index[t]=r.add(i),s}has(e){let t=e.lastSegment(),i=e.popLast(),r=this.index[t];return r&&r.has(i)}getEntries(e){return(this.index[e]||new Ne(_e.comparator)).toArray()}};var FR="IndexedDbIndexManager",Um=new Uint8Array(0),Iw=class{constructor(e,t){this.databaseId=t,this.collectionParentsCache=new Qu,this.targetToDnfSubTargets=new Ji(i=>wo(i),(i,r)=>ld(i,r)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.collectionParentsCache.has(t)){let i=t.lastSegment(),r=t.popLast();e.addOnCommittedListener(()=>{this.collectionParentsCache.add(t)});let s={collectionId:i,parent:on(r)};return LR(e).put(s)}return b.resolve()}getCollectionParents(e,t){let i=[],r=IDBKeyRange.bound([t,""],[hM(t),""],!1,!0);return LR(e).loadAll(r).next(s=>{for(let o of s){if(o.collectionId!==t)break;i.push(Ki(o.parent))}return i})}addFieldIndex(e,t){let i=Eu(e),r=fG(t);delete r.indexId;let s=i.add(r);if(t.indexState){let o=rc(e);return s.next(a=>{o.put(ER(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}else return s.next()}deleteFieldIndex(e,t){let i=Eu(e),r=rc(e),s=ic(e);return i.delete(t.indexId).next(()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=Eu(e),i=ic(e),r=rc(e);return t.deleteAll().next(()=>i.deleteAll()).next(()=>r.deleteAll())}createTargetIndexes(e,t){return b.forEach(this.getSubTargets(t),i=>this.getIndexType(e,i).next(r=>{if(r===0||r===1){let o=new hp(i).buildTargetIndex();if(o!=null)return this.addFieldIndex(e,o)}}))}getDocumentsMatchingTarget(e,t){let i=ic(e),r=!0,s=new Map;return b.forEach(this.getSubTargets(t),o=>this.getFieldIndex(e,o).next(a=>{r&&(r=!!a),s.set(o,a)})).next(()=>{if(r){let o=ne(),a=[];return b.forEach(s,(c,l)=>{R(FR,`Using index ${H3(c)} to execute ${wo(t)}`);let u=g5(l,c),d=y5(l,c),h=b5(l,c),m=v5(l,c),g=this.encodeBound(c,l,h),y=this.encodeBound(c,l,m),_=this.encodeValues(c,l,d),M=this.generateIndexRanges(c.indexId,u,g,h.inclusive,y,m.inclusive,_);return b.forEach(M,T=>i.loadFirst(T,t.limit).next(O=>{O.forEach(P=>{let W=L.fromSegments(P.documentKey);o.has(W)||(o=o.add(W),a.push(W))})}))}).next(()=>a)}else return b.resolve(null)})}getSubTargets(e){let t=this.targetToDnfSubTargets.get(e);return t||(e.filters.length===0?t=[e]:t=OG(ke.create(e.filters,"and")).map(r=>lw(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.targetToDnfSubTargets.set(e,t),t)}generateIndexRanges(e,t,i,r,s,o,a){let c=(t!=null?t.length:1)*Math.max(i.length,s.length),l=c/(t!=null?t.length:1),u=[];for(let d=0;d<c;++d){let h=t?this.encodeSingleElement(t[d/l]):Um,m=this.generateLowerBound(e,h,i[d%l],r),g=this.generateUpperBound(e,h,s[d%l],o),y=a.map(_=>this.generateLowerBound(e,h,_,!0));u.push(...this.createRange(m,g,y))}return u}generateLowerBound(e,t,i,r){let s=new uo(e,L.empty(),t,i);return r?s:s.successor()}generateUpperBound(e,t,i,r){let s=new uo(e,L.empty(),t,i);return r?s.successor():s}getFieldIndex(e,t){let i=new hp(t),r=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next(s=>{let o=null;for(let a of s)i.servedByIndex(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let i=2,r=this.getSubTargets(t);return b.forEach(r,s=>this.getFieldIndex(e,s).next(o=>{o?i!==0&&o.fields.length<_5(s)&&(i=1):i=0})).next(()=>w5(t)&&r.length>1&&i===2?1:i)}encodeDirectionalElements(e,t){let i=new lo;for(let r of yo(e)){let s=t.data.field(r.fieldPath);if(s==null)return null;let o=i.forKind(r.kind);Cr.INSTANCE.writeIndexValue(s,o)}return i.encodedBytes()}encodeSingleElement(e){let t=new lo;return Cr.INSTANCE.writeIndexValue(e,t.forKind(0)),t.encodedBytes()}encodeDirectionalKey(e,t){let i=new lo;return Cr.INSTANCE.writeIndexValue(vo(this.databaseId,t),i.forKind($3(e))),i.encodedBytes()}encodeValues(e,t,i){if(i===null)return[];let r=[];r.push(new lo);let s=0;for(let o of yo(e)){let a=i[s++];for(let c of r)if(this.isInFilter(t,o.fieldPath)&&Uu(a))r=this.expandIndexValues(r,o,a);else{let l=c.forKind(o.kind);Cr.INSTANCE.writeIndexValue(a,l)}}return this.getEncodedBytes(r)}encodeBound(e,t,i){return this.encodeValues(e,t,i.position)}getEncodedBytes(e){let t=[];for(let i=0;i<e.length;++i)t[i]=e[i].encodedBytes();return t}expandIndexValues(e,t,i){let r=[...e],s=[];for(let o of i.arrayValue.values||[])for(let a of r){let c=new lo;c.seed(a.encodedBytes()),Cr.INSTANCE.writeIndexValue(o,c.forKind(t.kind)),s.push(c)}return s}isInFilter(e,t){return!!e.filters.find(i=>i instanceof ge&&i.field.isEqual(t)&&(i.op==="in"||i.op==="not-in"))}getFieldIndexes(e,t){let i=Eu(e),r=rc(e);return(t?i.loadAll(K0,IDBKeyRange.bound(t,t)):i.loadAll()).next(s=>{let o=[];return b.forEach(s,a=>r.get([a.indexId,this.uid]).next(c=>{o.push(mG(a,c))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((i,r)=>{let s=i.indexState.sequenceNumber-r.indexState.sequenceNumber;return s!==0?s:te(i.collectionGroup,r.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,i){let r=Eu(e),s=rc(e);return this.getNextSequenceNumber(e).next(o=>r.loadAll(K0,IDBKeyRange.bound(t,t)).next(a=>b.forEach(a,c=>s.put(ER(c.indexId,this.uid,o,i)))))}updateIndexEntries(e,t){let i=new Map;return b.forEach(t,(r,s)=>{let o=i.get(r.collectionGroup);return(o?b.resolve(o):this.getFieldIndexes(e,r.collectionGroup)).next(c=>(i.set(r.collectionGroup,c),b.forEach(c,l=>this.getExistingIndexEntries(e,r,l).next(u=>{let d=this.computeIndexEntries(s,l);return u.isEqual(d)?b.resolve():this.updateEntries(e,s,l,u,d)}))))})}addIndexEntry(e,t,i,r){return ic(e).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.encodeDirectionalKey(i,t.key),documentKey:t.key.path.toArray()})}deleteIndexEntry(e,t,i,r){return ic(e).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.encodeDirectionalKey(i,t.key),t.key.path.toArray()])}getExistingIndexEntries(e,t,i){let r=ic(e),s=new Ne(fs);return r.iterate({index:SM,range:IDBKeyRange.only([i.indexId,this.uid,this.encodeDirectionalKey(i,t)])},(o,a)=>{s=s.add(new uo(i.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>s)}computeIndexEntries(e,t){let i=new Ne(fs),r=this.encodeDirectionalElements(t,e);if(r==null)return i;let s=FC(t);if(s!=null){let o=e.data.field(s.fieldPath);if(Uu(o))for(let a of o.arrayValue.values||[])i=i.add(new uo(t.indexId,e.key,this.encodeSingleElement(a),r))}else i=i.add(new uo(t.indexId,e.key,Um,r));return i}updateEntries(e,t,i,r,s){R(FR,"Updating index entries for document '%s'",t.key);let o=[];return k6(r,s,fs,a=>{o.push(this.addIndexEntry(e,t,i,a))},a=>{o.push(this.deleteIndexEntry(e,t,i,a))}),b.waitFor(o)}getNextSequenceNumber(e){let t=1;return rc(e).iterate({index:EM,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,s,o)=>{o.done(),t=s.sequenceNumber+1}).next(()=>t)}createRange(e,t,i){i=i.sort((o,a)=>fs(o,a)).filter((o,a,c)=>!a||fs(o,c[a-1])!==0);let r=[];r.push(e);for(let o of i){let a=fs(o,e),c=fs(o,t);if(a===0)r[0]=e.successor();else if(a>0&&c<0)r.push(o),r.push(o.successor());else if(c>0)break}r.push(t);let s=[];for(let o=0;o<r.length;o+=2){if(this.isRangeMatchable(r[o],r[o+1]))return[];let a=[r[o].indexId,this.uid,r[o].arrayValue,r[o].directionalValue,Um,[]],c=[r[o+1].indexId,this.uid,r[o+1].arrayValue,r[o+1].directionalValue,Um,[]];s.push(IDBKeyRange.bound(a,c))}return s}isRangeMatchable(e,t){return fs(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(BR)}getMinOffset(e,t){return b.mapArray(this.getSubTargets(t),i=>this.getFieldIndex(e,i).next(r=>r||j())).next(BR)}};function LR(n){return Rt(n,Nu)}function ic(n){return Rt(n,$p)}function Eu(n){return Rt(n,UC)}function rc(n){return Rt(n,Wp)}function BR(n){$(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let i=1;i<n.length;i++){let r=n[i].indexState.offset;LC(r,e)<0&&(e=r),t<r.largestBatchId&&(t=r.largestBatchId)}return new $n(e.readTime,e.documentKey,t)}function kO(n,e,t){let i=n.store(mi),r=n.store(Oc),s=[],o=IDBKeyRange.only(t.batchId),a=0,c=i.iterate({range:o},(u,d,h)=>(a++,h.delete()));s.push(c.next(()=>{$(a===1)}));let l=[];for(let u of t.mutations){let d=_M(e,u.key.path,t.batchId);s.push(r.delete(d)),l.push(u.key)}return b.waitFor(s).next(()=>l)}function mp(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else if(n.noDocument)e=n.noDocument;else throw j();return JSON.stringify(e).length}var pp=class n{constructor(e,t,i,r){this.userId=e,this.serializer=t,this.indexManager=i,this.referenceDelegate=r,this.documentKeysByBatchId={}}static forUser(e,t,i,r){$(e.uid!=="");let s=e.isAuthenticated()?e.uid:"";return new n(s,t,i,r)}checkEmpty(e){let t=!0,i=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return ms(e).iterate({index:ho,range:i},(r,s,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,i,r){let s=lc(e),o=ms(e);return o.add({}).next(a=>{$(typeof a=="number");let c=new zu(a,t,i,r),l=rG(this.serializer,this.userId,c),u=[],d=new Ne((h,m)=>te(h.canonicalString(),m.canonicalString()));for(let h of r){let m=_M(this.userId,h.key.path,a);d=d.add(h.key.path.popLast()),u.push(o.put(l)),u.push(s.put(m,t6))}return d.forEach(h=>{u.push(this.indexManager.addToCollectionParentIndex(e,h))}),e.addOnCommittedListener(()=>{this.documentKeysByBatchId[a]=c.keys()}),b.waitFor(u).next(()=>c)})}lookupMutationBatch(e,t){return ms(e).get(t).next(i=>i?($(i.userId===this.userId),co(this.serializer,i)):null)}lookupMutationKeys(e,t){return this.documentKeysByBatchId[t]?b.resolve(this.documentKeysByBatchId[t]):this.lookupMutationBatch(e,t).next(i=>{if(i){let r=i.keys();return this.documentKeysByBatchId[t]=r,r}else return null})}getNextMutationBatchAfterBatchId(e,t){let i=t+1,r=IDBKeyRange.lowerBound([this.userId,i]),s=null;return ms(e).iterate({index:ho,range:r},(o,a,c)=>{a.userId===this.userId&&($(a.batchId>=i),s=co(this.serializer,a)),c.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),i=vs;return ms(e).iterate({index:ho,range:t,reverse:!0},(r,s,o)=>{i=s.batchId,o.done()}).next(()=>i)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,vs],[this.userId,Number.POSITIVE_INFINITY]);return ms(e).loadAll(ho,t).next(i=>i.map(r=>co(this.serializer,r)))}getAllMutationBatchesAffectingDocumentKey(e,t){let i=Gm(this.userId,t.path),r=IDBKeyRange.lowerBound(i),s=[];return lc(e).iterate({range:r},(o,a,c)=>{let[l,u,d]=o,h=Ki(u);if(l!==this.userId||!t.path.isEqual(h)){c.done();return}return ms(e).get(d).next(m=>{if(!m)throw j();$(m.userId===this.userId),s.push(co(this.serializer,m))})}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let i=new Ne(te),r=[];return t.forEach(s=>{let o=Gm(this.userId,s.path),a=IDBKeyRange.lowerBound(o),c=lc(e).iterate({range:a},(l,u,d)=>{let[h,m,g]=l,y=Ki(m);if(h!==this.userId||!s.path.isEqual(y)){d.done();return}i=i.add(g)});r.push(c)}),b.waitFor(r).next(()=>this.lookupMutationBatches(e,i))}getAllMutationBatchesAffectingQuery(e,t){let i=t.path,r=i.length+1,s=Gm(this.userId,i),o=IDBKeyRange.lowerBound(s),a=new Ne(te);return lc(e).iterate({range:o},(c,l,u)=>{let[d,h,m]=c,g=Ki(h);if(d!==this.userId||!i.isPrefixOf(g)){u.done();return}g.length===r&&(a=a.add(m))}).next(()=>this.lookupMutationBatches(e,a))}lookupMutationBatches(e,t){let i=[],r=[];return t.forEach(s=>{r.push(ms(e).get(s).next(o=>{if(o===null)throw j();$(o.userId===this.userId),i.push(co(this.serializer,o))}))}),b.waitFor(r).next(()=>i)}removeMutationBatch(e,t){return kO(e.simpleDbTransaction,this.userId,t).next(i=>(e.addOnCommittedListener(()=>{this.removeCachedMutationKeys(t.batchId)}),b.forEach(i,r=>this.referenceDelegate.markPotentiallyOrphaned(e,r))))}removeCachedMutationKeys(e){delete this.documentKeysByBatchId[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return b.resolve();let i=IDBKeyRange.lowerBound(e6(this.userId)),r=[];return lc(e).iterate({range:i},(s,o,a)=>{if(s[0]!==this.userId){a.done();return}else{let l=Ki(s[1]);r.push(l)}}).next(()=>{$(r.length===0)})})}containsKey(e,t){return RO(e,this.userId,t)}getMutationQueueMetadata(e){return MO(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:vs,lastStreamToken:""})}};function RO(n,e,t){let i=Gm(e,t.path),r=i[1],s=IDBKeyRange.lowerBound(i),o=!1;return lc(n).iterate({range:s,keysOnly:!0},(a,c,l)=>{let[u,d,h]=a;u===e&&d===r&&(o=!0),l.done()}).next(()=>o)}function LG(n,e){let t=!1;return MO(n).iterateSerial(i=>RO(n,i,e).next(r=>(r&&(t=!0),b.resolve(!r)))).next(()=>t)}function ms(n){return Rt(n,mi)}function lc(n){return Rt(n,Oc)}function MO(n){return Rt(n,od)}var I0=2,Sc=class n{constructor(e){this.lastId=e}next(){return this.lastId+=I0,this.lastId}static forTargetCache(){return new n(2-I0)}static forSyncEngine(){return new n(1-I0)}};var Aw=class{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.retrieveMetadata(e).next(t=>{let i=new Sc(t.highestTargetId);return t.highestTargetId=i.next(),this.saveMetadata(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.retrieveMetadata(e).next(t=>Q.fromTimestamp(new Je(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.retrieveMetadata(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,i){return this.retrieveMetadata(e).next(r=>(r.highestListenSequenceNumber=t,i&&(r.lastRemoteSnapshotVersion=i.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.saveMetadata(e,r)))}addTargetData(e,t){return this.saveTargetData(e,t).next(()=>this.retrieveMetadata(e).next(i=>(i.targetCount+=1,this.updateMetadataFromTargetData(t,i),this.saveMetadata(e,i))))}updateTargetData(e,t){return this.saveTargetData(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>sc(e).delete(t.targetId)).next(()=>this.retrieveMetadata(e)).next(i=>($(i.targetCount>0),i.targetCount-=1,this.saveMetadata(e,i)))}removeTargets(e,t,i){let r=0,s=[];return sc(e).iterate((o,a)=>{let c=Iu(a);c.sequenceNumber<=t&&i.get(c.targetId)===null&&(r++,s.push(this.removeTargetData(e,c)))}).next(()=>b.waitFor(s)).next(()=>r)}forEachTarget(e,t){return sc(e).iterate((i,r)=>{let s=Iu(r);t(s)})}retrieveMetadata(e){return VR(e).get(tp).next(t=>($(t!==null),t))}saveMetadata(e,t){return VR(e).put(tp,t)}saveTargetData(e,t){return sc(e).put(xO(this.serializer,t))}updateMetadataFromTargetData(e,t){let i=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,i=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,i=!0),i}getTargetCount(e){return this.retrieveMetadata(e).next(t=>t.targetCount)}getTargetData(e,t){let i=wo(t),r=IDBKeyRange.bound([i,Number.NEGATIVE_INFINITY],[i,Number.POSITIVE_INFINITY]),s=null;return sc(e).iterate({range:r,index:CM},(o,a,c)=>{let l=Iu(a);ld(t,l.target)&&(s=l,c.done())}).next(()=>s)}addMatchingKeys(e,t,i){let r=[],s=gs(e);return t.forEach(o=>{let a=on(o.path);r.push(s.put({targetId:i,path:a})),r.push(this.referenceDelegate.addReference(e,i,o))}),b.waitFor(r)}removeMatchingKeys(e,t,i){let r=gs(e);return b.forEach(t,s=>{let o=on(s.path);return b.waitFor([r.delete([i,o]),this.referenceDelegate.removeReference(e,i,s)])})}removeMatchingKeysForTargetId(e,t){let i=gs(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return i.delete(r)}getMatchingKeysForTargetId(e,t){let i=IDBKeyRange.bound([t],[t+1],!1,!0),r=gs(e),s=ne();return r.iterate({range:i,keysOnly:!0},(o,a,c)=>{let l=Ki(o[1]),u=new L(l);s=s.add(u)}).next(()=>s)}containsKey(e,t){let i=on(t.path),r=IDBKeyRange.bound([i],[hM(i)],!1,!0),s=0;return gs(e).iterate({index:VC,keysOnly:!0,range:r},([o,a],c,l)=>{o!==0&&(s++,l.done())}).next(()=>s>0)}getTargetDataForTarget(e,t){return sc(e).get(t).next(i=>i?Iu(i):null)}};function sc(n){return Rt(n,Pc)}function VR(n){return Rt(n,ko)}function gs(n){return Rt(n,Nc)}var UR={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},hd=-1,OO=40*1024*1024,Gn=class n{constructor(e,t,i){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=i}static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};Gn.DEFAULT_COLLECTION_PERCENTILE=10;Gn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3;Gn.DEFAULT=new Gn(OO,Gn.DEFAULT_COLLECTION_PERCENTILE,Gn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT);Gn.DISABLED=new Gn(hd,0,0);var jR="LruGarbageCollector",qR=1*1024*1024,BG=1*60*1e3,VG=5*60*1e3;function zR([n,e],[t,i]){let r=te(n,t);return r===0?te(e,i):r}var Dw=class{constructor(e){this.maxElements=e,this.buffer=new Ne(zR),this.previousIndex=0}nextIndex(){return++this.previousIndex}addElement(e){let t=[e,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(t);else{let i=this.buffer.last();zR(t,i)<0&&(this.buffer=this.buffer.delete(i).add(t))}}get maxValue(){return this.buffer.last()[0]}},kw=class{constructor(e,t,i){this.garbageCollector=e,this.asyncQueue=t,this.localStore=i,this.gcTask=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==hd&&this.scheduleGC(BG)}stop(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)}get started(){return this.gcTask!==null}scheduleGC(e){R(jR,`Garbage collection scheduled in ${e}ms`),this.gcTask=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>p(this,null,function*(){this.gcTask=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){Rs(t)?R(jR,"Ignoring IndexedDB error during garbage collection: ",t):yield ks(t)}yield this.scheduleGC(VG)}))}},Rw=class{constructor(e,t){this.delegate=e,this.params=t}calculateTargetCount(e,t){return this.delegate.getSequenceNumberCount(e).next(i=>Math.floor(t/100*i))}nthSequenceNumber(e,t){if(t===0)return b.resolve(Sn.INVALID);let i=new Dw(t);return this.delegate.forEachTarget(e,r=>i.addElement(r.sequenceNumber)).next(()=>this.delegate.forEachOrphanedDocumentSequenceNumber(e,r=>i.addElement(r))).next(()=>i.maxValue)}removeTargets(e,t,i){return this.delegate.removeTargets(e,t,i)}removeOrphanedDocuments(e,t){return this.delegate.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===hd?(R("LruGarbageCollector","Garbage collection skipped; disabled"),b.resolve(UR)):this.getCacheSize(e).next(i=>i<this.params.cacheSizeCollectionThreshold?(R("LruGarbageCollector",`Garbage collection skipped; Cache size ${i} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),UR):this.runGarbageCollection(e,t))}getCacheSize(e){return this.delegate.getCacheSize(e)}runGarbageCollection(e,t){let i,r,s,o,a,c,l,u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(d=>(d>this.params.maximumSequenceNumbersToCollect?(R("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${d}`),r=this.params.maximumSequenceNumbersToCollect):r=d,o=Date.now(),this.nthSequenceNumber(e,r))).next(d=>(i=d,a=Date.now(),this.removeTargets(e,i,t))).next(d=>(s=d,c=Date.now(),this.removeOrphanedDocuments(e,i))).next(d=>{if(l=Date.now(),oc()<=Si.DEBUG){let h=`LRU Garbage Collection
	Counted targets in ${o-u}ms
	Determined least recently used ${r} in ${a-o}ms
	Removed ${s} targets in ${c-a}ms
	Removed ${d} documents in ${l-c}ms
Total Duration: ${l-u}ms`;R("LruGarbageCollector",h)}return b.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:s,documentsRemoved:d})})}};function UG(n,e){return new Rw(n,e)}var Mw=class{constructor(e,t){this.db=e,this.garbageCollector=UG(this,t)}getSequenceNumberCount(e){let t=this.orphanedDocumentCount(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}orphanedDocumentCount(e){let t=0;return this.forEachOrphanedDocumentSequenceNumber(e,i=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}forEachOrphanedDocumentSequenceNumber(e,t){return this.forEachOrphanedDocument(e,(i,r)=>t(r))}addReference(e,t,i){return jm(e,i)}removeReference(e,t,i){return jm(e,i)}removeTargets(e,t,i){return this.db.getTargetCache().removeTargets(e,t,i)}markPotentiallyOrphaned(e,t){return jm(e,t)}isPinned(e,t){return LG(e,t)}removeOrphanedDocuments(e,t){let r=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[],o=0;return this.forEachOrphanedDocument(e,(c,l)=>{if(l<=t){let u=this.isPinned(e,c).next(d=>{if(!d)return o++,r.getEntry(e,c).next(()=>(r.removeEntry(c,Q.min()),gs(e).delete(jG(c))))});s.push(u)}}).next(()=>b.waitFor(s)).next(()=>r.apply(e)).next(()=>o)}removeTarget(e,t){let i=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,i)}updateLimboDocument(e,t){return jm(e,t)}forEachOrphanedDocument(e,t){let i=gs(e),r=Sn.INVALID,s;return i.iterate({index:VC},([o,a],{path:c,sequenceNumber:l})=>{o===0?(r!==Sn.INVALID&&t(new L(Ki(s)),r),r=l,s=c):r=Sn.INVALID}).next(()=>{r!==Sn.INVALID&&t(new L(Ki(s)),r)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}};function jG(n){return[0,on(n.path)]}function qG(n,e){return{targetId:0,path:on(n.path),sequenceNumber:e}}function jm(n,e){return gs(n).put(qG(e,n.currentSequenceNumber))}var gp=class{constructor(){this.changes=new Ji(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,_t.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let i=this.changes.get(t);return i!==void 0?b.resolve(i):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var Ow=class{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,i){return so(e).put(i)}removeEntry(e,t,i){return so(e).delete(zG(t,i))}updateMetadata(e,t){return this.getMetadata(e).next(i=>(i.byteSize+=t,this.setMetadata(e,i)))}getEntry(e,t){let i=_t.newInvalidDocument(t);return so(e).iterate({index:Wm,range:IDBKeyRange.only(Su(t))},(r,s)=>{i=this.maybeDecodeDocument(t,s)}).next(()=>i)}getSizedEntry(e,t){let i={size:0,document:_t.newInvalidDocument(t)};return so(e).iterate({index:Wm,range:IDBKeyRange.only(Su(t))},(r,s)=>{i={document:this.maybeDecodeDocument(t,s),size:mp(s)}}).next(()=>i)}getEntries(e,t){let i=gn();return this.forEachDbEntry(e,t,(r,s)=>{let o=this.maybeDecodeDocument(r,s);i=i.insert(r,o)}).next(()=>i)}getSizedEntries(e,t){let i=gn(),r=new ze(L.comparator);return this.forEachDbEntry(e,t,(s,o)=>{let a=this.maybeDecodeDocument(s,o);i=i.insert(s,a),r=r.insert(s,mp(o))}).next(()=>({documents:i,sizeMap:r}))}forEachDbEntry(e,t,i){if(t.isEmpty())return b.resolve();let r=new Ne($R);t.forEach(c=>r=r.add(c));let s=IDBKeyRange.bound(Su(r.first()),Su(r.last())),o=r.getIterator(),a=o.getNext();return so(e).iterate({index:Wm,range:s},(c,l,u)=>{let d=L.fromSegments([...l.prefixPath,l.collectionGroup,l.documentId]);for(;a&&$R(a,d)<0;)i(a,null),a=o.getNext();a&&a.isEqual(d)&&(i(a,l),a=o.hasNext()?o.getNext():null),a?u.skip(Su(a)):u.done()}).next(()=>{for(;a;)i(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,i,r,s){let o=t.path,a=[o.popLast().toArray(),o.lastSegment(),Xp(i.readTime),i.documentKey.path.isEmpty()?"":i.documentKey.path.lastSegment()],c=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return so(e).loadAll(IDBKeyRange.bound(a,c,!0)).next(l=>{s?.incrementDocumentReadCount(l.length);let u=gn();for(let d of l){let h=this.maybeDecodeDocument(L.fromSegments(d.prefixPath.concat(d.collectionGroup,d.documentId)),d);h.isFoundDocument()&&(dd(t,h)||r.has(h.key))&&(u=u.insert(h.key,h))}return u})}getAllFromCollectionGroup(e,t,i,r){let s=gn(),o=WR(t,i),a=WR(t,$n.max());return so(e).iterate({index:wM,range:IDBKeyRange.bound(o,a,!0)},(c,l,u)=>{let d=this.maybeDecodeDocument(L.fromSegments(l.prefixPath.concat(l.collectionGroup,l.documentId)),l);s=s.insert(d.key,d),s.size===r&&u.done()}).next(()=>s)}newChangeBuffer(e){return new Pw(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return GR(e).get(H0).next(t=>($(!!t),t))}setMetadata(e,t){return GR(e).put(H0,t)}maybeDecodeDocument(e,t){if(t){let i=nG(this.serializer,t);if(!(i.isNoDocument()&&i.version.isEqual(Q.min())))return i}return _t.newInvalidDocument(e)}};function PO(n){return new Ow(n)}var Pw=class extends gp{constructor(e,t){super(),this.documentCache=e,this.trackRemovals=t,this.documentStates=new Ji(i=>i.toString(),(i,r)=>i.isEqual(r))}applyChanges(e){let t=[],i=0,r=new Ne((s,o)=>te(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{let a=this.documentStates.get(s);if(t.push(this.documentCache.removeEntry(e,s,a.readTime)),o.isValidDocument()){let c=CR(this.documentCache.serializer,o);r=r.add(s.path.popLast());let l=mp(c);i+=l-a.size,t.push(this.documentCache.addEntry(e,s,c))}else if(i-=a.size,this.trackRemovals){let c=CR(this.documentCache.serializer,o.convertToNoDocument(Q.min()));t.push(this.documentCache.addEntry(e,s,c))}}),r.forEach(s=>{t.push(this.documentCache.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.documentCache.updateMetadata(e,i)),b.waitFor(t)}getFromCache(e,t){return this.documentCache.getSizedEntry(e,t).next(i=>(this.documentStates.set(t,{size:i.size,readTime:i.document.readTime}),i.document))}getAllFromCache(e,t){return this.documentCache.getSizedEntries(e,t).next(({documents:i,sizeMap:r})=>(r.forEach((s,o)=>{this.documentStates.set(s,{size:o,readTime:i.get(s).readTime})}),i))}};function GR(n){return Rt(n,ad)}function so(n){return Rt(n,qp)}function Su(n){let e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function zG(n,e){let t=n.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],Xp(e),t[t.length-1]]}function WR(n,e){let t=e.documentKey.path.toArray();return[n,Xp(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function $R(n,e){let t=n.path.toArray(),i=e.path.toArray(),r=0;for(let s=0;s<t.length-2&&s<i.length-2;++s)if(r=te(t[s],i[s]),r)return r;return r=te(t.length,i.length),r||(r=te(t[t.length-2],i[i.length-2]),r)?r:te(t[t.length-1],i[i.length-1])}var GG=16;var Nw=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var yp=class{constructor(e,t,i,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=i,this.indexManager=r}getDocument(e,t){let i=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(i=r,this.remoteDocumentCache.getEntry(e,t))).next(r=>(i!==null&&Ru(i.mutation,r,Tn.empty(),Je.now()),r))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(i=>this.getLocalViewOfDocuments(e,i,ne()).next(()=>i))}getLocalViewOfDocuments(e,t,i=ne()){let r=Qi();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,i).next(s=>{let o=xu();return s.forEach((a,c)=>{o=o.insert(a,c.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){let i=Qi();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,ne()))}populateOverlays(e,t,i){let r=[];return i.forEach(s=>{t.has(s)||r.push(s)}),this.documentOverlayCache.getOverlays(e,r).next(s=>{s.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,i,r){let s=gn(),o=ju(),a=F5();return t.forEach((c,l)=>{let u=i.get(l.key);r.has(l.key)&&(u===void 0||u.mutation instanceof yi)?s=s.insert(l.key,l):u!==void 0?(o.set(l.key,u.mutation.getFieldMask()),Ru(u.mutation,l,u.mutation.getFieldMask(),Je.now())):o.set(l.key,Tn.empty())}),this.recalculateAndSaveOverlays(e,s).next(c=>(c.forEach((l,u)=>o.set(l,u)),t.forEach((l,u)=>{var d;return a.set(l,new Nw(u,(d=o.get(l))!==null&&d!==void 0?d:null))}),a))}recalculateAndSaveOverlays(e,t){let i=ju(),r=new ze((o,a)=>o-a),s=ne();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(let a of o)a.keys().forEach(c=>{let l=t.get(c);if(l===null)return;let u=i.get(c)||Tn.empty();u=a.applyToLocalView(l,u),i.set(c,u);let d=(r.get(a.batchId)||ne()).add(c);r=r.insert(a.batchId,d)})}).next(()=>{let o=[],a=r.getReverseIterator();for(;a.hasNext();){let c=a.getNext(),l=c.key,u=c.value,d=eO();u.forEach(h=>{if(!s.has(h)){let m=cO(t.get(h),i.get(h));m!==null&&d.set(h,m),s=s.add(h)}}),o.push(this.documentOverlayCache.saveOverlays(e,l,d))}return b.waitFor(o)}).next(()=>i)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(i=>this.recalculateAndSaveOverlays(e,i))}getDocumentsMatchingQuery(e,t,i,r){return T5(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):GC(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,i,r):this.getDocumentsMatchingCollectionQuery(e,t,i,r)}getNextDocuments(e,t,i,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,i,r).next(s=>{let o=r-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,i.largestBatchId,r-s.size):b.resolve(Qi()),a=pc,c=s;return o.next(l=>b.forEach(l,(u,d)=>(a<d.largestBatchId&&(a=d.largestBatchId),s.get(u)?b.resolve():this.remoteDocumentCache.getEntry(e,u).next(h=>{c=c.insert(u,h)}))).next(()=>this.populateOverlays(e,l,s)).next(()=>this.computeViews(e,c,l,ne())).next(u=>({batchId:a,changes:JM(u)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new L(t)).next(i=>{let r=xu();return i.isFoundDocument()&&(r=r.insert(i.key,i)),r})}getDocumentsMatchingCollectionGroupQuery(e,t,i,r){let s=t.collectionGroup,o=xu();return this.indexManager.getCollectionParents(e,s).next(a=>b.forEach(a,c=>{let l=C5(t,c.child(s));return this.getDocumentsMatchingCollectionQuery(e,l,i,r).next(u=>{u.forEach((d,h)=>{o=o.insert(d,h)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,i,r){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,i.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,i,s,r))).next(o=>{s.forEach((c,l)=>{let u=l.getKey();o.get(u)===null&&(o=o.insert(u,_t.newInvalidDocument(u)))});let a=xu();return o.forEach((c,l)=>{let u=s.get(c);u!==void 0&&Ru(u.mutation,l,Tn.empty(),Je.now()),dd(t,l)&&(a=a.insert(c,l))}),a})}};var Fw=class{constructor(e){this.serializer=e,this.bundles=new Map,this.namedQueries=new Map}getBundleMetadata(e,t){return b.resolve(this.bundles.get(t))}saveBundleMetadata(e,t){return this.bundles.set(t.id,dG(t)),b.resolve()}getNamedQuery(e,t){return b.resolve(this.namedQueries.get(t))}saveNamedQuery(e,t){return this.namedQueries.set(t.name,uG(t)),b.resolve()}};var Lw=class{constructor(){this.overlays=new ze(L.comparator),this.overlayByBatchId=new Map}getOverlay(e,t){return b.resolve(this.overlays.get(t))}getOverlays(e,t){let i=Qi();return b.forEach(t,r=>this.getOverlay(e,r).next(s=>{s!==null&&i.set(r,s)})).next(()=>i)}saveOverlays(e,t,i){return i.forEach((r,s)=>{this.saveOverlay(e,t,s)}),b.resolve()}removeOverlaysForBatchId(e,t,i){let r=this.overlayByBatchId.get(i);return r!==void 0&&(r.forEach(s=>this.overlays=this.overlays.remove(s)),this.overlayByBatchId.delete(i)),b.resolve()}getOverlaysForCollection(e,t,i){let r=Qi(),s=t.length+1,o=new L(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){let l=a.getNext().value,u=l.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===s&&l.largestBatchId>i&&r.set(l.getKey(),l)}return b.resolve(r)}getOverlaysForCollectionGroup(e,t,i,r){let s=new ze((l,u)=>l-u),o=this.overlays.getIterator();for(;o.hasNext();){let u=o.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>i){let h=s.get(u.largestBatchId);h===null&&(h=Qi(),s=s.insert(u.largestBatchId,h)),h.set(u.getKey(),u)}}let a=Qi(),c=s.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((d,h)=>a.set(d,h)),!(a.size()>=r)););return b.resolve(a)}saveOverlay(e,t,i){let r=this.overlays.get(i.key);if(r!==null){let o=this.overlayByBatchId.get(r.largestBatchId).delete(i.key);this.overlayByBatchId.set(r.largestBatchId,o)}this.overlays=this.overlays.insert(i.key,new Gu(t,i));let s=this.overlayByBatchId.get(t);s===void 0&&(s=ne(),this.overlayByBatchId.set(t,s)),this.overlayByBatchId.set(t,s.add(i.key))}};var Yu=class{constructor(){this.refsByKey=new Ne(vt.compareByKey),this.refsByTarget=new Ne(vt.compareByTargetId)}isEmpty(){return this.refsByKey.isEmpty()}addReference(e,t){let i=new vt(e,t);this.refsByKey=this.refsByKey.add(i),this.refsByTarget=this.refsByTarget.add(i)}addReferences(e,t){e.forEach(i=>this.addReference(i,t))}removeReference(e,t){this.removeRef(new vt(e,t))}removeReferences(e,t){e.forEach(i=>this.removeReference(i,t))}removeReferencesForId(e){let t=new L(new _e([])),i=new vt(t,e),r=new vt(t,e+1),s=[];return this.refsByTarget.forEachInRange([i,r],o=>{this.removeRef(o),s.push(o.key)}),s}removeAllReferences(){this.refsByKey.forEach(e=>this.removeRef(e))}removeRef(e){this.refsByKey=this.refsByKey.delete(e),this.refsByTarget=this.refsByTarget.delete(e)}referencesForId(e){let t=new L(new _e([])),i=new vt(t,e),r=new vt(t,e+1),s=ne();return this.refsByTarget.forEachInRange([i,r],o=>{s=s.add(o.key)}),s}containsKey(e){let t=new vt(e,0),i=this.refsByKey.firstAfterOrEqual(t);return i!==null&&e.isEqual(i.key)}},vt=class{constructor(e,t){this.key=e,this.targetOrBatchId=t}static compareByKey(e,t){return L.comparator(e.key,t.key)||te(e.targetOrBatchId,t.targetOrBatchId)}static compareByTargetId(e,t){return te(e.targetOrBatchId,t.targetOrBatchId)||L.comparator(e.key,t.key)}};var Bw=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.nextBatchId=1,this.batchesByDocumentKey=new Ne(vt.compareByKey)}checkEmpty(e){return b.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,i,r){let s=this.nextBatchId;this.nextBatchId++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new zu(s,t,i,r);this.mutationQueue.push(o);for(let a of r)this.batchesByDocumentKey=this.batchesByDocumentKey.add(new vt(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return b.resolve(o)}lookupMutationBatch(e,t){return b.resolve(this.findMutationBatch(t))}getNextMutationBatchAfterBatchId(e,t){let i=t+1,r=this.indexOfBatchId(i),s=r<0?0:r;return b.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return b.resolve(this.mutationQueue.length===0?vs:this.nextBatchId-1)}getAllMutationBatches(e){return b.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let i=new vt(t,0),r=new vt(t,Number.POSITIVE_INFINITY),s=[];return this.batchesByDocumentKey.forEachInRange([i,r],o=>{let a=this.findMutationBatch(o.targetOrBatchId);s.push(a)}),b.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let i=new Ne(te);return t.forEach(r=>{let s=new vt(r,0),o=new vt(r,Number.POSITIVE_INFINITY);this.batchesByDocumentKey.forEachInRange([s,o],a=>{i=i.add(a.targetOrBatchId)})}),b.resolve(this.findMutationBatches(i))}getAllMutationBatchesAffectingQuery(e,t){let i=t.path,r=i.length+1,s=i;L.isDocumentKey(s)||(s=s.child(""));let o=new vt(new L(s),0),a=new Ne(te);return this.batchesByDocumentKey.forEachWhile(c=>{let l=c.key.path;return i.isPrefixOf(l)?(l.length===r&&(a=a.add(c.targetOrBatchId)),!0):!1},o),b.resolve(this.findMutationBatches(a))}findMutationBatches(e){let t=[];return e.forEach(i=>{let r=this.findMutationBatch(i);r!==null&&t.push(r)}),t}removeMutationBatch(e,t){let i=this.indexOfExistingBatchId(t.batchId,"removed");$(i===0),this.mutationQueue.shift();let r=this.batchesByDocumentKey;return b.forEach(t.mutations,s=>{let o=new vt(s.key,t.batchId);return r=r.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.batchesByDocumentKey=r})}removeCachedMutationKeys(e){}containsKey(e,t){let i=new vt(t,0),r=this.batchesByDocumentKey.firstAfterOrEqual(i);return b.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,b.resolve()}indexOfExistingBatchId(e,t){return this.indexOfBatchId(e)}indexOfBatchId(e){if(this.mutationQueue.length===0)return 0;let t=this.mutationQueue[0].batchId;return e-t}findMutationBatch(e){let t=this.indexOfBatchId(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};function WG(){return new ze(L.comparator)}var Vw=class{constructor(e){this.sizer=e,this.docs=WG(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let i=t.key,r=this.docs.get(i),s=r?r.size:0,o=this.sizer(t);return this.docs=this.docs.insert(i,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,i.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let i=this.docs.get(t);return b.resolve(i?i.document.mutableCopy():_t.newInvalidDocument(t))}getEntries(e,t){let i=gn();return t.forEach(r=>{let s=this.docs.get(r);i=i.insert(r,s?s.document.mutableCopy():_t.newInvalidDocument(r))}),b.resolve(i)}getDocumentsMatchingQuery(e,t,i,r){let s=gn(),o=t.path,a=new L(o.child("")),c=this.docs.getIteratorFrom(a);for(;c.hasNext();){let{key:l,value:{document:u}}=c.getNext();if(!o.isPrefixOf(l.path))break;l.path.length>o.length+1||LC(mM(u),i)<=0||!r.has(u.key)&&!dd(t,u)||(s=s.insert(u.key,u.mutableCopy()))}return b.resolve(s)}getAllFromCollectionGroup(e,t,i,r){j()}forEachDocumentKey(e,t){return b.forEach(this.docs,i=>t(i))}newChangeBuffer(e){return new Uw(this)}getSize(e){return b.resolve(this.size)}};function $G(n){return new Vw(n)}var Uw=class extends gp{constructor(e){super(),this.documentCache=e}applyChanges(e){let t=[];return this.changes.forEach((i,r)=>{r.isValidDocument()?t.push(this.documentCache.addEntry(e,r)):this.documentCache.removeEntry(i)}),b.waitFor(t)}getFromCache(e,t){return this.documentCache.getEntry(e,t)}getAllFromCache(e,t){return this.documentCache.getEntries(e,t)}};var jw=class{constructor(e){this.persistence=e,this.targets=new Ji(t=>wo(t),ld),this.lastRemoteSnapshotVersion=Q.min(),this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new Yu,this.targetCount=0,this.targetIdGenerator=Sc.forTargetCache()}forEachTarget(e,t){return this.targets.forEach((i,r)=>t(r)),b.resolve()}getLastRemoteSnapshotVersion(e){return b.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return b.resolve(this.highestSequenceNumber)}allocateTargetId(e){return this.highestTargetId=this.targetIdGenerator.next(),b.resolve(this.highestTargetId)}setTargetsMetadata(e,t,i){return i&&(this.lastRemoteSnapshotVersion=i),t>this.highestSequenceNumber&&(this.highestSequenceNumber=t),b.resolve()}saveTargetData(e){this.targets.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.targetIdGenerator=new Sc(t),this.highestTargetId=t),e.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=e.sequenceNumber)}addTargetData(e,t){return this.saveTargetData(t),this.targetCount+=1,b.resolve()}updateTargetData(e,t){return this.saveTargetData(t),b.resolve()}removeTargetData(e,t){return this.targets.delete(t.target),this.references.removeReferencesForId(t.targetId),this.targetCount-=1,b.resolve()}removeTargets(e,t,i){let r=0,s=[];return this.targets.forEach((o,a)=>{a.sequenceNumber<=t&&i.get(a.targetId)===null&&(this.targets.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),r++)}),b.waitFor(s).next(()=>r)}getTargetCount(e){return b.resolve(this.targetCount)}getTargetData(e,t){let i=this.targets.get(t)||null;return b.resolve(i)}addMatchingKeys(e,t,i){return this.references.addReferences(t,i),b.resolve()}removeMatchingKeys(e,t,i){this.references.removeReferences(t,i);let r=this.persistence.referenceDelegate,s=[];return r&&t.forEach(o=>{s.push(r.markPotentiallyOrphaned(e,o))}),b.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.references.removeReferencesForId(t),b.resolve()}getMatchingKeysForTargetId(e,t){let i=this.references.referencesForId(t);return b.resolve(i)}containsKey(e,t){return b.resolve(this.references.containsKey(t))}};var HG="MemoryPersistence",bp=class{constructor(e,t){this.mutationQueues={},this.overlays={},this.listenSequence=new Sn(0),this._started=!1,this._started=!0,this.referenceDelegate=e(this),this.targetCache=new jw(this);let i=r=>this.referenceDelegate.documentSize(r);this.indexManager=new xw,this.remoteDocumentCache=$G(i),this.serializer=new up(t),this.bundleCache=new Fw(this.serializer)}start(){return Promise.resolve()}shutdown(){return this._started=!1,Promise.resolve()}get started(){return this._started}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Lw,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let i=this.mutationQueues[e.toKey()];return i||(i=new Bw(t,this.referenceDelegate),this.mutationQueues[e.toKey()]=i),i}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.bundleCache}runTransaction(e,t,i){R(HG,"Starting transaction:",e);let r=new qw(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),i(r).next(s=>this.referenceDelegate.onTransactionCommitted(r).next(()=>s)).toPromise().then(s=>(r.raiseOnCommittedEvent(),s))}mutationQueuesContainKey(e,t){return b.or(Object.values(this.mutationQueues).map(i=>()=>i.containsKey(e,t)))}},qw=class extends Jm{constructor(e){super(),this.currentSequenceNumber=e}},vp=class n{constructor(e){this.persistence=e,this.localViewReferences=new Yu,this._orphanedDocuments=null}static factory(e){return new n(e)}get orphanedDocuments(){if(this._orphanedDocuments)return this._orphanedDocuments;throw j()}addReference(e,t,i){return this.localViewReferences.addReference(i,t),this.orphanedDocuments.delete(i.toString()),b.resolve()}removeReference(e,t,i){return this.localViewReferences.removeReference(i,t),this.orphanedDocuments.add(i.toString()),b.resolve()}markPotentiallyOrphaned(e,t){return this.orphanedDocuments.add(t.toString()),b.resolve()}removeTarget(e,t){this.localViewReferences.removeReferencesForId(t.targetId).forEach(s=>this.orphanedDocuments.add(s.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(o=>this.orphanedDocuments.add(o.toString()))}).next(()=>r.removeTargetData(e,t))}onTransactionStarted(){this._orphanedDocuments=new Set}onTransactionCommitted(e){let i=this.persistence.getRemoteDocumentCache().newChangeBuffer();return b.forEach(this.orphanedDocuments,r=>{let s=L.fromPath(r);return this.isReferenced(e,s).next(o=>{o||i.removeEntry(s,Q.min())})}).next(()=>(this._orphanedDocuments=null,i.apply(e)))}updateLimboDocument(e,t){return this.isReferenced(e,t).next(i=>{i?this.orphanedDocuments.delete(t.toString()):this.orphanedDocuments.add(t.toString())})}documentSize(e){return 0}isReferenced(e,t){return b.or([()=>b.resolve(this.localViewReferences.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.mutationQueuesContainKey(e,t)])}};var zw=class{constructor(e){this.serializer=e}createOrUpgrade(e,t,i,r){let s=new ep("createOrUpgrade",t);i<1&&r>=1&&(QG(e),YG(e),HR(e),ZG(e));let o=b.resolve();return i<3&&r>=3&&(i!==0&&(tW(e),HR(e)),o=o.next(()=>iW(s))),i<4&&r>=4&&(i!==0&&(o=o.next(()=>XG(e,s))),o=o.next(()=>{rW(e)})),i<5&&r>=5&&(o=o.next(()=>this.removeAcknowledgedMutations(s))),i<6&&r>=6&&(o=o.next(()=>(eW(e),this.addDocumentGlobal(s)))),i<7&&r>=7&&(o=o.next(()=>this.ensureSequenceNumbers(s))),i<8&&r>=8&&(o=o.next(()=>this.createCollectionParentIndex(e,s))),i<9&&r>=9&&(o=o.next(()=>{nW(e)})),i<10&&r>=10&&(o=o.next(()=>this.rewriteCanonicalIds(s))),i<11&&r>=11&&(o=o.next(()=>{sW(e),oW(e)})),i<12&&r>=12&&(o=o.next(()=>{cW(e)})),i<13&&r>=13&&(o=o.next(()=>JG(e)).next(()=>this.rewriteRemoteDocumentCache(e,s)).next(()=>e.deleteObjectStore(ao))),i<14&&r>=14&&(o=o.next(()=>this.runOverlayMigration(e,s))),i<15&&r>=15&&(o=o.next(()=>aW(e))),i<16&&r>=16&&(o=o.next(()=>{t.objectStore(Wp).clear()}).next(()=>{t.objectStore($p).clear()})),o}addDocumentGlobal(e){let t=0;return e.store(ao).iterate((i,r)=>{t+=mp(r)}).next(()=>{let i={byteSize:t};return e.store(ad).put(H0,i)})}removeAcknowledgedMutations(e){let t=e.store(od),i=e.store(mi);return t.loadAll().next(r=>b.forEach(r,s=>{let o=IDBKeyRange.bound([s.userId,vs],[s.userId,s.lastAcknowledgedBatchId]);return i.loadAll(ho,o).next(a=>b.forEach(a,c=>{$(c.userId===s.userId);let l=co(this.serializer,c);return kO(e,s.userId,l).next(()=>{})}))}))}ensureSequenceNumbers(e){let t=e.store(Nc),i=e.store(ao);return e.store(ko).get(tp).next(s=>{let o=c=>t.put({targetId:0,path:on(c),sequenceNumber:s.highestListenSequenceNumber}),a=[];return i.iterate((c,l)=>{let u=new _e(c),d=KG(u);a.push(t.get(d).next(h=>h?b.resolve():o(u)))}).next(()=>b.waitFor(a))})}createCollectionParentIndex(e,t){e.createObjectStore(Nu,{keyPath:l6});let i=t.store(Nu),r=new Qu,s=o=>{if(r.add(o)){let a=o.lastSegment(),c=o.popLast();return i.put({collectionId:a,parent:on(c)})}};return t.store(ao).iterate({keysOnly:!0},(o,a)=>{let c=new _e(o);return s(c.popLast())}).next(()=>t.store(Oc).iterate({keysOnly:!0},([o,a,c],l)=>{let u=Ki(a);return s(u.popLast())}))}rewriteCanonicalIds(e){let t=e.store(Pc);return t.iterate((i,r)=>{let s=Iu(r),o=xO(this.serializer,s);return t.put(o)})}rewriteRemoteDocumentCache(e,t){let i=t.store(ao),r=[];return i.iterate((s,o)=>{let a=t.store(qp),c=lW(o).path.toArray(),l={prefixPath:c.slice(0,c.length-2),collectionGroup:c[c.length-2],documentId:c[c.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};r.push(a.put(l))}).next(()=>b.waitFor(r))}runOverlayMigration(e,t){let i=t.store(mi),r=PO(this.serializer),s=new bp(vp.factory,this.serializer.remoteSerializer);return i.loadAll().next(o=>{let a=new Map;return o.forEach(c=>{var l;let u=(l=a.get(c.userId))!==null&&l!==void 0?l:ne();co(this.serializer,c).keys().forEach(h=>u=u.add(h)),a.set(c.userId,u)}),b.forEach(a,(c,l)=>{let u=new wt(l),d=dp.forUser(this.serializer,u),h=s.getIndexManager(u),m=pp.forUser(u,this.serializer,h,s.referenceDelegate);return new yp(r,m,d,h).recalculateAndSaveOverlaysForDocumentKeys(new Fu(t,Sn.INVALID),c).next()})})}};function KG(n){return[0,on(n)]}function QG(n){n.createObjectStore(sd)}function YG(n){n.createObjectStore(od,{keyPath:J3}),n.createObjectStore(mi,{keyPath:bM,autoIncrement:!0}).createIndex(ho,vM,{unique:!0}),n.createObjectStore(Oc)}function XG(n,e){return e.store(mi).loadAll().next(i=>{n.deleteObjectStore(mi),n.createObjectStore(mi,{keyPath:bM,autoIncrement:!0}).createIndex(ho,vM,{unique:!0});let s=e.store(mi),o=i.map(a=>s.put(a));return b.waitFor(o)})}function ZG(n){n.createObjectStore(ao)}function JG(n){let e=n.createObjectStore(qp,{keyPath:n6});e.createIndex(Wm,i6),e.createIndex(wM,r6)}function eW(n){n.createObjectStore(ad)}function HR(n){n.createObjectStore(Nc,{keyPath:a6}).createIndex(VC,c6,{unique:!0}),n.createObjectStore(Pc,{keyPath:s6}).createIndex(CM,o6,{unique:!0}),n.createObjectStore(ko)}function tW(n){n.deleteObjectStore(Nc),n.deleteObjectStore(Pc),n.deleteObjectStore(ko)}function nW(n){n.objectStoreNames.contains("remoteDocumentChanges")&&n.deleteObjectStore("remoteDocumentChanges")}function iW(n){let e=n.store(ko),t={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:Q.min().toTimestamp(),targetCount:0};return e.put(tp,t)}function rW(n){n.createObjectStore(gc,{keyPath:u6})}function sW(n){n.createObjectStore(zp,{keyPath:d6})}function oW(n){n.createObjectStore(Gp,{keyPath:h6})}function aW(n){n.createObjectStore(UC,{keyPath:f6,autoIncrement:!0}).createIndex(K0,m6,{unique:!1}),n.createObjectStore(Wp,{keyPath:p6}).createIndex(EM,g6,{unique:!1}),n.createObjectStore($p,{keyPath:y6}).createIndex(SM,b6,{unique:!1})}function cW(n){let e=n.createObjectStore(Hp,{keyPath:v6});e.createIndex(Q0,_6,{unique:!1}),e.createIndex(TM,w6,{unique:!1})}function lW(n){return n.document?new L(_e.fromString(n.document.name).popFirst(5)):n.noDocument?L.fromSegments(n.noDocument.path):n.unknownDocument?L.fromSegments(n.unknownDocument.path):j()}var ps="IndexedDbPersistence",A0=30*60*1e3,D0=5e3,uW=4e3,k0="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",dW="This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.",hW="firestore_zombie",NO="main",Gw=class n{constructor(e,t,i,r,s,o,a,c,l,u,d=GG){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=i,this.queue=s,this.window=o,this.document=a,this.sequenceNumberSyncer=l,this.forceOwningTab=u,this.schemaVersion=d,this.listenSequence=null,this._started=!1,this.isPrimary=!1,this.networkEnabled=!0,this.windowUnloadHandler=null,this.inForeground=!1,this.documentVisibilityHandler=null,this.clientMetadataRefresher=null,this.lastGarbageCollectionTime=Number.NEGATIVE_INFINITY,this.primaryStateListener=h=>Promise.resolve(),!n.isAvailable())throw new x(v.UNIMPLEMENTED,dW);this.referenceDelegate=new Mw(this,r),this.dbName=t+NO,this.serializer=new up(c),this.simpleDb=new Er(this.dbName,this.schemaVersion,new zw(this.serializer)),this.targetCache=new Aw(this.referenceDelegate,this.serializer),this.remoteDocumentCache=PO(this.serializer),this.bundleCache=new ww,this.window&&this.window.localStorage?this.webStorage=this.window.localStorage:(this.webStorage=null,u===!1&&Ze(ps,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.updateClientMetadataAndTryBecomePrimary().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new x(v.FAILED_PRECONDITION,k0);return this.attachVisibilityHandler(),this.attachWindowUnloadHook(),this.scheduleClientMetadataAndPrimaryLeaseRefreshes(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.targetCache.getHighestSequenceNumber(e))}).then(e=>{this.listenSequence=new Sn(e,this.sequenceNumberSyncer)}).then(()=>{this._started=!0}).catch(e=>(this.simpleDb&&this.simpleDb.close(),Promise.reject(e)))}setPrimaryStateListener(e){return this.primaryStateListener=t=>p(this,null,function*(){if(this.started)return e(t)}),e(this.isPrimary)}setDatabaseDeletedListener(e){this.simpleDb.setVersionChangeListener(t=>p(this,null,function*(){t.newVersion===null&&(yield e())}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.queue.enqueueAndForget(()=>p(this,null,function*(){this.started&&(yield this.updateClientMetadataAndTryBecomePrimary())})))}updateClientMetadataAndTryBecomePrimary(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>qm(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.verifyPrimaryLease(e).next(i=>{i||(this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)))})}).next(()=>this.canActAsPrimary(e)).next(i=>this.isPrimary&&!i?this.releasePrimaryLeaseIfHeld(e).next(()=>!1):i?this.acquireOrExtendPrimaryLease(e).next(()=>!0):!1)).catch(e=>{if(Rs(e))return R(ps,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return R(ps,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.queue.enqueueRetryable(()=>this.primaryStateListener(e)),this.isPrimary=e})}verifyPrimaryLease(e){return Tu(e).get(Ja).next(i=>b.resolve(this.isLocalClient(i)))}removeClientMetadata(e){return qm(e).delete(this.clientId)}maybeGarbageCollectMultiClientState(){return p(this,null,function*(){if(this.isPrimary&&!this.isWithinAge(this.lastGarbageCollectionTime,A0)){this.lastGarbageCollectionTime=Date.now();let e=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{let i=Rt(t,gc);return i.loadAll().next(r=>{let s=this.filterActiveClients(r,A0),o=r.filter(a=>s.indexOf(a)===-1);return b.forEach(o,a=>i.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.webStorage)for(let t of e)this.webStorage.removeItem(this.zombiedClientLocalStorageKey(t.clientId))}})}scheduleClientMetadataAndPrimaryLeaseRefreshes(){this.clientMetadataRefresher=this.queue.enqueueAfterDelay("client_metadata_refresh",uW,()=>this.updateClientMetadataAndTryBecomePrimary().then(()=>this.maybeGarbageCollectMultiClientState()).then(()=>this.scheduleClientMetadataAndPrimaryLeaseRefreshes()))}isLocalClient(e){return e?e.ownerId===this.clientId:!1}canActAsPrimary(e){return this.forceOwningTab?b.resolve(!0):Tu(e).get(Ja).next(i=>{if(i!==null&&this.isWithinAge(i.leaseTimestampMs,D0)&&!this.isClientZombied(i.ownerId)){if(this.isLocalClient(i)&&this.networkEnabled)return!0;if(!this.isLocalClient(i)){if(!i.allowTabSynchronization)throw new x(v.FAILED_PRECONDITION,k0);return!1}}return this.networkEnabled&&this.inForeground?!0:qm(e).loadAll().next(s=>this.filterActiveClients(s,D0).find(a=>{if(this.clientId!==a.clientId){let c=!this.networkEnabled&&a.networkEnabled,l=!this.inForeground&&a.inForeground,u=this.networkEnabled===a.networkEnabled;if(c||l&&u)return!0}return!1})===void 0)}).next(i=>(this.isPrimary!==i&&R(ps,`Client ${i?"is":"is not"} eligible for a primary lease.`),i))}shutdown(){return p(this,null,function*(){this._started=!1,this.markClientZombied(),this.clientMetadataRefresher&&(this.clientMetadataRefresher.cancel(),this.clientMetadataRefresher=null),this.detachVisibilityHandler(),this.detachWindowUnloadHook(),yield this.simpleDb.runTransaction("shutdown","readwrite",[sd,gc],e=>{let t=new Fu(e,Sn.INVALID);return this.releasePrimaryLeaseIfHeld(t).next(()=>this.removeClientMetadata(t))}),this.simpleDb.close(),this.removeClientZombiedEntry()})}filterActiveClients(e,t){return e.filter(i=>this.isWithinAge(i.updateTimeMs,t)&&!this.isClientZombied(i.clientId))}getActiveClients(){return this.runTransaction("getActiveClients","readonly",e=>qm(e).loadAll().next(t=>this.filterActiveClients(t,A0).map(i=>i.clientId)))}get started(){return this._started}getMutationQueue(e,t){return pp.forUser(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new Iw(e,this.serializer.remoteSerializer.databaseId)}getDocumentOverlayCache(e){return dp.forUser(this.serializer,e)}getBundleCache(){return this.bundleCache}runTransaction(e,t,i){R(ps,"Starting transaction:",e);let r=t==="readonly"?"readonly":"readwrite",s=D6(this.schemaVersion),o;return this.simpleDb.runTransaction(e,r,s,a=>(o=new Fu(a,this.listenSequence?this.listenSequence.next():Sn.INVALID),t==="readwrite-primary"?this.verifyPrimaryLease(o).next(c=>c?!0:this.canActAsPrimary(o)).next(c=>{if(!c)throw Ze(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)),new x(v.FAILED_PRECONDITION,pM);return i(o)}).next(c=>this.acquireOrExtendPrimaryLease(o).next(()=>c)):this.verifyAllowTabSynchronization(o).next(()=>i(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}verifyAllowTabSynchronization(e){return Tu(e).get(Ja).next(i=>{if(i!==null&&this.isWithinAge(i.leaseTimestampMs,D0)&&!this.isClientZombied(i.ownerId)&&!this.isLocalClient(i)&&!this.forceOwningTab&&(!this.allowTabSynchronization||!i.allowTabSynchronization))throw new x(v.FAILED_PRECONDITION,k0)})}acquireOrExtendPrimaryLease(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Tu(e).put(Ja,t)}static isAvailable(){return Er.isAvailable()}releasePrimaryLeaseIfHeld(e){let t=Tu(e);return t.get(Ja).next(i=>this.isLocalClient(i)?(R(ps,"Releasing primary lease."),t.delete(Ja)):b.resolve())}isWithinAge(e,t){let i=Date.now(),r=i-t,s=i;return e<r?!1:e>s?(Ze(`Detected an update time that is in the future: ${e} > ${s}`),!1):!0}attachVisibilityHandler(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.documentVisibilityHandler=()=>{this.queue.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.updateClientMetadataAndTryBecomePrimary()))},this.document.addEventListener("visibilitychange",this.documentVisibilityHandler),this.inForeground=this.document.visibilityState==="visible")}detachVisibilityHandler(){this.documentVisibilityHandler&&(this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler),this.documentVisibilityHandler=null)}attachWindowUnloadHook(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.windowUnloadHandler=()=>{this.markClientZombied();let t=/(?:Version|Mobile)\/1[456]/;Hg()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.queue.enterRestrictedMode(!0),this.queue.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.windowUnloadHandler))}detachWindowUnloadHook(){this.windowUnloadHandler&&(this.window.removeEventListener("pagehide",this.windowUnloadHandler),this.windowUnloadHandler=null)}isClientZombied(e){var t;try{let i=((t=this.webStorage)===null||t===void 0?void 0:t.getItem(this.zombiedClientLocalStorageKey(e)))!==null;return R(ps,`Client '${e}' ${i?"is":"is not"} zombied in LocalStorage`),i}catch(i){return Ze(ps,"Failed to get zombied client id.",i),!1}}markClientZombied(){if(this.webStorage)try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch(e){Ze("Failed to set zombie client id.",e)}}removeClientZombiedEntry(){if(this.webStorage)try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch{}}zombiedClientLocalStorageKey(e){return`${hW}_${this.persistenceKey}_${e}`}};function Tu(n){return Rt(n,sd)}function qm(n){return Rt(n,gc)}function ZC(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}function fW(n){return p(this,null,function*(){if(!Er.isAvailable())return Promise.resolve();let e=n+NO;yield Er.delete(e)})}var JC="LocalStore",mW=5*60*1e6,Xu=class{constructor(e,t,i,r){this.persistence=e,this.queryEngine=t,this.serializer=r,this.targetDataByTarget=new ze(te),this.targetIdByTarget=new Ji(s=>wo(s),ld),this.collectionGroupReadTime=new Map,this.remoteDocuments=e.getRemoteDocumentCache(),this.targetCache=e.getTargetCache(),this.bundleCache=e.getBundleCache(),this.initializeUserComponents(i)}initializeUserComponents(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new yp(this.remoteDocuments,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.remoteDocuments.setIndexManager(this.indexManager),this.queryEngine.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.targetDataByTarget))}};function FO(n,e,t,i){return new Xu(n,e,t,i)}function LO(n,e){return p(this,null,function*(){let t=B(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next(o=>(s=o,t.initializeUserComponents(e),t.mutationQueue.getAllMutationBatches(r))).next(o=>{let a=[],c=[],l=ne();for(let u of s){a.push(u.batchId);for(let d of u.mutations)l=l.add(d.key)}for(let u of o){c.push(u.batchId);for(let d of u.mutations)l=l.add(d.key)}return t.localDocuments.getDocuments(r,l).next(u=>({affectedDocuments:u,removedBatchIds:a,addedBatchIds:c}))})})})}function pW(n,e){let t=B(n),i=Je.now(),r=e.reduce((a,c)=>a.add(c.key),ne()),s,o;return t.persistence.runTransaction("Locally write mutations","readwrite",a=>{let c=gn(),l=ne();return t.remoteDocuments.getEntries(a,r).next(u=>{c=u,c.forEach((d,h)=>{h.isValidDocument()||(l=l.add(d))})}).next(()=>t.localDocuments.getOverlayedDocuments(a,c)).next(u=>{s=u;let d=[];for(let h of e){let m=K5(h,s.get(h.key).overlayedDocument);m!=null&&d.push(new yi(h.key,m,VM(m.value.mapValue),st.exists(!0)))}return t.mutationQueue.addMutationBatch(a,i,d,e)}).next(u=>{o=u;let d=u.applyToLocalDocumentSet(s,l);return t.documentOverlayCache.saveOverlays(a,u.batchId,d)})}).then(()=>({batchId:o.batchId,changes:JM(s)}))}function gW(n,e){let t=B(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",i=>{let r=e.batch.keys(),s=t.remoteDocuments.newChangeBuffer({trackRemovals:!0});return xW(t,i,e,s).next(()=>s.apply(i)).next(()=>t.mutationQueue.performConsistencyCheck(i)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(i,r,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(i,yW(e))).next(()=>t.localDocuments.getDocuments(i,r))})}function yW(n){let e=ne();for(let t=0;t<n.mutationResults.length;++t)n.mutationResults[t].transformResults.length>0&&(e=e.add(n.batch.mutations[t].key));return e}function bW(n,e){let t=B(n);return t.persistence.runTransaction("Reject batch","readwrite-primary",i=>{let r;return t.mutationQueue.lookupMutationBatch(i,e).next(s=>($(s!==null),r=s.keys(),t.mutationQueue.removeMutationBatch(i,s))).next(()=>t.mutationQueue.performConsistencyCheck(i)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(i,r,e)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(i,r)).next(()=>t.localDocuments.getDocuments(i,r))})}function vW(n){let e=B(n);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",t=>e.mutationQueue.getHighestUnacknowledgedBatchId(t))}function BO(n){let e=B(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.targetCache.getLastRemoteSnapshotVersion(t))}function _W(n,e){let t=B(n),i=e.snapshotVersion,r=t.targetDataByTarget;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=t.remoteDocuments.newChangeBuffer({trackRemovals:!0});r=t.targetDataByTarget;let a=[];e.targetChanges.forEach((u,d)=>{let h=r.get(d);if(!h)return;a.push(t.targetCache.removeMatchingKeys(s,u.removedDocuments,d).next(()=>t.targetCache.addMatchingKeys(s,u.addedDocuments,d)));let m=h.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(d)!==null?m=m.withResumeToken(kt.EMPTY_BYTE_STRING,Q.min()).withLastLimboFreeSnapshotVersion(Q.min()):u.resumeToken.approximateByteSize()>0&&(m=m.withResumeToken(u.resumeToken,i)),r=r.insert(d,m),wW(h,m,u)&&a.push(t.targetCache.updateTargetData(s,m))});let c=gn(),l=ne();if(e.documentUpdates.forEach(u=>{e.resolvedLimboDocuments.has(u)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(s,u))}),a.push(VO(s,o,e.documentUpdates).next(u=>{c=u.changedDocuments,l=u.existenceChangedKeys})),!i.isEqual(Q.min())){let u=t.targetCache.getLastRemoteSnapshotVersion(s).next(d=>t.targetCache.setTargetsMetadata(s,s.currentSequenceNumber,i));a.push(u)}return b.waitFor(a).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,c,l)).next(()=>c)}).then(s=>(t.targetDataByTarget=r,s))}function VO(n,e,t){let i=ne(),r=ne();return t.forEach(s=>i=i.add(s)),e.getEntries(n,i).next(s=>{let o=gn();return t.forEach((a,c)=>{let l=s.get(a);c.isFoundDocument()!==l.isFoundDocument()&&(r=r.add(a)),c.isNoDocument()&&c.version.isEqual(Q.min())?(e.removeEntry(a,c.readTime),o=o.insert(a,c)):!l.isValidDocument()||c.version.compareTo(l.version)>0||c.version.compareTo(l.version)===0&&l.hasPendingWrites?(e.addEntry(c),o=o.insert(a,c)):R(JC,"Ignoring outdated watch update for ",a,". Current version:",l.version," Watch version:",c.version)}),{changedDocuments:o,existenceChangedKeys:r}})}function wW(n,e,t){return n.resumeToken.approximateByteSize()===0||e.snapshotVersion.toMicroseconds()-n.snapshotVersion.toMicroseconds()>=mW?!0:t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size>0}function CW(n,e){return p(this,null,function*(){let t=B(n);try{yield t.persistence.runTransaction("notifyLocalViewChanges","readwrite",i=>b.forEach(e,r=>b.forEach(r.addedKeys,s=>t.persistence.referenceDelegate.addReference(i,r.targetId,s)).next(()=>b.forEach(r.removedKeys,s=>t.persistence.referenceDelegate.removeReference(i,r.targetId,s)))))}catch(i){if(Rs(i))R(JC,"Failed to update sequence numbers: "+i);else throw i}for(let i of e){let r=i.targetId;if(!i.fromCache){let s=t.targetDataByTarget.get(r),o=s.snapshotVersion,a=s.withLastLimboFreeSnapshotVersion(o);t.targetDataByTarget=t.targetDataByTarget.insert(r,a)}}})}function EW(n,e){let t=B(n);return t.persistence.runTransaction("Get next mutation batch","readonly",i=>(e===void 0&&(e=vs),t.mutationQueue.getNextMutationBatchAfterBatchId(i,e)))}function SW(n,e){let t=B(n);return t.persistence.runTransaction("read document","readonly",i=>t.localDocuments.getDocument(i,e))}function Tc(n,e){let t=B(n);return t.persistence.runTransaction("Allocate target","readwrite",i=>{let r;return t.targetCache.getTargetData(i,e).next(s=>s?(r=s,b.resolve(r)):t.targetCache.allocateTargetId(i).next(o=>(r=new Ec(e,o,"TargetPurposeListen",i.currentSequenceNumber),t.targetCache.addTargetData(i,r).next(()=>r))))}).then(i=>{let r=t.targetDataByTarget.get(i.targetId);return(r===null||i.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(t.targetDataByTarget=t.targetDataByTarget.insert(i.targetId,i),t.targetIdByTarget.set(e,i.targetId)),i})}function TW(n,e,t){let i=B(n),r=i.targetIdByTarget.get(t);return r!==void 0?b.resolve(i.targetDataByTarget.get(r)):i.targetCache.getTargetData(e,t)}function xc(n,e,t){return p(this,null,function*(){let i=B(n),r=i.targetDataByTarget.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield i.persistence.runTransaction("Release target",s,o=>i.persistence.referenceDelegate.removeTarget(o,r)))}catch(o){if(Rs(o))R(JC,`Failed to update sequence numbers for target ${e}: ${o}`);else throw o}i.targetDataByTarget=i.targetDataByTarget.remove(e),i.targetIdByTarget.delete(r.target)})}function Zp(n,e,t){let i=B(n),r=Q.min(),s=ne();return i.persistence.runTransaction("Execute query","readwrite",o=>TW(i,o,an(e)).next(a=>{if(a)return r=a.lastLimboFreeSnapshotVersion,i.targetCache.getMatchingKeysForTargetId(o,a.targetId).next(c=>{s=c})}).next(()=>i.queryEngine.getDocumentsMatchingQuery(o,e,t?r:Q.min(),t?s:ne())).next(a=>(qO(i,YM(e),a),{documents:a,remoteKeys:s})))}function xW(n,e,t,i){let r=t.batch,s=r.keys(),o=b.resolve();return s.forEach(a=>{o=o.next(()=>i.getEntry(e,a)).next(c=>{let l=t.docVersions.get(a);$(l!==null),c.version.compareTo(l)<0&&(r.applyToRemoteDocument(c,t),c.isValidDocument()&&(c.setReadTime(t.commitVersion),i.addEntry(c)))})}),o.next(()=>n.mutationQueue.removeMutationBatch(e,r))}function IW(n,e){let t=B(n),i=B(t.mutationQueue);return t.persistence.runTransaction("Lookup mutation documents","readonly",r=>i.lookupMutationKeys(r,e).next(s=>s?t.localDocuments.getDocuments(r,s):b.resolve(null)))}function AW(n,e){B(B(n,Xu).mutationQueue).removeCachedMutationKeys(e)}function DW(n){return B(B(n,Xu).persistence).getActiveClients()}function UO(n,e){let t=B(n),i=B(t.targetCache),r=t.targetDataByTarget.get(e);return r?Promise.resolve(r.target):t.persistence.runTransaction("Get target data","readonly",s=>i.getTargetDataForTarget(s,e).next(o=>o?o.target:null))}function jO(n,e){let t=B(n),i=t.collectionGroupReadTime.get(e)||Q.min();return t.persistence.runTransaction("Get new document changes","readonly",r=>t.remoteDocuments.getAllFromCollectionGroup(r,e,fM(i,pc),Number.MAX_SAFE_INTEGER)).then(r=>(qO(t,e,r),r))}function qO(n,e,t){let i=n.collectionGroupReadTime.get(e)||Q.min();t.forEach((r,s)=>{s.readTime.compareTo(i)>0&&(i=s.readTime)}),n.collectionGroupReadTime.set(e,i)}function kW(n){return an(Fc(_e.fromString(`__bundle__/docs/${n}`)))}function RW(n,e,t,i){return p(this,null,function*(){let r=B(n),s=ne(),o=gn();for(let l of t){let u=e.toDocumentKey(l.metadata.name);l.document&&(s=s.add(u));let d=e.toMutableDocument(l);d.setReadTime(e.toSnapshotVersion(l.metadata.readTime)),o=o.insert(u,d)}let a=r.remoteDocuments.newChangeBuffer({trackRemovals:!0}),c=yield Tc(r,kW(i));return r.persistence.runTransaction("Apply bundle documents","readwrite",l=>VO(l,a,o).next(u=>(a.apply(l),u)).next(u=>r.targetCache.removeMatchingKeysForTargetId(l,c.targetId).next(()=>r.targetCache.addMatchingKeys(l,s,c.targetId)).next(()=>r.localDocuments.getLocalViewOfDocuments(l,u.changedDocuments,u.existenceChangedKeys)).next(()=>u.changedDocuments)))})}function MW(n,e){let t=B(n),i=ft(e.createTime);return t.persistence.runTransaction("hasNewerBundle","readonly",r=>t.bundleCache.getBundleMetadata(r,e.id)).then(r=>!!r&&r.createTime.compareTo(i)>=0)}function OW(n,e){let t=B(n);return t.persistence.runTransaction("Save bundle","readwrite",i=>t.bundleCache.saveBundleMetadata(i,e))}function PW(n,e){let t=B(n);return t.persistence.runTransaction("Get named query","readonly",i=>t.bundleCache.getNamedQuery(i,e))}function NW(i,r){return p(this,arguments,function*(n,e,t=ne()){let s=yield Tc(n,an(KC(e.bundledQuery))),o=B(n);return o.persistence.runTransaction("Save named query","readwrite",a=>{let c=ft(e.readTime);if(s.snapshotVersion.compareTo(c)>=0)return o.bundleCache.saveNamedQuery(a,e);let l=s.withResumeToken(kt.EMPTY_BYTE_STRING,c);return o.targetDataByTarget=o.targetDataByTarget.insert(l.targetId,l),o.targetCache.updateTargetData(a,l).next(()=>o.targetCache.removeMatchingKeysForTargetId(a,s.targetId)).next(()=>o.targetCache.addMatchingKeys(a,t,s.targetId)).next(()=>o.bundleCache.saveNamedQuery(a,e))})})}var Ww=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var FW=100;function LW(){return Hg()?8:Er.getAndroidVersion(al())>0?6:4}var _p=class{constructor(){this.initialized=!1,this.indexAutoCreationEnabled=!1,this.indexAutoCreationMinCollectionSize=FW,this.relativeIndexReadCostPerDocument=LW()}initialize(e,t){this.localDocumentsView=e,this.indexManager=t,this.initialized=!0}getDocumentsMatchingQuery(e,t,i,r){let s={result:null};return this.performQueryUsingIndex(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.performQueryUsingRemoteKeys(e,t,r,i).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new Ww;return this.executeFullCollectionScan(e,t,o).next(a=>{if(s.result=a,this.indexAutoCreationEnabled)return this.createCacheIndexes(e,t,o,a.size)})}).next(()=>s.result)}createCacheIndexes(e,t,i,r){return i.documentReadCount<this.indexAutoCreationMinCollectionSize?(oc()<=Si.DEBUG&&R("QueryEngine","SDK will not create cache indexes for query:",ac(t),"since it only creates cache indexes for collection contains","more than or equal to",this.indexAutoCreationMinCollectionSize,"documents"),b.resolve()):(oc()<=Si.DEBUG&&R("QueryEngine","Query:",ac(t),"scans",i.documentReadCount,"local documents and returns",r,"documents as results."),i.documentReadCount>this.relativeIndexReadCostPerDocument*r?(oc()<=Si.DEBUG&&R("QueryEngine","The SDK decides to create cache indexes for query:",ac(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,an(t))):b.resolve())}performQueryUsingIndex(e,t){if(mR(t))return b.resolve(null);let i=an(t);return this.indexManager.getIndexType(e,i).next(r=>r===0?null:(t.limit!==null&&r===1&&(t=op(t,null,"F"),i=an(t)),this.indexManager.getDocumentsMatchingTarget(e,i).next(s=>{let o=ne(...s);return this.localDocumentsView.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,i).next(c=>{let l=this.applyQuery(t,a);return this.needsRefill(t,l,o,c.readTime)?this.performQueryUsingIndex(e,op(t,null,"F")):this.appendRemainingResults(e,l,t,c)}))})))}performQueryUsingRemoteKeys(e,t,i,r){return mR(t)||r.isEqual(Q.min())?b.resolve(null):this.localDocumentsView.getDocuments(e,i).next(s=>{let o=this.applyQuery(t,s);return this.needsRefill(t,o,i,r)?b.resolve(null):(oc()<=Si.DEBUG&&R("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),ac(t)),this.appendRemainingResults(e,o,t,fM(r,pc)).next(a=>a))})}applyQuery(e,t){let i=new Ne(XM(e));return t.forEach((r,s)=>{dd(e,s)&&(i=i.add(s))}),i}needsRefill(e,t,i,r){if(e.limit===null)return!1;if(i.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return s?s.hasPendingWrites||s.version.compareTo(r)>0:!1}executeFullCollectionScan(e,t,i){return oc()<=Si.DEBUG&&R("QueryEngine","Using full collection scan to execute query:",ac(t)),this.localDocumentsView.getDocumentsMatchingQuery(e,t,$n.min(),i)}appendRemainingResults(e,t,i,r){return this.localDocumentsView.getDocumentsMatchingQuery(e,i,r).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}};var zO="firestore_clients";function KR(n,e){return`${zO}_${n}_${e}`}var GO="firestore_mutations";function QR(n,e,t){let i=`${GO}_${n}_${t}`;return e.isAuthenticated()&&(i+=`_${e.uid}`),i}var WO="firestore_targets";function R0(n,e){return`${WO}_${n}_${e}`}var BW="firestore_online_state";function VW(n){return`${BW}_${n}`}var UW="firestore_bundle_loaded_v2";function jW(n){return`${UW}_${n}`}var qW="firestore_sequence_number";function zW(n){return`${qW}_${n}`}var Hi="SharedClientState",wp=class n{constructor(e,t,i,r){this.user=e,this.batchId=t,this.state=i,this.error=r}static fromWebStorageEntry(e,t,i){let r=JSON.parse(i),s=typeof r=="object"&&["pending","acknowledged","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object"),o;return s&&r.error&&(s=typeof r.error.message=="string"&&typeof r.error.code=="string",s&&(o=new x(r.error.code,r.error.message))),s?new n(e,t,r.state,o):(Ze(Hi,`Failed to parse mutation state for ID '${t}': ${i}`),null)}toWebStorageJSON(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},Mu=class n{constructor(e,t,i){this.targetId=e,this.state=t,this.error=i}static fromWebStorageEntry(e,t){let i=JSON.parse(t),r=typeof i=="object"&&["not-current","current","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object"),s;return r&&i.error&&(r=typeof i.error.message=="string"&&typeof i.error.code=="string",r&&(s=new x(i.error.code,i.error.message))),r?new n(e,i.state,s):(Ze(Hi,`Failed to parse target state for ID '${e}': ${t}`),null)}toWebStorageJSON(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},Cp=class n{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static fromWebStorageEntry(e,t){let i=JSON.parse(t),r=typeof i=="object"&&i.activeTargetIds instanceof Array,s=$C();for(let o=0;r&&o<i.activeTargetIds.length;++o)r=FM(i.activeTargetIds[o]),s=s.add(i.activeTargetIds[o]);return r?new n(e,s):(Ze(Hi,`Failed to parse client data for instance '${e}': ${t}`),null)}},$w=class n{constructor(e,t){this.clientId=e,this.onlineState=t}static fromWebStorageEntry(e){let t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new n(t.clientId,t.onlineState):(Ze(Hi,`Failed to parse online state: ${e}`),null)}},Zu=class{constructor(){this.activeTargetIds=$C()}addQueryTarget(e){this.activeTargetIds=this.activeTargetIds.add(e)}removeQueryTarget(e){this.activeTargetIds=this.activeTargetIds.delete(e)}toWebStorageJSON(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}},Ou=class{constructor(e,t,i,r,s){this.window=e,this.queue=t,this.persistenceKey=i,this.localClientId=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.storageListener=this.handleWebStorageEvent.bind(this),this.activeClients=new ze(te),this.started=!1,this.earlyEvents=[];let o=i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.localClientStorageKey=KR(this.persistenceKey,this.localClientId),this.sequenceNumberKey=zW(this.persistenceKey),this.activeClients=this.activeClients.insert(this.localClientId,new Zu),this.clientStateKeyRe=new RegExp(`^${zO}_${o}_([^_]*)$`),this.mutationBatchKeyRe=new RegExp(`^${GO}_${o}_(\\d+)(?:_(.*))?$`),this.queryTargetKeyRe=new RegExp(`^${WO}_${o}_(\\d+)$`),this.onlineStateKey=VW(this.persistenceKey),this.bundleLoadedKey=jW(this.persistenceKey),this.window.addEventListener("storage",this.storageListener)}static isAvailable(e){return!!(e&&e.localStorage)}start(){return p(this,null,function*(){let e=yield this.syncEngine.getActiveClients();for(let i of e){if(i===this.localClientId)continue;let r=this.getItem(KR(this.persistenceKey,i));if(r){let s=Cp.fromWebStorageEntry(i,r);s&&(this.activeClients=this.activeClients.insert(s.clientId,s))}}this.persistClientState();let t=this.storage.getItem(this.onlineStateKey);if(t){let i=this.fromWebStorageOnlineState(t);i&&this.handleOnlineStateEvent(i)}for(let i of this.earlyEvents)this.handleWebStorageEvent(i);this.earlyEvents=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(e){this.setItem(this.sequenceNumberKey,JSON.stringify(e))}getAllActiveQueryTargets(){return this.extractActiveQueryTargets(this.activeClients)}isActiveQueryTarget(e){let t=!1;return this.activeClients.forEach((i,r)=>{r.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.persistMutationState(e,"pending")}updateMutationState(e,t,i){this.persistMutationState(e,t,i),this.removeMutationState(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){let i=this.storage.getItem(R0(this.persistenceKey,e));if(i){let r=Mu.fromWebStorageEntry(e,i);r&&(t=r.state)}}return this.localClientState.addQueryTarget(e),this.persistClientState(),t}removeLocalQueryTarget(e){this.localClientState.removeQueryTarget(e),this.persistClientState()}isLocalQueryTarget(e){return this.localClientState.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(R0(this.persistenceKey,e))}updateQueryState(e,t,i){this.persistQueryTargetState(e,t,i)}handleUserChange(e,t,i){t.forEach(r=>{this.removeMutationState(r)}),this.currentUser=e,i.forEach(r=>{this.addPendingMutation(r)})}setOnlineState(e){this.persistOnlineState(e)}notifyBundleLoaded(e){this.persistBundleLoadedState(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.storageListener),this.removeItem(this.localClientStorageKey),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return R(Hi,"READ",e,t),t}setItem(e,t){R(Hi,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){R(Hi,"REMOVE",e),this.storage.removeItem(e)}handleWebStorageEvent(e){let t=e;if(t.storageArea===this.storage){if(R(Hi,"EVENT",t.key,t.newValue),t.key===this.localClientStorageKey){Ze("Received WebStorage notification for local change. Another client might have garbage-collected our state");return}this.queue.enqueueRetryable(()=>p(this,null,function*(){if(!this.started){this.earlyEvents.push(t);return}if(t.key!==null){if(this.clientStateKeyRe.test(t.key))if(t.newValue!=null){let i=this.fromWebStorageClientState(t.key,t.newValue);if(i)return this.handleClientStateEvent(i.clientId,i)}else{let i=this.fromWebStorageClientStateKey(t.key);return this.handleClientStateEvent(i,null)}else if(this.mutationBatchKeyRe.test(t.key)){if(t.newValue!==null){let i=this.fromWebStorageMutationMetadata(t.key,t.newValue);if(i)return this.handleMutationBatchEvent(i)}}else if(this.queryTargetKeyRe.test(t.key)){if(t.newValue!==null){let i=this.fromWebStorageQueryTargetMetadata(t.key,t.newValue);if(i)return this.handleQueryTargetEvent(i)}}else if(t.key===this.onlineStateKey){if(t.newValue!==null){let i=this.fromWebStorageOnlineState(t.newValue);if(i)return this.handleOnlineStateEvent(i)}}else if(t.key===this.sequenceNumberKey){let i=GW(t.newValue);i!==Sn.INVALID&&this.sequenceNumberHandler(i)}else if(t.key===this.bundleLoadedKey){let i=this.fromWebStoreBundleLoadedState(t.newValue);yield Promise.all(i.map(r=>this.syncEngine.synchronizeWithChangedDocuments(r)))}}}))}}get localClientState(){return this.activeClients.get(this.localClientId)}persistClientState(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())}persistMutationState(e,t,i){let r=new wp(this.currentUser,e,t,i),s=QR(this.persistenceKey,this.currentUser,e);this.setItem(s,r.toWebStorageJSON())}removeMutationState(e){let t=QR(this.persistenceKey,this.currentUser,e);this.removeItem(t)}persistOnlineState(e){let t={clientId:this.localClientId,onlineState:e};this.storage.setItem(this.onlineStateKey,JSON.stringify(t))}persistQueryTargetState(e,t,i){let r=R0(this.persistenceKey,e),s=new Mu(e,t,i);this.setItem(r,s.toWebStorageJSON())}persistBundleLoadedState(e){let t=JSON.stringify(Array.from(e));this.setItem(this.bundleLoadedKey,t)}fromWebStorageClientStateKey(e){let t=this.clientStateKeyRe.exec(e);return t?t[1]:null}fromWebStorageClientState(e,t){let i=this.fromWebStorageClientStateKey(e);return Cp.fromWebStorageEntry(i,t)}fromWebStorageMutationMetadata(e,t){let i=this.mutationBatchKeyRe.exec(e),r=Number(i[1]),s=i[2]!==void 0?i[2]:null;return wp.fromWebStorageEntry(new wt(s),r,t)}fromWebStorageQueryTargetMetadata(e,t){let i=this.queryTargetKeyRe.exec(e),r=Number(i[1]);return Mu.fromWebStorageEntry(r,t)}fromWebStorageOnlineState(e){return $w.fromWebStorageEntry(e)}fromWebStoreBundleLoadedState(e){return JSON.parse(e)}handleMutationBatchEvent(e){return p(this,null,function*(){if(e.user.uid!==this.currentUser.uid){R(Hi,`Ignoring mutation for non-active user ${e.user.uid}`);return}return this.syncEngine.applyBatchState(e.batchId,e.state,e.error)})}handleQueryTargetEvent(e){return this.syncEngine.applyTargetState(e.targetId,e.state,e.error)}handleClientStateEvent(e,t){let i=t?this.activeClients.insert(e,t):this.activeClients.remove(e),r=this.extractActiveQueryTargets(this.activeClients),s=this.extractActiveQueryTargets(i),o=[],a=[];return s.forEach(c=>{r.has(c)||o.push(c)}),r.forEach(c=>{s.has(c)||a.push(c)}),this.syncEngine.applyActiveTargetsChange(o,a).then(()=>{this.activeClients=i})}handleOnlineStateEvent(e){this.activeClients.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}extractActiveQueryTargets(e){let t=$C();return e.forEach((i,r)=>{t=t.unionWith(r.activeTargetIds)}),t}};function GW(n){let e=Sn.INVALID;if(n!=null)try{let t=JSON.parse(n);$(typeof t=="number"),e=t}catch(t){Ze(Hi,"Failed to read sequence number from WebStorage",t)}return e}var Ep=class{constructor(){this.localState=new Zu,this.queryState={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,i){}addLocalQueryTarget(e){return this.localState.addQueryTarget(e),this.queryState[e]||"not-current"}updateQueryState(e,t,i){this.queryState[e]=t}removeLocalQueryTarget(e){this.localState.removeQueryTarget(e)}isLocalQueryTarget(e){return this.localState.activeTargetIds.has(e)}clearQueryState(e){delete this.queryState[e]}getAllActiveQueryTargets(){return this.localState.activeTargetIds}isActiveQueryTarget(e){return this.localState.activeTargetIds.has(e)}start(){return this.localState=new Zu,Promise.resolve()}handleUserChange(e,t,i){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var Hw=class{addCallback(e){}shutdown(){}};var Kw=class{constructor(e){this.sendFn=e.sendFn,this.closeFn=e.closeFn}onOpen(e){this.wrappedOnOpen=e}onClose(e){this.wrappedOnClose=e}onMessage(e){this.wrappedOnMessage=e}close(){this.closeFn()}send(e){this.sendFn(e)}callOnOpen(){this.wrappedOnOpen()}callOnClose(e){this.wrappedOnClose(e)}callOnMessage(e){this.wrappedOnMessage(e)}};var zm=null;function WW(){return 268435456+Math.round(2147483648*Math.random())}function M0(){return zm===null?zm=WW():zm++,"0x"+zm.toString(16)}function $W(n){return new Promise((e,t)=>{n((i,r)=>{i?t(i):e(r)})})}var HW="1.9.1",sn="GrpcConnection",KW=`gl-node/${process.versions.node} fire/${Mc} grpc/${HW}`;function O0(n,e,t,i){$(e===null||e.type==="OAuth");let r=new po.Metadata;return e&&e.headers.forEach((s,o)=>r.set(o,s)),t&&t.headers.forEach((s,o)=>r.set(o,s)),i&&r.set("X-Firebase-GMPID",i),r.set("X-Goog-Api-Client",KW),r.set("Google-Cloud-Resource-Prefix",n),r.set("x-goog-request-params",n),r}var Qw=class{constructor(e,t){this.databaseInfo=t,this.cachedStub=null,this.firestore=e.google.firestore.v1,this.databasePath=`projects/${t.databaseId.projectId}/databases/${t.databaseId.database}`}get shouldResourcePathBeIncludedInRequest(){return!0}ensureActiveStub(){if(!this.cachedStub){R(sn,"Creating Firestore stub.");let e=this.databaseInfo.ssl?po.credentials.createSsl():po.credentials.createInsecure();this.cachedStub=new this.firestore.Firestore(this.databaseInfo.host,e)}return this.cachedStub}invokeRPC(e,t,i,r,s){let o=M0(),a=this.ensureActiveStub(),c=O0(this.databasePath,r,s,this.databaseInfo.appId),l=Object.assign({database:this.databasePath},i);return $W(u=>(R(sn,`RPC '${e}' ${o} invoked with request:`,i),a[e](l,c,(d,h)=>{d?(R(sn,`RPC '${e}' ${o} failed with error:`,d),u(new x(Km(d.code),d.message))):(R(sn,`RPC '${e}' ${o} completed with response:`,h),u(void 0,h))})))}invokeStreamingRPC(e,t,i,r,s,o){let a=M0(),c=[],l=new ht;R(sn,`RPC '${e}' ${a} invoked (streaming) with request:`,i);let u=this.ensureActiveStub(),d=O0(this.databasePath,r,s,this.databaseInfo.appId),h=Object.assign(Object.assign({},i),{database:this.databasePath}),m=u[e](h,d),g=!1;return m.on("data",y=>{R(sn,`RPC ${e} ${a} received result:`,y),c.push(y),o!==void 0&&c.length===o&&(g=!0,l.resolve(c))}),m.on("end",()=>{R(sn,`RPC '${e}' ${a} completed.`),g||(g=!0,l.resolve(c))}),m.on("error",y=>{R(sn,`RPC '${e}' ${a} failed with error:`,y);let _=Km(y.code);l.reject(new x(_,y.message))}),l.promise}openStream(e,t,i){let r=M0(),s=this.ensureActiveStub(),o=O0(this.databasePath,t,i,this.databaseInfo.appId),a=s[e](o),c=!1,l=d=>{c||(c=!0,u.callOnClose(d),a.end())},u=new Kw({sendFn:d=>{if(c)R(sn,`RPC '${e}' stream ${r} not sending because gRPC stream is closed:`,d);else{R(sn,`RPC '${e}' stream ${r} sending:`,d);try{a.write(d)}catch(h){throw Ze("Failure sending:",d),Ze("Error:",h),h}}},closeFn:()=>{R(sn,`RPC '${e}' stream ${r} closed locally via close().`),l()}});return a.on("data",d=>{c||(R(sn,`RPC '${e}' stream ${r} received:`,d),u.callOnMessage(d))}),a.on("end",()=>{R(sn,`RPC '${e}' stream ${r} ended.`),l()}),a.on("error",d=>{if(!c){Wn(sn,`RPC '${e}' stream ${r} error. Code:`,d.code,"Message:",d.message);let h=Km(d.code);l(new x(h,d.message))}}),R(sn,`Opening RPC '${e}' stream ${r} to ${this.databaseInfo.host}`),setTimeout(()=>{u.callOnOpen()},0),u}terminate(){this.cachedStub&&(this.cachedStub.close(),this.cachedStub=void 0)}},$O={google:{nested:{protobuf:{options:{csharp_namespace:"Google.Protobuf.WellKnownTypes",go_package:"github.com/golang/protobuf/ptypes/wrappers",java_package:"com.google.protobuf",java_outer_classname:"WrappersProto",java_multiple_files:!0,objc_class_prefix:"GPB",cc_enable_arenas:!0,optimize_for:"SPEED"},nested:{Timestamp:{fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}},FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5},serverStreaming:{type:"bool",id:6}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16},javaGenericServices:{type:"bool",id:17},pyGenericServices:{type:"bool",id:18},deprecated:{type:"bool",id:23},ccEnableArenas:{type:"bool",id:31},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1},noStandardDescriptorAccessor:{type:"bool",id:2},deprecated:{type:"bool",id:3},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[8,8]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5},deprecated:{type:"bool",id:3},weak:{type:"bool",id:10},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}},Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},Empty:{fields:{}},DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}},Any:{fields:{typeUrl:{type:"string",id:1},value:{type:"bytes",id:2}}}}},firestore:{nested:{v1:{options:{csharp_namespace:"Google.Cloud.Firestore.V1",go_package:"google.golang.org/genproto/googleapis/firestore/v1;firestore",java_multiple_files:!0,java_outer_classname:"WriteProto",java_package:"com.google.firestore.v1",objc_class_prefix:"GCFS",php_namespace:"Google\\Cloud\\Firestore\\V1",ruby_package:"Google::Cloud::Firestore::V1"},nested:{AggregationResult:{fields:{aggregateFields:{keyType:"string",type:"Value",id:2}}},BitSequence:{fields:{bitmap:{type:"bytes",id:1},padding:{type:"int32",id:2}}},BloomFilter:{fields:{bits:{type:"BitSequence",id:1},hashCount:{type:"int32",id:2}}},DocumentMask:{fields:{fieldPaths:{rule:"repeated",type:"string",id:1}}},Precondition:{oneofs:{conditionType:{oneof:["exists","updateTime"]}},fields:{exists:{type:"bool",id:1},updateTime:{type:"google.protobuf.Timestamp",id:2}}},TransactionOptions:{oneofs:{mode:{oneof:["readOnly","readWrite"]}},fields:{readOnly:{type:"ReadOnly",id:2},readWrite:{type:"ReadWrite",id:3}},nested:{ReadWrite:{fields:{retryTransaction:{type:"bytes",id:1}}},ReadOnly:{oneofs:{consistencySelector:{oneof:["readTime"]}},fields:{readTime:{type:"google.protobuf.Timestamp",id:2}}}}},Document:{fields:{name:{type:"string",id:1},fields:{keyType:"string",type:"Value",id:2},createTime:{type:"google.protobuf.Timestamp",id:3},updateTime:{type:"google.protobuf.Timestamp",id:4}}},Value:{oneofs:{valueType:{oneof:["nullValue","booleanValue","integerValue","doubleValue","timestampValue","stringValue","bytesValue","referenceValue","geoPointValue","arrayValue","mapValue"]}},fields:{nullValue:{type:"google.protobuf.NullValue",id:11},booleanValue:{type:"bool",id:1},integerValue:{type:"int64",id:2},doubleValue:{type:"double",id:3},timestampValue:{type:"google.protobuf.Timestamp",id:10},stringValue:{type:"string",id:17},bytesValue:{type:"bytes",id:18},referenceValue:{type:"string",id:5},geoPointValue:{type:"google.type.LatLng",id:8},arrayValue:{type:"ArrayValue",id:9},mapValue:{type:"MapValue",id:6}}},ArrayValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},MapValue:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Firestore:{options:{"(google.api.default_host)":"firestore.googleapis.com","(google.api.oauth_scopes)":"https://www.googleapis.com/auth/cloud-platform,https://www.googleapis.com/auth/datastore"},methods:{GetDocument:{requestType:"GetDocumentRequest",responseType:"Document",options:{"(google.api.http).get":"/v1/{name=projects/*/databases/*/documents/*/**}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{name=projects/*/databases/*/documents/*/**}"}}]},ListDocuments:{requestType:"ListDocumentsRequest",responseType:"ListDocumentsResponse",options:{"(google.api.http).get":"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"}}]},UpdateDocument:{requestType:"UpdateDocumentRequest",responseType:"Document",options:{"(google.api.http).patch":"/v1/{document.name=projects/*/databases/*/documents/*/**}","(google.api.http).body":"document","(google.api.method_signature)":"document,update_mask"},parsedOptions:[{"(google.api.http)":{patch:"/v1/{document.name=projects/*/databases/*/documents/*/**}",body:"document"}},{"(google.api.method_signature)":"document,update_mask"}]},DeleteDocument:{requestType:"DeleteDocumentRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).delete":"/v1/{name=projects/*/databases/*/documents/*/**}","(google.api.method_signature)":"name"},parsedOptions:[{"(google.api.http)":{delete:"/v1/{name=projects/*/databases/*/documents/*/**}"}},{"(google.api.method_signature)":"name"}]},BatchGetDocuments:{requestType:"BatchGetDocumentsRequest",responseType:"BatchGetDocumentsResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchGet","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchGet",body:"*"}}]},BeginTransaction:{requestType:"BeginTransactionRequest",responseType:"BeginTransactionResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:beginTransaction","(google.api.http).body":"*","(google.api.method_signature)":"database"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:beginTransaction",body:"*"}},{"(google.api.method_signature)":"database"}]},Commit:{requestType:"CommitRequest",responseType:"CommitResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:commit","(google.api.http).body":"*","(google.api.method_signature)":"database,writes"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:commit",body:"*"}},{"(google.api.method_signature)":"database,writes"}]},Rollback:{requestType:"RollbackRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:rollback","(google.api.http).body":"*","(google.api.method_signature)":"database,transaction"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:rollback",body:"*"}},{"(google.api.method_signature)":"database,transaction"}]},RunQuery:{requestType:"RunQueryRequest",responseType:"RunQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery",body:"*"}}}]},RunAggregationQuery:{requestType:"RunAggregationQueryRequest",responseType:"RunAggregationQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery",body:"*"}}}]},PartitionQuery:{requestType:"PartitionQueryRequest",responseType:"PartitionQueryResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:partitionQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:partitionQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery",body:"*"}}}]},Write:{requestType:"WriteRequest",requestStream:!0,responseType:"WriteResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:write","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:write",body:"*"}}]},Listen:{requestType:"ListenRequest",requestStream:!0,responseType:"ListenResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:listen","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:listen",body:"*"}}]},ListCollectionIds:{requestType:"ListCollectionIdsRequest",responseType:"ListCollectionIdsResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds","(google.api.http).additional_bindings.body":"*","(google.api.method_signature)":"parent"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds",body:"*"}}},{"(google.api.method_signature)":"parent"}]},BatchWrite:{requestType:"BatchWriteRequest",responseType:"BatchWriteResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchWrite","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchWrite",body:"*"}}]},CreateDocument:{requestType:"CreateDocumentRequest",responseType:"Document",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}","(google.api.http).body":"document"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}",body:"document"}}]}}},GetDocumentRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:5}}},ListDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:3},pageToken:{type:"string",id:4},orderBy:{type:"string",id:6},mask:{type:"DocumentMask",id:7},transaction:{type:"bytes",id:8},readTime:{type:"google.protobuf.Timestamp",id:10},showMissing:{type:"bool",id:12}}},ListDocumentsResponse:{fields:{documents:{rule:"repeated",type:"Document",id:1},nextPageToken:{type:"string",id:2}}},CreateDocumentRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},documentId:{type:"string",id:3},document:{type:"Document",id:4,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:5}}},UpdateDocumentRequest:{fields:{document:{type:"Document",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},updateMask:{type:"DocumentMask",id:2},mask:{type:"DocumentMask",id:3},currentDocument:{type:"Precondition",id:4}}},DeleteDocumentRequest:{fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},currentDocument:{type:"Precondition",id:2}}},BatchGetDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},documents:{rule:"repeated",type:"string",id:2},mask:{type:"DocumentMask",id:3},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:7}}},BatchGetDocumentsResponse:{oneofs:{result:{oneof:["found","missing"]}},fields:{found:{type:"Document",id:1},missing:{type:"string",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:4}}},BeginTransactionRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},options:{type:"TransactionOptions",id:2}}},BeginTransactionResponse:{fields:{transaction:{type:"bytes",id:1}}},CommitRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},transaction:{type:"bytes",id:3}}},CommitResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},commitTime:{type:"google.protobuf.Timestamp",id:2}}},RollbackRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},transaction:{type:"bytes",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}}}},RunQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},transaction:{type:"bytes",id:5},newTransaction:{type:"TransactionOptions",id:6},readTime:{type:"google.protobuf.Timestamp",id:7}}},RunQueryResponse:{fields:{transaction:{type:"bytes",id:2},document:{type:"Document",id:1},readTime:{type:"google.protobuf.Timestamp",id:3},skippedResults:{type:"int32",id:4}}},RunAggregationQueryRequest:{oneofs:{queryType:{oneof:["structuredAggregationQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredAggregationQuery:{type:"StructuredAggregationQuery",id:2},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:6}}},RunAggregationQueryResponse:{fields:{result:{type:"AggregationResult",id:1},transaction:{type:"bytes",id:2},readTime:{type:"google.protobuf.Timestamp",id:3}}},PartitionQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},partitionCount:{type:"int64",id:3},pageToken:{type:"string",id:4},pageSize:{type:"int32",id:5}}},PartitionQueryResponse:{fields:{partitions:{rule:"repeated",type:"Cursor",id:1},nextPageToken:{type:"string",id:2}}},WriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},streamId:{type:"string",id:2},writes:{rule:"repeated",type:"Write",id:3},streamToken:{type:"bytes",id:4},labels:{keyType:"string",type:"string",id:5}}},WriteResponse:{fields:{streamId:{type:"string",id:1},streamToken:{type:"bytes",id:2},writeResults:{rule:"repeated",type:"WriteResult",id:3},commitTime:{type:"google.protobuf.Timestamp",id:4}}},ListenRequest:{oneofs:{targetChange:{oneof:["addTarget","removeTarget"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},addTarget:{type:"Target",id:2},removeTarget:{type:"int32",id:3},labels:{keyType:"string",type:"string",id:4}}},ListenResponse:{oneofs:{responseType:{oneof:["targetChange","documentChange","documentDelete","documentRemove","filter"]}},fields:{targetChange:{type:"TargetChange",id:2},documentChange:{type:"DocumentChange",id:3},documentDelete:{type:"DocumentDelete",id:4},documentRemove:{type:"DocumentRemove",id:6},filter:{type:"ExistenceFilter",id:5}}},Target:{oneofs:{targetType:{oneof:["query","documents"]},resumeType:{oneof:["resumeToken","readTime"]}},fields:{query:{type:"QueryTarget",id:2},documents:{type:"DocumentsTarget",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:11},targetId:{type:"int32",id:5},once:{type:"bool",id:6},expectedCount:{type:"google.protobuf.Int32Value",id:12}},nested:{DocumentsTarget:{fields:{documents:{rule:"repeated",type:"string",id:2}}},QueryTarget:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1},structuredQuery:{type:"StructuredQuery",id:2}}}}},TargetChange:{fields:{targetChangeType:{type:"TargetChangeType",id:1},targetIds:{rule:"repeated",type:"int32",id:2},cause:{type:"google.rpc.Status",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:6}},nested:{TargetChangeType:{values:{NO_CHANGE:0,ADD:1,REMOVE:2,CURRENT:3,RESET:4}}}},ListCollectionIdsRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:2},pageToken:{type:"string",id:3}}},ListCollectionIdsResponse:{fields:{collectionIds:{rule:"repeated",type:"string",id:1},nextPageToken:{type:"string",id:2}}},BatchWriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},labels:{keyType:"string",type:"string",id:3}}},BatchWriteResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},status:{rule:"repeated",type:"google.rpc.Status",id:2}}},StructuredQuery:{fields:{select:{type:"Projection",id:1},from:{rule:"repeated",type:"CollectionSelector",id:2},where:{type:"Filter",id:3},orderBy:{rule:"repeated",type:"Order",id:4},startAt:{type:"Cursor",id:7},endAt:{type:"Cursor",id:8},offset:{type:"int32",id:6},limit:{type:"google.protobuf.Int32Value",id:5}},nested:{CollectionSelector:{fields:{collectionId:{type:"string",id:2},allDescendants:{type:"bool",id:3}}},Filter:{oneofs:{filterType:{oneof:["compositeFilter","fieldFilter","unaryFilter"]}},fields:{compositeFilter:{type:"CompositeFilter",id:1},fieldFilter:{type:"FieldFilter",id:2},unaryFilter:{type:"UnaryFilter",id:3}}},CompositeFilter:{fields:{op:{type:"Operator",id:1},filters:{rule:"repeated",type:"Filter",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,AND:1,OR:2}}}},FieldFilter:{fields:{field:{type:"FieldReference",id:1},op:{type:"Operator",id:2},value:{type:"Value",id:3}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,LESS_THAN:1,LESS_THAN_OR_EQUAL:2,GREATER_THAN:3,GREATER_THAN_OR_EQUAL:4,EQUAL:5,NOT_EQUAL:6,ARRAY_CONTAINS:7,IN:8,ARRAY_CONTAINS_ANY:9,NOT_IN:10}}}},UnaryFilter:{oneofs:{operandType:{oneof:["field"]}},fields:{op:{type:"Operator",id:1},field:{type:"FieldReference",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,IS_NAN:2,IS_NULL:3,IS_NOT_NAN:4,IS_NOT_NULL:5}}}},Order:{fields:{field:{type:"FieldReference",id:1},direction:{type:"Direction",id:2}}},FieldReference:{fields:{fieldPath:{type:"string",id:2}}},Projection:{fields:{fields:{rule:"repeated",type:"FieldReference",id:2}}},Direction:{values:{DIRECTION_UNSPECIFIED:0,ASCENDING:1,DESCENDING:2}}}},StructuredAggregationQuery:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{structuredQuery:{type:"StructuredQuery",id:1},aggregations:{rule:"repeated",type:"Aggregation",id:3}},nested:{Aggregation:{oneofs:{operator:{oneof:["count","sum","avg"]}},fields:{count:{type:"Count",id:1},sum:{type:"Sum",id:2},avg:{type:"Avg",id:3},alias:{type:"string",id:7}},nested:{Count:{fields:{upTo:{type:"google.protobuf.Int64Value",id:1}}},Sum:{fields:{field:{type:"FieldReference",id:1}}},Avg:{fields:{field:{type:"FieldReference",id:1}}}}}}},Cursor:{fields:{values:{rule:"repeated",type:"Value",id:1},before:{type:"bool",id:2}}},Write:{oneofs:{operation:{oneof:["update","delete","verify","transform"]}},fields:{update:{type:"Document",id:1},delete:{type:"string",id:2},verify:{type:"string",id:5},transform:{type:"DocumentTransform",id:6},updateMask:{type:"DocumentMask",id:3},updateTransforms:{rule:"repeated",type:"DocumentTransform.FieldTransform",id:7},currentDocument:{type:"Precondition",id:4}}},DocumentTransform:{fields:{document:{type:"string",id:1},fieldTransforms:{rule:"repeated",type:"FieldTransform",id:2}},nested:{FieldTransform:{oneofs:{transformType:{oneof:["setToServerValue","increment","maximum","minimum","appendMissingElements","removeAllFromArray"]}},fields:{fieldPath:{type:"string",id:1},setToServerValue:{type:"ServerValue",id:2},increment:{type:"Value",id:3},maximum:{type:"Value",id:4},minimum:{type:"Value",id:5},appendMissingElements:{type:"ArrayValue",id:6},removeAllFromArray:{type:"ArrayValue",id:7}},nested:{ServerValue:{values:{SERVER_VALUE_UNSPECIFIED:0,REQUEST_TIME:1}}}}}},WriteResult:{fields:{updateTime:{type:"google.protobuf.Timestamp",id:1},transformResults:{rule:"repeated",type:"Value",id:2}}},DocumentChange:{fields:{document:{type:"Document",id:1},targetIds:{rule:"repeated",type:"int32",id:5},removedTargetIds:{rule:"repeated",type:"int32",id:6}}},DocumentDelete:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:6},readTime:{type:"google.protobuf.Timestamp",id:4}}},DocumentRemove:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:2},readTime:{type:"google.protobuf.Timestamp",id:4}}},ExistenceFilter:{fields:{targetId:{type:"int32",id:1},count:{type:"int32",id:2},unchangedNames:{type:"BloomFilter",id:3}}}}}}},api:{options:{go_package:"google.golang.org/genproto/googleapis/api/annotations;annotations",java_multiple_files:!0,java_outer_classname:"HttpProto",java_package:"com.google.api",objc_class_prefix:"GAPI",cc_enable_arenas:!0},nested:{http:{type:"HttpRule",id:72295728,extend:"google.protobuf.MethodOptions"},Http:{fields:{rules:{rule:"repeated",type:"HttpRule",id:1}}},HttpRule:{oneofs:{pattern:{oneof:["get","put","post","delete","patch","custom"]}},fields:{get:{type:"string",id:2},put:{type:"string",id:3},post:{type:"string",id:4},delete:{type:"string",id:5},patch:{type:"string",id:6},custom:{type:"CustomHttpPattern",id:8},selector:{type:"string",id:1},body:{type:"string",id:7},additionalBindings:{rule:"repeated",type:"HttpRule",id:11}}},CustomHttpPattern:{fields:{kind:{type:"string",id:1},path:{type:"string",id:2}}},methodSignature:{rule:"repeated",type:"string",id:1051,extend:"google.protobuf.MethodOptions"},defaultHost:{type:"string",id:1049,extend:"google.protobuf.ServiceOptions"},oauthScopes:{type:"string",id:1050,extend:"google.protobuf.ServiceOptions"},fieldBehavior:{rule:"repeated",type:"google.api.FieldBehavior",id:1052,extend:"google.protobuf.FieldOptions"},FieldBehavior:{values:{FIELD_BEHAVIOR_UNSPECIFIED:0,OPTIONAL:1,REQUIRED:2,OUTPUT_ONLY:3,INPUT_ONLY:4,IMMUTABLE:5,UNORDERED_LIST:6,NON_EMPTY_DEFAULT:7}}}},type:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/type/latlng;latlng",java_multiple_files:!0,java_outer_classname:"LatLngProto",java_package:"com.google.type",objc_class_prefix:"GTP"},nested:{LatLng:{fields:{latitude:{type:"double",id:1},longitude:{type:"double",id:2}}}}},rpc:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/rpc/status;status",java_multiple_files:!0,java_outer_classname:"StatusProto",java_package:"com.google.rpc",objc_class_prefix:"RPC"},nested:{Status:{fields:{code:{type:"int32",id:1},message:{type:"string",id:2},details:{rule:"repeated",type:"google.protobuf.Any",id:3}}}}}}}},QW={nested:$O},YW=Object.freeze({__proto__:null,nested:$O,default:QW});var XW={longs:String,enums:String,defaults:!0,oneofs:!1};function ZW(){let n=uM.fromJSON(YW,XW);return po.loadPackageDefinition(n)}function JW(n){let e=ZW();return new Qw(e,n)}function e$(){return new Hw}function HO(){return process.env.USE_MOCK_PERSISTENCE==="YES"?window:null}function t$(){return null}function fd(n){return new gw(n,!1)}var n$="ExponentialBackoff",i$=1e3,r$=1.5,s$=60*1e3,Ju=class{constructor(e,t,i=i$,r=r$,s=s$){this.queue=e,this.timerId=t,this.initialDelayMs=i,this.backoffFactor=r,this.maxDelayMs=s,this.currentBaseMs=0,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}reset(){this.currentBaseMs=0}resetToMax(){this.currentBaseMs=this.maxDelayMs}backoffAndRun(e){this.cancel();let t=Math.floor(this.currentBaseMs+this.jitterDelayMs()),i=Math.max(0,Date.now()-this.lastAttemptTime),r=Math.max(0,t-i);r>0&&R(n$,`Backing off for ${r} ms (base delay: ${this.currentBaseMs} ms, delay with jitter: ${t} ms, last attempt: ${i} ms ago)`),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,r,()=>(this.lastAttemptTime=Date.now(),e())),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)}skipBackoff(){this.timerPromise!==null&&(this.timerPromise.skipDelay(),this.timerPromise=null)}cancel(){this.timerPromise!==null&&(this.timerPromise.cancel(),this.timerPromise=null)}jitterDelayMs(){return(Math.random()-.5)*this.currentBaseMs}};var YR="PersistentStream",o$=60*1e3,a$=10*1e3,Sp=class{constructor(e,t,i,r,s,o,a,c){this.queue=e,this.idleTimerId=i,this.healthTimerId=r,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=c,this.state=0,this.closeCount=0,this.idleTimer=null,this.healthCheck=null,this.stream=null,this.backoff=new Ju(e,t)}isStarted(){return this.state===1||this.state===5||this.isOpen()}isOpen(){return this.state===2||this.state===3}start(){if(this.state===4){this.performBackoff();return}this.auth()}stop(){return p(this,null,function*(){this.isStarted()&&(yield this.close(0))})}inhibitBackoff(){this.state=0,this.backoff.reset()}markIdle(){this.isOpen()&&this.idleTimer===null&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,o$,()=>this.handleIdleCloseTimer()))}sendRequest(e){this.cancelIdleCheck(),this.stream.send(e)}handleIdleCloseTimer(){return p(this,null,function*(){if(this.isOpen())return this.close(0)})}cancelIdleCheck(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)}cancelHealthCheck(){this.healthCheck&&(this.healthCheck.cancel(),this.healthCheck=null)}close(e,t){return p(this,null,function*(){this.cancelIdleCheck(),this.cancelHealthCheck(),this.backoff.cancel(),this.closeCount++,e!==4?this.backoff.reset():t&&t.code===v.RESOURCE_EXHAUSTED?(Ze(t.toString()),Ze("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):t&&t.code===v.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.onClose(t)})}tearDown(){}auth(){this.state=1;let e=this.getCloseGuardedDispatcher(this.closeCount),t=this.closeCount;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([i,r])=>{this.closeCount===t&&this.startStream(i,r)},i=>{e(()=>{let r=new x(v.UNKNOWN,"Fetching auth token failed: "+i.message);return this.handleStreamClose(r)})})}startStream(e,t){let i=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(e,t),this.stream.onOpen(()=>{i(()=>(this.state=2,this.healthCheck=this.queue.enqueueAfterDelay(this.healthTimerId,a$,()=>(this.isOpen()&&(this.state=3),Promise.resolve())),this.listener.onOpen()))}),this.stream.onClose(r=>{i(()=>this.handleStreamClose(r))}),this.stream.onMessage(r=>{i(()=>this.onMessage(r))})}performBackoff(){this.state=5,this.backoff.backoffAndRun(()=>p(this,null,function*(){this.state=0,this.start()}))}handleStreamClose(e){return R(YR,`close with error: ${e}`),this.stream=null,this.close(4,e)}getCloseGuardedDispatcher(e){return t=>{this.queue.enqueueAndForget(()=>this.closeCount===e?t():(R(YR,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},Yw=class extends Sp{constructor(e,t,i,r,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,i,r,o),this.serializer=s}startRpc(e,t){return this.connection.openStream("Listen",e,t)}onMessage(e){this.backoff.reset();let t=v9(this.serializer,e),i=w9(e);return this.listener.onWatchChange(t,i)}watch(e){let t={};t.database=vw(this.serializer),t.addTarget=M9(this.serializer,e);let i=k9(this.serializer,e);i&&(t.labels=i),this.sendRequest(t)}unwatch(e){let t={};t.database=vw(this.serializer),t.removeTarget=e,this.sendRequest(t)}},Xw=class extends Sp{constructor(e,t,i,r,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,i,r,o),this.serializer=s,this.handshakeComplete_=!1}get handshakeComplete(){return this.handshakeComplete_}start(){this.handshakeComplete_=!1,this.lastStreamToken=void 0,super.start()}tearDown(){this.handshakeComplete_&&this.writeMutations([])}startRpc(e,t){return this.connection.openStream("Write",e,t)}onMessage(e){if($(!!e.streamToken),this.lastStreamToken=e.streamToken,this.handshakeComplete_){this.backoff.reset();let t=T9(e.writeResults,e.commitTime),i=ft(e.commitTime);return this.listener.onMutationResult(i,t)}else return $(!e.writeResults||e.writeResults.length===0),this.handshakeComplete_=!0,this.listener.onHandshakeComplete()}writeHandshake(){let e={};e.database=vw(this.serializer),this.sendRequest(e)}writeMutations(e){let t={streamToken:this.lastStreamToken,writes:e.map(i=>Ku(this.serializer,i))};this.sendRequest(t)}};var Zw=class{},Jw=class extends Zw{constructor(e,t,i,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=i,this.serializer=r,this.terminated=!1}verifyInitialized(){if(this.terminated)throw new x(v.FAILED_PRECONDITION,"The client has already been terminated.")}invokeRPC(e,t,i,r){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.invokeRPC(e,bw(t,i),r,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===v.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new x(v.UNKNOWN,s.toString())})}invokeStreamingRPC(e,t,i,r,s){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.invokeStreamingRPC(e,bw(t,i),r,o,a,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===v.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new x(v.UNKNOWN,o.toString())})}terminate(){this.terminated=!0,this.connection.terminate()}};function c$(n,e,t,i){return new Jw(n,e,t,i)}function l$(n,e){return p(this,null,function*(){let t=B(n),i={writes:e.map(r=>Ku(t.serializer,r))};yield t.invokeRPC("Commit",t.serializer.databaseId,_e.emptyPath(),i)})}function u$(n,e){return p(this,null,function*(){let t=B(n),i={documents:e.map(a=>Hu(t.serializer,a))},r=yield t.invokeStreamingRPC("BatchGetDocuments",t.serializer.databaseId,_e.emptyPath(),i,e.length),s=new Map;r.forEach(a=>{let c=b9(t.serializer,a);s.set(c.key.toString(),c)});let o=[];return e.forEach(a=>{let c=s.get(a.toString());$(!!c),o.push(c)}),o})}function d$(n,e,t){let i=B(n);return i.verifyInitialized(),new Xw(e,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,t)}function h$(n,e,t){let i=B(n);return i.verifyInitialized(),new Yw(e,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,t)}var f$="OnlineStateTracker",XR=1,ZR=10*1e3,eC=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}handleWatchStreamStart(){this.watchStreamFailures===0&&(this.setAndBroadcast("Unknown"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay("online_state_timeout",ZR,()=>(this.onlineStateTimer=null,this.logClientOfflineWarningIfNecessary(`Backend didn't respond within ${ZR/1e3} seconds.`),this.setAndBroadcast("Offline"),Promise.resolve())))}handleWatchStreamFailure(e){this.state==="Online"?this.setAndBroadcast("Unknown"):(this.watchStreamFailures++,this.watchStreamFailures>=XR&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary(`Connection failed ${XR} times. Most recent error: ${e.toString()}`),this.setAndBroadcast("Offline")))}set(e){this.clearOnlineStateTimer(),this.watchStreamFailures=0,e==="Online"&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(e)}setAndBroadcast(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}logClientOfflineWarningIfNecessary(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.shouldWarnClientIsOffline?(Ze(t),this.shouldWarnClientIsOffline=!1):R(f$,t)}clearOnlineStateTimer(){this.onlineStateTimer!==null&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)}};var To="RemoteStore",m$=10,tC=class{constructor(e,t,i,r,s){this.localStore=e,this.datastore=t,this.asyncQueue=i,this.remoteSyncer={},this.writePipeline=[],this.listenTargets=new Map,this.offlineCauses=new Set,this.onNetworkStatusChange=[],this.connectivityMonitor=s,this.connectivityMonitor.addCallback(o=>{i.enqueueAndForget(()=>p(this,null,function*(){Ms(this)&&(R(To,"Restarting streams for network reachability change."),yield R$(this))}))}),this.onlineStateTracker=new eC(i,r)}};function p$(n,e,t,i,r){return new tC(n,e,t,i,r)}function g$(n){let e=B(n);return e.offlineCauses.delete(0),md(e)}function md(n){return p(this,null,function*(){if(Ms(n))for(let e of n.onNetworkStatusChange)yield e(!0)})}function y$(n){return p(this,null,function*(){let e=B(n);e.offlineCauses.add(0),yield Lc(e),e.onlineStateTracker.set("Offline")})}function Lc(n){return p(this,null,function*(){for(let e of n.onNetworkStatusChange)yield e(!1)})}function b$(n){return p(this,null,function*(){let e=B(n);R(To,"RemoteStore shutting down."),e.offlineCauses.add(5),yield Lc(e),e.connectivityMonitor.shutdown(),e.onlineStateTracker.set("Unknown")})}function Jp(n,e){let t=B(n);t.listenTargets.has(e.targetId)||(t.listenTargets.set(e.targetId,e),nE(t)?tE(t):Uc(t).isOpen()&&eE(t,e))}function Bc(n,e){let t=B(n),i=Uc(t);t.listenTargets.delete(e),i.isOpen()&&KO(t,e),t.listenTargets.size===0&&(i.isOpen()?i.markIdle():Ms(t)&&t.onlineStateTracker.set("Unknown"))}function eE(n,e){if(n.watchChangeAggregator.recordPendingTargetRequest(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Q.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Uc(n).watch(e)}function KO(n,e){n.watchChangeAggregator.recordPendingTargetRequest(e),Uc(n).unwatch(e)}function tE(n){n.watchChangeAggregator=new pw({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),getTargetDataForTarget:e=>n.listenTargets.get(e)||null,getDatabaseId:()=>n.datastore.serializer.databaseId}),Uc(n).start(),n.onlineStateTracker.handleWatchStreamStart()}function nE(n){return Ms(n)&&!Uc(n).isStarted()&&n.listenTargets.size>0}function Ms(n){return B(n).offlineCauses.size===0}function QO(n){n.watchChangeAggregator=void 0}function v$(n){return p(this,null,function*(){n.listenTargets.forEach((e,t)=>{eE(n,e)})})}function _$(n,e){return p(this,null,function*(){QO(n),nE(n)?(n.onlineStateTracker.handleWatchStreamFailure(e),tE(n)):n.onlineStateTracker.set("Unknown")})}function w$(n,e,t){return p(this,null,function*(){if(n.onlineStateTracker.set("Online"),e instanceof cp&&e.state===2&&e.cause){try{yield E$(n,e)}catch(i){R(To,"Failed to remove targets %s: %s ",e.targetIds.join(","),i),yield Tp(n,i)}return}if(e instanceof mc?n.watchChangeAggregator.handleDocumentChange(e):e instanceof ap?n.watchChangeAggregator.handleExistenceFilter(e):n.watchChangeAggregator.handleTargetChange(e),!t.isEqual(Q.min()))try{let i=yield BO(n.localStore);t.compareTo(i)>=0&&(yield C$(n,t))}catch(i){R(To,"Failed to raise snapshot:",i),yield Tp(n,i)}})}function Tp(n,e,t){return p(this,null,function*(){if(Rs(e))n.offlineCauses.add(1),yield Lc(n),n.onlineStateTracker.set("Offline"),t||(t=()=>BO(n.localStore)),n.asyncQueue.enqueueRetryable(()=>p(this,null,function*(){R(To,"Retrying IndexedDB access"),yield t(),n.offlineCauses.delete(1),yield md(n)}));else throw e})}function YO(n,e){return e().catch(t=>Tp(n,t,e))}function C$(n,e){let t=n.watchChangeAggregator.createRemoteEvent(e);return t.targetChanges.forEach((i,r)=>{if(i.resumeToken.approximateByteSize()>0){let s=n.listenTargets.get(r);s&&n.listenTargets.set(r,s.withResumeToken(i.resumeToken,e))}}),t.targetMismatches.forEach((i,r)=>{let s=n.listenTargets.get(i);if(!s)return;n.listenTargets.set(i,s.withResumeToken(kt.EMPTY_BYTE_STRING,s.snapshotVersion)),KO(n,i);let o=new Ec(s.target,i,r,s.sequenceNumber);eE(n,o)}),n.remoteSyncer.applyRemoteEvent(t)}function E$(n,e){return p(this,null,function*(){let t=e.cause;for(let i of e.targetIds)n.listenTargets.has(i)&&(yield n.remoteSyncer.rejectListen(i,t),n.listenTargets.delete(i),n.watchChangeAggregator.removeTarget(i))})}function Vc(n){return p(this,null,function*(){let e=B(n),t=Os(e),i=e.writePipeline.length>0?e.writePipeline[e.writePipeline.length-1].batchId:vs;for(;S$(e);)try{let r=yield EW(e.localStore,i);if(r===null){e.writePipeline.length===0&&t.markIdle();break}else i=r.batchId,T$(e,r)}catch(r){yield Tp(e,r)}XO(e)&&ZO(e)})}function S$(n){return Ms(n)&&n.writePipeline.length<m$}function T$(n,e){n.writePipeline.push(e);let t=Os(n);t.isOpen()&&t.handshakeComplete&&t.writeMutations(e.mutations)}function XO(n){return Ms(n)&&!Os(n).isStarted()&&n.writePipeline.length>0}function ZO(n){Os(n).start()}function x$(n){return p(this,null,function*(){Os(n).writeHandshake()})}function I$(n){return p(this,null,function*(){let e=Os(n);for(let t of n.writePipeline)e.writeMutations(t.mutations)})}function A$(n,e,t){return p(this,null,function*(){let i=n.writePipeline.shift(),r=dw.from(i,e,t);yield YO(n,()=>n.remoteSyncer.applySuccessfulWrite(r)),yield Vc(n)})}function D$(n,e){return p(this,null,function*(){e&&Os(n).handshakeComplete&&(yield k$(n,e)),XO(n)&&ZO(n)})}function k$(n,e){return p(this,null,function*(){if(t9(e.code)){let t=n.writePipeline.shift();Os(n).inhibitBackoff(),yield YO(n,()=>n.remoteSyncer.rejectFailedWrite(t.batchId,e)),yield Vc(n)}})}function R$(n){return p(this,null,function*(){let e=B(n);e.offlineCauses.add(4),yield Lc(e),e.onlineStateTracker.set("Unknown"),e.offlineCauses.delete(4),yield md(e)})}function JR(n,e){return p(this,null,function*(){let t=B(n);t.asyncQueue.verifyOperationInProgress(),R(To,"RemoteStore received new credentials");let i=Ms(t);t.offlineCauses.add(3),yield Lc(t),i&&t.onlineStateTracker.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.offlineCauses.delete(3),yield md(t)})}function nC(n,e){return p(this,null,function*(){let t=B(n);e?(t.offlineCauses.delete(2),yield md(t)):e||(t.offlineCauses.add(2),yield Lc(t),t.onlineStateTracker.set("Unknown"))})}function Uc(n){return n.watchStream||(n.watchStream=h$(n.datastore,n.asyncQueue,{onOpen:v$.bind(null,n),onClose:_$.bind(null,n),onWatchChange:w$.bind(null,n)}),n.onNetworkStatusChange.push(e=>p(this,null,function*(){e?(n.watchStream.inhibitBackoff(),nE(n)?tE(n):n.onlineStateTracker.set("Unknown")):(yield n.watchStream.stop(),QO(n))}))),n.watchStream}function Os(n){return n.writeStream||(n.writeStream=d$(n.datastore,n.asyncQueue,{onOpen:x$.bind(null,n),onClose:D$.bind(null,n),onHandshakeComplete:I$.bind(null,n),onMutationResult:A$.bind(null,n)}),n.onNetworkStatusChange.push(e=>p(this,null,function*(){e?(n.writeStream.inhibitBackoff(),yield Vc(n)):(yield n.writeStream.stop(),n.writePipeline.length>0&&(R(To,`Stopping write stream with ${n.writePipeline.length} pending writes`),n.writePipeline=[]))}))),n.writeStream}var M$="AsyncQueue",iC=class n{constructor(e,t,i,r,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=i,this.op=r,this.removalCallback=s,this.deferred=new ht,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,i,r,s){let o=Date.now()+i,a=new n(e,t,o,r,s);return a.start(i),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new x(v.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function jc(n,e){if(Ze(M$,`${e}: ${n}`),Rs(n))return new x(v.UNAVAILABLE,`${e}: ${n}`);throw n}var xp=class n{constructor(e){e?this.comparator=(t,i)=>e(t,i)||L.comparator(t.key,i.key):this.comparator=(t,i)=>L.comparator(t.key,i.key),this.keyedMap=xu(),this.sortedSet=new ze(this.comparator)}static emptySet(e){return new n(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,i)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),i=e.sortedSet.getIterator();for(;t.hasNext();){let r=t.getNext().key,s=i.getNext().key;if(!r.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let i=new n;return i.comparator=this.comparator,i.keyedMap=e,i.sortedSet=t,i}};var Ip=class{constructor(){this.changeMap=new ze(L.comparator)}track(e){let t=e.doc.key,i=this.changeMap.get(t);if(!i){this.changeMap=this.changeMap.insert(t,e);return}e.type!==0&&i.type===3?this.changeMap=this.changeMap.insert(t,e):e.type===3&&i.type!==1?this.changeMap=this.changeMap.insert(t,{type:i.type,doc:e.doc}):e.type===2&&i.type===2?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):e.type===2&&i.type===0?this.changeMap=this.changeMap.insert(t,{type:0,doc:e.doc}):e.type===1&&i.type===0?this.changeMap=this.changeMap.remove(t):e.type===1&&i.type===2?this.changeMap=this.changeMap.insert(t,{type:1,doc:i.doc}):e.type===0&&i.type===1?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):j()}getChanges(){let e=[];return this.changeMap.inorderTraversal((t,i)=>{e.push(i)}),e}},Ic=class n{constructor(e,t,i,r,s,o,a,c,l){this.query=e,this.docs=t,this.oldDocs=i,this.docChanges=r,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=c,this.hasCachedResults=l}static fromInitialDocuments(e,t,i,r,s){let o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new n(e,t,xp.emptySet(t),o,i,r,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(this.fromCache!==e.fromCache||this.hasCachedResults!==e.hasCachedResults||this.syncStateChanged!==e.syncStateChanged||!this.mutatedKeys.isEqual(e.mutatedKeys)||!ud(this.query,e.query)||!this.docs.isEqual(e.docs)||!this.oldDocs.isEqual(e.oldDocs))return!1;let t=this.docChanges,i=e.docChanges;if(t.length!==i.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==i[r].type||!t[r].doc.isEqual(i[r].doc))return!1;return!0}};var rC=class{constructor(){this.viewSnap=void 0,this.listeners=[]}hasRemoteListeners(){return this.listeners.some(e=>e.listensToRemoteStore())}};function O$(){return new sC}var sC=class{constructor(){this.queries=new Ji(e=>QM(e),ud),this.onlineState="Unknown",this.snapshotsInSyncListeners=new Set}};function iE(n,e){return p(this,null,function*(){let t=B(n),i=3,r=e.query,s=t.queries.get(r);s?!s.hasRemoteListeners()&&e.listensToRemoteStore()&&(i=2):(s=new rC,i=e.listensToRemoteStore()?0:1);try{switch(i){case 0:s.viewSnap=yield t.onListen(r,!0);break;case 1:s.viewSnap=yield t.onListen(r,!1);break;case 2:yield t.onFirstRemoteStoreListen(r);break;default:break}}catch(o){let a=jc(o,`Initialization of query '${ac(e.query)}' failed`);e.onError(a);return}t.queries.set(r,s),s.listeners.push(e),e.applyOnlineStateChange(t.onlineState),s.viewSnap&&e.onViewSnapshot(s.viewSnap)&&sE(t)})}function rE(n,e){return p(this,null,function*(){let t=B(n),i=e.query,r=3,s=t.queries.get(i);if(s){let o=s.listeners.indexOf(e);o>=0&&(s.listeners.splice(o,1),s.listeners.length===0?r=e.listensToRemoteStore()?0:1:!s.hasRemoteListeners()&&e.listensToRemoteStore()&&(r=2))}switch(r){case 0:return t.queries.delete(i),t.onUnlisten(i,!0);case 1:return t.queries.delete(i),t.onUnlisten(i,!1);case 2:return t.onLastRemoteStoreUnlisten(i);default:return}})}function P$(n,e){let t=B(n),i=!1;for(let r of e){let s=r.query,o=t.queries.get(s);if(o){for(let a of o.listeners)a.onViewSnapshot(r)&&(i=!0);o.viewSnap=r}}i&&sE(t)}function N$(n,e,t){let i=B(n),r=i.queries.get(e);if(r)for(let s of r.listeners)s.onError(t);i.queries.delete(e)}function F$(n,e){let t=B(n);t.onlineState=e;let i=!1;t.queries.forEach((r,s)=>{for(let o of s.listeners)o.applyOnlineStateChange(e)&&(i=!0)}),i&&sE(t)}function L$(n,e){B(n).snapshotsInSyncListeners.add(e),e.next()}function B$(n,e){B(n).snapshotsInSyncListeners.delete(e)}function sE(n){n.snapshotsInSyncListeners.forEach(e=>{e.next()})}var JO=function(n){return n.Default="default",n.Cache="cache",n}(JO||{}),ed=class{constructor(e,t,i){this.query=e,this.queryObserver=t,this.raisedInitialEvent=!1,this.snap=null,this.onlineState="Unknown",this.options=i||{}}onViewSnapshot(e){if(!this.options.includeMetadataChanges){let i=[];for(let r of e.docChanges)r.type!==3&&i.push(r);e=new Ic(e.query,e.docs,e.oldDocs,i,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.raisedInitialEvent?this.shouldRaiseEvent(e)&&(this.queryObserver.next(e),t=!0):this.shouldRaiseInitialEvent(e,this.onlineState)&&(this.raiseInitialEvent(e),t=!0),this.snap=e,t}onError(e){this.queryObserver.error(e)}applyOnlineStateChange(e){this.onlineState=e;let t=!1;return this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,e)&&(this.raiseInitialEvent(this.snap),t=!0),t}shouldRaiseInitialEvent(e,t){if(!e.fromCache||!this.listensToRemoteStore())return!0;let i=t!=="Offline";return this.options.waitForSyncWhenOnline&&i?!1:!e.docs.isEmpty()||e.hasCachedResults||t==="Offline"}shouldRaiseEvent(e){if(e.docChanges.length>0)return!0;let t=this.snap&&this.snap.hasPendingWrites!==e.hasPendingWrites;return e.syncStateChanged||t?this.options.includeMetadataChanges===!0:!1}raiseInitialEvent(e){e=Ic.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.raisedInitialEvent=!0,this.queryObserver.next(e)}listensToRemoteStore(){return this.options.source!==JO.Cache}};var oC=class n{constructor(e,t,i,r){this.targetId=e,this.fromCache=t,this.addedKeys=i,this.removedKeys=r}static fromSnapshot(e,t){let i=ne(),r=ne();for(let s of t.docChanges)switch(s.type){case 0:i=i.add(s.doc.key);break;case 1:r=r.add(s.doc.key);break}return new n(e,t.fromCache,i,r)}};var Ap=class{constructor(e){this.serializer=e}toDocumentKey(e){return Yi(this.serializer,e)}toMutableDocument(e){return e.metadata.exists?vO(this.serializer,e.document,!1):_t.newNoDocument(this.toDocumentKey(e.metadata.name),this.toSnapshotVersion(e.metadata.readTime))}toSnapshotVersion(e){return ft(e)}},aC=class{constructor(e,t,i){this.bundleMetadata=e,this.localStore=t,this.serializer=i,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=eP(e)}addSizedElement(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.payload.namedQuery)this.queries.push(e.payload.namedQuery);else if(e.payload.documentMetadata){this.documents.push({metadata:e.payload.documentMetadata}),e.payload.documentMetadata.exists||++t;let i=_e.fromString(e.payload.documentMetadata.name);this.collectionGroups.add(i.get(i.length-2))}else e.payload.document&&(this.documents[this.documents.length-1].document=e.payload.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}getQueryDocumentMapping(e){let t=new Map,i=new Ap(this.serializer);for(let r of e)if(r.metadata.queries){let s=i.toDocumentKey(r.metadata.name);for(let o of r.metadata.queries){let a=(t.get(o)||ne()).add(s);t.set(o,a)}}return t}complete(){return p(this,null,function*(){let e=yield RW(this.localStore,new Ap(this.serializer),this.documents,this.bundleMetadata.id),t=this.getQueryDocumentMapping(this.documents);for(let i of this.queries)yield NW(this.localStore,i,t.get(i.name));return this.progress.taskState="Success",{progress:this.progress,changedCollectionGroups:this.collectionGroups,changedDocs:e}})}};function eP(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}function V$(n){return{taskState:"Success",documentsLoaded:n.totalDocuments,bytesLoaded:n.totalBytes,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}var Dp=class{constructor(e){this.key=e}},kp=class{constructor(e){this.key=e}},Rp=class{constructor(e,t){this.query=e,this._syncedDocuments=t,this.syncState=null,this.hasCachedResults=!1,this.current=!1,this.limboDocuments=ne(),this.mutatedKeys=ne(),this.docComparator=XM(e),this.documentSet=new xp(this.docComparator)}get syncedDocuments(){return this._syncedDocuments}computeDocChanges(e,t){let i=t?t.changeSet:new Ip,r=t?t.documentSet:this.documentSet,s=t?t.mutatedKeys:this.mutatedKeys,o=r,a=!1,c=this.query.limitType==="F"&&r.size===this.query.limit?r.last():null,l=this.query.limitType==="L"&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((u,d)=>{let h=r.get(u),m=dd(this.query,d)?d:null,g=h?this.mutatedKeys.has(h.key):!1,y=m?m.hasLocalMutations||this.mutatedKeys.has(m.key)&&m.hasCommittedMutations:!1,_=!1;h&&m?h.data.isEqual(m.data)?g!==y&&(i.track({type:3,doc:m}),_=!0):this.shouldWaitForSyncedDocument(h,m)||(i.track({type:2,doc:m}),_=!0,(c&&this.docComparator(m,c)>0||l&&this.docComparator(m,l)<0)&&(a=!0)):!h&&m?(i.track({type:0,doc:m}),_=!0):h&&!m&&(i.track({type:1,doc:h}),_=!0,(c||l)&&(a=!0)),_&&(m?(o=o.add(m),y?s=s.add(u):s=s.delete(u)):(o=o.delete(u),s=s.delete(u)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let u=this.query.limitType==="F"?o.last():o.first();o=o.delete(u.key),s=s.delete(u.key),i.track({type:1,doc:u})}return{documentSet:o,changeSet:i,needsRefill:a,mutatedKeys:s}}shouldWaitForSyncedDocument(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,i,r){let s=this.documentSet;this.documentSet=e.documentSet,this.mutatedKeys=e.mutatedKeys;let o=e.changeSet.getChanges();o.sort((d,h)=>U$(d.type,h.type)||this.docComparator(d.doc,h.doc)),this.applyTargetChange(i),r=r??!1;let a=t&&!r?this.updateLimboDocuments():[],l=this.limboDocuments.size===0&&this.current&&!r?1:0,u=l!==this.syncState;return this.syncState=l,o.length===0&&!u?{limboChanges:a}:{snapshot:new Ic(this.query,e.documentSet,s,o,e.mutatedKeys,l===0,u,!1,i?i.resumeToken.approximateByteSize()>0:!1),limboChanges:a}}applyOnlineStateChange(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new Ip,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}}shouldBeInLimbo(e){return!(this._syncedDocuments.has(e)||!this.documentSet.has(e)||this.documentSet.get(e).hasLocalMutations)}applyTargetChange(e){e&&(e.addedDocuments.forEach(t=>this._syncedDocuments=this._syncedDocuments.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this._syncedDocuments=this._syncedDocuments.delete(t)),this.current=e.current)}updateLimboDocuments(){if(!this.current)return[];let e=this.limboDocuments;this.limboDocuments=ne(),this.documentSet.forEach(i=>{this.shouldBeInLimbo(i.key)&&(this.limboDocuments=this.limboDocuments.add(i.key))});let t=[];return e.forEach(i=>{this.limboDocuments.has(i)||t.push(new kp(i))}),this.limboDocuments.forEach(i=>{e.has(i)||t.push(new Dp(i))}),t}synchronizeWithPersistedState(e){this._syncedDocuments=e.remoteKeys,this.limboDocuments=ne();let t=this.computeDocChanges(e.documents);return this.applyChanges(t,!0)}computeInitialSnapshot(){return Ic.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,this.syncState===0,this.hasCachedResults)}};function U$(n,e){let t=i=>{switch(i){case 0:return 1;case 2:return 2;case 3:return 2;case 1:return 0;default:return j()}};return t(n)-t(e)}var Ps="SyncEngine",cC=class{constructor(e,t,i){this.query=e,this.targetId=t,this.view=i}},lC=class{constructor(e){this.key=e,this.receivedDocument=!1}},uC=class{constructor(e,t,i,r,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=i,this.sharedClientState=r,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.syncEngineListener={},this.queryViewsByQuery=new Ji(a=>QM(a),ud),this.queriesByTarget=new Map,this.enqueuedLimboResolutions=new Set,this.activeLimboTargetsByKey=new ze(L.comparator),this.activeLimboResolutionsByTarget=new Map,this.limboDocumentRefs=new Yu,this.mutationUserCallbacks={},this.pendingWritesCallbacks=new Map,this.limboTargetIdGenerator=Sc.forSyncEngine(),this.onlineState="Unknown",this._isPrimaryClient=void 0}get isPrimaryClient(){return this._isPrimaryClient===!0}};function j$(n,e,t,i,r,s,o){let a=new uC(n,e,t,i,r,s);return o&&(a._isPrimaryClient=!0),a}function q$(n,e,t=!0){return p(this,null,function*(){let i=eg(n),r,s=i.queryViewsByQuery.get(e);return s?(i.sharedClientState.addLocalQueryTarget(s.targetId),r=s.view.computeInitialSnapshot()):r=yield tP(i,e,t,!0),r})}function z$(n,e){return p(this,null,function*(){let t=eg(n);yield tP(t,e,!0,!1)})}function tP(n,e,t,i){return p(this,null,function*(){let r=yield Tc(n.localStore,an(e)),s=r.targetId,o=t?n.sharedClientState.addLocalQueryTarget(s):"not-current",a;return i&&(a=yield oE(n,e,s,o==="current",r.resumeToken)),n.isPrimaryClient&&t&&Jp(n.remoteStore,r),a})}function oE(n,e,t,i,r){return p(this,null,function*(){n.applyDocChanges=(d,h,m)=>eH(n,d,h,m);let s=yield Zp(n.localStore,e,!0),o=new Rp(e,s.remoteKeys),a=o.computeDocChanges(s.documents),c=$u.createSynthesizedTargetChangeForCurrentChange(t,i&&n.onlineState!=="Offline",r),l=o.applyChanges(a,n.isPrimaryClient,c);lE(n,t,l.limboChanges);let u=new cC(e,t,o);return n.queryViewsByQuery.set(e,u),n.queriesByTarget.has(t)?n.queriesByTarget.get(t).push(e):n.queriesByTarget.set(t,[e]),l.snapshot})}function G$(n,e,t){return p(this,null,function*(){let i=B(n),r=i.queryViewsByQuery.get(e),s=i.queriesByTarget.get(r.targetId);if(s.length>1){i.queriesByTarget.set(r.targetId,s.filter(o=>!ud(o,e))),i.queryViewsByQuery.delete(e);return}i.isPrimaryClient?(i.sharedClientState.removeLocalQueryTarget(r.targetId),i.sharedClientState.isActiveQueryTarget(r.targetId)||(yield xc(i.localStore,r.targetId,!1).then(()=>{i.sharedClientState.clearQueryState(r.targetId),t&&Bc(i.remoteStore,r.targetId),Ac(i,r.targetId)}).catch(ks))):(Ac(i,r.targetId),yield xc(i.localStore,r.targetId,!0))})}function W$(n,e){return p(this,null,function*(){let t=B(n),i=t.queryViewsByQuery.get(e),r=t.queriesByTarget.get(i.targetId);t.isPrimaryClient&&r.length===1&&(t.sharedClientState.removeLocalQueryTarget(i.targetId),Bc(t.remoteStore,i.targetId))})}function $$(n,e,t){return p(this,null,function*(){let i=dE(n);try{let r=yield pW(i.localStore,e);i.sharedClientState.addPendingMutation(r.batchId),Z$(i,r.batchId,t),yield kr(i,r.changes),yield Vc(i.remoteStore)}catch(r){let s=jc(r,"Failed to persist write");t.reject(s)}})}function nP(n,e){return p(this,null,function*(){let t=B(n);try{let i=yield _W(t.localStore,e);e.targetChanges.forEach((r,s)=>{let o=t.activeLimboResolutionsByTarget.get(s);o&&($(r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size<=1),r.addedDocuments.size>0?o.receivedDocument=!0:r.modifiedDocuments.size>0?$(o.receivedDocument):r.removedDocuments.size>0&&($(o.receivedDocument),o.receivedDocument=!1))}),yield kr(t,i,e)}catch(i){yield ks(i)}})}function eM(n,e,t){let i=B(n);if(i.isPrimaryClient&&t===0||!i.isPrimaryClient&&t===1){let r=[];i.queryViewsByQuery.forEach((s,o)=>{let a=o.view.applyOnlineStateChange(e);a.snapshot&&r.push(a.snapshot)}),F$(i.eventManager,e),r.length&&i.syncEngineListener.onWatchChange(r),i.onlineState=e,i.isPrimaryClient&&i.sharedClientState.setOnlineState(e)}}function H$(n,e,t){return p(this,null,function*(){let i=B(n);i.sharedClientState.updateQueryState(e,"rejected",t);let r=i.activeLimboResolutionsByTarget.get(e),s=r&&r.key;if(s){let o=new ze(L.comparator);o=o.insert(s,_t.newNoDocument(s,Q.min()));let a=ne().add(s),c=new Wu(Q.min(),new Map,new ze(te),o,a);yield nP(i,c),i.activeLimboTargetsByKey=i.activeLimboTargetsByKey.remove(s),i.activeLimboResolutionsByTarget.delete(e),uE(i)}else yield xc(i.localStore,e,!1).then(()=>Ac(i,e,t)).catch(ks)})}function K$(n,e){return p(this,null,function*(){let t=B(n),i=e.batch.batchId;try{let r=yield gW(t.localStore,e);cE(t,i,null),aE(t,i),t.sharedClientState.updateMutationState(i,"acknowledged"),yield kr(t,r)}catch(r){yield ks(r)}})}function Q$(n,e,t){return p(this,null,function*(){let i=B(n);try{let r=yield bW(i.localStore,e);cE(i,e,t),aE(i,e),i.sharedClientState.updateMutationState(e,"rejected",t),yield kr(i,r)}catch(r){yield ks(r)}})}function Y$(n,e){return p(this,null,function*(){let t=B(n);Ms(t.remoteStore)||R(Ps,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let i=yield vW(t.localStore);if(i===vs){e.resolve();return}let r=t.pendingWritesCallbacks.get(i)||[];r.push(e),t.pendingWritesCallbacks.set(i,r)}catch(i){let r=jc(i,"Initialization of waitForPendingWrites() operation failed");e.reject(r)}})}function aE(n,e){(n.pendingWritesCallbacks.get(e)||[]).forEach(t=>{t.resolve()}),n.pendingWritesCallbacks.delete(e)}function X$(n,e){n.pendingWritesCallbacks.forEach(t=>{t.forEach(i=>{i.reject(new x(v.CANCELLED,e))})}),n.pendingWritesCallbacks.clear()}function Z$(n,e,t){let i=n.mutationUserCallbacks[n.currentUser.toKey()];i||(i=new ze(te)),i=i.insert(e,t),n.mutationUserCallbacks[n.currentUser.toKey()]=i}function cE(n,e,t){let i=B(n),r=i.mutationUserCallbacks[i.currentUser.toKey()];if(r){let s=r.get(e);s&&(t?s.reject(t):s.resolve(),r=r.remove(e)),i.mutationUserCallbacks[i.currentUser.toKey()]=r}}function Ac(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let i of n.queriesByTarget.get(e))n.queryViewsByQuery.delete(i),t&&n.syncEngineListener.onWatchError(i,t);n.queriesByTarget.delete(e),n.isPrimaryClient&&n.limboDocumentRefs.removeReferencesForId(e).forEach(r=>{n.limboDocumentRefs.containsKey(r)||iP(n,r)})}function iP(n,e){n.enqueuedLimboResolutions.delete(e.path.canonicalString());let t=n.activeLimboTargetsByKey.get(e);t!==null&&(Bc(n.remoteStore,t),n.activeLimboTargetsByKey=n.activeLimboTargetsByKey.remove(e),n.activeLimboResolutionsByTarget.delete(t),uE(n))}function lE(n,e,t){for(let i of t)i instanceof Dp?(n.limboDocumentRefs.addReference(i.key,e),J$(n,i)):i instanceof kp?(R(Ps,"Document no longer in limbo: "+i.key),n.limboDocumentRefs.removeReference(i.key,e),n.limboDocumentRefs.containsKey(i.key)||iP(n,i.key)):j()}function J$(n,e){let t=e.key,i=t.path.canonicalString();!n.activeLimboTargetsByKey.get(t)&&!n.enqueuedLimboResolutions.has(i)&&(R(Ps,"New document in limbo: "+t),n.enqueuedLimboResolutions.add(i),uE(n))}function uE(n){for(;n.enqueuedLimboResolutions.size>0&&n.activeLimboTargetsByKey.size<n.maxConcurrentLimboResolutions;){let e=n.enqueuedLimboResolutions.values().next().value;n.enqueuedLimboResolutions.delete(e);let t=new L(_e.fromString(e)),i=n.limboTargetIdGenerator.next();n.activeLimboResolutionsByTarget.set(i,new lC(t)),n.activeLimboTargetsByKey=n.activeLimboTargetsByKey.insert(t,i),Jp(n.remoteStore,new Ec(an(Fc(t.path)),i,"TargetPurposeLimboResolution",Sn.INVALID))}}function kr(n,e,t){return p(this,null,function*(){let i=B(n),r=[],s=[],o=[];i.queryViewsByQuery.isEmpty()||(i.queryViewsByQuery.forEach((a,c)=>{o.push(i.applyDocChanges(c,e,t).then(l=>{if((l||t)&&i.isPrimaryClient&&i.sharedClientState.updateQueryState(c.targetId,l?.fromCache?"not-current":"current"),l){r.push(l);let u=oC.fromSnapshot(c.targetId,l);s.push(u)}}))}),yield Promise.all(o),i.syncEngineListener.onWatchChange(r),yield CW(i.localStore,s))})}function eH(n,e,t,i){return p(this,null,function*(){let r=e.view.computeDocChanges(t);r.needsRefill&&(r=yield Zp(n.localStore,e.query,!1).then(({documents:c})=>e.view.computeDocChanges(c,r)));let s=i&&i.targetChanges.get(e.targetId),o=i&&i.targetMismatches.get(e.targetId)!=null,a=e.view.applyChanges(r,n.isPrimaryClient,s,o);return lE(n,e.targetId,a.limboChanges),a.snapshot})}function tH(n,e){return p(this,null,function*(){let t=B(n);if(!t.currentUser.isEqual(e)){R(Ps,"User change. New user:",e.toKey());let r=yield LO(t.localStore,e);t.currentUser=e,X$(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield kr(t,r.affectedDocuments)}})}function nH(n,e){let t=B(n),i=t.activeLimboResolutionsByTarget.get(e);if(i&&i.receivedDocument)return ne().add(i.key);{let r=ne(),s=t.queriesByTarget.get(e);if(!s)return r;for(let o of s){let a=t.queryViewsByQuery.get(o);r=r.unionWith(a.view.syncedDocuments)}return r}}function iH(n,e){return p(this,null,function*(){let t=B(n),i=yield Zp(t.localStore,e.query,!0),r=e.view.synchronizeWithPersistedState(i);return t.isPrimaryClient&&lE(t,e.targetId,r.limboChanges),r})}function rH(n,e){return p(this,null,function*(){let t=B(n);return jO(t.localStore,e).then(i=>kr(t,i))})}function sH(n,e,t,i){return p(this,null,function*(){let r=B(n),s=yield IW(r.localStore,e);if(s===null){R(Ps,"Cannot apply mutation batch with id: "+e);return}t==="pending"?yield Vc(r.remoteStore):t==="acknowledged"||t==="rejected"?(cE(r,e,i||null),aE(r,e),AW(r.localStore,e)):j(),yield kr(r,s)})}function oH(n,e){return p(this,null,function*(){let t=B(n);if(eg(t),dE(t),e===!0&&t._isPrimaryClient!==!0){let i=t.sharedClientState.getAllActiveQueryTargets(),r=yield tM(t,i.toArray());t._isPrimaryClient=!0,yield nC(t.remoteStore,!0);for(let s of r)Jp(t.remoteStore,s)}else if(e===!1&&t._isPrimaryClient!==!1){let i=[],r=Promise.resolve();t.queriesByTarget.forEach((s,o)=>{t.sharedClientState.isLocalQueryTarget(o)?i.push(o):r=r.then(()=>(Ac(t,o),xc(t.localStore,o,!0))),Bc(t.remoteStore,o)}),yield r,yield tM(t,i),aH(t),t._isPrimaryClient=!1,yield nC(t.remoteStore,!1)}})}function aH(n){let e=B(n);e.activeLimboResolutionsByTarget.forEach((t,i)=>{Bc(e.remoteStore,i)}),e.limboDocumentRefs.removeAllReferences(),e.activeLimboResolutionsByTarget=new Map,e.activeLimboTargetsByKey=new ze(L.comparator)}function tM(n,e,t){return p(this,null,function*(){let i=B(n),r=[],s=[];for(let o of e){let a,c=i.queriesByTarget.get(o);if(c&&c.length!==0){a=yield Tc(i.localStore,an(c[0]));for(let l of c){let u=i.queryViewsByQuery.get(l),d=yield iH(i,u);d.snapshot&&s.push(d.snapshot)}}else{let l=yield UO(i.localStore,o);a=yield Tc(i.localStore,l),yield oE(i,rP(l),o,!1,a.resumeToken)}r.push(a)}return i.syncEngineListener.onWatchChange(s),r})}function rP(n){return KM(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function cH(n){let e=B(n);return DW(e.localStore)}function lH(n,e,t,i){return p(this,null,function*(){let r=B(n);if(r._isPrimaryClient){R(Ps,"Ignoring unexpected query state notification.");return}let s=r.queriesByTarget.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{let o=yield jO(r.localStore,YM(s[0])),a=Wu.createSynthesizedRemoteEventForCurrentChange(e,t==="current",kt.EMPTY_BYTE_STRING);yield kr(r,o,a);break}case"rejected":{yield xc(r.localStore,e,!0),Ac(r,e,i);break}default:j()}})}function uH(n,e,t){return p(this,null,function*(){let i=eg(n);if(i._isPrimaryClient){for(let r of e){if(i.queriesByTarget.has(r)&&i.sharedClientState.isActiveQueryTarget(r)){R(Ps,"Adding an already active target "+r);continue}let o=yield UO(i.localStore,r),a=yield Tc(i.localStore,o);yield oE(i,rP(o),a.targetId,!1,a.resumeToken),Jp(i.remoteStore,a)}for(let r of t)i.queriesByTarget.has(r)&&(yield xc(i.localStore,r,!1).then(()=>{Bc(i.remoteStore,r),Ac(i,r)}).catch(ks))}})}function eg(n){let e=B(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=nP.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=nH.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=H$.bind(null,e),e.syncEngineListener.onWatchChange=P$.bind(null,e.eventManager),e.syncEngineListener.onWatchError=N$.bind(null,e.eventManager),e}function dE(n){let e=B(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=K$.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Q$.bind(null,e),e}function dH(n,e,t){let i=B(n);hH(i,e,t).then(r=>{i.sharedClientState.notifyBundleLoaded(r)})}function hH(n,e,t){return p(this,null,function*(){try{let i=yield e.getMetadata();if(yield MW(n.localStore,i))return yield e.close(),t._completeWith(V$(i)),Promise.resolve(new Set);t._updateProgress(eP(i));let s=new aC(i,n.localStore,e.serializer),o=yield e.nextElement();for(;o;){let c=yield s.addSizedElement(o);c&&t._updateProgress(c),o=yield e.nextElement()}let a=yield s.complete();return yield kr(n,a.changedDocs,void 0),yield OW(n.localStore,i),t._completeWith(a.progress),Promise.resolve(a.changedCollectionGroups)}catch(i){return Wn(Ps,`Loading bundle failed with ${i}`),t._failWith(i),Promise.resolve(new Set)}})}var td=class{constructor(){this.synchronizeTabs=!1}initialize(e){return p(this,null,function*(){this.serializer=fd(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),yield this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)})}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return FO(this.persistence,new _p,e.initialUser,this.serializer)}createPersistence(e){return new bp(vp.factory,this.serializer)}createSharedClientState(e){return new Ep}terminate(){return p(this,null,function*(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}};var Mp=class n extends td{constructor(e,t,i){super(),this.onlineComponentProvider=e,this.cacheSizeBytes=t,this.forceOwnership=i,this.synchronizeTabs=!1}initialize(e){return p(this,null,function*(){yield Og(n.prototype,this,"initialize").call(this,e),yield this.onlineComponentProvider.initialize(this,e),yield dE(this.onlineComponentProvider.syncEngine),yield Vc(this.onlineComponentProvider.remoteStore),yield this.persistence.setPrimaryStateListener(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}createLocalStore(e){return FO(this.persistence,new _p,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){let i=this.persistence.referenceDelegate.garbageCollector;return new kw(i,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){let i=new W0(t,this.persistence);return new G0(e.asyncQueue,i)}createPersistence(e){let t=ZC(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),i=this.cacheSizeBytes!==void 0?Gn.withCacheSize(this.cacheSizeBytes):Gn.DEFAULT;return new Gw(this.synchronizeTabs,t,e.clientId,i,e.asyncQueue,HO(),t$(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new Ep}},dC=class n extends Mp{constructor(e,t){super(e,t,!1),this.onlineComponentProvider=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){return p(this,null,function*(){yield Og(n.prototype,this,"initialize").call(this,e);let t=this.onlineComponentProvider.syncEngine;this.sharedClientState instanceof Ou&&(this.sharedClientState.syncEngine={applyBatchState:sH.bind(null,t),applyTargetState:lH.bind(null,t),applyActiveTargetsChange:uH.bind(null,t),getActiveClients:cH.bind(null,t),synchronizeWithChangedDocuments:rH.bind(null,t)},yield this.sharedClientState.start()),yield this.persistence.setPrimaryStateListener(i=>p(this,null,function*(){yield oH(this.onlineComponentProvider.syncEngine,i),this.gcScheduler&&(i&&!this.gcScheduler.started?this.gcScheduler.start():i||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(i&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():i||this.indexBackfillerScheduler.stop())}))})}createSharedClientState(e){let t=HO();if(!Ou.isAvailable(t))throw new x(v.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let i=ZC(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Ou(t,e.asyncQueue,i,e.clientId,e.initialUser)}},nd=class{initialize(e,t){return p(this,null,function*(){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>eM(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=tH.bind(null,this.syncEngine),yield nC(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(e){return O$()}createDatastore(e){let t=fd(e.databaseInfo.databaseId),i=JW(e.databaseInfo);return c$(e.authCredentials,e.appCheckCredentials,i,t)}createRemoteStore(e){return p$(this.localStore,this.datastore,e.asyncQueue,t=>eM(this.syncEngine,t,0),e$())}createSyncEngine(e,t){return j$(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return p(this,null,function*(){var e;yield b$(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate()})}};var fH=10240;function mH(n,e=fH){let t=0;return{read(){return p(this,null,function*(){if(t<n.byteLength){let s={value:n.slice(t,t+e),done:!1};return t+=e,s}return{done:!0}})},cancel(){return p(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}function hE(n,e,t){if(!t)throw new x(v.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function fE(n,e,t,i){if(e===!0&&i===!0)throw new x(v.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function nM(n){if(!L.isDocumentKey(n))throw new x(v.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function iM(n){if(L.isDocumentKey(n))throw new x(v.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function pH(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function pd(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=gH(n);return e?`a custom ${e} object`:"an object"}}else return typeof n=="function"?"a function":j()}function gH(n){return n.constructor?n.constructor.name:null}function we(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new x(v.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=pd(n);throw new x(v.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function sP(n,e){if(e<=0)throw new x(v.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}function yH(n,e){if(!(n instanceof Uint8Array))throw new x(v.INVALID_ARGUMENT,`NodePlatform.toByteStreamReader expects source to be Uint8Array, got ${pd(n)}`);return mH(n,e)}var Dc=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.scheduleEvent(this.observer.next,e)}error(e){this.observer.error?this.scheduleEvent(this.observer.error,e):Ze("Uncaught Error in snapshot listener:",e.toString())}mute(){this.muted=!0}scheduleEvent(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}};var hC=class{constructor(e,t){this.payload=e,this.byteLength=t}isBundleMetadata(){return"metadata"in this.payload}};var fC=class{constructor(e,t){this.reader=e,this.serializer=t,this.metadata=new ht,this.buffer=new Uint8Array,this.textDecoder=n9(),this.nextElementImpl().then(i=>{i&&i.isBundleMetadata()?this.metadata.resolve(i.payload.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(i?.payload)}`))},i=>this.metadata.reject(i))}close(){return this.reader.cancel()}getMetadata(){return p(this,null,function*(){return this.metadata.promise})}nextElement(){return p(this,null,function*(){return yield this.getMetadata(),this.nextElementImpl()})}nextElementImpl(){return p(this,null,function*(){let e=yield this.readLength();if(e===null)return null;let t=this.textDecoder.decode(e),i=Number(t);isNaN(i)&&this.raiseError(`length string (${t}) is not valid number`);let r=yield this.readJsonString(i);return new hC(JSON.parse(r),e.length+i)})}indexOfOpenBracket(){return this.buffer.findIndex(e=>e===123)}readLength(){return p(this,null,function*(){for(;this.indexOfOpenBracket()<0&&!(yield this.pullMoreDataToBuffer()););if(this.buffer.length===0)return null;let e=this.indexOfOpenBracket();e<0&&this.raiseError("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t})}readJsonString(e){return p(this,null,function*(){for(;this.buffer.length<e;)(yield this.pullMoreDataToBuffer())&&this.raiseError("Reached the end of bundle when more is expected.");let t=this.textDecoder.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t})}raiseError(e){throw this.reader.cancel(),new Error(`Invalid bundle format: ${e}`)}pullMoreDataToBuffer(){return p(this,null,function*(){let e=yield this.reader.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done})}};function bH(n,e){return new fC(n,e)}var mC=class{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){return p(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new x(v.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=yield u$(this.datastore,e);return t.forEach(i=>this.recordVersion(i)),t})}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(i){this.lastTransactionError=i}this.writtenDocs.add(e.toString())}delete(e){this.write(new Is(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){return p(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,i)=>{let r=L.fromPath(i);this.mutations.push(new qu(r,this.precondition(r)))}),yield l$(this.datastore,this.mutations),this.committed=!0})}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else if(e.isNoDocument())t=Q.min();else throw j();let i=this.readVersions.get(e.key.toString());if(i){if(!t.isEqual(i))throw new x(v.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(Q.min())?st.exists(!1):st.updateTime(t):st.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(Q.min()))throw new x(v.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return st.updateTime(t)}else return st.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}};var pC=class{constructor(e,t,i,r,s){this.asyncQueue=e,this.datastore=t,this.options=i,this.updateFunction=r,this.deferred=s,this.attemptsRemaining=i.maxAttempts,this.backoff=new Ju(this.asyncQueue,"transaction_retry")}run(){this.attemptsRemaining-=1,this.runWithBackOff()}runWithBackOff(){this.backoff.backoffAndRun(()=>p(this,null,function*(){let e=new mC(this.datastore),t=this.tryRunUpdateFunction(e);t&&t.then(i=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(i)}).catch(r=>{this.handleTransactionError(r)}))}).catch(i=>{this.handleTransactionError(i)})}))}tryRunUpdateFunction(e){try{let t=this.updateFunction(e);return cd(t)||!t.catch||!t.then?(this.deferred.reject(Error("Transaction callback must return a Promise")),null):t}catch(t){return this.deferred.reject(t),null}}handleTransactionError(e){this.attemptsRemaining>0&&this.isRetryableTransactionError(e)?(this.attemptsRemaining-=1,this.asyncQueue.enqueueAndForget(()=>(this.runWithBackOff(),Promise.resolve()))):this.deferred.reject(e)}isRetryableTransactionError(e){if(e.name==="FirebaseError"){let t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!hO(t)}return!1}};var As="FirestoreClient",vH=100,_H=11,wH=20,CH=22,gC=class{constructor(e,t,i,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=i,this.databaseInfo=r,this.user=wt.UNAUTHENTICATED,this.clientId=Xm.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(i,s=>p(this,null,function*(){R(As,"Received user=",s.uid),yield this.authCredentialListener(s),this.user=s})),this.appCheckCredentials.start(i,s=>(R(As,"Received new app check token=",s),this.appCheckCredentialListener(s,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:vH}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new x(v.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();let e=new ht;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>p(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let i=jc(t,"Failed to shutdown persistence");e.reject(i)}})),e.promise}};function Qm(n,e){return p(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),R(As,"Initializing OfflineComponentProvider");let t=n.configuration;yield e.initialize(t);let i=t.initialUser;n.setCredentialChangeListener(r=>p(this,null,function*(){i.isEqual(r)||(yield LO(e.localStore,r),i=r)})),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e})}function yC(n,e){return p(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield mE(n);R(As,"Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(i=>JR(e.remoteStore,i)),n.setAppCheckTokenChangeListener((i,r)=>JR(e.remoteStore,r)),n._onlineComponents=e})}function oP(n){return n.name==="FirebaseError"?n.code===v.FAILED_PRECONDITION||n.code===v.UNIMPLEMENTED:typeof DOMException<"u"&&n instanceof DOMException?n.code===CH||n.code===wH||n.code===_H:!0}function mE(n){return p(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){R(As,"Using user provided OfflineComponentProvider");try{yield Qm(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!oP(t))throw t;Wn("Error using user provided cache. Falling back to memory cache: "+t),yield Qm(n,new td)}}else R(As,"Using default OfflineComponentProvider"),yield Qm(n,new td);return n._offlineComponents})}function tg(n){return p(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(R(As,"Using user provided OnlineComponentProvider"),yield yC(n,n._uninitializedComponentsProvider._online)):(R(As,"Using default OnlineComponentProvider"),yield yC(n,new nd))),n._onlineComponents})}function aP(n){return mE(n).then(e=>e.persistence)}function pE(n){return mE(n).then(e=>e.localStore)}function cP(n){return tg(n).then(e=>e.remoteStore)}function gE(n){return tg(n).then(e=>e.syncEngine)}function EH(n){return tg(n).then(e=>e.datastore)}function kc(n){return p(this,null,function*(){let e=yield tg(n),t=e.eventManager;return t.onListen=q$.bind(null,e.syncEngine),t.onUnlisten=G$.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=z$.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=W$.bind(null,e.syncEngine),t})}function SH(n){return n.asyncQueue.enqueue(()=>p(this,null,function*(){let e=yield aP(n),t=yield cP(n);return e.setNetworkEnabled(!0),g$(t)}))}function TH(n){return n.asyncQueue.enqueue(()=>p(this,null,function*(){let e=yield aP(n),t=yield cP(n);return e.setNetworkEnabled(!1),y$(t)}))}function xH(n){let e=new ht;return n.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){let t=yield gE(n);return Y$(t,e)})),e.promise}function IH(n,e,t,i){let r=new Dc(i),s=new ed(e,r,t);return n.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){let o=yield kc(n);return iE(o,s)})),()=>{r.mute(),n.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){let o=yield kc(n);return rE(o,s)}))}}function AH(n,e){let t=new ht;return n.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){let i=yield pE(n);return OH(i,e,t)})),t.promise}function lP(n,e,t={}){let i=new ht;return n.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){let r=yield kc(n);return PH(r,n.asyncQueue,e,t,i)})),i.promise}function DH(n,e){let t=new ht;return n.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){let i=yield pE(n);return NH(i,e,t)})),t.promise}function uP(n,e,t={}){let i=new ht;return n.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){let r=yield kc(n);return FH(r,n.asyncQueue,e,t,i)})),i.promise}function kH(n,e){let t=new ht;return n.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){let i=yield gE(n);return $$(i,e,t)})),t.promise}function RH(n,e){let t=new Dc(e);return n.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){let i=yield kc(n);return L$(i,t)})),()=>{t.mute(),n.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){let i=yield kc(n);return B$(i,t)}))}}function MH(n,e,t){let i=new ht;return n.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){let r=yield EH(n);new pC(n.asyncQueue,r,t,e,i).run()})),i.promise}function OH(n,e,t){return p(this,null,function*(){try{let i=yield SW(n,e);i.isFoundDocument()?t.resolve(i):i.isNoDocument()?t.resolve(null):t.reject(new x(v.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(i){let r=jc(i,`Failed to get document '${e} from cache`);t.reject(r)}})}function PH(n,e,t,i,r){let s=new Dc({next:a=>{e.enqueueAndForget(()=>rE(n,o));let c=a.docs.has(t);!c&&a.fromCache?r.reject(new x(v.UNAVAILABLE,"Failed to get document because the client is offline.")):c&&a.fromCache&&i&&i.source==="server"?r.reject(new x(v.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):r.resolve(a)},error:a=>r.reject(a)}),o=new ed(Fc(t.path),s,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return iE(n,o)}function NH(n,e,t){return p(this,null,function*(){try{let i=yield Zp(n,e,!0),r=new Rp(e,i.remoteKeys),s=r.computeDocChanges(i.documents),o=r.applyChanges(s,!1);t.resolve(o.snapshot)}catch(i){let r=jc(i,`Failed to execute query '${e} against cache`);t.reject(r)}})}function FH(n,e,t,i,r){let s=new Dc({next:a=>{e.enqueueAndForget(()=>rE(n,o)),a.fromCache&&i.source==="server"?r.reject(new x(v.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):r.resolve(a)},error:a=>r.reject(a)}),o=new ed(t,s,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return iE(n,o)}function LH(n,e,t,i){let r=VH(t,fd(e));n.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){dH(yield gE(n),r,i)}))}function BH(n,e){return n.asyncQueue.enqueue(()=>p(this,null,function*(){return PW(yield pE(n),e)}))}function VH(n,e){let t;return typeof n=="string"?t=fO().encode(n):t=n,bH(yH(t),e)}function UH(n,e){return n.timeoutSeconds===e.timeoutSeconds}function dP(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var jH="ComponentProvider",rM=new Map;function qH(n){let e=rM.get(n);e&&(R(jH,"Removing Datastore"),rM.delete(n),e.terminate())}function zH(n,e,t,i){return new X0(n,e,t,i.host,i.ssl,i.experimentalForceLongPolling,i.experimentalAutoDetectLongPolling,dP(i.experimentalLongPollingOptions),i.useFetchStreams)}var hP="firestore.googleapis.com",sM=!0,oM=5,aM=30,GH=!0,Op=class{constructor(e){var t,i;if(e.host===void 0){if(e.ssl!==void 0)throw new x(v.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=hP,this.ssl=sM}else this.host=e.host,this.ssl=(t=e.ssl)!==null&&t!==void 0?t:sM;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=OO;else{if(e.cacheSizeBytes!==hd&&e.cacheSizeBytes<qR)throw new x(v.INVALID_ARGUMENT,`cacheSizeBytes must be at least ${qR}`);this.cacheSizeBytes=e.cacheSizeBytes}fE("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=GH:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=dP((i=e.experimentalLongPollingOptions)!==null&&i!==void 0?i:{}),WH(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&UH(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}};function WH(n){if(n.timeoutSeconds!==void 0){if(isNaN(n.timeoutSeconds))throw new x(v.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (must not be NaN)`);if(n.timeoutSeconds<oM)throw new x(v.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (minimum allowed value is ${oM})`);if(n.timeoutSeconds>aM)throw new x(v.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (maximum allowed value is ${aM})`)}}var xo=class{constructor(e,t,i,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=i,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Op({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new x(v.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new x(v.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Op(e),e.credentials!==void 0&&(this._authCredentials=q3(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return qH(this),Promise.resolve()}};function ng(n,e,t,i={}){var r;n=we(n,xo);let s=n._getSettings(),o=`${e}:${t}`;if(s.host!==hP&&s.host!==o&&Wn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),i.mockUserToken){let a,c;if(typeof i.mockUserToken=="string")a=i.mockUserToken,c=wt.MOCK_USER;else{a=gT(i.mockUserToken,(r=n._app)===null||r===void 0?void 0:r.options.projectId);let l=i.mockUserToken.sub||i.mockUserToken.user_id;if(!l)throw new x(v.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");c=new wt(l)}n._authCredentials=new N0(new Ym(a,c))}}var Ft=class n{constructor(e,t,i){this.converter=t,this._query=i,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},Ve=class n{constructor(e,t,i){this.converter=t,this._key=i,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Xi(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}},Xi=class n extends Ft{constructor(e,t,i){super(e,t,Fc(i)),this._path=i,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new Ve(this.firestore,null,new L(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function gd(n,e,...t){if(n=Xe(n),hE("collection","path",e),n instanceof xo){let i=_e.fromString(e,...t);return iM(i),new Xi(n,null,i)}else{if(!(n instanceof Ve)&&!(n instanceof Xi))throw new x(v.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let i=n._path.child(_e.fromString(e,...t));return iM(i),new Xi(n.firestore,null,i)}}function yE(n,e){if(n=we(n,xo),hE("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new x(v.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Ft(n,null,S5(e))}function Mo(n,e,...t){if(n=Xe(n),arguments.length===1&&(e=Xm.newId()),hE("doc","path",e),n instanceof xo){let i=_e.fromString(e,...t);return nM(i),new Ve(n,null,new L(i))}else{if(!(n instanceof Ve)&&!(n instanceof Xi))throw new x(v.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let i=n._path.child(_e.fromString(e,...t));return nM(i),new Ve(n.firestore,n instanceof Xi?n.converter:null,new L(i))}}function yd(n,e){return n=Xe(n),e=Xe(e),(n instanceof Ve||n instanceof Xi)&&(e instanceof Ve||e instanceof Xi)?n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter:!1}function ig(n,e){return n=Xe(n),e=Xe(e),n instanceof Ft&&e instanceof Ft?n.firestore===e.firestore&&ud(n._query,e._query)&&n.converter===e.converter:!1}var $H="AsyncQueue",bC=class{constructor(){this.tail=Promise.resolve(),this.retryableOps=[],this._isShuttingDown=!1,this.delayedOperations=[],this.failure=null,this.operationInProgress=!1,this.skipNonRestrictedTasks=!1,this.timerIdsToSkip=[],this.backoff=new Ju(this,"async_queue_retry"),this.visibilityHandler=()=>{this.backoff.skipBackoff()}}get isShuttingDown(){return this._isShuttingDown}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.verifyNotFailed(),this.enqueueInternal(e)}enterRestrictedMode(e){this._isShuttingDown||(this._isShuttingDown=!0,this.skipNonRestrictedTasks=e||!1)}enqueue(e){if(this.verifyNotFailed(),this._isShuttingDown)return new Promise(()=>{});let t=new ht;return this.enqueueInternal(()=>this._isShuttingDown&&this.skipNonRestrictedTasks?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.retryableOps.push(e),this.retryNextOp()))}retryNextOp(){return p(this,null,function*(){if(this.retryableOps.length!==0){try{yield this.retryableOps[0](),this.retryableOps.shift(),this.backoff.reset()}catch(e){if(Rs(e))R($H,"Operation failed with retryable error: "+e);else throw e}this.retryableOps.length>0&&this.backoff.backoffAndRun(()=>this.retryNextOp())}})}enqueueInternal(e){let t=this.tail.then(()=>(this.operationInProgress=!0,e().catch(i=>{this.failure=i,this.operationInProgress=!1;let r=KH(i);throw Ze("INTERNAL UNHANDLED ERROR: ",r),i}).then(i=>(this.operationInProgress=!1,i))));return this.tail=t,t}enqueueAfterDelay(e,t,i){this.verifyNotFailed(),this.timerIdsToSkip.indexOf(e)>-1&&(t=0);let r=iC.createAndSchedule(this,e,t,i,s=>this.removeDelayedOperation(s));return this.delayedOperations.push(r),r}verifyNotFailed(){this.failure&&j()}verifyOperationInProgress(){}drain(){return p(this,null,function*(){let e;do e=this.tail,yield e;while(e!==this.tail)})}containsDelayedOperation(e){for(let t of this.delayedOperations)if(t.timerId===e)return!0;return!1}runAllDelayedOperationsUntil(e){return this.drain().then(()=>{this.delayedOperations.sort((t,i)=>t.targetTimeMs-i.targetTimeMs);for(let t of this.delayedOperations)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.drain()})}skipDelaysForTimerId(e){this.timerIdsToSkip.push(e)}removeDelayedOperation(e){let t=this.delayedOperations.indexOf(e);this.delayedOperations.splice(t,1)}};function HH(){return new bC}function KH(n){let e=n.message||"";return n.stack&&(n.stack.includes(n.message)?e=n.stack:e=n.message+`
`+n.stack),e}var vC=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new ht,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,i){this._progressObserver={next:e,error:t,complete:i}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}};var fP=hd,Qe=class extends xo{constructor(e,t,i,r){super(e,t,i,r),this.type="firestore",this._queue=HH(),this._persistenceKey=r?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||pP(this),this._firestoreClient.terminate()}};function mP(n,e){let t=typeof n=="object"?n:ll(),i=typeof n=="string"?n:e||Z0,r=Qg(t,"firestore").getImmediate({identifier:i});if(!r._initialized){let s=pT("firestore");s&&ng(r,...s)}return r}function Et(n){return n._firestoreClient||pP(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function pP(n){var e,t,i;let r=n._freezeSettings(),s=zH(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,r);n._firestoreClient=new gC(n._authCredentials,n._appCheckCredentials,n._queue,s),!((t=r.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((i=r.localCache)===null||i===void 0)&&i._onlineComponentProvider)&&(n._firestoreClient._uninitializedComponentsProvider={_offlineKind:r.localCache.kind,_offline:r.localCache._offlineComponentProvider,_online:r.localCache._onlineComponentProvider})}function bE(n,e){n=we(n,Qe),yP(n);let t=Et(n);if(t._uninitializedComponentsProvider)throw new x(v.FAILED_PRECONDITION,"SDK cache is already specified.");Wn("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let i=n._freezeSettings(),r=new nd,s=new Mp(r,i.cacheSizeBytes,e?.forceOwnership);return gP(t,r,s)}function vE(n){n=we(n,Qe),yP(n);let e=Et(n);if(e._uninitializedComponentsProvider)throw new x(v.FAILED_PRECONDITION,"SDK cache is already specified.");Wn("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=n._freezeSettings(),i=new nd,r=new dC(i,t.cacheSizeBytes);return gP(e,i,r)}function gP(n,e,t){let i=new ht;return n.asyncQueue.enqueue(()=>p(this,null,function*(){try{yield Qm(n,t),yield yC(n,e),i.resolve()}catch(r){let s=r;if(!oP(s))throw s;Wn("Error enabling indexeddb cache. Falling back to memory cache: "+s),i.reject(s)}})).then(()=>i.promise)}function _E(n){if(n._initialized&&!n._terminated)throw new x(v.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let e=new ht;return n._queue.enqueueAndForgetEvenWhileRestricted(()=>p(this,null,function*(){try{yield fW(ZC(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function wE(n){n=we(n,Qe);let e=Et(n);return xH(e)}function CE(n){n=we(n,Qe);let e=Et(n);return SH(e)}function EE(n){n=we(n,Qe);let e=Et(n);return TH(e)}function SE(n,e){n=we(n,Qe);let t=Et(n),i=new vC;return LH(t,n._databaseId,e,i),i}function TE(n,e){n=we(n,Qe);let t=Et(n);return BH(t,e).then(i=>i?new Ft(n,null,i.query):null)}function yP(n){if(n._initialized||n._terminated)throw new x(v.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}function QH(n,e=!0){U3(vT),cl(new js("firestore",(t,{instanceIdentifier:i,options:r})=>{let s=t.getProvider("app").getImmediate(),o=new Qe(new F0(t.getProvider("auth-internal")),new U0(t.getProvider("app-check-internal")),L6(s,i),s);return r=Object.assign({useFetchStreams:e},r),o._setSettings(r),o},"PUBLIC").setMultipleInstances(!0)),Ut(eR,tR,n),Ut(eR,tR,"esm2017")}var er=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(kt.fromBase64String(e))}catch(t){throw new x(v.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(kt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var bi=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new x(v.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new mt(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var Ir=class{constructor(e){this._methodName=e}};var Io=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new x(v.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new x(v.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return te(this._lat,e._lat)||te(this._long,e._long)}};var YH=/^__.*__$/,_C=class{constructor(e,t,i){this.data=e,this.fieldMask=t,this.fieldTransforms=i}toMutation(e,t){return this.fieldMask!==null?new yi(e,this.data,this.fieldMask,t,this.fieldTransforms):new xs(e,this.data,t,this.fieldTransforms)}},Pp=class{constructor(e,t,i){this.data=e,this.fieldMask=t,this.fieldTransforms=i}toMutation(e,t){return new yi(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function bP(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw j()}}var Np=class n{constructor(e,t,i,r,s,o){this.settings=e,this.databaseId=t,this.serializer=i,this.ignoreUndefinedProperties=r,s===void 0&&this.validatePath(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new n(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){var t;let i=(t=this.path)===null||t===void 0?void 0:t.child(e),r=this.contextWith({path:i,arrayElement:!1});return r.validatePathSegment(e),r}childContextForFieldPath(e){var t;let i=(t=this.path)===null||t===void 0?void 0:t.child(e),r=this.contextWith({path:i,arrayElement:!1});return r.validatePath(),r}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return Fp(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(e.length===0)throw this.createError("Document fields must not be empty");if(bP(this.dataSource)&&YH.test(e))throw this.createError('Document fields cannot begin and end with "__"')}},wC=class{constructor(e,t,i){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=i||fd(e)}createContext(e,t,i,r=!1){return new Np({dataSource:e,methodName:t,targetDoc:i,path:mt.emptyPath(),arrayElement:!1,hasConverter:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function Oo(n){let e=n._freezeSettings(),t=fd(n._databaseId);return new wC(n._databaseId,!!e.ignoreUndefinedProperties,t)}function rg(n,e,t,i,r,s={}){let o=n.createContext(s.merge||s.mergeFields?2:0,e,t,r);AE("Data must be an object, but it was:",o,i);let a=wP(i,o),c,l;if(s.merge)c=new Tn(o.fieldMask),l=o.fieldTransforms;else if(s.mergeFields){let u=[];for(let d of s.mergeFields){let h=xC(e,d,t);if(!o.contains(h))throw new x(v.INVALID_ARGUMENT,`Field '${h}' is specified in your field mask but missing from your input data.`);EP(u,h)||u.push(h)}c=new Tn(u),l=o.fieldTransforms.filter(d=>c.covers(d.field))}else c=null,l=o.fieldTransforms;return new _C(new Kt(a),c,l)}var id=class n extends Ir{_toFieldTransform(e){if(e.dataSource===2)e.fieldMask.push(e.path);else throw e.dataSource===1?e.createError(`${this._methodName}() can only appear at the top level of your update data`):e.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return null}isEqual(e){return e instanceof n}};function vP(n,e,t){return new Np({dataSource:3,targetDoc:e.settings.targetDoc,methodName:n._methodName,arrayElement:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}var CC=class n extends Ir{_toFieldTransform(e){return new Co(e.path,new Ss)}isEqual(e){return e instanceof n}},EC=class n extends Ir{constructor(e,t){super(e),this._elements=t}_toFieldTransform(e){let t=vP(this,e,!0),i=this._elements.map(s=>Po(s,t)),r=new Tr(i);return new Co(e.path,r)}isEqual(e){return e instanceof n&&Kg(this._elements,e._elements)}},SC=class n extends Ir{constructor(e,t){super(e),this._elements=t}_toFieldTransform(e){let t=vP(this,e,!0),i=this._elements.map(s=>Po(s,t)),r=new xr(i);return new Co(e.path,r)}isEqual(e){return e instanceof n&&Kg(this._elements,e._elements)}},TC=class n extends Ir{constructor(e,t){super(e),this._operand=t}_toFieldTransform(e){let t=new Ts(e.serializer,iO(e.serializer,this._operand));return new Co(e.path,t)}isEqual(e){return e instanceof n&&this._operand===e._operand}};function xE(n,e,t,i){let r=n.createContext(1,e,t);AE("Data must be an object, but it was:",r,i);let s=[],o=Kt.empty();Ro(i,(c,l)=>{let u=DE(e,c,t);l=Xe(l);let d=r.childContextForFieldPath(u);if(l instanceof id)s.push(u);else{let h=Po(l,d);h!=null&&(s.push(u),o.set(u,h))}});let a=new Tn(s);return new Pp(o,a,r.fieldTransforms)}function IE(n,e,t,i,r,s){let o=n.createContext(1,e,t),a=[xC(e,i,t)],c=[r];if(s.length%2!==0)throw new x(v.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let h=0;h<s.length;h+=2)a.push(xC(e,s[h])),c.push(s[h+1]);let l=[],u=Kt.empty();for(let h=a.length-1;h>=0;--h)if(!EP(l,a[h])){let m=a[h],g=c[h];g=Xe(g);let y=o.childContextForFieldPath(m);if(g instanceof id)l.push(m);else{let _=Po(g,y);_!=null&&(l.push(m),u.set(m,_))}}let d=new Tn(l);return new Pp(u,d,o.fieldTransforms)}function _P(n,e,t,i=!1){let r=n.createContext(i?4:3,e);return Po(t,r)}function Po(n,e){if(n=Xe(n),CP(n))return AE("Unsupported field value:",e,n),wP(n,e);if(n instanceof Ir)return ZH(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.arrayElement&&e.dataSource!==4)throw e.createError("Nested arrays are not supported");return XH(n,e)}else return JH(n,e)}function wP(n,e){let t={};return kM(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Ro(n,(i,r)=>{let s=Po(r,e.childContextForField(i));s!=null&&(t[i]=s)}),{mapValue:{fields:t}}}function XH(n,e){let t=[],i=0;for(let r of n){let s=Po(r,e.childContextForArray(i));s==null&&(s={nullValue:"NULL_VALUE"}),t.push(s),i++}return{arrayValue:{values:t}}}function ZH(n,e){if(!bP(e.dataSource))throw e.createError(`${n._methodName}() can only be used with update() and set()`);if(!e.path)throw e.createError(`${n._methodName}() is not currently supported inside arrays`);let t=n._toFieldTransform(e);t&&e.fieldTransforms.push(t)}function JH(n,e){if(n=Xe(n),n===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return iO(e.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){let t=Je.fromDate(n);return{timestampValue:Cc(e.serializer,t)}}else if(n instanceof Je){let t=new Je(n.seconds,Math.floor(n.nanoseconds/1e3)*1e3);return{timestampValue:Cc(e.serializer,t)}}else{if(n instanceof Io)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof er)return{bytesValue:mO(e.serializer,n._byteString)};if(n instanceof Ve){let t=e.databaseId,i=n.firestore._databaseId;if(!i.isEqual(t))throw e.createError(`Document reference is for database ${i.projectId}/${i.database} but should be for database ${t.projectId}/${t.database}`);return{referenceValue:HC(n.firestore._databaseId||e.databaseId,n._key.path)}}else throw e.createError(`Unsupported field value: ${pd(n)}`)}}function CP(n){return typeof n=="object"&&n!==null&&!(n instanceof Array)&&!(n instanceof Date)&&!(n instanceof Je)&&!(n instanceof Io)&&!(n instanceof er)&&!(n instanceof Ve)&&!(n instanceof Ir)}function AE(n,e,t){if(!CP(t)||!pH(t)){let i=pd(t);throw i==="an object"?e.createError(n+" a custom object"):e.createError(n+" "+i)}}function xC(n,e,t){if(e=Xe(e),e instanceof bi)return e._internalPath;if(typeof e=="string")return DE(n,e);throw Fp("Field path arguments must be of type string or ",n,!1,void 0,t)}var e8=new RegExp("[~\\*/\\[\\]]");function DE(n,e,t){if(e.search(e8)>=0)throw Fp(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new bi(...e.split("."))._internalPath}catch{throw Fp(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Fp(n,e,t,i,r){let s=i&&!i.isEmpty(),o=r!==void 0,a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${i}`),o&&(c+=` in document ${r}`),c+=")"),new x(v.INVALID_ARGUMENT,a+n+c)}function EP(n,e){return n.some(t=>t.isEqual(e))}var Ao=class{constructor(e,t,i,r,s){this._firestore=e,this._userDataWriter=t,this._key=i,this._document=r,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Ve(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document)if(this._converter){let e=new IC(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}else return this._userDataWriter.convertValue(this._document.data.value);else return}get(e){if(this._document){let t=this._document.data.field(sg("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},IC=class extends Ao{data(){return super.data()}};function sg(n,e){return typeof e=="string"?DE(n,e):e instanceof bi?e._internalPath:e._delegate._internalPath}function SP(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new x(v.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var rd=class{},Do=class extends rd{};function _i(n,e,...t){let i=[];e instanceof rd&&i.push(e),i=i.concat(t),c8(i);for(let r of i)n=r._apply(n);return n}var Lp=class n extends Do{constructor(e,t,i){super(),this._field=e,this._op=t,this._value=i,this.type="where"}static _create(e,t,i){return new n(e,t,i)}_apply(e){let t=this._parse(e);return xP(e._query,t),new Ft(e.firestore,e.converter,WC(e._query,t))}_parse(e){let t=Oo(e.firestore);return t8(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function og(n,e,t){let i=e,r=sg("where",n);return Lp._create(r,i,t)}var AC=class n extends rd{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new n(e,t)}_parse(e){let t=this._queryConstraints.map(i=>i._parse(e)).filter(i=>i.getFilters().length>0);return t.length===1?t[0]:ke.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(o8(e._query,t),new Ft(e.firestore,e.converter,WC(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var DC=class n extends Do{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new n(e,t)}_apply(e){let t=n8(e._query,this._field,this._direction);return new Ft(e.firestore,e.converter,I5(e._query,t))}};function kE(n,e="asc"){let t=e,i=sg("orderBy",n);return DC._create(i,t)}var Bp=class n extends Do{constructor(e,t,i){super(),this.type=e,this._limit=t,this._limitType=i}static _create(e,t,i){return new n(e,t,i)}_apply(e){return new Ft(e.firestore,e.converter,op(e._query,this._limit,this._limitType))}};function RE(n){return sP("limit",n),Bp._create("limit",n,"F")}function ME(n){return sP("limitToLast",n),Bp._create("limitToLast",n,"L")}var Vp=class n extends Do{constructor(e,t,i){super(),this.type=e,this._docOrFields=t,this._inclusive=i}static _create(e,t,i){return new n(e,t,i)}_apply(e){let t=TP(e,this.type,this._docOrFields,this._inclusive);return new Ft(e.firestore,e.converter,A5(e._query,t))}};function OE(...n){return Vp._create("startAt",n,!0)}function PE(...n){return Vp._create("startAfter",n,!1)}var Up=class n extends Do{constructor(e,t,i){super(),this.type=e,this._docOrFields=t,this._inclusive=i}static _create(e,t,i){return new n(e,t,i)}_apply(e){let t=TP(e,this.type,this._docOrFields,this._inclusive);return new Ft(e.firestore,e.converter,D5(e._query,t))}};function NE(...n){return Up._create("endBefore",n,!1)}function FE(...n){return Up._create("endAt",n,!0)}function TP(n,e,t,i){if(t[0]=Xe(t[0]),t[0]instanceof Ao)return i8(n._query,n.firestore._databaseId,e,t[0]._document,i);{let r=Oo(n.firestore);return r8(n._query,n.firestore._databaseId,r,e,t,i)}}function t8(n,e,t,i,r,s,o){let a;if(r.isKeyField()){if(s==="array-contains"||s==="array-contains-any")throw new x(v.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if(s==="in"||s==="not-in"){lM(o,s);let l=[];for(let u of o)l.push(cM(i,n,u));a={arrayValue:{values:l}}}else a=cM(i,n,o)}else(s==="in"||s==="not-in"||s==="array-contains-any")&&lM(o,s),a=_P(t,e,o,s==="in"||s==="not-in");return ge.create(r,s,a)}function n8(n,e,t){if(n.startAt!==null)throw new x(v.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(n.endAt!==null)throw new x(v.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new _o(e,t)}function i8(n,e,t,i,r){if(!i)throw new x(v.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${t}().`);let s=[];for(let o of vc(n))if(o.field.isKeyField())s.push(vo(e,i.key));else{let a=i.data.field(o.field);if(Kp(a))throw new x(v.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+o.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(a!==null)s.push(a);else{let c=o.field.canonicalString();throw new x(v.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${c}' (used as the orderBy) does not exist.`)}}return new Zi(s,r)}function r8(n,e,t,i,r,s){let o=n.explicitOrderBy;if(r.length>o.length)throw new x(v.INVALID_ARGUMENT,`Too many arguments provided to ${i}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let a=[];for(let c=0;c<r.length;c++){let l=r[c];if(o[c].field.isKeyField()){if(typeof l!="string")throw new x(v.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${i}(), but got a ${typeof l}`);if(!GC(n)&&l.indexOf("/")!==-1)throw new x(v.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${i}() must be a plain document ID, but '${l}' contains a slash.`);let d=n.path.child(_e.fromString(l));if(!L.isDocumentKey(d))throw new x(v.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${i}() must result in a valid document path, but '${d}' is not because it contains an odd number of segments.`);let h=new L(d);a.push(vo(e,h))}else{let d=_P(t,i,l);a.push(d)}}return new Zi(a,s)}function cM(n,e,t){if(t=Xe(t),typeof t=="string"){if(t==="")throw new x(v.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!GC(e)&&t.indexOf("/")!==-1)throw new x(v.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let i=e.path.child(_e.fromString(t));if(!L.isDocumentKey(i))throw new x(v.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${i}' is not because it has an odd number of segments (${i.length}).`);return vo(n,new L(i))}else{if(t instanceof Ve)return vo(n,t._key);throw new x(v.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${pd(t)}.`)}}function lM(n,e){if(!Array.isArray(n)||n.length===0)throw new x(v.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function s8(n){switch(n){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}function xP(n,e){let t=a8(n.filters,s8(e.op));if(t!==null)throw t===e.op?new x(v.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new x(v.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function o8(n,e){let t=n,i=e.getFlattenedFilters();for(let r of i)xP(t,r),t=WC(t,r)}function a8(n,e){for(let t of n)for(let i of t.getFlattenedFilters())if(e.indexOf(i.op)>=0)return i.op;return null}function c8(n){let e=n.filter(i=>i instanceof AC).length,t=n.filter(i=>i instanceof Lp).length;if(e>1||e>0&&t>0)throw new x(v.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}var Rc=class{convertValue(e,t="none"){switch(bo(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ot(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(ws(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw j()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let i={};return Ro(e,(r,s)=>{i[r]=this.convertValue(s,t)}),i}convertGeoPoint(e){return new Io(ot(e.latitude),ot(e.longitude))}convertArray(e,t){return(e.values||[]).map(i=>this.convertValue(i,t))}convertServerTimestamp(e,t){switch(t){case"previous":let i=jC(e);return i==null?null:this.convertValue(i,t);case"estimate":return this.convertTimestamp(Lu(e));default:return null}}convertTimestamp(e){let t=Sr(e);return new Je(t.seconds,t.nanos)}convertDocumentKey(e,t){let i=_e.fromString(e);$(TO(i));let r=new Cs(i.get(1),i.get(3)),s=new L(i.popFirst(5));return r.isEqual(t)||Ze(`Document ${s} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};function ag(n,e,t){let i;return n?t&&(t.merge||t.mergeFields)?i=n.toFirestore(e,t):i=n.toFirestore(e):i=e,i}var kC=class extends Rc{constructor(e){super(),this.firestore=e}convertBytes(e){return new er(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ve(this.firestore,null,t)}};function RC(n){return l8(n,["next","error","complete"])}function l8(n,e){if(typeof n!="object"||n===null)return!1;let t=n;for(let i of e)if(i in t&&typeof t[i]=="function")return!0;return!1}var Ar=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},Hn=class extends Ao{constructor(e,t,i,r,s,o){super(e,t,i,r,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document)if(this._converter){let t=new Ds(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}else return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps);else return}get(e,t={}){if(this._document){let i=this._document.data.field(sg("DocumentSnapshot.get",e));if(i!==null)return this._userDataWriter.convertValue(i,t.serverTimestamps)}}},Ds=class extends Hn{data(e={}){return super.data(e)}},vi=class{constructor(e,t,i,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new Ar(r.hasPendingWrites,r.fromCache),this.query=i}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(i=>{e.call(t,new Ds(this._firestore,this._userDataWriter,i.key,i,new Ar(this._snapshot.mutatedKeys.has(i.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new x(v.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return(!this._cachedChanges||this._cachedChangesIncludeMetadataChanges!==t)&&(this._cachedChanges=u8(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};function u8(n,e){if(n._snapshot.oldDocs.isEmpty()){let t=0;return n._snapshot.docChanges.map(i=>{let r=new Ds(n._firestore,n._userDataWriter,i.doc.key,i.doc,new Ar(n._snapshot.mutatedKeys.has(i.doc.key),n._snapshot.fromCache),n.query.converter);return i.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}})}else{let t=n._snapshot.oldDocs;return n._snapshot.docChanges.filter(i=>e||i.type!==3).map(i=>{let r=new Ds(n._firestore,n._userDataWriter,i.doc.key,i.doc,new Ar(n._snapshot.mutatedKeys.has(i.doc.key),n._snapshot.fromCache),n.query.converter),s=-1,o=-1;return i.type!==0&&(s=t.indexOf(i.doc.key),t=t.delete(i.doc.key)),i.type!==1&&(t=t.add(i.doc),o=t.indexOf(i.doc.key)),{type:d8(i.type),doc:r,oldIndex:s,newIndex:o}})}}function d8(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return j()}}function cg(n,e){return n instanceof Hn&&e instanceof Hn?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof vi&&e instanceof vi?n._firestore===e._firestore&&ig(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot):!1}function LE(n){n=we(n,Ve);let e=we(n.firestore,Qe),t=Et(e);return lP(t,n._key).then(i=>zE(e,n,i))}var Dr=class extends Rc{constructor(e){super(),this.firestore=e}convertBytes(e){return new er(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ve(this.firestore,null,t)}};function BE(n){n=we(n,Ve);let e=we(n.firestore,Qe),t=Et(e),i=new Dr(e);return AH(t,n._key).then(r=>new Hn(e,i,n._key,r,new Ar(r!==null&&r.hasLocalMutations,!0),n.converter))}function VE(n){n=we(n,Ve);let e=we(n.firestore,Qe),t=Et(e);return lP(t,n._key,{source:"server"}).then(i=>zE(e,n,i))}function lg(n){n=we(n,Ft);let e=we(n.firestore,Qe),t=Et(e),i=new Dr(e);return SP(n._query),uP(t,n._query).then(r=>new vi(e,i,n,r))}function UE(n){n=we(n,Ft);let e=we(n.firestore,Qe),t=Et(e),i=new Dr(e);return DH(t,n._query).then(r=>new vi(e,i,n,r))}function jE(n){n=we(n,Ft);let e=we(n.firestore,Qe),t=Et(e),i=new Dr(e);return uP(t,n._query,{source:"server"}).then(r=>new vi(e,i,n,r))}function ug(n,e,t){n=we(n,Ve);let i=we(n.firestore,Qe),r=ag(n.converter,e,t),s=Oo(i),a=rg(s,"setDoc",n._key,r,n.converter!==null,t).toMutation(n._key,st.none());return zc(i,[a])}function bd(n,e,t,...i){n=we(n,Ve);let r=we(n.firestore,Qe),s=Oo(r);e=Xe(e);let o;typeof e=="string"||e instanceof bi?o=IE(s,"updateDoc",n._key,e,t,i):o=xE(s,"updateDoc",n._key,e);let a=o.toMutation(n._key,st.exists(!0));return zc(r,[a])}function dg(n){let e=we(n.firestore,Qe),t=[new Is(n._key,st.none())];return zc(e,t)}function hg(n,e){let t=we(n.firestore,Qe),i=Mo(n),r=ag(n.converter,e),s=Oo(n.firestore),a=rg(s,"addDoc",i._key,r,n.converter!==null,{}).toMutation(i._key,st.exists(!1));return zc(t,[a]).then(()=>i)}function qc(n,...e){var t,i,r;n=Xe(n);let s={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]=="object"&&!RC(e[o])&&(s=e[o],o++);let a={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(RC(e[o])){let h=e[o];e[o]=(t=h.next)===null||t===void 0?void 0:t.bind(h),e[o+1]=(i=h.error)===null||i===void 0?void 0:i.bind(h),e[o+2]=(r=h.complete)===null||r===void 0?void 0:r.bind(h)}let c,l,u;if(n instanceof Ve)l=we(n.firestore,Qe),u=Fc(n._key.path),c={next:h=>{e[o]&&e[o](zE(l,n,h))},error:e[o+1],complete:e[o+2]};else{let h=we(n,Ft);l=we(h.firestore,Qe),u=h._query;let m=new Dr(l);c={next:g=>{e[o]&&e[o](new vi(l,m,h,g))},error:e[o+1],complete:e[o+2]},SP(n._query)}let d=Et(l);return IH(d,u,a,c)}function qE(n,e){n=we(n,Qe);let t=Et(n),i=RC(e)?e:{next:e};return RH(t,i)}function zc(n,e){let t=Et(n);return kH(t,e)}function zE(n,e,t){let i=t.docs.get(e._key),r=new Dr(n);return new Hn(n,r,e._key,i,new Ar(t.hasPendingWrites,t.fromCache),e.converter)}var h8={maxAttempts:5};function f8(n){if(n.maxAttempts<1)throw new x(v.INVALID_ARGUMENT,"Max attempts must be at least 1")}var jp=class{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Oo(e)}set(e,t,i){this._verifyNotCommitted();let r=bs(e,this._firestore),s=ag(r.converter,t,i),o=rg(this._dataReader,"WriteBatch.set",r._key,s,r.converter!==null,i);return this._mutations.push(o.toMutation(r._key,st.none())),this}update(e,t,i,...r){this._verifyNotCommitted();let s=bs(e,this._firestore);t=Xe(t);let o;return typeof t=="string"||t instanceof bi?o=IE(this._dataReader,"WriteBatch.update",s._key,t,i,r):o=xE(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(o.toMutation(s._key,st.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=bs(e,this._firestore);return this._mutations=this._mutations.concat(new Is(t._key,st.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new x(v.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function bs(n,e){if(n=Xe(n),n.firestore!==e)throw new x(v.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}var MC=class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=Oo(e)}get(e){let t=bs(e,this._firestore),i=new kC(this._firestore);return this._transaction.lookup([t._key]).then(r=>{if(!r||r.length!==1)return j();let s=r[0];if(s.isFoundDocument())return new Ao(this._firestore,i,s.key,s,t.converter);if(s.isNoDocument())return new Ao(this._firestore,i,t._key,null,t.converter);throw j()})}set(e,t,i){let r=bs(e,this._firestore),s=ag(r.converter,t,i),o=rg(this._dataReader,"Transaction.set",r._key,s,r.converter!==null,i);return this._transaction.set(r._key,o),this}update(e,t,i,...r){let s=bs(e,this._firestore);t=Xe(t);let o;return typeof t=="string"||t instanceof bi?o=IE(this._dataReader,"Transaction.update",s._key,t,i,r):o=xE(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,o),this}delete(e){let t=bs(e,this._firestore);return this._transaction.delete(t._key),this}};var OC=class extends MC{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=bs(e,this._firestore),i=new Dr(this._firestore);return super.get(e).then(r=>new Hn(this._firestore,i,t._key,r._document,new Ar(!1,!1),t.converter))}};function GE(n,e,t){n=we(n,Qe);let i=Object.assign(Object.assign({},h8),t);f8(i);let r=Et(n);return MH(r,s=>e(new OC(n,s)),i)}function WE(){return new id("deleteField")}function $E(){return new CC("serverTimestamp")}function HE(...n){return new EC("arrayUnion",n)}function KE(...n){return new SC("arrayRemove",n)}function QE(n){return new TC("increment",n)}QH("node");var m8="@firebase/firestore-compat",p8="0.3.29";function tS(n,e){if(e===void 0)return{merge:!1};if(e.mergeFields!==void 0&&e.merge!==void 0)throw new x("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function IP(){if(typeof Uint8Array>"u")throw new x("unimplemented","Uint8Arrays are not available in this environment.")}function AP(){if(!RM())throw new x("unimplemented","Blobs are unavailable in Firestore in this environment.")}var fg=class n{constructor(e){this._delegate=e}static fromBase64String(e){return AP(),new n(er.fromBase64String(e))}static fromUint8Array(e){return IP(),new n(er.fromUint8Array(e))}toBase64(){return AP(),this._delegate.toBase64()}toUint8Array(){return IP(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}};function YE(n){return g8(n,["next","error","complete"])}function g8(n,e){if(typeof n!="object"||n===null)return!1;let t=n;for(let i of e)if(i in t&&typeof t[i]=="function")return!0;return!1}var XE=class{enableIndexedDbPersistence(e,t){return bE(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return vE(e._delegate)}clearIndexedDbPersistence(e){return _E(e._delegate)}},mg=class{constructor(e,t,i){this._delegate=t,this._persistenceProvider=i,this.INTERNAL={delete:()=>this.terminate()},e instanceof Cs||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){let t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&Wn("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&(e=Object.assign(Object.assign({},t),e),delete e.merge),this._delegate._setSettings(e)}useEmulator(e,t,i={}){ng(this._delegate,e,t,i)}enableNetwork(){return CE(this._delegate)}disableNetwork(){return EE(this._delegate)}enablePersistence(e){let t=!1,i=!1;return e&&(t=!!e.synchronizeTabs,i=!!e.experimentalForceOwningTab,fE("synchronizeTabs",t,"experimentalForceOwningTab",i)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,i)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return wE(this._delegate)}onSnapshotsInSync(e){return qE(this._delegate,e)}get app(){if(!this._appCompat)throw new x("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new $c(this,gd(this._delegate,e))}catch(t){throw cn(t,"collection()","Firestore.collection()")}}doc(e){try{return new tr(this,Mo(this._delegate,e))}catch(t){throw cn(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new Bo(this,yE(this._delegate,e))}catch(t){throw cn(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return GE(this._delegate,t=>e(new pg(this,t)))}batch(){return Et(this._delegate),new gg(new jp(this._delegate,e=>zc(this._delegate,e)))}loadBundle(e){return SE(this._delegate,e)}namedQuery(e){return TE(this._delegate,e).then(t=>t?new Bo(this,t):null)}},Gc=class extends Rc{constructor(e){super(),this.firestore=e}convertBytes(e){return new fg(new er(e))}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return tr.forKey(t,this.firestore,null)}};function y8(n){PC(n)}var pg=class{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new Gc(e)}get(e){let t=No(e);return this._delegate.get(t).then(i=>new Fo(this._firestore,new Hn(this._firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,t.converter)))}set(e,t,i){let r=No(e);return i?(tS("Transaction.set",i),this._delegate.set(r,t,i)):this._delegate.set(r,t),this}update(e,t,i,...r){let s=No(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,i,...r),this}delete(e){let t=No(e);return this._delegate.delete(t),this}},gg=class{constructor(e){this._delegate=e}set(e,t,i){let r=No(e);return i?(tS("WriteBatch.set",i),this._delegate.set(r,t,i)):this._delegate.set(r,t),this}update(e,t,i,...r){let s=No(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,i,...r),this}delete(e){let t=No(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}},Wc=class n{constructor(e,t,i){this._firestore=e,this._userDataWriter=t,this._delegate=i}fromFirestore(e,t){let i=new Ds(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new Lo(this._firestore,i),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){let i=n.INSTANCES,r=i.get(e);r||(r=new WeakMap,i.set(e,r));let s=r.get(t);return s||(s=new n(e,new Gc(e),t),r.set(t,s)),s}};Wc.INSTANCES=new WeakMap;var tr=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Gc(e)}static forPath(e,t,i){if(e.length%2!==0)throw new x("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new n(t,new Ve(t._delegate,i,new L(e)))}static forKey(e,t,i){return new n(t,new Ve(t._delegate,i,e))}get id(){return this._delegate.id}get parent(){return new $c(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new $c(this.firestore,gd(this._delegate,e))}catch(t){throw cn(t,"collection()","DocumentReference.collection()")}}isEqual(e){return e=Xe(e),e instanceof Ve?yd(this._delegate,e):!1}set(e,t){t=tS("DocumentReference.set",t);try{return t?ug(this._delegate,e,t):ug(this._delegate,e)}catch(i){throw cn(i,"setDoc()","DocumentReference.set()")}}update(e,t,...i){try{return arguments.length===1?bd(this._delegate,e):bd(this._delegate,e,t,...i)}catch(r){throw cn(r,"updateDoc()","DocumentReference.update()")}}delete(){return dg(this._delegate)}onSnapshot(...e){let t=DP(e),i=kP(e,r=>new Fo(this.firestore,new Hn(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)));return qc(this._delegate,t,i)}get(e){let t;return e?.source==="cache"?t=BE(this._delegate):e?.source==="server"?t=VE(this._delegate):t=LE(this._delegate),t.then(i=>new Fo(this.firestore,new Hn(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)))}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(Wc.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function cn(n,e,t){return n.message=n.message.replace(e,t),n}function DP(n){for(let e of n)if(typeof e=="object"&&!YE(e))return e;return{}}function kP(n,e){var t,i;let r;return YE(n[0])?r=n[0]:YE(n[1])?r=n[1]:typeof n[0]=="function"?r={next:n[0],error:n[1],complete:n[2]}:r={next:n[1],error:n[2],complete:n[3]},{next:s=>{r.next&&r.next(e(s))},error:(t=r.error)===null||t===void 0?void 0:t.bind(r),complete:(i=r.complete)===null||i===void 0?void 0:i.bind(r)}}var Fo=class{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new tr(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return cg(this._delegate,e._delegate)}},Lo=class extends Fo{data(e){let t=this._delegate.data(e);return this._delegate._converter||dM(t!==void 0,"Document in a QueryDocumentSnapshot should exist"),t}},Bo=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Gc(e)}where(e,t,i){try{return new n(this.firestore,_i(this._delegate,og(e,t,i)))}catch(r){throw cn(r,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new n(this.firestore,_i(this._delegate,kE(e,t)))}catch(i){throw cn(i,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new n(this.firestore,_i(this._delegate,RE(e)))}catch(t){throw cn(t,"limit()","Query.limit()")}}limitToLast(e){try{return new n(this.firestore,_i(this._delegate,ME(e)))}catch(t){throw cn(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new n(this.firestore,_i(this._delegate,OE(...e)))}catch(t){throw cn(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new n(this.firestore,_i(this._delegate,PE(...e)))}catch(t){throw cn(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new n(this.firestore,_i(this._delegate,NE(...e)))}catch(t){throw cn(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new n(this.firestore,_i(this._delegate,FE(...e)))}catch(t){throw cn(t,"endAt()","Query.endAt()")}}isEqual(e){return ig(this._delegate,e._delegate)}get(e){let t;return e?.source==="cache"?t=UE(this._delegate):e?.source==="server"?t=jE(this._delegate):t=lg(this._delegate),t.then(i=>new vd(this.firestore,new vi(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)))}onSnapshot(...e){let t=DP(e),i=kP(e,r=>new vd(this.firestore,new vi(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)));return qc(this._delegate,t,i)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(Wc.getInstance(this.firestore,e)):this._delegate.withConverter(null))}},ZE=class{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new Lo(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}},vd=class{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new Bo(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new Lo(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new ZE(this._firestore,t))}forEach(e,t){this._delegate.forEach(i=>{e.call(t,new Lo(this._firestore,i))})}isEqual(e){return cg(this._delegate,e._delegate)}},$c=class n extends Bo{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){let e=this._delegate.parent;return e?new tr(this.firestore,e):null}doc(e){try{return e===void 0?new tr(this.firestore,Mo(this._delegate)):new tr(this.firestore,Mo(this._delegate,e))}catch(t){throw cn(t,"doc()","CollectionReference.doc()")}}add(e){return hg(this._delegate,e).then(t=>new tr(this.firestore,t))}isEqual(e){return yd(this._delegate,e._delegate)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(Wc.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function No(n){return we(n,Ve)}var JE=class n{constructor(...e){this._delegate=new bi(...e)}static documentId(){return new n(mt.keyField().canonicalString())}isEqual(e){return e=Xe(e),e instanceof bi?this._delegate._internalPath.isEqual(e._internalPath):!1}};var eS=class n{constructor(e){this._delegate=e}static serverTimestamp(){let e=$E();return e._methodName="FieldValue.serverTimestamp",new n(e)}static delete(){let e=WE();return e._methodName="FieldValue.delete",new n(e)}static arrayUnion(...e){let t=HE(...e);return t._methodName="FieldValue.arrayUnion",new n(t)}static arrayRemove(...e){let t=KE(...e);return t._methodName="FieldValue.arrayRemove",new n(t)}static increment(e){let t=QE(e);return t._methodName="FieldValue.increment",new n(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}};var b8={Firestore:mg,GeoPoint:Io,Timestamp:Je,Blob:fg,Transaction:pg,WriteBatch:gg,DocumentReference:tr,DocumentSnapshot:Fo,Query:Bo,QueryDocumentSnapshot:Lo,QuerySnapshot:vd,CollectionReference:$c,FieldPath:JE,FieldValue:eS,setLogLevel:y8,CACHE_SIZE_UNLIMITED:fP};function v8(n,e){n.INTERNAL.registerComponent(new js("firestore-compat",t=>{let i=t.getProvider("app-compat").getImmediate(),r=t.getProvider("firestore").getImmediate();return e(i,r)},"PUBLIC").setServiceProps(Object.assign({},b8)))}function _8(n){v8(n,(e,t)=>new mg(e,t,new XE)),n.registerVersion(m8,p8,"node")}_8(Xt);function w8(n,e=Md){return new un(t=>{let i;return e!=null?e.schedule(()=>{i=n.onSnapshot({includeMetadataChanges:!0},t)}):i=n.onSnapshot({includeMetadataChanges:!0},t),()=>{i?.()}})}function RP(n,e){return w8(n,e)}function C8(n,e){return RP(n,e).pipe(Pr(void 0),$o(),Ae(t=>{let[i,r]=t;return r.exists?i?.exists?{payload:r,type:"modified"}:{payload:r,type:"added"}:{payload:r,type:"removed"}}))}function rS(n,e){return RP(n,e).pipe(Ae(t=>({payload:t,type:"query"})))}var yg=class{ref;afs;constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){let i=this.ref.collection(e),{ref:r,query:s}=FP(i,t);return new vg(r,s,this.afs)}snapshotChanges(){return C8(this.ref,this.afs.schedulers.outsideAngular).pipe(Zt)}valueChanges(e={}){return this.snapshotChanges().pipe(Ae(({payload:t})=>e.idField?In(he({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return Yn(this.ref.get(e)).pipe(Zt)}};function bg(n,e){return rS(n,e).pipe(Pr(void 0),$o(),Ae(t=>{let[i,r]=t,s=r.payload.docChanges(),o=s.map(a=>({type:a.type,payload:a}));return i&&JSON.stringify(i.payload.metadata)!==JSON.stringify(r.payload.metadata)&&r.payload.docs.forEach((a,c)=>{let l=s.find(d=>d.doc.ref.isEqual(a.ref)),u=i?.payload.docs.find(d=>d.ref.isEqual(a.ref));l&&JSON.stringify(l.doc.metadata)===JSON.stringify(a.metadata)||!l&&u&&JSON.stringify(u.metadata)===JSON.stringify(a.metadata)||o.push({type:"modified",payload:{oldIndex:c,newIndex:c,type:"modified",doc:a}})}),o}))}function MP(n,e,t){return bg(n,t).pipe(rl((i,r)=>E8(i,r.map(s=>s.payload),e),[]),Wo(),Ae(i=>i.map(r=>({type:r.type,payload:r}))))}function E8(n,e,t){return e.forEach(i=>{t.indexOf(i.type)>-1&&(n=S8(n,i))}),n}function nS(n,e,t,...i){let r=n.slice();return r.splice(e,t,...i),r}function S8(n,e){switch(e.type){case"added":if(!(n[e.newIndex]&&n[e.newIndex].doc.ref.isEqual(e.doc.ref)))return nS(n,e.newIndex,0,e);break;case"modified":if(n[e.oldIndex]==null||n[e.oldIndex].doc.ref.isEqual(e.doc.ref))if(e.oldIndex!==e.newIndex){let t=n.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}else return nS(n,e.newIndex,1,e);break;case"removed":if(n[e.oldIndex]&&n[e.oldIndex].doc.ref.isEqual(e.doc.ref))return nS(n,e.oldIndex,1);break}return n}function OP(n){return(!n||n.length===0)&&(n=["added","removed","modified"]),n}var vg=class{ref;query;afs;constructor(e,t,i){this.ref=e,this.query=t,this.afs=i}stateChanges(e){let t=bg(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe(Ae(i=>i.filter(r=>e.indexOf(r.type)>-1)))),t.pipe(Pr(void 0),$o(),Xn(([i,r])=>r.length>0||!i),Ae(([,i])=>i),Zt)}auditTrail(e){return this.stateChanges(e).pipe(rl((t,i)=>[...t,...i],[]))}snapshotChanges(e){let t=OP(e);return MP(this.query,t,this.afs.schedulers.outsideAngular).pipe(Zt)}valueChanges(e={}){return rS(this.query,this.afs.schedulers.outsideAngular).pipe(Ae(t=>t.payload.docs.map(i=>e.idField?In(he({},i.data()),{[e.idField]:i.id}):i.data())),Zt)}get(e){return Yn(this.query.get(e)).pipe(Zt)}add(e){return this.ref.add(e)}doc(e){return new yg(this.ref.doc(e),this.afs)}},iS=class{query;afs;constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return!e||e.length===0?bg(this.query,this.afs.schedulers.outsideAngular).pipe(Zt):bg(this.query,this.afs.schedulers.outsideAngular).pipe(Ae(t=>t.filter(i=>e.indexOf(i.type)>-1)),Xn(t=>t.length>0),Zt)}auditTrail(e){return this.stateChanges(e).pipe(rl((t,i)=>[...t,...i],[]))}snapshotChanges(e){let t=OP(e);return MP(this.query,t,this.afs.schedulers.outsideAngular).pipe(Zt)}valueChanges(e={}){return rS(this.query,this.afs.schedulers.outsideAngular).pipe(Ae(i=>i.payload.docs.map(r=>e.idField?he({[e.idField]:r.id},r.data()):r.data())),Zt)}get(e){return Yn(this.query.get(e)).pipe(Zt)}},PP=new J("angularfire2.enableFirestorePersistence"),NP=new J("angularfire2.firestore.persistenceSettings"),T8=new J("angularfire2.firestore.settings"),x8=new J("angularfire2.firestore.use-emulator");function FP(n,e=t=>t){return{query:e(n),ref:n}}var _d=(()=>{class n{schedulers;firestore;persistenceEnabled$;constructor(t,i,r,s,o,a,c,l,u,d,h,m,g,y,_,M,T){this.schedulers=c;let O=bl(t,a,i),P=u;d&&yy(O,a,h,g,y,_,m,M),[this.firestore,this.persistenceEnabled$]=fh(`${O.name}.firestore`,"AngularFirestore",O.name,()=>{let W=a.runOutsideAngular(()=>O.firestore());if(s&&W.settings(s),P&&W.useEmulator(...P),r&&!Gd(o)){let X=()=>{try{return Yn(W.enablePersistence(l||void 0).then(()=>!0,()=>!1))}catch(ue){return typeof console<"u"&&console.warn(ue),An(!1)}};return[W,a.runOutsideAngular(X)]}else return[W,An(!1)]},[s,P,r])}collection(t,i){let r;typeof t=="string"?r=this.firestore.collection(t):r=t;let{ref:s,query:o}=FP(r,i),a=this.schedulers.ngZone.run(()=>s);return new vg(a,o,this)}collectionGroup(t,i){let r=i||(o=>o),s=this.firestore.collectionGroup(t);return new iS(r(s),this)}doc(t){let i;typeof t=="string"?i=this.firestore.doc(t):i=t;let r=this.schedulers.ngZone.run(()=>i);return new yg(r,this)}createId(){return this.firestore.collection("_").doc().id}static \u0275fac=function(i){return new(i||n)(C(ra),C(sa,8),C(PP,8),C(T8,8),C(Ci),C(ae),C(xi),C(NP,8),C(x8,8),C(ur,8),C(dy,8),C(hy,8),C(fy,8),C(my,8),C(py,8),C(gy,8),C(ii,8))};static \u0275prov=ie({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})(),LP=(()=>{class n{constructor(){Xt.registerVersion("angularfire",hn.full,"fst-compat")}static enablePersistence(t){return{ngModule:n,providers:[{provide:PP,useValue:!0},{provide:NP,useValue:t}]}}static \u0275fac=function(i){return new(i||n)};static \u0275mod=se({type:n});static \u0275inj=re({providers:[_d]})}return n})();var VP=(()=>{let e=class e{constructor(i){this.renderer=i}ngOnInit(){this.renderer.setStyle(document.body,"background","url( https://mnd-assets.mynewsdesk.com/image/upload/c_fill,dpr_auto,f_auto,g_auto,q_auto:good,w_1782/a2i7v0esw1hag0nql553) no-repeat center center fixed"),this.renderer.setStyle(document.body,"background-size","cover")}};e.\u0275fac=function(r){return new(r||e)(z(rr))},e.\u0275cmp=Ee({type:e,selectors:[["app-first-page"]],decls:6,vars:0,consts:[[1,"home"],[1,"text"]],template:function(r,s){r&1&&(S(0,"div",0)(1,"div",1)(2,"h1"),F(3,"Welcome to Colleague Care!"),w(),S(4,"p"),F(5,"Your compass for cultivating camaraderie in the workplace. Streamline your team's efforts with intuitive scheduling for tasks and events, fostering a culture of collaboration and support. Elevate your work environment, one chore at a time."),w()()())},styles:["@media (min-width: 768px){.home[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;flex-direction:column;align-items:center;margin-top:150px}.text[_ngcontent-%COMP%]{width:700px;background-color:#00000080;border-radius:30px;transition:width 1s ease-out,background-color 1s ease-out}.text[_ngcontent-%COMP%]:hover{width:700px;background-color:#000;border-radius:30px;transition:width 1s ease-in,background-color 1s ease-in}p[_ngcontent-%COMP%]{color:#fff;font-size:larger;text-align:center;margin:50px}h1[_ngcontent-%COMP%]{color:#fff;text-align:center;margin:50px}}@media (max-width: 767px){.home[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;flex-direction:column;align-items:center;margin-top:100px}.text[_ngcontent-%COMP%]{width:300px;background-color:#00000080;border-radius:30px;transition:width 1s ease-out,background-color 1s ease-out}.text[_ngcontent-%COMP%]:hover{width:300px;background-color:#000;border-radius:30px;transition:width 1s ease-in,background-color 1s ease-in}p[_ngcontent-%COMP%]{color:#fff;font-size:large;text-align:center;margin:30px}h1[_ngcontent-%COMP%]{color:#fff;text-align:center;margin:30px}}"]});let n=e;return n})();function I8(n,e){if(n&1){let t=lt();S(0,"div",3)(1,"h2"),F(2,"Login"),w(),S(3,"div",4)(4,"label",5),F(5,"Email:"),w(),S(6,"input",6),ti("ngModelChange",function(r){ye(t);let s=fe();return ei(s.email,r)||(s.email=r),be(r)}),w()(),S(7,"div",4)(8,"label",7),F(9,"Password:"),w(),S(10,"input",8),ti("ngModelChange",function(r){ye(t);let s=fe();return ei(s.password,r)||(s.password=r),be(r)}),w()(),S(11,"div",9)(12,"button",10),ce("click",function(){ye(t);let r=fe();return be(r.login())}),F(13,"Login"),w()(),S(14,"div",11)(15,"p"),F(16,"Don't have an account? "),S(17,"a",12),ce("click",function(){return ye(t),fe().toggleRegistrationForm(),be(!1)}),F(18,"Create"),w()()()()}if(n&2){let t=fe();q(6),Jn("ngModel",t.email),q(4),Jn("ngModel",t.password)}}function A8(n,e){if(n&1){let t=lt();S(0,"div",13)(1,"h2"),F(2,"Create Account"),w(),S(3,"div",4)(4,"label",5),F(5,"Email:"),w(),S(6,"input",6),ti("ngModelChange",function(r){ye(t);let s=fe();return ei(s.email,r)||(s.email=r),be(r)}),w()(),S(7,"div",4)(8,"label",7),F(9,"Password:"),w(),S(10,"input",8),ti("ngModelChange",function(r){ye(t);let s=fe();return ei(s.password,r)||(s.password=r),be(r)}),w()(),S(11,"div",4)(12,"label",14),F(13,"First Name:"),w(),S(14,"input",15),ti("ngModelChange",function(r){ye(t);let s=fe();return ei(s.firstName,r)||(s.firstName=r),be(r)}),w()(),S(15,"div",4)(16,"label",16),F(17,"Last Name:"),w(),S(18,"input",17),ti("ngModelChange",function(r){ye(t);let s=fe();return ei(s.lastName,r)||(s.lastName=r),be(r)}),w()(),S(19,"div",4)(20,"label",18),F(21,"Birthday:"),w(),S(22,"input",19),ti("ngModelChange",function(r){ye(t);let s=fe();return ei(s.birthday,r)||(s.birthday=r),be(r)}),w()(),S(23,"div",20)(24,"button",10),ce("click",function(){ye(t);let r=fe();return be(r.register())}),F(25,"Register"),w()(),S(26,"div",21)(27,"p"),F(28,"Already have an account? "),S(29,"a",22),ce("click",function(){return ye(t),fe().toggleRegistrationForm(),be(!1)}),F(30,"Login"),w()()()()}if(n&2){let t=fe();q(6),Jn("ngModel",t.email),q(4),Jn("ngModel",t.password),q(4),Jn("ngModel",t.firstName),q(4),Jn("ngModel",t.lastName),q(4),Jn("ngModel",t.birthday)}}var UP=(()=>{let e=class e{constructor(i,r,s){this.auth=i,this.router=r,this.firestore=s,this.email="",this.password="",this.firstName="",this.lastName="",this.birthday=null,this.showRegistrationForm=!1}login(){return p(this,null,function*(){try{let i=yield this.auth.signInWithEmailAndPassword(this.email,this.password);console.log("Logged in successfully!",i.user),i.user&&this.router.navigate(["/display"])}catch(i){alert("Login failed. Please check your credentials."),console.error("Login error:",i),this.email="",this.password=""}})}register(){return p(this,null,function*(){try{let i=yield this.auth.createUserWithEmailAndPassword(this.email,this.password);console.log("Registered successfully!",i.user),i.user&&(yield this.firestore.collection("colleagues").doc(i.user.uid).set({email:this.email,firstName:this.firstName,lastName:this.lastName,birthday:this.birthday}),this.router.navigate(["/display"]))}catch(i){alert("Registration failed. Please try again."),console.error("Registration error:",i),this.email="",this.password=""}})}toggleRegistrationForm(){this.showRegistrationForm=!this.showRegistrationForm,this.email="",this.password="",this.firstName="",this.lastName="",this.birthday=null}};e.\u0275fac=function(r){return new(r||e)(z(ur),z(Jo),z(_d))},e.\u0275cmp=Ee({type:e,selectors:[["app-login-page"]],decls:3,vars:2,consts:[[1,"login"],["class","login-table",4,"ngIf"],["class","registration-table",4,"ngIf"],[1,"login-table"],[1,"input"],["for","email"],["type","email","id","email",3,"ngModelChange","ngModel"],["for","password"],["type","password","id","password",3,"ngModelChange","ngModel"],[1,"login-button"],[3,"click"],[1,"create-account-link"],["href","#",1,"create",3,"click"],[1,"registration-table"],["for","firstName"],["type","text","id","firstName",3,"ngModelChange","ngModel"],["for","lastName"],["type","text","id","lastName",3,"ngModelChange","ngModel"],["for","birthday"],["type","date","id","birthday",3,"ngModelChange","ngModel"],[1,"registration-button"],[1,"login-link"],["href","#",3,"click"]],template:function(r,s){r&1&&(S(0,"div",0),$e(1,I8,19,2,"div",1)(2,A8,31,5,"div",2),w()),r&2&&(q(),me("ngIf",!s.showRegistrationForm),q(),me("ngIf",s.showRegistrationForm))},dependencies:[Rn,Ti,Fr,cr],styles:[".login[_ngcontent-%COMP%]{height:100%;width:100%;display:flex;align-items:center;justify-content:center}h2[_ngcontent-%COMP%]{margin-top:20px}.login-table[_ngcontent-%COMP%]{background-color:#00000080;border-radius:30px;color:#fff;transition:width 1s ease-out,background-color 1s ease-out;margin-bottom:300px;display:flex;align-items:center;justify-content:center;flex-direction:column}.login-table[_ngcontent-%COMP%]:hover{background-color:#000;border-radius:30px;color:#fff;transition:width 1s ease-in,background-color 1s ease-in}.registration-table[_ngcontent-%COMP%]{background-color:#00000080;border-radius:30px;color:#fff;transition:width 1s ease-out,background-color 1s ease-out;margin-bottom:120px;display:flex;align-items:center;justify-content:center;flex-direction:column}.registration-table[_ngcontent-%COMP%]:hover{background-color:#000;border-radius:30px;color:#fff;transition:width 1s ease-in,background-color 1s ease-in}.input[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin-left:40px;margin-right:40px;margin-bottom:20px}input[_ngcontent-%COMP%]{border-radius:20px;border:solid 2px #E1E1E1;height:20px;padding-left:5px;padding-right:5px;background-color:#fff;transition:background-color .3s ease}label[_ngcontent-%COMP%]{font-size:small}input[_ngcontent-%COMP%]:hover{background-color:#f9f9f9}.login-button[_ngcontent-%COMP%], .registration-button[_ngcontent-%COMP%]{align-self:flex-end}button[_ngcontent-%COMP%]{border-radius:20px;margin-bottom:40px;margin-right:40px;margin-top:20px;height:25px;width:75px;border:solid 2px rgb(99,99,99);transition:border-color .3s ease;font-size:medium}button[_ngcontent-%COMP%]:hover{border-color:#e1e1e1}"]});let n=e;return n})();var Pee=Mg(nF(),1);var jP="auth",wd=class{constructor(e){return e}},Cd=class{constructor(){return gl(jP)}};var oS=new J("angularfire2.auth-instances");function AK(n,e){let t=lh(jP,n,e);return t&&new wd(t)}function DK(n){return(e,t)=>{let i=e.runOutsideAngular(()=>n(t));return new wd(i)}}var kK={provide:Cd,deps:[[new dn,oS]]},RK={provide:wd,useFactory:AK,deps:[[new dn,oS],lr]},MK=(()=>{class n{constructor(){Ut("angularfire",hn.full,"auth")}static \u0275fac=function(i){return new(i||n)};static \u0275mod=se({type:n});static \u0275inj=re({providers:[RK,kK]})}return n})();function qP(n,...e){return{ngModule:MK,providers:[{provide:oS,useFactory:DK(n),multi:!0,deps:[ae,Vt,xi,zs,[new dn,ii],...e]}]}}var zP=Jt(Yg,!0);var _g=function(){return _g=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++){t=arguments[i];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},_g.apply(this,arguments)};var PK={includeMetadataChanges:!1};function GP(n,e){return e===void 0&&(e=PK),new un(function(t){var i=qc(n,e,{next:t.next.bind(t),error:t.error.bind(t),complete:t.complete.bind(t)});return{unsubscribe:i}})}function WP(n,e){var t;e===void 0&&(e={});var i=n.data(e);return!n.exists()||typeof i!="object"||i===null||!e.idField?i:_g(_g({},i),(t={},t[e.idField]=n.id,t))}function $P(n){return GP(n,{includeMetadataChanges:!0}).pipe(Ae(function(e){return e.docs}))}function HP(n,e){return e===void 0&&(e={}),$P(n).pipe(Ae(function(t){return t.map(function(i){return WP(i,e)})}))}var xn=class{constructor(e){return e}},KP="firestore",aS=class{constructor(){return gl(KP)}};var cS=new J("angularfire2.firestore-instances");function NK(n,e){let t=lh(KP,n,e);return t&&new xn(t)}function FK(n){return(e,t)=>{let i=e.runOutsideAngular(()=>n(t));return new xn(i)}}var LK={provide:aS,deps:[[new dn,cS]]},BK={provide:xn,useFactory:NK,deps:[[new dn,cS],lr]},VK=(()=>{class n{constructor(){Ut("angularfire",hn.full,"fst")}static \u0275fac=function(i){return new(i||n)};static \u0275mod=se({type:n});static \u0275inj=re({providers:[BK,LK]})}return n})();function QP(n,...e){return{ngModule:VK,providers:[{provide:cS,useFactory:FK(n),multi:!0,deps:[ae,Vt,xi,zs,[new dn,Cd],[new dn,ii],...e]}]}}var YP=Jt(HP,!0);var Kc=Jt(hg,!0);var Kn=Jt(gd,!0);var XP=Jt(dg,!0);var lS=Jt(Mo,!0);var Ed=Jt(lg,!0);var ZP=Jt(mP,!0);var uS=Jt(_i,!0);var JP=Jt(bd,!0);var wg=Jt(og,!0);var UK=["createChoreForm"],tN=(()=>{let e=class e{constructor(){this.firestore=je(xn)}saveData(){let i=Kn(this.firestore,"chores");Kc(i,{chore_name:this.choreForm.value.chore_name,description:this.choreForm.value.description,category:this.choreForm.value.category})}resetForm(){this.choreForm.reset({"chore-name":"",description:"",category:"Cleaning"})}submitForm(){alert(this.choreForm.value.chore_name),this.saveData(),this.resetForm()}};e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=Ee({type:e,selectors:[["app-create-chore"]],viewQuery:function(r,s){if(r&1&&sr(UK,5),r&2){let o;or(o=ar())&&(s.choreForm=o.first)}},decls:23,vars:0,consts:[["createChoreForm","ngForm"],["autocomplete","off"],["for","chore_name"],["type","text","id","chore_name","name","chore_name","ngModel",""],["for","description"],["id","description","name","description","ngModel",""],[1,"drop-down"],["for","category"],["id","category","name","category","ngModel",""],["value","Cleaning"],["value","Delivery"],["value","Maintain"],[3,"click"]],template:function(r,s){if(r&1){let o=lt();S(0,"form",1,0)(2,"div")(3,"label",2),F(4,"Chore Name:"),w(),oe(5,"input",3),w(),S(6,"div")(7,"label",4),F(8,"Description:"),w(),oe(9,"textarea",5),w(),S(10,"div",6)(11,"label",7),F(12,"Category:"),w(),S(13,"select",8)(14,"option",9),F(15,"Cleaning"),w(),S(16,"option",10),F(17,"Deliver"),w(),S(18,"option",11),F(19,"maintenance"),w()()(),S(20,"div")(21,"button",12),ce("click",function(){return ye(o),be(s.submitForm())}),F(22,"Submit"),w()()()}},dependencies:[rh,sh,oh,Ti,na,Fr,nh,cr,pl],styles:["@media (min-width: 768px){div[_ngcontent-%COMP%]{display:flex;flex-direction:column;color:#000;margin-left:150px;margin-top:20px}#category[_ngcontent-%COMP%]{width:410px;border-radius:5px;border:solid 2px #E1E1E1}#chore_name[_ngcontent-%COMP%]{width:150px;border-radius:20px;border:solid 2px #E1E1E1;padding-left:5px;padding-right:5px;background-color:#fff;transition:background-color .3s ease}#chore_name[_ngcontent-%COMP%]:hover{background-color:#f9f9f9}#description[_ngcontent-%COMP%]{height:200px;width:400px;border-radius:20px;border:solid 2px #E1E1E1;padding-left:5px;padding-top:10px;padding-right:5px;background-color:#fff;transition:background-color .3s ease;resize:vertical;overflow-y:auto}#description[_ngcontent-%COMP%]:hover{background-color:#f9f9f9}button[_ngcontent-%COMP%]{height:25px;width:75px;border-radius:20px;background-color:#fff;border:solid 2px rgb(99,99,99);transition:border-color .3s ease;font-size:medium}button[_ngcontent-%COMP%]:hover{border-color:#e1e1e1}}@media (max-width: 767px){div[_ngcontent-%COMP%]{display:flex;flex-direction:column;color:#000;margin-left:50px;margin-top:20px}#chore_name[_ngcontent-%COMP%]{width:150px;border-radius:20px;border:solid 2px #E1E1E1;padding-left:5px;padding-right:5px;background-color:#fff;transition:background-color .3s ease}#chore_name[_ngcontent-%COMP%]:hover{background-color:#f9f9f9}#description[_ngcontent-%COMP%]{height:240px;width:225px;border-radius:20px;border:solid 2px #E1E1E1;padding-left:5px;padding-top:10px;padding-right:5px;background-color:#fff;transition:background-color .3s ease;resize:vertical;overflow-y:auto}#description[_ngcontent-%COMP%]:hover{background-color:#f9f9f9}button[_ngcontent-%COMP%]{height:25px;width:75px;border-radius:20px;background-color:#fff;border:solid 2px rgb(99,99,99);transition:border-color .3s ease;font-size:medium;margin-top:5px}button[_ngcontent-%COMP%]:hover{border-color:#e1e1e1}}"]});let n=e;return n})();var qK=["createEventForm"],nN=(()=>{let e=class e{constructor(){this.firestore=je(xn)}saveData(){let i=Kn(this.firestore,"events");Kc(i,{name:this.eventForm.value.name,description:this.eventForm.value.description,date:this.eventForm.value.date,time:this.eventForm.value.time,category:this.eventForm.value.category})}resetForm(){this.eventForm.reset({name:"",description:"",date:"",time:"",category:"Fika"})}submitForm(){this.saveData(),this.resetForm()}};e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=Ee({type:e,selectors:[["app-create-event"]],viewQuery:function(r,s){if(r&1&&sr(qK,5),r&2){let o;or(o=ar())&&(s.eventForm=o.first)}},decls:34,vars:0,consts:[["createEventForm","ngForm"],["autocomplete","off",1,"eventform"],[1,"textInput"],["for","name"],["type","text","id","name","name","name","ngModel",""],["for","description"],["id","description","name","description","ngModel",""],[1,"date-time"],["for","date"],["type","date","id","date","name","date","ngModel",""],["for","time"],["type","time","id","time","name","time","ngModel",""],["for","category"],["id","category","name","category","ngModel",""],["value","Fika"],["value","Birthday"],["value","AV"],["value","Trip"],[3,"click"]],template:function(r,s){if(r&1){let o=lt();S(0,"form",1,0)(2,"div",2)(3,"label",3),F(4,"Event name:"),w(),oe(5,"input",4),w(),S(6,"div",2)(7,"label",5),F(8,"Description:"),w(),oe(9,"textarea",6),w(),S(10,"div",7)(11,"div")(12,"label",8),F(13,"Date:"),w(),oe(14,"input",9),w(),S(15,"div")(16,"label",10),F(17,"Time:"),w(),oe(18,"input",11),w()(),S(19,"div",2)(20,"label",12),F(21,"Category:"),w(),S(22,"select",13)(23,"option",14),F(24,"Fika"),w(),S(25,"option",15),F(26,"Birthday"),w(),S(27,"option",16),F(28,"AV"),w(),S(29,"option",17),F(30,"Trip"),w()()(),S(31,"div")(32,"button",18),ce("click",function(){return ye(o),be(s.submitForm())}),F(33,"Submit"),w()()()}},dependencies:[rh,sh,oh,Ti,na,Fr,nh,cr,pl],styles:["@media (min-width: 768px){.eventform[_ngcontent-%COMP%]{margin-left:150px;margin-top:20px}.textInput[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin-top:20px}#category[_ngcontent-%COMP%]{width:410px;border-radius:5px;border:solid 2px #E1E1E1}#name[_ngcontent-%COMP%]{width:150px;border-radius:20px;border:solid 2px #E1E1E1;padding-left:5px;padding-right:5px;background-color:#fff;transition:background-color .3s ease}#name[_ngcontent-%COMP%]:hover{background-color:#f9f9f9}#description[_ngcontent-%COMP%]{height:150px;width:400px;border-radius:20px;border:solid 2px #E1E1E1;padding-left:5px;padding-top:10px;padding-right:5px;background-color:#fff;transition:background-color .3s ease;resize:vertical;overflow-y:auto}#description[_ngcontent-%COMP%]:hover{background-color:#f9f9f9}.date-time[_ngcontent-%COMP%]{display:flex;flex-direction:row;margin-top:20px}#date[_ngcontent-%COMP%]{height:20px;margin-right:20px}#time[_ngcontent-%COMP%]{height:20px}button[_ngcontent-%COMP%]{margin-top:20px;height:25px;width:75px;border-radius:20px;background-color:#fff;border:solid 2px rgb(99,99,99);transition:border-color .3s ease;font-size:medium}button[_ngcontent-%COMP%]:hover{border-color:#e1e1e1}}@media (max-width: 767px){.eventform[_ngcontent-%COMP%]{margin-left:50px;margin-top:20px}.textInput[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin-top:20px}#name[_ngcontent-%COMP%]{width:150px;border-radius:20px;border:solid 2px #E1E1E1;padding-left:5px;padding-right:5px;background-color:#fff;transition:background-color .3s ease}#name[_ngcontent-%COMP%]:hover{background-color:#f9f9f9}#description[_ngcontent-%COMP%]{height:200px;width:225px;border-radius:20px;border:solid 2px #E1E1E1;padding-left:5px;padding-top:10px;padding-right:5px;background-color:#fff;transition:background-color .3s ease;resize:vertical;overflow-y:auto}#description[_ngcontent-%COMP%]:hover{background-color:#f9f9f9}.date-time[_ngcontent-%COMP%]{display:flex;flex-direction:row;margin-top:20px}#date[_ngcontent-%COMP%]{height:20px;margin-right:20px}#time[_ngcontent-%COMP%]{height:20px}button[_ngcontent-%COMP%]{margin-top:20px;height:25px;width:75px;border-radius:20px;background-color:#fff;border:solid 2px rgb(99,99,99);transition:border-color .3s ease;font-size:medium}button[_ngcontent-%COMP%]:hover{border-color:#e1e1e1}}"]});let n=e;return n})();function GK(n,e){n&1&&oe(0,"app-create-chore")}function WK(n,e){n&1&&oe(0,"app-create-event")}var iN=(()=>{let e=class e{constructor(){this.createChoreVisible=!0,this.createEventVisible=!1}showCreateChore(){this.createChoreVisible=!0,this.createEventVisible=!1}showCreateEvent(){this.createChoreVisible=!1,this.createEventVisible=!0}};e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=Ee({type:e,selectors:[["app-display-card"]],decls:8,vars:6,consts:[[1,"toggle-buttons"],[1,"chore",3,"click"],[1,"event",3,"click"],[1,"display-content"],[4,"ngIf"]],template:function(r,s){r&1&&(S(0,"div",0)(1,"button",1),ce("click",function(){return s.showCreateChore()}),F(2,"Create Chore"),w(),S(3,"button",2),ce("click",function(){return s.showCreateEvent()}),F(4,"Create Event"),w()(),S(5,"div",3),$e(6,GK,1,0,"app-create-chore",4)(7,WK,1,0,"app-create-event",4),w()),r&2&&(q(),kn("shaded-chore",s.createChoreVisible),q(2),kn("shaded-event",s.createEventVisible),q(3),me("ngIf",s.createChoreVisible),q(),me("ngIf",s.createEventVisible))},dependencies:[Rn,tN,nN],styles:[".toggle-buttons[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-around;width:100%}button[_ngcontent-%COMP%]{width:100%;height:40px;background-color:#89abb4;transition:background-color .3s ease}button[_ngcontent-%COMP%]:hover, .shaded-chore[_ngcontent-%COMP%], .shaded-event[_ngcontent-%COMP%]{background-color:#f5f9fa}.event[_ngcontent-%COMP%]{border-top-right-radius:30px;border-style:hidden}.chore[_ngcontent-%COMP%]{border-top-left-radius:30px;border-style:hidden}"]});let n=e;return n})();var rN=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=Ee({type:e,selectors:[["app-form-page"]],decls:3,vars:0,consts:[[1,"form-page"],[1,"form"]],template:function(r,s){r&1&&(S(0,"div",0)(1,"div",1),oe(2,"app-display-card"),w()())},dependencies:[iN],styles:["@keyframes _ngcontent-%COMP%_snapIn{0%{transform:translateY(100%);opacity:0}to{transform:translateY(0);opacity:1}}.form[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_snapIn .5s ease-out forwards;opacity:0}@media (min-width: 768px){.form-page[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;justify-content:center}.form[_ngcontent-%COMP%]{width:700px;height:500px;margin-top:75px;background-color:#f5f9fa;border-radius:30px}}@media (max-width: 767px){.form-page[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;justify-content:center}.form[_ngcontent-%COMP%]{width:700px;height:600px;margin-top:75px;background-color:#f5f9fa;border-radius:30px}}"]});let n=e;return n})();function HK(n,e){if(n&1&&(S(0,"div")(1,"p",13),F(2),w()()),n&2){let t=fe().$implicit;q(2),bn(t.chore.description)}}function KK(n,e){n&1&&oe(0,"img",14)}function QK(n,e){n&1&&oe(0,"img",15)}function YK(n,e){n&1&&oe(0,"img",16)}function XK(n,e){if(n&1){let t=lt();S(0,"div",6),ce("click",function(){let r=ye(t).$implicit,s=fe();return be(s.toggleDetails(r))}),S(1,"div",7)(2,"h3"),F(3),w(),S(4,"p"),F(5),w(),$e(6,HK,3,1,"div",8),w(),S(7,"div",9),$e(8,KK,1,0,"img",10)(9,QK,1,0,"img",11)(10,YK,1,0,"img",12),w()()}if(n&2){let t=e.$implicit;q(3),bn(t.chore.chore_name),q(2),ZS("",t.colleague.first_name," ",t.colleague.last_name,""),q(),me("ngIf",t.expanded),q(2),me("ngIf",t.chore.category==="Cleaning"),q(),me("ngIf",t.chore.category==="Maintain"),q(),me("ngIf",t.chore.category==="Delivery")}}var sN=(()=>{let e=class e{constructor(i){this.firestore=i,this.schedule=[],this.displayedSchedule=[],this.currentPage=0,this.pageSize=5,this.maxPage=0,this.createSchedule()}createSchedule(){return p(this,null,function*(){let i=Kn(this.firestore,"chores"),r=Kn(this.firestore,"colleagues"),o=(yield Ed(i)).docs.map(u=>u.data()),c=(yield Ed(r)).docs.map(u=>u.data()),l=this.getWeekNumber(new Date);for(let u of o)if(!(yield this.getExistingSchedule(u,l))){let h=this.shuffleArray(c),m=this.generateChoreSchedule(h,l,u);yield this.saveSchedule(m)}yield this.fetchSchedule()})}fetchSchedule(){return p(this,null,function*(){let i=this.getWeekNumber(new Date),r=Kn(this.firestore,"schedule"),s=uS(r,wg("weekNumber","==",i)),o=yield Ed(s);this.schedule=o.docs.map(a=>a.data()),this.maxPage=Math.ceil(this.schedule.length/this.pageSize)-1,this.updateDisplayedSchedule()})}getExistingSchedule(i,r){return p(this,null,function*(){let s=Kn(this.firestore,"schedule"),o=uS(s,wg("chore.chore_name","==",i.chore_name),wg("weekNumber","==",r));return!(yield Ed(o)).empty})}saveSchedule(i){return p(this,null,function*(){let r=Kn(this.firestore,"schedule");for(let s of i)try{yield Kc(r,s)}catch(o){console.error("Error adding document: ",o)}})}generateChoreSchedule(i,r,s){let o=[];for(let a=0;a<i.length;a++){let c=r+a,l=a%i.length,u=i[l],d={weekNumber:c,colleague:u,chore:s};o.push(d)}return o}getWeekNumber(i){let r=new Date(i.getFullYear(),0,1),s=Math.floor((i.getTime()-r.getTime())/(24*3600*1e3)),o=(11-r.getDay())%7,a=s-o;return Math.ceil((a+1)/7)}shuffleArray(i){for(let r=i.length-1;r>0;r--){let s=Math.floor(Math.random()*(r+1));[i[r],i[s]]=[i[s],i[r]]}return i}toggleDetails(i){i.expanded=!i.expanded}nextPage(){this.currentPage<this.maxPage&&(this.currentPage++,this.updateDisplayedSchedule())}prevPage(){this.currentPage>0&&(this.currentPage--,this.updateDisplayedSchedule())}updateDisplayedSchedule(){let i=this.currentPage*this.pageSize;this.displayedSchedule=this.schedule.slice(i,i+this.pageSize)}};e.\u0275fac=function(r){return new(r||e)(z(xn))},e.\u0275cmp=Ee({type:e,selectors:[["app-chedual-creator"]],decls:10,vars:3,consts:[[1,"headCard"],[1,"displayTable"],["class","tableContent",3,"click",4,"ngFor","ngForOf"],[1,"pagination"],[1,"prevPage",3,"click","disabled"],[1,"nextPage",3,"click","disabled"],[1,"tableContent",3,"click"],[1,"column"],[4,"ngIf"],[1,"category-icon"],["src","../../../assets/images/cleaning.svg","alt","Cleaning Icon",4,"ngIf"],["src","../../../assets/images/maintain.svg","alt","Maintain Icon",4,"ngIf"],["src","../../../assets/images/delivery.svg","alt","Delivery Icon",4,"ngIf"],[1,"important"],["src","../../../assets/images/cleaning.svg","alt","Cleaning Icon"],["src","../../../assets/images/maintain.svg","alt","Maintain Icon"],["src","../../../assets/images/delivery.svg","alt","Delivery Icon"]],template:function(r,s){r&1&&(S(0,"div",0)(1,"h2"),F(2,"Chores assigned this week."),w()(),S(3,"div",1),$e(4,XK,11,7,"div",2),S(5,"div",3)(6,"button",4),ce("click",function(){return s.prevPage()}),F(7,"Prev"),w(),S(8,"button",5),ce("click",function(){return s.nextPage()}),F(9,"Next"),w()()()),r&2&&(q(4),me("ngForOf",s.displayedSchedule),q(2),me("disabled",s.currentPage===0),q(2),me("disabled",s.currentPage===s.maxPage))},dependencies:[Zo,Rn],styles:["@media (min-width: 768px){.displayTable[_ngcontent-%COMP%]{background-color:#f5f9fa;width:400px;display:flex;flex-direction:column;align-items:center;padding-top:20px;padding-bottom:20px;border-bottom-left-radius:20px;border-bottom-right-radius:20px}.tableContent[_ngcontent-%COMP%]{background-color:#fff;display:flex;flex-direction:row;border:solid 2px #E1E1E1;width:250px;border-radius:30px;padding-left:40px;padding-right:40px;margin:10px}.tableContent[_ngcontent-%COMP%]:hover{background-color:#f9f9f9}.column[_ngcontent-%COMP%]{width:200px}.category-icon[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:70px;height:70px}.headCard[_ngcontent-%COMP%]{background-color:#89abb4;color:#fff;border-top-left-radius:20px;border-top-right-radius:20px;display:flex;align-items:center;justify-content:center}.important[_ngcontent-%COMP%]{background-color:#f2ffab}.pagination[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:space-between}button[_ngcontent-%COMP%]{margin-left:40px;margin-right:40px;margin-top:10px;height:30px;background-color:#fff;border:solid 1px rgb(99,99,99);transition:border-color .3s ease;font-size:medium}button[_ngcontent-%COMP%]:hover{border-color:#e1e1e1}.prevPage[_ngcontent-%COMP%]{border-bottom-left-radius:20px;border-top-left-radius:20px}.nextPage[_ngcontent-%COMP%]{border-bottom-right-radius:20px;border-top-right-radius:20px}}@media (max-width: 767px){.displayTable[_ngcontent-%COMP%]{background-color:#f5f9fa;width:100%;display:flex;flex-direction:column;align-items:center;padding-top:20px;padding-bottom:20px;border-bottom-left-radius:20px;border-bottom-right-radius:20px}.tableContent[_ngcontent-%COMP%]{background-color:#fff;border:solid 2px #E1E1E1;width:250px;border-radius:30px;padding-left:25px;padding-right:25px;margin:10px}.tableContent[_ngcontent-%COMP%]:hover{background-color:#f9f9f9}.headCard[_ngcontent-%COMP%]{background-color:#89abb4;color:#000;border-top-left-radius:20px;border-top-right-radius:20px;display:flex;align-items:center;justify-content:center}.important[_ngcontent-%COMP%]{background-color:#f2ffab}.pagination[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:space-between}button[_ngcontent-%COMP%]{margin-left:40px;margin-right:40px;margin-top:10px;height:30px;background-color:#fff;border:solid 1px rgb(99,99,99);transition:border-color .3s ease;font-size:medium}button[_ngcontent-%COMP%]:hover{border-color:#e1e1e1}.prevPage[_ngcontent-%COMP%]{border-bottom-left-radius:20px;border-top-left-radius:20px}.nextPage[_ngcontent-%COMP%]{border-bottom-right-radius:20px;border-top-right-radius:20px}.category-icon[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:70px;height:70px}}"]});let n=e;return n})();var JK=(n,e)=>({"event-exists":n,"no-event":e});function e7(n,e){if(n&1&&(KS(0),S(1,"h2"),F(2,"Today it's time for:"),w(),S(3,"p"),F(4),w(),QS()),n&2){let t=fe();q(4),bn(t.eventToday.name)}}function t7(n,e){n&1&&(S(0,"h2"),F(1,"No event today :("),w())}function n7(n,e){if(n&1){let t=lt();S(0,"div")(1,"p",16),F(2),w(),S(3,"p"),F(4),w(),S(5,"div",17)(6,"button",18),ce("click",function(){ye(t);let r=fe().$implicit,s=fe();return be(s.editEvent(r))}),F(7,"Edit"),w(),S(8,"button",19),ce("click",function(){ye(t);let r=fe().$implicit,s=fe();return be(s.deleteEvent(r))}),oe(9,"img",20),w()()()}if(n&2){let t=fe().$implicit;q(2),bn(t.description),q(2),Zn("",t.time," o'clock")}}function i7(n,e){n&1&&oe(0,"img",21)}function r7(n,e){n&1&&oe(0,"img",22)}function s7(n,e){n&1&&oe(0,"img",23)}function o7(n,e){n&1&&oe(0,"img",24)}function a7(n,e){if(n&1){let t=lt();S(0,"div",8),ce("click",function(){let r=ye(t).$implicit,s=fe();return be(s.toggleDetails(r))}),S(1,"div",9)(2,"h3"),F(3),w(),S(4,"p"),F(5),w(),$e(6,n7,10,2,"div",10),w(),S(7,"div",11),$e(8,i7,1,0,"img",12)(9,r7,1,0,"img",13)(10,s7,1,0,"img",14)(11,o7,1,0,"img",15),w()()}if(n&2){let t=e.$implicit;q(3),bn(t.name),q(2),bn(t.date),q(),me("ngIf",t.expanded),q(2),me("ngIf",t.category==="Fika"),q(),me("ngIf",t.category==="Birthday"),q(),me("ngIf",t.category==="AV"),q(),me("ngIf",t.category==="Trip")}}var oN=(()=>{let e=class e{constructor(i){this.firestore=i,this.events$=YP(Kn(this.firestore,"events"),{idField:"id"}),this.sortedEvents=[],this.currentPage=0,this.pageSize=5,this.eventToday=null}ngOnInit(){this.events$.subscribe(i=>{this.sortedEvents=this.sortEventsByDate(i),this.updateEventToday()})}sortEventsByDate(i){let r=new Date;return i.filter(s=>new Date(s.date+" "+s.time).getTime()>r.getTime()).sort((s,o)=>{let a=new Date(s.date+" "+s.time),c=new Date(o.date+" "+o.time);return a.getTime()-c.getTime()})}toggleDetails(i){i.expanded=!i.expanded}nextPage(){let i=Math.ceil(this.sortedEvents.length/this.pageSize);this.currentPage<i-1&&this.currentPage++}prevPage(){this.currentPage>0&&this.currentPage--}getDisplayedEvents(){let i=this.currentPage*this.pageSize;return this.sortedEvents.slice(i,i+this.pageSize)}deleteEvent(i){if(!i||!i.id){console.error("Invalid event:",i);return}if(confirm("Are you sure you want to delete this event?")){let r=lS(this.firestore,"events",i.id);XP(r).then(()=>{console.log("Event deleted successfully."),this.updateEventToday()}).catch(s=>{console.error("Error deleting event:",s)})}}editEvent(i){let r=prompt("Enter new name:",i.name),s=prompt("Enter new description:",i.description),o=prompt("Enter new date (YYYY-MM-DD):",i.date),a=prompt("Enter new time (HH:MM):",i.time);if(r===null||s===null||o===null||a===null||r===""||s===""||o===""||a==="")return;let c=new Date(o),l=lS(this.firestore,"events",i.id);JP(l,{name:r,description:s,date:c.toISOString().split("T")[0],time:a}).then(()=>{console.log("Event updated successfully.");let u=this.sortedEvents.findIndex(d=>d.id===i.id);u!==-1&&(this.sortedEvents[u].name=r,this.sortedEvents[u].description=s,this.sortedEvents[u].date=c.toISOString().split("T")[0],this.sortedEvents[u].time=a)}).catch(u=>{console.error("Error updating event:",u)})}updateEventToday(){let i=new Date;this.eventToday=this.sortedEvents.find(r=>new Date(r.date).toDateString()===i.toDateString())||null}};e.\u0275fac=function(r){return new(r||e)(z(xn))},e.\u0275cmp=Ee({type:e,selectors:[["app-fetch-events"]],decls:11,vars:9,consts:[["noEventToday",""],[1,"event-today-box",3,"ngClass"],[4,"ngIf","ngIfElse"],[1,"displayTable"],["class","tableContent",3,"click",4,"ngFor","ngForOf"],[1,"pagination"],[1,"prevPage",3,"click","disabled"],[1,"nextPage",3,"click","disabled"],[1,"tableContent",3,"click"],[1,"column"],[4,"ngIf"],[1,"category-icon"],["src","../../../assets/fika.png","alt","Fika Icon",4,"ngIf"],["src","../../../assets/images/birthday.svg","alt","Birthday Icon",4,"ngIf"],["src","../../../assets/images/drink.svg","alt","AV Icon",4,"ngIf"],["src","../../../assets/images/trip.svg","alt","Trip Icon",4,"ngIf"],[1,"important"],[1,"delEditButtons"],[1,"editButton",3,"click"],[1,"deleteButton",3,"click"],["src","../../../assets/bin.png","alt","Delete",2,"width","16px","height","16px"],["src","../../../assets/fika.png","alt","Fika Icon"],["src","../../../assets/images/birthday.svg","alt","Birthday Icon"],["src","../../../assets/images/drink.svg","alt","AV Icon"],["src","../../../assets/images/trip.svg","alt","Trip Icon"]],template:function(r,s){if(r&1){let o=lt();S(0,"div",1),$e(1,e7,5,1,"ng-container",2)(2,t7,2,0,"ng-template",null,0,jd),w(),S(4,"div",3),$e(5,a7,12,7,"div",4),S(6,"div",5)(7,"button",6),ce("click",function(){return ye(o),be(s.prevPage())}),F(8,"Prev"),w(),S(9,"button",7),ce("click",function(){return ye(o),be(s.nextPage())}),F(10,"Next"),w()()()}if(r&2){let o=Ud(3);me("ngClass",JS(6,JK,s.eventToday,!s.eventToday)),q(),me("ngIf",s.eventToday)("ngIfElse",o),q(4),me("ngForOf",s.getDisplayedEvents()),q(2),me("disabled",s.currentPage===0),q(2),me("disabled",s.currentPage===s.sortedEvents.length/s.pageSize-1)}},dependencies:[sT,Zo,Rn],styles:["@media (min-width: 768px){.displayTable[_ngcontent-%COMP%]{background-color:#f5f9fa;width:400px;display:flex;flex-direction:column;align-items:center;padding-top:20px;padding-bottom:20px;border-bottom-left-radius:20px;border-bottom-right-radius:20px}.tableContent[_ngcontent-%COMP%]{display:flex;flex-direction:row;background-color:#fff;border:solid 2px #E1E1E1;width:250px;border-radius:30px;padding-left:40px;padding-right:40px;margin:10px}.category-icon[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:70px;height:70px}.delEditButtons[_ngcontent-%COMP%]{display:flex;flex-direction:row}.tableContent[_ngcontent-%COMP%]:hover{background-color:#f9f9f9}.eventDetails[_ngcontent-%COMP%]{overflow:hidden;max-height:0;transition:max-height .3s ease}.eventDetails.open[_ngcontent-%COMP%]{max-height:200px;min-height:75px;border-bottom-left-radius:10px;border-bottom-right-radius:10px}.event-today-box[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:400px;height:70px}.event-exists[_ngcontent-%COMP%]{background-color:#81fbb8;border-top-left-radius:20px;border-top-right-radius:20px;display:flex;flex-direction:column}.event-exists[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:2px}.event-exists[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-top:2px;margin-bottom:0}.no-event[_ngcontent-%COMP%]{background-color:#89abb4;border-top-left-radius:20px;border-top-right-radius:20px}.pagination[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:space-between}.column[_ngcontent-%COMP%]{width:200px}button[_ngcontent-%COMP%]{margin-left:40px;margin-right:40px;margin-top:10px;height:30px;background-color:#fff;border:solid 1px rgb(99,99,99);transition:border-color .3s ease;font-size:medium}button[_ngcontent-%COMP%]:hover{border-color:#e1e1e1}.editButton[_ngcontent-%COMP%]{margin-bottom:20px;border-top:none;border-left:none;border-right:none;border-width:3px;background-color:transparent}.deleteButton[_ngcontent-%COMP%]{margin-top:12px;padding-top:1px;border:none;background:none}.prevPage[_ngcontent-%COMP%]{border-bottom-left-radius:20px;border-top-left-radius:20px}.nextPage[_ngcontent-%COMP%]{border-bottom-right-radius:20px;border-top-right-radius:20px}.important[_ngcontent-%COMP%]{background-color:#f2ffab}}@media (max-width: 767px){.displayTable[_ngcontent-%COMP%]{background-color:#f5f9fa;width:100%;display:flex;flex-direction:column;align-items:center;padding-top:20px;padding-bottom:20px;border-bottom-left-radius:20px;border-bottom-right-radius:20px}.tableContent[_ngcontent-%COMP%]{background-color:#fff;border:solid 2px #E1E1E1;width:250px;border-radius:30px;padding-left:25px;padding-right:25px;margin:10px}.tableContent[_ngcontent-%COMP%]:hover{background-color:#f9f9f9}.eventDetails[_ngcontent-%COMP%]{overflow:hidden;max-height:0;transition:max-height .3s ease}.eventDetails.open[_ngcontent-%COMP%]{max-height:200px;min-height:75px;border-bottom-left-radius:10px;border-bottom-right-radius:10px}.event-today-box[_ngcontent-%COMP%]{margin-top:40px;display:flex;align-items:center;justify-content:center;width:500px;height:70px}.event-exists[_ngcontent-%COMP%]{width:100%;background-color:#81fbb8;border-top-left-radius:20px;border-top-right-radius:20px;display:flex;flex-direction:column}.event-exists[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:2px}.event-exists[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-top:2px;margin-bottom:0}.no-event[_ngcontent-%COMP%]{width:100%;background-color:#89abb4;border-top-left-radius:20px;border-top-right-radius:20px}.pagination[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:space-between}button[_ngcontent-%COMP%]{margin-left:40px;margin-right:40px;margin-top:10px;height:30px;background-color:#fff;border:solid 1px rgb(99,99,99);transition:border-color .3s ease;font-size:medium}button[_ngcontent-%COMP%]:hover{border-color:#e1e1e1}.prevPage[_ngcontent-%COMP%]{border-bottom-left-radius:20px;border-top-left-radius:20px}.nextPage[_ngcontent-%COMP%]{border-bottom-right-radius:20px;border-top-right-radius:20px}.important[_ngcontent-%COMP%]{background-color:#f2ffab}.category-icon[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:70px;height:70px}}"]});let n=e;return n})();var Cg=(()=>{let e=class e{constructor(i){this.auth=i,this.isLoggedIn=this.auth.authState.pipe(Ae(r=>!!r)),this.userEmail=this.auth.authState.pipe(Ae(r=>r?r.email:null))}logout(){return p(this,null,function*(){try{yield this.auth.signOut(),console.log("Logged out successfully!")}catch(i){console.error("Logout error:",i)}})}};e.\u0275fac=function(r){return new(r||e)(C(ur))},e.\u0275prov=ie({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();function l7(n,e){n&1&&(S(0,"div")(1,"p"),F(2,"No suggestions yet."),w()())}function u7(n,e){if(n&1){let t=lt();S(0,"div",13)(1,"div",14)(2,"input",15),eT(3,"async"),ti("ngModelChange",function(r){let s=ye(t).$implicit;return ei(s.selected,r)||(s.selected=r),be(r)}),ce("change",function(){let r=ye(t).$implicit,s=fe(2);return be(s.selectSuggestion(r.id))}),w(),S(4,"span",16),F(5),w(),S(6,"div",17),oe(7,"div",18),w(),S(8,"span"),F(9),w()()()}if(n&2){let t=e.$implicit,i=fe(2);q(2),Jn("ngModel",t.selected),me("disabled",!i.canVote(t))("checked",t.voters.includes(tT(3,7,i.authService.userEmail))),q(3),bn(t.suggestion),q(2),Bg("width",i.getPercentage(t.votes),"%"),q(2),Zn("",i.getPercentage(t.votes),"%")}}function d7(n,e){if(n&1&&(S(0,"div",10),$e(1,u7,10,9,"div",11),w(),S(2,"div",12),F(3),w()),n&2){let t=fe();q(),me("ngForOf",t.suggestions),q(2),Zn(" Total Votes: ",t.getTotalVotes()," ")}}function h7(n,e){if(n&1&&(S(0,"p",19),F(1),w()),n&2){let t=fe();q(),bn(t.errorMessage)}}var cN=(()=>{let e=class e{constructor(i,r){this.firestore=i,this.authService=r,this.suggestions=[],this.suggestionText="",this.selectedSuggestionId=null,this.voted=!1,this.isLoading=!1,this.errorMessage=""}ngOnInit(){this.loadSuggestions(),this.checkIfVotedToday()}loadSuggestions(){let r=new Date().toISOString().split("T")[0];this.firestore.collection("lunch",s=>s.where("date","==",r)).valueChanges({idField:"id"}).subscribe(s=>{this.suggestions=s})}createSuggestion(){if(this.suggestionText.trim().length===0){this.errorMessage="Cannot create an empty suggestion.";return}this.isLoading=!0,this.authService.userEmail.subscribe(i=>{if(i&&!this.voted){let r=new Date;this.firestore.collection("lunch").add({suggestion:this.suggestionText,date:r.toISOString().split("T")[0],createdBy:i,votes:1,voters:[i]}).then(()=>{this.loadSuggestions(),this.suggestionText="",this.voted=!0}).catch(s=>{console.error("Error creating suggestion:",s),this.errorMessage="Failed to create suggestion."}).finally(()=>{this.isLoading=!1})}else this.errorMessage="User not authenticated or already voted.",this.isLoading=!1})}selectSuggestion(i){this.selectedSuggestionId=i}triggerVote(){if(!this.selectedSuggestionId){this.errorMessage="No suggestion selected.";return}let i=this.suggestions.find(r=>r.id===this.selectedSuggestionId);i&&!this.voted?this.vote(i):this.errorMessage="Invalid selection or already voted."}vote(i){this.authService.userEmail.subscribe(r=>{r&&this.canVote(i)&&this.firestore.doc(`lunch/${i.id}`).update({votes:i.votes+1,voters:[...i.voters,r]}).then(()=>{this.loadSuggestions(),this.voted=!0}).catch(s=>{console.error("Error voting:",s),this.errorMessage="Failed to vote."})})}canVote(i){return!this.voted&&!i.voters.includes(this.authService.userEmail)}getTotalVotes(){let i=0;return this.suggestions.forEach(r=>{i+=r.votes}),i}getPercentage(i){let r=this.getTotalVotes();return r>0?Math.round(i/r*100):0}checkIfVotedToday(){let r=new Date().toISOString().split("T")[0];this.authService.userEmail.subscribe(s=>{s&&this.firestore.collection("lunch",o=>o.where("date","==",r).where("voters","array-contains",s)).get().subscribe(o=>{this.voted=!o.empty})})}};e.\u0275fac=function(r){return new(r||e)(z(_d),z(Cg))},e.\u0275cmp=Ee({type:e,selectors:[["app-lunch"]],decls:16,vars:6,consts:[["suggestionsList",""],[1,"lunch"],[1,"headCard"],[1,"displayTable"],[4,"ngIf","ngIfElse"],[1,"vote"],[3,"click","disabled"],[1,"input"],["type","text",3,"ngModelChange","ngModel"],["style","color: red;",4,"ngIf"],[1,"suggestions"],["class","suggestion",4,"ngFor","ngForOf"],[1,"totalVotes"],[1,"suggestion"],[1,"suggestion-info"],["type","checkbox",1,"checkbox",3,"ngModelChange","change","ngModel","disabled","checked"],[1,"spacer"],[1,"percentage-bar"],[1,"percentage-fill"],[2,"color","red"]],template:function(r,s){if(r&1){let o=lt();S(0,"div",1)(1,"div",2)(2,"h2"),F(3,"Lunch Poll."),w()(),S(4,"div",3),$e(5,l7,3,0,"div",4),S(6,"div",5),$e(7,d7,4,2,"ng-template",null,0,jd),S(9,"button",6),ce("click",function(){return ye(o),be(s.triggerVote())}),F(10,"Vote Now"),w()(),S(11,"div",7)(12,"input",8),ti("ngModelChange",function(c){return ye(o),ei(s.suggestionText,c)||(s.suggestionText=c),be(c)}),w(),S(13,"button",6),ce("click",function(){return ye(o),be(s.createSuggestion())}),F(14,"Submit"),w(),$e(15,h7,2,1,"p",9),w()()()}if(r&2){let o=Ud(8);q(5),me("ngIf",s.suggestions.length===0)("ngIfElse",o),q(4),me("disabled",!s.selectedSuggestionId||s.voted),q(3),Jn("ngModel",s.suggestionText),q(),me("disabled",s.isLoading||s.voted),q(2),me("ngIf",s.errorMessage)}},dependencies:[Zo,Rn,Ti,Zg,Fr,cr,oT],styles:['@media (min-width: 768px){.displayTable[_ngcontent-%COMP%]{background-color:#f5f9fa;width:400px;min-height:300px;display:flex;flex-direction:column;align-items:center;justify-content:space-between;padding-top:20px;padding-bottom:20px;border-bottom-left-radius:20px;border-bottom-right-radius:20px;background-image:url("./media/food-MHR4OW2U.svg");background-size:200px;background-position:center;background-repeat:no-repeat}.tableContent[_ngcontent-%COMP%]{background-color:#fff;border:solid 2px #E1E1E1;width:250px;border-radius:30px;padding-left:40px;padding-right:40px;margin:10px}.headCard[_ngcontent-%COMP%]{background-color:#89abb4;color:#fff;border-top-left-radius:20px;border-top-right-radius:20px;display:flex;align-items:center;justify-content:center}.spacer[_ngcontent-%COMP%]{margin-right:10px}.suggestion[_ngcontent-%COMP%]{margin-top:15px;display:flex;align-items:center}.suggestion-info[_ngcontent-%COMP%]{display:flex;align-items:center}.percentage-bar[_ngcontent-%COMP%]{width:100px;height:10px;background-color:#ddd;border-radius:5px;margin-top:5px;margin-left:10px}.percentage-fill[_ngcontent-%COMP%]{height:100%;background-color:#4caf50;border-radius:5px}.input[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{margin-right:10px;border-radius:20px;border:solid 2px #E1E1E1}button[_ngcontent-%COMP%]{margin-top:20px;height:25px;width:75px;border-radius:20px;background-color:#fff;border:solid 2px rgb(99,99,99);transition:border-color .3s ease;font-size:medium}button[_ngcontent-%COMP%]:hover{border-color:#e1e1e1}}@media (max-width: 767px){.displayTable[_ngcontent-%COMP%]{background-color:#f5f9fa;width:400px;min-height:300px;display:flex;flex-direction:column;align-items:center;justify-content:space-between;padding-top:20px;padding-bottom:20px;border-bottom-left-radius:20px;border-bottom-right-radius:20px;background-image:url("./media/food-MHR4OW2U.svg");background-size:200px;background-position:center;background-repeat:no-repeat}.lunch[_ngcontent-%COMP%]{margin-top:30px}.tableContent[_ngcontent-%COMP%]{background-color:#fff;border:solid 2px #E1E1E1;width:250px;border-radius:30px;padding-left:40px;padding-right:40px;margin:10px}.headCard[_ngcontent-%COMP%]{background-color:#89abb4;color:#fff;border-top-left-radius:20px;border-top-right-radius:20px;display:flex;align-items:center;justify-content:center}.spacer[_ngcontent-%COMP%]{margin-right:10px}.suggestion[_ngcontent-%COMP%]{margin-top:15px;display:flex;align-items:center}.suggestion-info[_ngcontent-%COMP%]{display:flex;align-items:center}.percentage-bar[_ngcontent-%COMP%]{width:100px;height:10px;background-color:#ddd;border-radius:5px;margin-top:5px;margin-left:10px}.percentage-fill[_ngcontent-%COMP%]{height:100%;background-color:#4caf50;border-radius:5px}.input[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{margin-right:10px;border-radius:20px;border:solid 2px #E1E1E1}button[_ngcontent-%COMP%]{margin-top:20px;height:25px;width:75px;border-radius:20px;background-color:#fff;border:solid 2px rgb(99,99,99);transition:border-color .3s ease;font-size:medium}button[_ngcontent-%COMP%]:hover{border-color:#e1e1e1}}']});let n=e;return n})();var lN=(()=>{let e=class e{constructor(i){this.renderer=i}ngOnInit(){this.renderer.setStyle(document.body,"background","url(../../../assets/images/together.svg) no-repeat center center fixed"),this.renderer.setStyle(document.body,"background-size","cover")}};e.\u0275fac=function(r){return new(r||e)(z(rr))},e.\u0275cmp=Ee({type:e,selectors:[["app-display-page"]],decls:4,vars:0,consts:[[1,"display"]],template:function(r,s){r&1&&(S(0,"div",0),oe(1,"app-chedual-creator")(2,"app-lunch")(3,"app-fetch-events"),w())},dependencies:[sN,oN,cN],styles:["@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}.display[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{opacity:0;animation:_ngcontent-%COMP%_fadeIn 1s ease-in-out forwards}.display[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:nth-child(1){animation-delay:.2s}.display[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:nth-child(2){animation-delay:.4s}.display[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:nth-child(3){animation-delay:.6s}@media (min-width: 768px){.display[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between;margin-left:100px;margin-right:100px;margin-top:100px;padding-bottom:100px}}@media (max-width: 767px){.display[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;margin-top:50px}}"]});let n=e;return n})();var dS=(()=>{let e=class e{constructor(i,r){this.auth=i,this.router=r}canActivate(){return this.auth.authState.pipe(Ae(i=>i?!0:(this.router.navigate(["/"]),!1)))}};e.\u0275fac=function(r){return new(r||e)(C(ur),C(Jo))},e.\u0275prov=ie({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var m7=[{path:"",component:VP},{path:"login",component:UP},{path:"form",component:rN,canActivate:[dS]},{path:"display",component:lN,canActivate:[dS]}],uN=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=se({type:e}),e.\u0275inj=re({imports:[Wg.forRoot(m7),Wg]});let n=e;return n})();var dN=(()=>{let e=class e{constructor(){this.currentWeek=0}ngOnInit(){this.currentWeek=this.getWeekNumber(new Date)}getWeekNumber(i){let r=new Date(i.getFullYear(),0,1);return Math.ceil(((i.getTime()-r.getTime())/864e5+r.getDay()+1)/7)}};e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=Ee({type:e,selectors:[["app-week-display"]],decls:5,vars:1,consts:[[1,"week-number-square"],[1,"weekNo"]],template:function(r,s){r&1&&(S(0,"div",0)(1,"p"),F(2,"This week is the :"),w(),S(3,"div",1),F(4),w()()),r&2&&(q(4),Zn(" ",s.currentWeek,"th"))},styles:["@media (min-width: 768px){.week-number-square[_ngcontent-%COMP%]{width:242.16px;height:10x;background-color:#fff;display:flex;justify-content:center;align-items:center;font-size:20px;margin-top:60px;color:#388b3f;border-bottom-left-radius:10px;border-bottom-right-radius:10px;border-left:solid 3px gray;border-right:solid 3px gray;border-bottom:solid 3px gray}.weekNo[_ngcontent-%COMP%]{font-size:large;font-weight:900;border-bottom:solid 1px}}@media (max-width: 767px){.week-number-square[_ngcontent-%COMP%]{width:140px;height:40px;background-color:#fff;display:flex;justify-content:center;align-items:center;font-size:18px;margin-top:50px;color:#388b3f;border-bottom-left-radius:10px;border-bottom-right-radius:10px;border-left:solid 3px gray;border-right:solid 3px gray;border-bottom:solid 3px gray}.week-number-square[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:small}.weekNo[_ngcontent-%COMP%]{font-size:medium;font-weight:900;border-bottom:solid 1px}}"]});let n=e;return n})();function g7(n,e){if(n&1){let t=lt();S(0,"button",4),ce("click",function(){ye(t);let r=fe();return be(r.navigateToForm())}),F(1,"Create Agendas"),w()}}function y7(n,e){if(n&1){let t=lt();S(0,"button",4),ce("click",function(){ye(t);let r=fe();return be(r.navigateToDisplay())}),F(1,"Agendas"),w()}}var hN=(()=>{let e=class e{constructor(i,r){this.authService=i,this.router=r,this.isLoggedIn=!1}ngOnInit(){this.authService.isLoggedIn.subscribe(i=>{this.isLoggedIn=i})}navigateToForm(){this.router.navigate(["/form"])}navigateToDisplay(){this.router.navigate(["/display"])}navigateToLoginOrLogout(){this.isLoggedIn?this.authService.logout().then(()=>{this.router.navigate([""])}):this.router.navigate(["/login"])}};e.\u0275fac=function(r){return new(r||e)(z(Cg),z(Jo))},e.\u0275cmp=Ee({type:e,selectors:[["app-header"]],decls:13,vars:3,consts:[[1,"header"],[1,"buttons"],[1,"filler"],["src","../../assets/images/CC.jpg","alt","cc"],[3,"click"],[3,"click",4,"ngIf"],[1,"weekDisplay"]],template:function(r,s){r&1&&(S(0,"div",0)(1,"div",1),oe(2,"div",2)(3,"div",2)(4,"div",2),w(),oe(5,"img",3),S(6,"div",1)(7,"button",4),ce("click",function(){return s.navigateToLoginOrLogout()}),F(8),w(),$e(9,g7,2,0,"button",5)(10,y7,2,0,"button",5),w()(),S(11,"div",6),oe(12,"app-week-display"),w()),r&2&&(q(8),bn(s.isLoggedIn?"Logout":"Login"),q(),me("ngIf",s.isLoggedIn),q(),me("ngIf",s.isLoggedIn))},dependencies:[Rn,dN],styles:["@media (min-width: 768px){.header[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;background-image:linear-gradient(135deg,#81fbb8 10%,#518e55);height:70px;display:flex;flex-direction:row;justify-content:space-between;z-index:1}img[_ngcontent-%COMP%]{height:70px;border-left:solid 3px gray;border-right:solid 3px gray}.buttons[_ngcontent-%COMP%]{width:350px;display:flex;flex-direction:row-reverse;align-items:center;justify-content:space-around;margin-left:100px;margin-right:175px}button[_ngcontent-%COMP%]{padding-top:2px;background:none;border:none;font-size:large;color:#fff;border-bottom:transparent solid 3px;transition:border-color 1s ease-out}button[_ngcontent-%COMP%]:hover{transition:.3s ease-in;border-color:#fff;color:#f5f5f5}.weekDisplay[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;justify-content:center;align-items:center}}@media (max-width: 767px){.header[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;background-image:linear-gradient(135deg,#81fbb8 10%,#518e55);height:50px;display:flex;flex-direction:row;justify-items:flex-start;align-items:center}img[_ngcontent-%COMP%]{height:50px;width:140px;border-left:solid 3px gray;border-right:solid 3px gray}button[_ngcontent-%COMP%]{padding-top:2px;margin-left:1px;margin-right:1px;background:none;border:none;font-size:small;color:#fff;border-bottom:transparent solid 3px;transition:border-color 1s ease-out}.weekDisplay[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:row;justify-content:start;align-items:center}}"]});let n=e;return n})();var Eg=(()=>{let e=class e{constructor(){this.title="cc"}};e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=Ee({type:e,selectors:[["app-root"]],decls:2,vars:0,template:function(r,s){r&1&&oe(0,"app-header")(1,"router-outlet")},dependencies:[fT,hN]});let n=e;return n})();var v7="@",_7=(()=>{let e=class e{constructor(i,r,s,o,a){this.doc=i,this.delegate=r,this.zone=s,this.animationType=o,this.moduleImpl=a,this._rendererFactoryPromise=null,this.scheduler=je(GS,{optional:!0})}ngOnDestroy(){this._engine?.flush()}loadImpl(){return(this.moduleImpl??import("./chunk-ZKLS75OQ.mjs")).catch(r=>{throw new Ho(5300,!1)}).then(({\u0275createEngine:r,\u0275AnimationRendererFactory:s})=>{this._engine=r(this.animationType,this.doc,this.scheduler);let o=new s(this.delegate,this._engine,this.zone);return this.delegate=o,o})}createRenderer(i,r){let s=this.delegate.createRenderer(i,r);if(s.\u0275type===0)return s;typeof s.throwOnSyntheticProps=="boolean"&&(s.throwOnSyntheticProps=!1);let o=new hS(s);return r?.data?.animation&&!this._rendererFactoryPromise&&(this._rendererFactoryPromise=this.loadImpl()),this._rendererFactoryPromise?.then(a=>{let c=a.createRenderer(i,r);o.use(c)}).catch(a=>{o.use(s)}),o}begin(){this.delegate.begin?.()}end(){this.delegate.end?.()}whenRenderingDone(){return this.delegate.whenRenderingDone?.()??Promise.resolve()}};e.\u0275fac=function(r){Fd()},e.\u0275prov=ie({token:e,factory:e.\u0275fac});let n=e;return n})(),hS=class{constructor(e){this.delegate=e,this.replay=[],this.\u0275type=1}use(e){if(this.delegate=e,this.replay!==null){for(let t of this.replay)t(e);this.replay=null}}get data(){return this.delegate.data}destroy(){this.replay=null,this.delegate.destroy()}createElement(e,t){return this.delegate.createElement(e,t)}createComment(e){return this.delegate.createComment(e)}createText(e){return this.delegate.createText(e)}get destroyNode(){return this.delegate.destroyNode}appendChild(e,t){this.delegate.appendChild(e,t)}insertBefore(e,t,i,r){this.delegate.insertBefore(e,t,i,r)}removeChild(e,t,i){this.delegate.removeChild(e,t,i)}selectRootElement(e,t){return this.delegate.selectRootElement(e,t)}parentNode(e){return this.delegate.parentNode(e)}nextSibling(e){return this.delegate.nextSibling(e)}setAttribute(e,t,i,r){this.delegate.setAttribute(e,t,i,r)}removeAttribute(e,t,i){this.delegate.removeAttribute(e,t,i)}addClass(e,t){this.delegate.addClass(e,t)}removeClass(e,t){this.delegate.removeClass(e,t)}setStyle(e,t,i,r){this.delegate.setStyle(e,t,i,r)}removeStyle(e,t,i){this.delegate.removeStyle(e,t,i)}setProperty(e,t,i){this.shouldReplay(t)&&this.replay.push(r=>r.setProperty(e,t,i)),this.delegate.setProperty(e,t,i)}setValue(e,t){this.delegate.setValue(e,t)}listen(e,t,i){return this.shouldReplay(t)&&this.replay.push(r=>r.listen(e,t,i)),this.delegate.listen(e,t,i)}shouldReplay(e){return this.replay!==null&&e.startsWith(v7)}};function fN(n="animations"){return $S("NgAsyncAnimations"),qS([{provide:WS,useFactory:(e,t,i)=>new _7(e,t,i,n),deps:[Oe,cT,ae]},{provide:ir,useValue:n==="noop"?"NoopAnimations":"BrowserAnimations"}])}var mS;try{mS=typeof Intl<"u"&&Intl.v8BreakIterator}catch{mS=!1}var at=(()=>{let e=class e{constructor(i){this._platformId=i,this.isBrowser=this._platformId?aT(this._platformId):typeof document=="object"&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!!(window.chrome||mS)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}};e.\u0275fac=function(r){return new(r||e)(C(Ci))},e.\u0275prov=ie({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var Sd;function w7(){if(Sd==null&&typeof window<"u")try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>Sd=!0}))}finally{Sd=Sd||!1}return Sd}function Qc(n){return w7()?n:!!n.capture}var Vo;function mN(){if(Vo==null){if(typeof document!="object"||!document||typeof Element!="function"||!Element)return Vo=!1,Vo;if("scrollBehavior"in document.documentElement.style)Vo=!0;else{let n=Element.prototype.scrollTo;n?Vo=!/\{\s*\[native code\]\s*\}/.test(n.toString()):Vo=!1}}return Vo}var fS;function C7(){if(fS==null){let n=typeof document<"u"?document.head:null;fS=!!(n&&(n.createShadowRoot||n.attachShadow))}return fS}function pN(n){if(C7()){let e=n.getRootNode?n.getRootNode():null;if(typeof ShadowRoot<"u"&&ShadowRoot&&e instanceof ShadowRoot)return e}return null}function wi(n){return n.composedPath?n.composedPath()[0]:n.target}function Td(){return typeof __karma__<"u"&&!!__karma__||typeof jasmine<"u"&&!!jasmine||typeof jest<"u"&&!!jest||typeof Mocha<"u"&&!!Mocha}function Yc(n){return Array.isArray(n)?n:[n]}function pt(n){return n==null?"":typeof n=="string"?n:`${n}px`}function Rr(n){return n instanceof nt?n.nativeElement:n}var gN=new Set,jo,E7=(()=>{let e=class e{constructor(i,r){this._platform=i,this._nonce=r,this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):T7}matchMedia(i){return(this._platform.WEBKIT||this._platform.BLINK)&&S7(i,this._nonce),this._matchMedia(i)}};e.\u0275fac=function(r){return new(r||e)(C(at),C(zS,8))},e.\u0275prov=ie({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();function S7(n,e){if(!gN.has(n))try{jo||(jo=document.createElement("style"),e&&jo.setAttribute("nonce",e),jo.setAttribute("type","text/css"),document.head.appendChild(jo)),jo.sheet&&(jo.sheet.insertRule(`@media ${n} {body{ }}`,0),gN.add(n))}catch(t){console.error(t)}}function T7(n){return{matches:n==="all"||n==="",media:n,addListener:()=>{},removeListener:()=>{}}}var Sg=(()=>{let e=class e{constructor(i,r){this._mediaMatcher=i,this._zone=r,this._queries=new Map,this._destroySubject=new We}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(i){return yN(Yc(i)).some(s=>this._registerQuery(s).mql.matches)}observe(i){let s=yN(Yc(i)).map(a=>this._registerQuery(a).observable),o=LS(s);return o=BS(o.pipe(il(1)),o.pipe(Nd(1),Ng(0))),o.pipe(Ae(a=>{let c={matches:!1,breakpoints:{}};return a.forEach(({matches:l,query:u})=>{c.matches=c.matches||l,c.breakpoints[u]=l}),c}))}_registerQuery(i){if(this._queries.has(i))return this._queries.get(i);let r=this._mediaMatcher.matchMedia(i),o={observable:new un(a=>{let c=l=>this._zone.run(()=>a.next(l));return r.addListener(c),()=>{r.removeListener(c)}}).pipe(Pr(r),Ae(({matches:a})=>({query:i,matches:a})),nr(this._destroySubject)),mql:r};return this._queries.set(i,o),o}};e.\u0275fac=function(r){return new(r||e)(C(E7),C(ae))},e.\u0275prov=ie({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();function yN(n){return n.map(e=>e.split(",")).reduce((e,t)=>e.concat(t)).map(e=>e.trim())}var bN={XSmall:"(max-width: 599.98px)",Small:"(min-width: 600px) and (max-width: 959.98px)",Medium:"(min-width: 960px) and (max-width: 1279.98px)",Large:"(min-width: 1280px) and (max-width: 1919.98px)",XLarge:"(min-width: 1920px)",Handset:"(max-width: 599.98px) and (orientation: portrait), (max-width: 959.98px) and (orientation: landscape)",Tablet:"(min-width: 600px) and (max-width: 839.98px) and (orientation: portrait), (min-width: 960px) and (max-width: 1279.98px) and (orientation: landscape)",Web:"(min-width: 840px) and (orientation: portrait), (min-width: 1280px) and (orientation: landscape)",HandsetPortrait:"(max-width: 599.98px) and (orientation: portrait)",TabletPortrait:"(min-width: 600px) and (max-width: 839.98px) and (orientation: portrait)",WebPortrait:"(min-width: 840px) and (orientation: portrait)",HandsetLandscape:"(max-width: 959.98px) and (orientation: landscape)",TabletLandscape:"(min-width: 960px) and (max-width: 1279.98px) and (orientation: landscape)",WebLandscape:"(min-width: 1280px) and (orientation: landscape)"};function gS(n){return n.buttons===0||n.detail===0}function yS(n){let e=n.touches&&n.touches[0]||n.changedTouches&&n.changedTouches[0];return!!e&&e.identifier===-1&&(e.radiusX==null||e.radiusX===1)&&(e.radiusY==null||e.radiusY===1)}var I7=new J("cdk-input-modality-detector-options"),A7={ignoreKeys:[18,17,224,91,16]},wN=650,Xc=Qc({passive:!0,capture:!0}),D7=(()=>{let e=class e{get mostRecentModality(){return this._modality.value}constructor(i,r,s,o){this._platform=i,this._mostRecentTarget=null,this._modality=new NS(null),this._lastTouchMs=0,this._onKeydown=a=>{this._options?.ignoreKeys?.some(c=>c===a.keyCode)||(this._modality.next("keyboard"),this._mostRecentTarget=wi(a))},this._onMousedown=a=>{Date.now()-this._lastTouchMs<wN||(this._modality.next(gS(a)?"keyboard":"mouse"),this._mostRecentTarget=wi(a))},this._onTouchstart=a=>{if(yS(a)){this._modality.next("keyboard");return}this._lastTouchMs=Date.now(),this._modality.next("touch"),this._mostRecentTarget=wi(a)},this._options=he(he({},A7),o),this.modalityDetected=this._modality.pipe(Nd(1)),this.modalityChanged=this.modalityDetected.pipe(Wo()),i.isBrowser&&r.runOutsideAngular(()=>{s.addEventListener("keydown",this._onKeydown,Xc),s.addEventListener("mousedown",this._onMousedown,Xc),s.addEventListener("touchstart",this._onTouchstart,Xc)})}ngOnDestroy(){this._modality.complete(),this._platform.isBrowser&&(document.removeEventListener("keydown",this._onKeydown,Xc),document.removeEventListener("mousedown",this._onMousedown,Xc),document.removeEventListener("touchstart",this._onTouchstart,Xc))}};e.\u0275fac=function(r){return new(r||e)(C(at),C(ae),C(Oe),C(I7,8))},e.\u0275prov=ie({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),k7=new J("liveAnnouncerElement",{providedIn:"root",factory:R7});function R7(){return null}var M7=new J("LIVE_ANNOUNCER_DEFAULT_OPTIONS"),O7=0,CN=(()=>{let e=class e{constructor(i,r,s,o){this._ngZone=r,this._defaultOptions=o,this._document=s,this._liveElement=i||this._createLiveElement()}announce(i,...r){let s=this._defaultOptions,o,a;return r.length===1&&typeof r[0]=="number"?a=r[0]:[o,a]=r,this.clear(),clearTimeout(this._previousTimeout),o||(o=s&&s.politeness?s.politeness:"polite"),a==null&&s&&(a=s.duration),this._liveElement.setAttribute("aria-live",o),this._liveElement.id&&this._exposeAnnouncerToModals(this._liveElement.id),this._ngZone.runOutsideAngular(()=>(this._currentPromise||(this._currentPromise=new Promise(c=>this._currentResolve=c)),clearTimeout(this._previousTimeout),this._previousTimeout=setTimeout(()=>{this._liveElement.textContent=i,typeof a=="number"&&(this._previousTimeout=setTimeout(()=>this.clear(),a)),this._currentResolve?.(),this._currentPromise=this._currentResolve=void 0},100),this._currentPromise))}clear(){this._liveElement&&(this._liveElement.textContent="")}ngOnDestroy(){clearTimeout(this._previousTimeout),this._liveElement?.remove(),this._liveElement=null,this._currentResolve?.(),this._currentPromise=this._currentResolve=void 0}_createLiveElement(){let i="cdk-live-announcer-element",r=this._document.getElementsByClassName(i),s=this._document.createElement("div");for(let o=0;o<r.length;o++)r[o].remove();return s.classList.add(i),s.classList.add("cdk-visually-hidden"),s.setAttribute("aria-atomic","true"),s.setAttribute("aria-live","polite"),s.id=`cdk-live-announcer-${O7++}`,this._document.body.appendChild(s),s}_exposeAnnouncerToModals(i){let r=this._document.querySelectorAll('body > .cdk-overlay-container [aria-modal="true"]');for(let s=0;s<r.length;s++){let o=r[s],a=o.getAttribute("aria-owns");a?a.indexOf(i)===-1&&o.setAttribute("aria-owns",a+" "+i):o.setAttribute("aria-owns",i)}}};e.\u0275fac=function(r){return new(r||e)(C(k7,8),C(ae),C(Oe),C(M7,8))},e.\u0275prov=ie({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var xg=function(n){return n[n.IMMEDIATE=0]="IMMEDIATE",n[n.EVENTUAL=1]="EVENTUAL",n}(xg||{}),P7=new J("cdk-focus-monitor-default-options"),Tg=Qc({passive:!0,capture:!0}),EN=(()=>{let e=class e{constructor(i,r,s,o,a){this._ngZone=i,this._platform=r,this._inputModalityDetector=s,this._origin=null,this._windowFocused=!1,this._originFromTouchInteraction=!1,this._elementInfo=new Map,this._monitoredElementCount=0,this._rootNodeFocusListenerCount=new Map,this._windowFocusListener=()=>{this._windowFocused=!0,this._windowFocusTimeoutId=window.setTimeout(()=>this._windowFocused=!1)},this._stopInputModalityDetector=new We,this._rootNodeFocusAndBlurListener=c=>{let l=wi(c);for(let u=l;u;u=u.parentElement)c.type==="focus"?this._onFocus(c,u):this._onBlur(c,u)},this._document=o,this._detectionMode=a?.detectionMode||xg.IMMEDIATE}monitor(i,r=!1){let s=Rr(i);if(!this._platform.isBrowser||s.nodeType!==1)return An();let o=pN(s)||this._getDocument(),a=this._elementInfo.get(s);if(a)return r&&(a.checkChildren=!0),a.subject;let c={checkChildren:r,subject:new We,rootNode:o};return this._elementInfo.set(s,c),this._registerGlobalListeners(c),c.subject}stopMonitoring(i){let r=Rr(i),s=this._elementInfo.get(r);s&&(s.subject.complete(),this._setClasses(r),this._elementInfo.delete(r),this._removeGlobalListeners(s))}focusVia(i,r,s){let o=Rr(i),a=this._getDocument().activeElement;o===a?this._getClosestElementsInfo(o).forEach(([c,l])=>this._originChanged(c,r,l)):(this._setOrigin(r),typeof o.focus=="function"&&o.focus(s))}ngOnDestroy(){this._elementInfo.forEach((i,r)=>this.stopMonitoring(r))}_getDocument(){return this._document||document}_getWindow(){return this._getDocument().defaultView||window}_getFocusOrigin(i){return this._origin?this._originFromTouchInteraction?this._shouldBeAttributedToTouch(i)?"touch":"program":this._origin:this._windowFocused&&this._lastFocusOrigin?this._lastFocusOrigin:i&&this._isLastInteractionFromInputLabel(i)?"mouse":"program"}_shouldBeAttributedToTouch(i){return this._detectionMode===xg.EVENTUAL||!!i?.contains(this._inputModalityDetector._mostRecentTarget)}_setClasses(i,r){i.classList.toggle("cdk-focused",!!r),i.classList.toggle("cdk-touch-focused",r==="touch"),i.classList.toggle("cdk-keyboard-focused",r==="keyboard"),i.classList.toggle("cdk-mouse-focused",r==="mouse"),i.classList.toggle("cdk-program-focused",r==="program")}_setOrigin(i,r=!1){this._ngZone.runOutsideAngular(()=>{if(this._origin=i,this._originFromTouchInteraction=i==="touch"&&r,this._detectionMode===xg.IMMEDIATE){clearTimeout(this._originTimeoutId);let s=this._originFromTouchInteraction?wN:1;this._originTimeoutId=setTimeout(()=>this._origin=null,s)}})}_onFocus(i,r){let s=this._elementInfo.get(r),o=wi(i);!s||!s.checkChildren&&r!==o||this._originChanged(r,this._getFocusOrigin(o),s)}_onBlur(i,r){let s=this._elementInfo.get(r);!s||s.checkChildren&&i.relatedTarget instanceof Node&&r.contains(i.relatedTarget)||(this._setClasses(r),this._emitOrigin(s,null))}_emitOrigin(i,r){i.subject.observers.length&&this._ngZone.run(()=>i.subject.next(r))}_registerGlobalListeners(i){if(!this._platform.isBrowser)return;let r=i.rootNode,s=this._rootNodeFocusListenerCount.get(r)||0;s||this._ngZone.runOutsideAngular(()=>{r.addEventListener("focus",this._rootNodeFocusAndBlurListener,Tg),r.addEventListener("blur",this._rootNodeFocusAndBlurListener,Tg)}),this._rootNodeFocusListenerCount.set(r,s+1),++this._monitoredElementCount===1&&(this._ngZone.runOutsideAngular(()=>{this._getWindow().addEventListener("focus",this._windowFocusListener)}),this._inputModalityDetector.modalityDetected.pipe(nr(this._stopInputModalityDetector)).subscribe(o=>{this._setOrigin(o,!0)}))}_removeGlobalListeners(i){let r=i.rootNode;if(this._rootNodeFocusListenerCount.has(r)){let s=this._rootNodeFocusListenerCount.get(r);s>1?this._rootNodeFocusListenerCount.set(r,s-1):(r.removeEventListener("focus",this._rootNodeFocusAndBlurListener,Tg),r.removeEventListener("blur",this._rootNodeFocusAndBlurListener,Tg),this._rootNodeFocusListenerCount.delete(r))}--this._monitoredElementCount||(this._getWindow().removeEventListener("focus",this._windowFocusListener),this._stopInputModalityDetector.next(),clearTimeout(this._windowFocusTimeoutId),clearTimeout(this._originTimeoutId))}_originChanged(i,r,s){this._setClasses(i,r),this._emitOrigin(s,r),this._lastFocusOrigin=r}_getClosestElementsInfo(i){let r=[];return this._elementInfo.forEach((s,o)=>{(o===i||s.checkChildren&&o.contains(i))&&r.push([o,s])}),r}_isLastInteractionFromInputLabel(i){let{_mostRecentTarget:r,mostRecentModality:s}=this._inputModalityDetector;if(s!=="mouse"||!r||r===i||i.nodeName!=="INPUT"&&i.nodeName!=="TEXTAREA"||i.disabled)return!1;let o=i.labels;if(o){for(let a=0;a<o.length;a++)if(o[a].contains(r))return!0}return!1}};e.\u0275fac=function(r){return new(r||e)(C(ae),C(at),C(D7),C(Oe,8),C(P7,8))},e.\u0275prov=ie({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var qo=function(n){return n[n.NONE=0]="NONE",n[n.BLACK_ON_WHITE=1]="BLACK_ON_WHITE",n[n.WHITE_ON_BLACK=2]="WHITE_ON_BLACK",n}(qo||{}),vN="cdk-high-contrast-black-on-white",_N="cdk-high-contrast-white-on-black",pS="cdk-high-contrast-active",SN=(()=>{let e=class e{constructor(i,r){this._platform=i,this._document=r,this._breakpointSubscription=je(Sg).observe("(forced-colors: active)").subscribe(()=>{this._hasCheckedHighContrastMode&&(this._hasCheckedHighContrastMode=!1,this._applyBodyHighContrastModeCssClasses())})}getHighContrastMode(){if(!this._platform.isBrowser)return qo.NONE;let i=this._document.createElement("div");i.style.backgroundColor="rgb(1,2,3)",i.style.position="absolute",this._document.body.appendChild(i);let r=this._document.defaultView||window,s=r&&r.getComputedStyle?r.getComputedStyle(i):null,o=(s&&s.backgroundColor||"").replace(/ /g,"");switch(i.remove(),o){case"rgb(0,0,0)":case"rgb(45,50,54)":case"rgb(32,32,32)":return qo.WHITE_ON_BLACK;case"rgb(255,255,255)":case"rgb(255,250,239)":return qo.BLACK_ON_WHITE}return qo.NONE}ngOnDestroy(){this._breakpointSubscription.unsubscribe()}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){let i=this._document.body.classList;i.remove(pS,vN,_N),this._hasCheckedHighContrastMode=!0;let r=this.getHighContrastMode();r===qo.BLACK_ON_WHITE?i.add(pS,vN):r===qo.WHITE_ON_BLACK&&i.add(pS,_N)}}};e.\u0275fac=function(r){return new(r||e)(C(at),C(Oe))},e.\u0275prov=ie({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var N7=new J("cdk-dir-doc",{providedIn:"root",factory:F7});function F7(){return je(Oe)}var L7=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;function B7(n){let e=n?.toLowerCase()||"";return e==="auto"&&typeof navigator<"u"&&navigator?.language?L7.test(navigator.language)?"rtl":"ltr":e==="rtl"?"rtl":"ltr"}var xN=(()=>{let e=class e{constructor(i){if(this.value="ltr",this.change=new Dn,i){let r=i.body?i.body.dir:null,s=i.documentElement?i.documentElement.dir:null;this.value=B7(r||s||"ltr")}}ngOnDestroy(){this.change.complete()}};e.\u0275fac=function(r){return new(r||e)(C(N7,8))},e.\u0275prov=ie({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var Ns=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=se({type:e}),e.\u0275inj=re({});let n=e;return n})();function j7(){return!0}var q7=new J("mat-sanity-checks",{providedIn:"root",factory:j7}),Fs=(()=>{let e=class e{constructor(i,r,s){this._sanityChecks=r,this._document=s,this._hasDoneGlobalChecks=!1,i._applyBodyHighContrastModeCssClasses(),this._hasDoneGlobalChecks||(this._hasDoneGlobalChecks=!0)}_checkIsEnabled(i){return Td()?!1:typeof this._sanityChecks=="boolean"?this._sanityChecks:!!this._sanityChecks[i]}};e.\u0275fac=function(r){return new(r||e)(C(SN),C(q7,8),C(Oe))},e.\u0275mod=se({type:e}),e.\u0275inj=re({imports:[Ns,Ns]});let n=e;return n})();var Qn=function(n){return n[n.FADING_IN=0]="FADING_IN",n[n.VISIBLE=1]="VISIBLE",n[n.FADING_OUT=2]="FADING_OUT",n[n.HIDDEN=3]="HIDDEN",n}(Qn||{}),_S=class{constructor(e,t,i,r=!1){this._renderer=e,this.element=t,this.config=i,this._animationForciblyDisabledThroughCss=r,this.state=Qn.HIDDEN}fadeOut(){this._renderer.fadeOutRipple(this)}},IN=Qc({passive:!0,capture:!0}),wS=class{constructor(){this._events=new Map,this._delegateEventHandler=e=>{let t=wi(e);t&&this._events.get(e.type)?.forEach((i,r)=>{(r===t||r.contains(t))&&i.forEach(s=>s.handleEvent(e))})}}addHandler(e,t,i,r){let s=this._events.get(t);if(s){let o=s.get(i);o?o.add(r):s.set(i,new Set([r]))}else this._events.set(t,new Map([[i,new Set([r])]])),e.runOutsideAngular(()=>{document.addEventListener(t,this._delegateEventHandler,IN)})}removeHandler(e,t,i){let r=this._events.get(e);if(!r)return;let s=r.get(t);s&&(s.delete(i),s.size===0&&r.delete(t),r.size===0&&(this._events.delete(e),document.removeEventListener(e,this._delegateEventHandler,IN)))}},AN={enterDuration:225,exitDuration:150},z7=800,DN=Qc({passive:!0,capture:!0}),kN=["mousedown","touchstart"],RN=["mouseup","mouseleave","touchend","touchcancel"],xd=class xd{constructor(e,t,i,r){this._target=e,this._ngZone=t,this._platform=r,this._isPointerDown=!1,this._activeRipples=new Map,this._pointerUpEventsRegistered=!1,r.isBrowser&&(this._containerElement=Rr(i))}fadeInRipple(e,t,i={}){let r=this._containerRect=this._containerRect||this._containerElement.getBoundingClientRect(),s=he(he({},AN),i.animation);i.centered&&(e=r.left+r.width/2,t=r.top+r.height/2);let o=i.radius||G7(e,t,r),a=e-r.left,c=t-r.top,l=s.enterDuration,u=document.createElement("div");u.classList.add("mat-ripple-element"),u.style.left=`${a-o}px`,u.style.top=`${c-o}px`,u.style.height=`${o*2}px`,u.style.width=`${o*2}px`,i.color!=null&&(u.style.backgroundColor=i.color),u.style.transitionDuration=`${l}ms`,this._containerElement.appendChild(u);let d=window.getComputedStyle(u),h=d.transitionProperty,m=d.transitionDuration,g=h==="none"||m==="0s"||m==="0s, 0s"||r.width===0&&r.height===0,y=new _S(this,u,i,g);u.style.transform="scale3d(1, 1, 1)",y.state=Qn.FADING_IN,i.persistent||(this._mostRecentTransientRipple=y);let _=null;return!g&&(l||s.exitDuration)&&this._ngZone.runOutsideAngular(()=>{let M=()=>this._finishRippleTransition(y),T=()=>this._destroyRipple(y);u.addEventListener("transitionend",M),u.addEventListener("transitioncancel",T),_={onTransitionEnd:M,onTransitionCancel:T}}),this._activeRipples.set(y,_),(g||!l)&&this._finishRippleTransition(y),y}fadeOutRipple(e){if(e.state===Qn.FADING_OUT||e.state===Qn.HIDDEN)return;let t=e.element,i=he(he({},AN),e.config.animation);t.style.transitionDuration=`${i.exitDuration}ms`,t.style.opacity="0",e.state=Qn.FADING_OUT,(e._animationForciblyDisabledThroughCss||!i.exitDuration)&&this._finishRippleTransition(e)}fadeOutAll(){this._getActiveRipples().forEach(e=>e.fadeOut())}fadeOutAllNonPersistent(){this._getActiveRipples().forEach(e=>{e.config.persistent||e.fadeOut()})}setupTriggerEvents(e){let t=Rr(e);!this._platform.isBrowser||!t||t===this._triggerElement||(this._removeTriggerEvents(),this._triggerElement=t,kN.forEach(i=>{xd._eventManager.addHandler(this._ngZone,i,t,this)}))}handleEvent(e){e.type==="mousedown"?this._onMousedown(e):e.type==="touchstart"?this._onTouchStart(e):this._onPointerUp(),this._pointerUpEventsRegistered||(this._ngZone.runOutsideAngular(()=>{RN.forEach(t=>{this._triggerElement.addEventListener(t,this,DN)})}),this._pointerUpEventsRegistered=!0)}_finishRippleTransition(e){e.state===Qn.FADING_IN?this._startFadeOutTransition(e):e.state===Qn.FADING_OUT&&this._destroyRipple(e)}_startFadeOutTransition(e){let t=e===this._mostRecentTransientRipple,{persistent:i}=e.config;e.state=Qn.VISIBLE,!i&&(!t||!this._isPointerDown)&&e.fadeOut()}_destroyRipple(e){let t=this._activeRipples.get(e)??null;this._activeRipples.delete(e),this._activeRipples.size||(this._containerRect=null),e===this._mostRecentTransientRipple&&(this._mostRecentTransientRipple=null),e.state=Qn.HIDDEN,t!==null&&(e.element.removeEventListener("transitionend",t.onTransitionEnd),e.element.removeEventListener("transitioncancel",t.onTransitionCancel)),e.element.remove()}_onMousedown(e){let t=gS(e),i=this._lastTouchStartEvent&&Date.now()<this._lastTouchStartEvent+z7;!this._target.rippleDisabled&&!t&&!i&&(this._isPointerDown=!0,this.fadeInRipple(e.clientX,e.clientY,this._target.rippleConfig))}_onTouchStart(e){if(!this._target.rippleDisabled&&!yS(e)){this._lastTouchStartEvent=Date.now(),this._isPointerDown=!0;let t=e.changedTouches;if(t)for(let i=0;i<t.length;i++)this.fadeInRipple(t[i].clientX,t[i].clientY,this._target.rippleConfig)}}_onPointerUp(){this._isPointerDown&&(this._isPointerDown=!1,this._getActiveRipples().forEach(e=>{let t=e.state===Qn.VISIBLE||e.config.terminateOnPointerUp&&e.state===Qn.FADING_IN;!e.config.persistent&&t&&e.fadeOut()}))}_getActiveRipples(){return Array.from(this._activeRipples.keys())}_removeTriggerEvents(){let e=this._triggerElement;e&&(kN.forEach(t=>xd._eventManager.removeHandler(t,e,this)),this._pointerUpEventsRegistered&&RN.forEach(t=>e.removeEventListener(t,this,DN)))}};xd._eventManager=new wS;var CS=xd;function G7(n,e,t){let i=Math.max(Math.abs(n-t.left),Math.abs(n-t.right)),r=Math.max(Math.abs(e-t.top),Math.abs(e-t.bottom));return Math.sqrt(i*i+r*r)}var NN=new J("mat-ripple-global-options"),W7=(()=>{let e=class e{get disabled(){return this._disabled}set disabled(i){i&&this.fadeOutAllNonPersistent(),this._disabled=i,this._setupTriggerEventsIfEnabled()}get trigger(){return this._trigger||this._elementRef.nativeElement}set trigger(i){this._trigger=i,this._setupTriggerEventsIfEnabled()}constructor(i,r,s,o,a){this._elementRef=i,this._animationMode=a,this.radius=0,this._disabled=!1,this._isInitialized=!1,this._globalOptions=o||{},this._rippleRenderer=new CS(this,r,i,s)}ngOnInit(){this._isInitialized=!0,this._setupTriggerEventsIfEnabled()}ngOnDestroy(){this._rippleRenderer._removeTriggerEvents()}fadeOutAll(){this._rippleRenderer.fadeOutAll()}fadeOutAllNonPersistent(){this._rippleRenderer.fadeOutAllNonPersistent()}get rippleConfig(){return{centered:this.centered,radius:this.radius,color:this.color,animation:he(he(he({},this._globalOptions.animation),this._animationMode==="NoopAnimations"?{enterDuration:0,exitDuration:0}:{}),this.animation),terminateOnPointerUp:this._globalOptions.terminateOnPointerUp}}get rippleDisabled(){return this.disabled||!!this._globalOptions.disabled}_setupTriggerEventsIfEnabled(){!this.disabled&&this._isInitialized&&this._rippleRenderer.setupTriggerEvents(this.trigger)}launch(i,r=0,s){return typeof i=="number"?this._rippleRenderer.fadeInRipple(i,r,he(he({},this.rippleConfig),s)):this._rippleRenderer.fadeInRipple(0,0,he(he({},this.rippleConfig),i))}};e.\u0275fac=function(r){return new(r||e)(z(nt),z(ae),z(at),z(NN,8),z(ir,8))},e.\u0275dir=Me({type:e,selectors:[["","mat-ripple",""],["","matRipple",""]],hostAttrs:[1,"mat-ripple"],hostVars:2,hostBindings:function(r,s){r&2&&kn("mat-ripple-unbounded",s.unbounded)},inputs:{color:[Ye.None,"matRippleColor","color"],unbounded:[Ye.None,"matRippleUnbounded","unbounded"],centered:[Ye.None,"matRippleCentered","centered"],radius:[Ye.None,"matRippleRadius","radius"],animation:[Ye.None,"matRippleAnimation","animation"],disabled:[Ye.None,"matRippleDisabled","disabled"],trigger:[Ye.None,"matRippleTrigger","trigger"]},exportAs:["matRipple"],standalone:!0});let n=e;return n})(),FN=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=se({type:e}),e.\u0275inj=re({imports:[Fs,Fs]});let n=e;return n})();var MN={capture:!0},ON=["focus","click","mouseenter","touchstart"],bS="mat-ripple-loader-uninitialized",vS="mat-ripple-loader-class-name",PN="mat-ripple-loader-centered",Ig="mat-ripple-loader-disabled",LN=(()=>{let e=class e{constructor(){this._document=je(Oe,{optional:!0}),this._animationMode=je(ir,{optional:!0}),this._globalRippleOptions=je(NN,{optional:!0}),this._platform=je(at),this._ngZone=je(ae),this._hosts=new Map,this._onInteraction=i=>{if(!(i.target instanceof HTMLElement))return;let s=i.target.closest(`[${bS}]`);s&&this._createRipple(s)},this._ngZone.runOutsideAngular(()=>{for(let i of ON)this._document?.addEventListener(i,this._onInteraction,MN)})}ngOnDestroy(){let i=this._hosts.keys();for(let r of i)this.destroyRipple(r);for(let r of ON)this._document?.removeEventListener(r,this._onInteraction,MN)}configureRipple(i,r){i.setAttribute(bS,""),(r.className||!i.hasAttribute(vS))&&i.setAttribute(vS,r.className||""),r.centered&&i.setAttribute(PN,""),r.disabled&&i.setAttribute(Ig,"")}getRipple(i){return this._hosts.get(i)||this._createRipple(i)}setDisabled(i,r){let s=this._hosts.get(i);if(s){s.disabled=r;return}r?i.setAttribute(Ig,""):i.removeAttribute(Ig)}_createRipple(i){if(!this._document)return;let r=this._hosts.get(i);if(r)return r;i.querySelector(".mat-ripple")?.remove();let s=this._document.createElement("span");s.classList.add("mat-ripple",i.getAttribute(vS)),i.append(s);let o=new W7(new nt(s),this._ngZone,this._platform,this._globalRippleOptions?this._globalRippleOptions:void 0,this._animationMode?this._animationMode:void 0);return o._isInitialized=!0,o.trigger=i,o.centered=i.hasAttribute(PN),o.disabled=i.hasAttribute(Ig),this.attachRipple(i,o),o}attachRipple(i,r){i.removeAttribute(bS),this._hosts.set(i,r)}destroyRipple(i){let r=this._hosts.get(i);r&&(r.ngOnDestroy(),this._hosts.delete(i))}};e.\u0275fac=function(r){return new(r||e)},e.\u0275prov=ie({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var $7=["mat-button",""],H7=[[["",8,"material-icons",3,"iconPositionEnd",""],["mat-icon",3,"iconPositionEnd",""],["","matButtonIcon","",3,"iconPositionEnd",""]],"*",[["","iconPositionEnd","",8,"material-icons"],["mat-icon","iconPositionEnd",""],["","matButtonIcon","","iconPositionEnd",""]]],K7=[".material-icons:not([iconPositionEnd]), mat-icon:not([iconPositionEnd]), [matButtonIcon]:not([iconPositionEnd])","*",".material-icons[iconPositionEnd], mat-icon[iconPositionEnd], [matButtonIcon][iconPositionEnd]"];var Q7=new J("MAT_BUTTON_CONFIG");var Y7=[{attribute:"mat-button",mdcClasses:["mdc-button","mat-mdc-button"]},{attribute:"mat-flat-button",mdcClasses:["mdc-button","mdc-button--unelevated","mat-mdc-unelevated-button"]},{attribute:"mat-raised-button",mdcClasses:["mdc-button","mdc-button--raised","mat-mdc-raised-button"]},{attribute:"mat-stroked-button",mdcClasses:["mdc-button","mdc-button--outlined","mat-mdc-outlined-button"]},{attribute:"mat-fab",mdcClasses:["mdc-fab","mat-mdc-fab"]},{attribute:"mat-mini-fab",mdcClasses:["mdc-fab","mdc-fab--mini","mat-mdc-mini-fab"]},{attribute:"mat-icon-button",mdcClasses:["mdc-icon-button","mat-mdc-icon-button"]}],X7=(()=>{let e=class e{get ripple(){return this._rippleLoader?.getRipple(this._elementRef.nativeElement)}set ripple(i){this._rippleLoader?.attachRipple(this._elementRef.nativeElement,i)}get disableRipple(){return this._disableRipple}set disableRipple(i){this._disableRipple=i,this._updateRippleDisabled()}get disabled(){return this._disabled}set disabled(i){this._disabled=i,this._updateRippleDisabled()}constructor(i,r,s,o){this._elementRef=i,this._platform=r,this._ngZone=s,this._animationMode=o,this._focusMonitor=je(EN),this._rippleLoader=je(LN),this._isFab=!1,this._disableRipple=!1,this._disabled=!1;let a=je(Q7,{optional:!0}),c=i.nativeElement,l=c.classList;this.disabledInteractive=a?.disabledInteractive??!1,this._rippleLoader?.configureRipple(c,{className:"mat-mdc-button-ripple"});for(let{attribute:u,mdcClasses:d}of Y7)c.hasAttribute(u)&&l.add(...d)}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0)}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef),this._rippleLoader?.destroyRipple(this._elementRef.nativeElement)}focus(i="program",r){i?this._focusMonitor.focusVia(this._elementRef.nativeElement,i,r):this._elementRef.nativeElement.focus(r)}_getAriaDisabled(){return this.ariaDisabled!=null?this.ariaDisabled:this.disabled&&this.disabledInteractive?!0:null}_getDisabledAttribute(){return this.disabledInteractive||!this.disabled?null:!0}_updateRippleDisabled(){this._rippleLoader?.setDisabled(this._elementRef.nativeElement,this.disableRipple||this.disabled)}};e.\u0275fac=function(r){Fd()},e.\u0275dir=Me({type:e,inputs:{color:"color",disableRipple:[Ye.HasDecoratorInputTransform,"disableRipple","disableRipple",Ei],disabled:[Ye.HasDecoratorInputTransform,"disabled","disabled",Ei],ariaDisabled:[Ye.HasDecoratorInputTransform,"aria-disabled","ariaDisabled",Ei],disabledInteractive:[Ye.HasDecoratorInputTransform,"disabledInteractive","disabledInteractive",Ei]},features:[Qo]});let n=e;return n})();var BN=(()=>{let e=class e extends X7{constructor(i,r,s,o){super(i,r,s,o)}};e.\u0275fac=function(r){return new(r||e)(z(nt),z(at),z(ae),z(ir,8))},e.\u0275cmp=Ee({type:e,selectors:[["button","mat-button",""],["button","mat-raised-button",""],["button","mat-flat-button",""],["button","mat-stroked-button",""]],hostVars:14,hostBindings:function(r,s){r&2&&(Vs("disabled",s._getDisabledAttribute())("aria-disabled",s._getAriaDisabled()),HS(s.color?"mat-"+s.color:""),kn("mat-mdc-button-disabled",s.disabled)("mat-mdc-button-disabled-interactive",s.disabledInteractive)("_mat-animation-noopable",s._animationMode==="NoopAnimations")("mat-unthemed",!s.color)("mat-mdc-button-base",!0))},exportAs:["matButton"],standalone:!0,features:[Ot,Us],attrs:$7,ngContentSelectors:K7,decls:7,vars:4,consts:[[1,"mat-mdc-button-persistent-ripple"],[1,"mdc-button__label"],[1,"mat-mdc-focus-indicator"],[1,"mat-mdc-button-touch-target"]],template:function(r,s){r&1&&(Vd(H7),oe(0,"span",0),Yo(1),S(2,"span",1),Yo(3,1),w(),Yo(4,2),oe(5,"span",2)(6,"span",3)),r&2&&kn("mdc-button__ripple",!s._isFab)("mdc-fab__ripple",s._isFab)},styles:['.mdc-touch-target-wrapper{display:inline}.mdc-elevation-overlay{position:absolute;border-radius:inherit;pointer-events:none;opacity:var(--mdc-elevation-overlay-opacity, 0);transition:opacity 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-button{position:relative;display:inline-flex;align-items:center;justify-content:center;box-sizing:border-box;min-width:64px;border:none;outline:none;line-height:inherit;user-select:none;-webkit-appearance:none;overflow:visible;vertical-align:middle;background:rgba(0,0,0,0)}.mdc-button .mdc-elevation-overlay{width:100%;height:100%;top:0;left:0}.mdc-button::-moz-focus-inner{padding:0;border:0}.mdc-button:active{outline:none}.mdc-button:hover{cursor:pointer}.mdc-button:disabled{cursor:default;pointer-events:none}.mdc-button[hidden]{display:none}.mdc-button .mdc-button__icon{margin-left:0;margin-right:8px;display:inline-block;position:relative;vertical-align:top}[dir=rtl] .mdc-button .mdc-button__icon,.mdc-button .mdc-button__icon[dir=rtl]{margin-left:8px;margin-right:0}.mdc-button .mdc-button__progress-indicator{font-size:0;position:absolute;transform:translate(-50%, -50%);top:50%;left:50%;line-height:initial}.mdc-button .mdc-button__label{position:relative}.mdc-button .mdc-button__focus-ring{pointer-events:none;border:2px solid rgba(0,0,0,0);border-radius:6px;box-sizing:content-box;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:calc(100% + 4px);width:calc(100% + 4px);display:none}@media screen and (forced-colors: active){.mdc-button .mdc-button__focus-ring{border-color:CanvasText}}.mdc-button .mdc-button__focus-ring::after{content:"";border:2px solid rgba(0,0,0,0);border-radius:8px;display:block;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:calc(100% + 4px);width:calc(100% + 4px)}@media screen and (forced-colors: active){.mdc-button .mdc-button__focus-ring::after{border-color:CanvasText}}@media screen and (forced-colors: active){.mdc-button.mdc-ripple-upgraded--background-focused .mdc-button__focus-ring,.mdc-button:not(.mdc-ripple-upgraded):focus .mdc-button__focus-ring{display:block}}.mdc-button .mdc-button__touch{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%)}.mdc-button__label+.mdc-button__icon{margin-left:8px;margin-right:0}[dir=rtl] .mdc-button__label+.mdc-button__icon,.mdc-button__label+.mdc-button__icon[dir=rtl]{margin-left:0;margin-right:8px}svg.mdc-button__icon{fill:currentColor}.mdc-button--touch{margin-top:6px;margin-bottom:6px}.mdc-button{padding:0 8px 0 8px}.mdc-button--unelevated{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);padding:0 16px 0 16px}.mdc-button--unelevated.mdc-button--icon-trailing{padding:0 12px 0 16px}.mdc-button--unelevated.mdc-button--icon-leading{padding:0 16px 0 12px}.mdc-button--raised{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);padding:0 16px 0 16px}.mdc-button--raised.mdc-button--icon-trailing{padding:0 12px 0 16px}.mdc-button--raised.mdc-button--icon-leading{padding:0 16px 0 12px}.mdc-button--outlined{border-style:solid;transition:border 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-button--outlined .mdc-button__ripple{border-style:solid;border-color:rgba(0,0,0,0)}.mat-mdc-button{font-family:var(--mdc-text-button-label-text-font);font-size:var(--mdc-text-button-label-text-size);letter-spacing:var(--mdc-text-button-label-text-tracking);font-weight:var(--mdc-text-button-label-text-weight);text-transform:var(--mdc-text-button-label-text-transform);height:var(--mdc-text-button-container-height);border-radius:var(--mdc-text-button-container-shape);padding:0 var(--mat-text-button-horizontal-padding, 8px)}.mat-mdc-button:not(:disabled){color:var(--mdc-text-button-label-text-color)}.mat-mdc-button:disabled{color:var(--mdc-text-button-disabled-label-text-color)}.mat-mdc-button .mdc-button__ripple{border-radius:var(--mdc-text-button-container-shape)}.mat-mdc-button:has(.material-icons,mat-icon,[matButtonIcon]){padding:0 var(--mat-text-button-with-icon-horizontal-padding, 8px)}.mat-mdc-button>.mat-icon{margin-right:var(--mat-text-button-icon-spacing, 8px);margin-left:var(--mat-text-button-icon-offset, 0)}[dir=rtl] .mat-mdc-button>.mat-icon{margin-right:var(--mat-text-button-icon-offset, 0);margin-left:var(--mat-text-button-icon-spacing, 8px)}.mat-mdc-button .mdc-button__label+.mat-icon{margin-right:var(--mat-text-button-icon-offset, 0);margin-left:var(--mat-text-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-button .mdc-button__label+.mat-icon{margin-right:var(--mat-text-button-icon-spacing, 8px);margin-left:var(--mat-text-button-icon-offset, 0)}.mat-mdc-button .mat-ripple-element{background-color:var(--mat-text-button-ripple-color)}.mat-mdc-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-text-button-state-layer-color)}.mat-mdc-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-text-button-disabled-state-layer-color)}.mat-mdc-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-text-button-hover-state-layer-opacity)}.mat-mdc-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-text-button-focus-state-layer-opacity)}.mat-mdc-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-text-button-pressed-state-layer-opacity)}.mat-mdc-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-text-button-touch-target-display)}.mat-mdc-button[disabled],.mat-mdc-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-text-button-disabled-label-text-color)}.mat-mdc-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-unelevated-button{font-family:var(--mdc-filled-button-label-text-font);font-size:var(--mdc-filled-button-label-text-size);letter-spacing:var(--mdc-filled-button-label-text-tracking);font-weight:var(--mdc-filled-button-label-text-weight);text-transform:var(--mdc-filled-button-label-text-transform);height:var(--mdc-filled-button-container-height);border-radius:var(--mdc-filled-button-container-shape);padding:0 var(--mat-filled-button-horizontal-padding, 16px)}.mat-mdc-unelevated-button:not(:disabled){background-color:var(--mdc-filled-button-container-color)}.mat-mdc-unelevated-button:disabled{background-color:var(--mdc-filled-button-disabled-container-color)}.mat-mdc-unelevated-button:not(:disabled){color:var(--mdc-filled-button-label-text-color)}.mat-mdc-unelevated-button:disabled{color:var(--mdc-filled-button-disabled-label-text-color)}.mat-mdc-unelevated-button .mdc-button__ripple{border-radius:var(--mdc-filled-button-container-shape)}.mat-mdc-unelevated-button>.mat-icon{margin-right:var(--mat-filled-button-icon-spacing, 8px);margin-left:var(--mat-filled-button-icon-offset, -4px)}[dir=rtl] .mat-mdc-unelevated-button>.mat-icon{margin-right:var(--mat-filled-button-icon-offset, -4px);margin-left:var(--mat-filled-button-icon-spacing, 8px)}.mat-mdc-unelevated-button .mdc-button__label+.mat-icon{margin-right:var(--mat-filled-button-icon-offset, -4px);margin-left:var(--mat-filled-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-unelevated-button .mdc-button__label+.mat-icon{margin-right:var(--mat-filled-button-icon-spacing, 8px);margin-left:var(--mat-filled-button-icon-offset, -4px)}.mat-mdc-unelevated-button .mat-ripple-element{background-color:var(--mat-filled-button-ripple-color)}.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-filled-button-state-layer-color)}.mat-mdc-unelevated-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-filled-button-disabled-state-layer-color)}.mat-mdc-unelevated-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-filled-button-hover-state-layer-opacity)}.mat-mdc-unelevated-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-filled-button-focus-state-layer-opacity)}.mat-mdc-unelevated-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-filled-button-pressed-state-layer-opacity)}.mat-mdc-unelevated-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-filled-button-touch-target-display)}.mat-mdc-unelevated-button[disabled],.mat-mdc-unelevated-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-filled-button-disabled-label-text-color);background-color:var(--mdc-filled-button-disabled-container-color)}.mat-mdc-unelevated-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-raised-button{font-family:var(--mdc-protected-button-label-text-font);font-size:var(--mdc-protected-button-label-text-size);letter-spacing:var(--mdc-protected-button-label-text-tracking);font-weight:var(--mdc-protected-button-label-text-weight);text-transform:var(--mdc-protected-button-label-text-transform);height:var(--mdc-protected-button-container-height);border-radius:var(--mdc-protected-button-container-shape);padding:0 var(--mat-protected-button-horizontal-padding, 16px);box-shadow:var(--mdc-protected-button-container-elevation-shadow)}.mat-mdc-raised-button:not(:disabled){background-color:var(--mdc-protected-button-container-color)}.mat-mdc-raised-button:disabled{background-color:var(--mdc-protected-button-disabled-container-color)}.mat-mdc-raised-button:not(:disabled){color:var(--mdc-protected-button-label-text-color)}.mat-mdc-raised-button:disabled{color:var(--mdc-protected-button-disabled-label-text-color)}.mat-mdc-raised-button .mdc-button__ripple{border-radius:var(--mdc-protected-button-container-shape)}.mat-mdc-raised-button>.mat-icon{margin-right:var(--mat-protected-button-icon-spacing, 8px);margin-left:var(--mat-protected-button-icon-offset, -4px)}[dir=rtl] .mat-mdc-raised-button>.mat-icon{margin-right:var(--mat-protected-button-icon-offset, -4px);margin-left:var(--mat-protected-button-icon-spacing, 8px)}.mat-mdc-raised-button .mdc-button__label+.mat-icon{margin-right:var(--mat-protected-button-icon-offset, -4px);margin-left:var(--mat-protected-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-raised-button .mdc-button__label+.mat-icon{margin-right:var(--mat-protected-button-icon-spacing, 8px);margin-left:var(--mat-protected-button-icon-offset, -4px)}.mat-mdc-raised-button .mat-ripple-element{background-color:var(--mat-protected-button-ripple-color)}.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-protected-button-state-layer-color)}.mat-mdc-raised-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-protected-button-disabled-state-layer-color)}.mat-mdc-raised-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-protected-button-hover-state-layer-opacity)}.mat-mdc-raised-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-protected-button-focus-state-layer-opacity)}.mat-mdc-raised-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-protected-button-pressed-state-layer-opacity)}.mat-mdc-raised-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-protected-button-touch-target-display)}.mat-mdc-raised-button:hover{box-shadow:var(--mdc-protected-button-hover-container-elevation-shadow)}.mat-mdc-raised-button:focus{box-shadow:var(--mdc-protected-button-focus-container-elevation-shadow)}.mat-mdc-raised-button:active,.mat-mdc-raised-button:focus:active{box-shadow:var(--mdc-protected-button-pressed-container-elevation-shadow)}.mat-mdc-raised-button[disabled],.mat-mdc-raised-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-protected-button-disabled-label-text-color);background-color:var(--mdc-protected-button-disabled-container-color)}.mat-mdc-raised-button[disabled].mat-mdc-button-disabled,.mat-mdc-raised-button.mat-mdc-button-disabled.mat-mdc-button-disabled{box-shadow:var(--mdc-protected-button-disabled-container-elevation-shadow)}.mat-mdc-raised-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-outlined-button{font-family:var(--mdc-outlined-button-label-text-font);font-size:var(--mdc-outlined-button-label-text-size);letter-spacing:var(--mdc-outlined-button-label-text-tracking);font-weight:var(--mdc-outlined-button-label-text-weight);text-transform:var(--mdc-outlined-button-label-text-transform);height:var(--mdc-outlined-button-container-height);border-radius:var(--mdc-outlined-button-container-shape);padding:0 15px 0 15px;border-width:var(--mdc-outlined-button-outline-width);padding:0 var(--mat-outlined-button-horizontal-padding, 15px)}.mat-mdc-outlined-button:not(:disabled){color:var(--mdc-outlined-button-label-text-color)}.mat-mdc-outlined-button:disabled{color:var(--mdc-outlined-button-disabled-label-text-color)}.mat-mdc-outlined-button .mdc-button__ripple{border-radius:var(--mdc-outlined-button-container-shape)}.mat-mdc-outlined-button:not(:disabled){border-color:var(--mdc-outlined-button-outline-color)}.mat-mdc-outlined-button:disabled{border-color:var(--mdc-outlined-button-disabled-outline-color)}.mat-mdc-outlined-button.mdc-button--icon-trailing{padding:0 11px 0 15px}.mat-mdc-outlined-button.mdc-button--icon-leading{padding:0 15px 0 11px}.mat-mdc-outlined-button .mdc-button__ripple{top:-1px;left:-1px;bottom:-1px;right:-1px;border-width:var(--mdc-outlined-button-outline-width)}.mat-mdc-outlined-button .mdc-button__touch{left:calc(-1 * var(--mdc-outlined-button-outline-width));width:calc(100% + 2 * var(--mdc-outlined-button-outline-width))}.mat-mdc-outlined-button>.mat-icon{margin-right:var(--mat-outlined-button-icon-spacing, 8px);margin-left:var(--mat-outlined-button-icon-offset, -4px)}[dir=rtl] .mat-mdc-outlined-button>.mat-icon{margin-right:var(--mat-outlined-button-icon-offset, -4px);margin-left:var(--mat-outlined-button-icon-spacing, 8px)}.mat-mdc-outlined-button .mdc-button__label+.mat-icon{margin-right:var(--mat-outlined-button-icon-offset, -4px);margin-left:var(--mat-outlined-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-outlined-button .mdc-button__label+.mat-icon{margin-right:var(--mat-outlined-button-icon-spacing, 8px);margin-left:var(--mat-outlined-button-icon-offset, -4px)}.mat-mdc-outlined-button .mat-ripple-element{background-color:var(--mat-outlined-button-ripple-color)}.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-outlined-button-state-layer-color)}.mat-mdc-outlined-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-outlined-button-disabled-state-layer-color)}.mat-mdc-outlined-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-outlined-button-hover-state-layer-opacity)}.mat-mdc-outlined-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-outlined-button-focus-state-layer-opacity)}.mat-mdc-outlined-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-outlined-button-pressed-state-layer-opacity)}.mat-mdc-outlined-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-outlined-button-touch-target-display)}.mat-mdc-outlined-button[disabled],.mat-mdc-outlined-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-outlined-button-disabled-label-text-color);border-color:var(--mdc-outlined-button-disabled-outline-color)}.mat-mdc-outlined-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-button-base{text-decoration:none}.mat-mdc-button,.mat-mdc-unelevated-button,.mat-mdc-raised-button,.mat-mdc-outlined-button{-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-mdc-button .mat-mdc-button-ripple,.mat-mdc-button .mat-mdc-button-persistent-ripple,.mat-mdc-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button .mat-mdc-button-ripple,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button .mat-mdc-button-ripple,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit}.mat-mdc-button .mat-mdc-button-ripple,.mat-mdc-unelevated-button .mat-mdc-button-ripple,.mat-mdc-raised-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mat-mdc-button-ripple{overflow:hidden}.mat-mdc-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{content:"";opacity:0}.mat-mdc-button .mdc-button__label,.mat-mdc-unelevated-button .mdc-button__label,.mat-mdc-raised-button .mdc-button__label,.mat-mdc-outlined-button .mdc-button__label{z-index:1}.mat-mdc-button .mat-mdc-focus-indicator,.mat-mdc-unelevated-button .mat-mdc-focus-indicator,.mat-mdc-raised-button .mat-mdc-focus-indicator,.mat-mdc-outlined-button .mat-mdc-focus-indicator{top:0;left:0;right:0;bottom:0;position:absolute}.mat-mdc-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-unelevated-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-raised-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-outlined-button:focus .mat-mdc-focus-indicator::before{content:""}.mat-mdc-button._mat-animation-noopable,.mat-mdc-unelevated-button._mat-animation-noopable,.mat-mdc-raised-button._mat-animation-noopable,.mat-mdc-outlined-button._mat-animation-noopable{transition:none !important;animation:none !important}.mat-mdc-button>.mat-icon,.mat-mdc-unelevated-button>.mat-icon,.mat-mdc-raised-button>.mat-icon,.mat-mdc-outlined-button>.mat-icon{display:inline-block;position:relative;vertical-align:top;font-size:1.125rem;height:1.125rem;width:1.125rem}.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mdc-button__ripple{top:-1px;left:-1px;bottom:-1px;right:-1px;border-width:-1px}.mat-mdc-unelevated-button .mat-mdc-focus-indicator::before,.mat-mdc-raised-button .mat-mdc-focus-indicator::before{margin:calc(calc(var(--mat-mdc-focus-indicator-border-width, 3px) + 2px)*-1)}.mat-mdc-outlined-button .mat-mdc-focus-indicator::before{margin:calc(calc(var(--mat-mdc-focus-indicator-border-width, 3px) + 3px)*-1)}',".cdk-high-contrast-active .mat-mdc-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-unelevated-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-raised-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-outlined-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-icon-button{outline:solid 1px}"],encapsulation:2,changeDetection:0});let n=e;return n})();var VN=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=se({type:e}),e.\u0275inj=re({imports:[Fs,FN,Fs]});let n=e;return n})();var Id=class{attach(e){return this._attachedHost=e,e.attach(this)}detach(){let e=this._attachedHost;e!=null&&(this._attachedHost=null,e.detach())}get isAttached(){return this._attachedHost!=null}setAttachedHost(e){this._attachedHost=e}},Zc=class extends Id{constructor(e,t,i,r,s){super(),this.component=e,this.viewContainerRef=t,this.injector=i,this.componentFactoryResolver=r,this.projectableNodes=s}},Jc=class extends Id{constructor(e,t,i,r){super(),this.templateRef=e,this.viewContainerRef=t,this.context=i,this.injector=r}get origin(){return this.templateRef.elementRef}attach(e,t=this.context){return this.context=t,super.attach(e)}detach(){return this.context=void 0,super.detach()}},ES=class extends Id{constructor(e){super(),this.element=e instanceof nt?e.nativeElement:e}},el=class{constructor(){this._isDisposed=!1,this.attachDomPortal=null}hasAttached(){return!!this._attachedPortal}attach(e){if(e instanceof Zc)return this._attachedPortal=e,this.attachComponentPortal(e);if(e instanceof Jc)return this._attachedPortal=e,this.attachTemplatePortal(e);if(this.attachDomPortal&&e instanceof ES)return this._attachedPortal=e,this.attachDomPortal(e)}detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(e){this._disposeFn=e}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}};var Ag=class extends el{constructor(e,t,i,r,s){super(),this.outletElement=e,this._componentFactoryResolver=t,this._appRef=i,this._defaultInjector=r,this.attachDomPortal=o=>{this._document;let a=o.element;a.parentNode;let c=this._document.createComment("dom-portal");a.parentNode.insertBefore(c,a),this.outletElement.appendChild(a),this._attachedPortal=o,super.setDisposeFn(()=>{c.parentNode&&c.parentNode.replaceChild(a,c)})},this._document=s}attachComponentPortal(e){let i=(e.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(e.component),r;return e.viewContainerRef?(r=e.viewContainerRef.createComponent(i,e.viewContainerRef.length,e.injector||e.viewContainerRef.injector,e.projectableNodes||void 0),this.setDisposeFn(()=>r.destroy())):(r=i.create(e.injector||this._defaultInjector||Vt.NULL),this._appRef.attachView(r.hostView),this.setDisposeFn(()=>{this._appRef.viewCount>0&&this._appRef.detachView(r.hostView),r.destroy()})),this.outletElement.appendChild(this._getComponentRootNode(r)),this._attachedPortal=e,r}attachTemplatePortal(e){let t=e.viewContainerRef,i=t.createEmbeddedView(e.templateRef,e.context,{injector:e.injector});return i.rootNodes.forEach(r=>this.outletElement.appendChild(r)),i.detectChanges(),this.setDisposeFn(()=>{let r=t.indexOf(i);r!==-1&&t.remove(r)}),this._attachedPortal=e,i}dispose(){super.dispose(),this.outletElement.remove()}_getComponentRootNode(e){return e.hostView.rootNodes[0]}};var SS=(()=>{let e=class e extends el{constructor(i,r,s){super(),this._componentFactoryResolver=i,this._viewContainerRef=r,this._isInitialized=!1,this.attached=new Dn,this.attachDomPortal=o=>{this._document;let a=o.element;a.parentNode;let c=this._document.createComment("dom-portal");o.setAttachedHost(this),a.parentNode.insertBefore(c,a),this._getRootNode().appendChild(a),this._attachedPortal=o,super.setDisposeFn(()=>{c.parentNode&&c.parentNode.replaceChild(a,c)})},this._document=s}get portal(){return this._attachedPortal}set portal(i){this.hasAttached()&&!i&&!this._isInitialized||(this.hasAttached()&&super.detach(),i&&super.attach(i),this._attachedPortal=i||null)}get attachedRef(){return this._attachedRef}ngOnInit(){this._isInitialized=!0}ngOnDestroy(){super.dispose(),this._attachedRef=this._attachedPortal=null}attachComponentPortal(i){i.setAttachedHost(this);let r=i.viewContainerRef!=null?i.viewContainerRef:this._viewContainerRef,o=(i.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(i.component),a=r.createComponent(o,r.length,i.injector||r.injector,i.projectableNodes||void 0);return r!==this._viewContainerRef&&this._getRootNode().appendChild(a.hostView.rootNodes[0]),super.setDisposeFn(()=>a.destroy()),this._attachedPortal=i,this._attachedRef=a,this.attached.emit(a),a}attachTemplatePortal(i){i.setAttachedHost(this);let r=this._viewContainerRef.createEmbeddedView(i.templateRef,i.context,{injector:i.injector});return super.setDisposeFn(()=>this._viewContainerRef.clear()),this._attachedPortal=i,this._attachedRef=r,this.attached.emit(r),r}_getRootNode(){let i=this._viewContainerRef.element.nativeElement;return i.nodeType===i.ELEMENT_NODE?i:i.parentNode}};e.\u0275fac=function(r){return new(r||e)(z(Ld),z(Bd),z(Oe))},e.\u0275dir=Me({type:e,selectors:[["","cdkPortalOutlet",""]],inputs:{portal:[Ye.None,"cdkPortalOutlet","portal"]},outputs:{attached:"attached"},exportAs:["cdkPortalOutlet"],standalone:!0,features:[Ot]});let n=e;return n})();var Dg=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=se({type:e}),e.\u0275inj=re({});let n=e;return n})();var Z7=20,jN=(()=>{let e=class e{constructor(i,r,s){this._ngZone=i,this._platform=r,this._scrolled=new We,this._globalSubscription=null,this._scrolledCount=0,this.scrollContainers=new Map,this._document=s}register(i){this.scrollContainers.has(i)||this.scrollContainers.set(i,i.elementScrolled().subscribe(()=>this._scrolled.next(i)))}deregister(i){let r=this.scrollContainers.get(i);r&&(r.unsubscribe(),this.scrollContainers.delete(i))}scrolled(i=Z7){return this._platform.isBrowser?new un(r=>{this._globalSubscription||this._addGlobalListener();let s=i>0?this._scrolled.pipe(Pg(i)).subscribe(r):this._scrolled.subscribe(r);return this._scrolledCount++,()=>{s.unsubscribe(),this._scrolledCount--,this._scrolledCount||this._removeGlobalListener()}}):An()}ngOnDestroy(){this._removeGlobalListener(),this.scrollContainers.forEach((i,r)=>this.deregister(r)),this._scrolled.complete()}ancestorScrolled(i,r){let s=this.getAncestorScrollContainers(i);return this.scrolled(r).pipe(Xn(o=>!o||s.indexOf(o)>-1))}getAncestorScrollContainers(i){let r=[];return this.scrollContainers.forEach((s,o)=>{this._scrollableContainsElement(o,i)&&r.push(o)}),r}_getWindow(){return this._document.defaultView||window}_scrollableContainsElement(i,r){let s=Rr(r),o=i.getElementRef().nativeElement;do if(s==o)return!0;while(s=s.parentElement);return!1}_addGlobalListener(){this._globalSubscription=this._ngZone.runOutsideAngular(()=>{let i=this._getWindow();return US(i.document,"scroll").subscribe(()=>this._scrolled.next())})}_removeGlobalListener(){this._globalSubscription&&(this._globalSubscription.unsubscribe(),this._globalSubscription=null)}};e.\u0275fac=function(r){return new(r||e)(C(ae),C(at),C(Oe,8))},e.\u0275prov=ie({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var J7=20,TS=(()=>{let e=class e{constructor(i,r,s){this._platform=i,this._change=new We,this._changeListener=o=>{this._change.next(o)},this._document=s,r.runOutsideAngular(()=>{if(i.isBrowser){let o=this._getWindow();o.addEventListener("resize",this._changeListener),o.addEventListener("orientationchange",this._changeListener)}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){if(this._platform.isBrowser){let i=this._getWindow();i.removeEventListener("resize",this._changeListener),i.removeEventListener("orientationchange",this._changeListener)}this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();let i={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),i}getViewportRect(){let i=this.getViewportScrollPosition(),{width:r,height:s}=this.getViewportSize();return{top:i.top,left:i.left,bottom:i.top+s,right:i.left+r,height:s,width:r}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};let i=this._document,r=this._getWindow(),s=i.documentElement,o=s.getBoundingClientRect(),a=-o.top||i.body.scrollTop||r.scrollY||s.scrollTop||0,c=-o.left||i.body.scrollLeft||r.scrollX||s.scrollLeft||0;return{top:a,left:c}}change(i=J7){return i>0?this._change.pipe(Pg(i)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){let i=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:i.innerWidth,height:i.innerHeight}:{width:0,height:0}}};e.\u0275fac=function(r){return new(r||e)(C(at),C(ae),C(Oe,8))},e.\u0275prov=ie({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var UN=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=se({type:e}),e.\u0275inj=re({});let n=e;return n})(),xS=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=se({type:e}),e.\u0275inj=re({imports:[Ns,UN,Ns,UN]});let n=e;return n})();var qN=mN(),IS=class{constructor(e,t){this._viewportRuler=e,this._previousHTMLStyles={top:"",left:""},this._isEnabled=!1,this._document=t}attach(){}enable(){if(this._canBeEnabled()){let e=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=e.style.left||"",this._previousHTMLStyles.top=e.style.top||"",e.style.left=pt(-this._previousScrollPosition.left),e.style.top=pt(-this._previousScrollPosition.top),e.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}disable(){if(this._isEnabled){let e=this._document.documentElement,t=this._document.body,i=e.style,r=t.style,s=i.scrollBehavior||"",o=r.scrollBehavior||"";this._isEnabled=!1,i.left=this._previousHTMLStyles.left,i.top=this._previousHTMLStyles.top,e.classList.remove("cdk-global-scrollblock"),qN&&(i.scrollBehavior=r.scrollBehavior="auto"),window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),qN&&(i.scrollBehavior=s,r.scrollBehavior=o)}}_canBeEnabled(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;let t=this._document.body,i=this._viewportRuler.getViewportSize();return t.scrollHeight>i.height||t.scrollWidth>i.width}};var AS=class{constructor(e,t,i,r){this._scrollDispatcher=e,this._ngZone=t,this._viewportRuler=i,this._config=r,this._scrollSubscription=null,this._detach=()=>{this.disable(),this._overlayRef.hasAttached()&&this._ngZone.run(()=>this._overlayRef.detach())}}attach(e){this._overlayRef,this._overlayRef=e}enable(){if(this._scrollSubscription)return;let e=this._scrollDispatcher.scrolled(0).pipe(Xn(t=>!t||!this._overlayRef.overlayElement.contains(t.getElementRef().nativeElement)));this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=e.subscribe(()=>{let t=this._viewportRuler.getViewportScrollPosition().top;Math.abs(t-this._initialScrollPosition)>this._config.threshold?this._detach():this._overlayRef.updatePosition()})):this._scrollSubscription=e.subscribe(this._detach)}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}},kg=class{enable(){}disable(){}attach(){}};function DS(n,e){return e.some(t=>{let i=n.bottom<t.top,r=n.top>t.bottom,s=n.right<t.left,o=n.left>t.right;return i||r||s||o})}function zN(n,e){return e.some(t=>{let i=n.top<t.top,r=n.bottom>t.bottom,s=n.left<t.left,o=n.right>t.right;return i||r||s||o})}var kS=class{constructor(e,t,i,r){this._scrollDispatcher=e,this._viewportRuler=t,this._ngZone=i,this._config=r,this._scrollSubscription=null}attach(e){this._overlayRef,this._overlayRef=e}enable(){if(!this._scrollSubscription){let e=this._config?this._config.scrollThrottle:0;this._scrollSubscription=this._scrollDispatcher.scrolled(e).subscribe(()=>{if(this._overlayRef.updatePosition(),this._config&&this._config.autoClose){let t=this._overlayRef.overlayElement.getBoundingClientRect(),{width:i,height:r}=this._viewportRuler.getViewportSize();DS(t,[{width:i,height:r,bottom:r,right:i,top:0,left:0}])&&(this.disable(),this._ngZone.run(()=>this._overlayRef.detach()))}})}}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}},tQ=(()=>{let e=class e{constructor(i,r,s,o){this._scrollDispatcher=i,this._viewportRuler=r,this._ngZone=s,this.noop=()=>new kg,this.close=a=>new AS(this._scrollDispatcher,this._ngZone,this._viewportRuler,a),this.block=()=>new IS(this._viewportRuler,this._document),this.reposition=a=>new kS(this._scrollDispatcher,this._viewportRuler,this._ngZone,a),this._document=o}};e.\u0275fac=function(r){return new(r||e)(C(jN),C(TS),C(ae),C(Oe))},e.\u0275prov=ie({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),Ad=class{constructor(e){if(this.scrollStrategy=new kg,this.panelClass="",this.hasBackdrop=!1,this.backdropClass="cdk-overlay-dark-backdrop",this.disposeOnNavigation=!1,e){let t=Object.keys(e);for(let i of t)e[i]!==void 0&&(this[i]=e[i])}}};var RS=class{constructor(e,t){this.connectionPair=e,this.scrollableViewProperties=t}};var KN=(()=>{let e=class e{constructor(i){this._attachedOverlays=[],this._document=i}ngOnDestroy(){this.detach()}add(i){this.remove(i),this._attachedOverlays.push(i)}remove(i){let r=this._attachedOverlays.indexOf(i);r>-1&&this._attachedOverlays.splice(r,1),this._attachedOverlays.length===0&&this.detach()}};e.\u0275fac=function(r){return new(r||e)(C(Oe))},e.\u0275prov=ie({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),nQ=(()=>{let e=class e extends KN{constructor(i,r){super(i),this._ngZone=r,this._keydownListener=s=>{let o=this._attachedOverlays;for(let a=o.length-1;a>-1;a--)if(o[a]._keydownEvents.observers.length>0){let c=o[a]._keydownEvents;this._ngZone?this._ngZone.run(()=>c.next(s)):c.next(s);break}}}add(i){super.add(i),this._isAttached||(this._ngZone?this._ngZone.runOutsideAngular(()=>this._document.body.addEventListener("keydown",this._keydownListener)):this._document.body.addEventListener("keydown",this._keydownListener),this._isAttached=!0)}detach(){this._isAttached&&(this._document.body.removeEventListener("keydown",this._keydownListener),this._isAttached=!1)}};e.\u0275fac=function(r){return new(r||e)(C(Oe),C(ae,8))},e.\u0275prov=ie({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),iQ=(()=>{let e=class e extends KN{constructor(i,r,s){super(i),this._platform=r,this._ngZone=s,this._cursorStyleIsSet=!1,this._pointerDownListener=o=>{this._pointerDownEventTarget=wi(o)},this._clickListener=o=>{let a=wi(o),c=o.type==="click"&&this._pointerDownEventTarget?this._pointerDownEventTarget:a;this._pointerDownEventTarget=null;let l=this._attachedOverlays.slice();for(let u=l.length-1;u>-1;u--){let d=l[u];if(d._outsidePointerEvents.observers.length<1||!d.hasAttached())continue;if(d.overlayElement.contains(a)||d.overlayElement.contains(c))break;let h=d._outsidePointerEvents;this._ngZone?this._ngZone.run(()=>h.next(o)):h.next(o)}}}add(i){if(super.add(i),!this._isAttached){let r=this._document.body;this._ngZone?this._ngZone.runOutsideAngular(()=>this._addEventListeners(r)):this._addEventListeners(r),this._platform.IOS&&!this._cursorStyleIsSet&&(this._cursorOriginalValue=r.style.cursor,r.style.cursor="pointer",this._cursorStyleIsSet=!0),this._isAttached=!0}}detach(){if(this._isAttached){let i=this._document.body;i.removeEventListener("pointerdown",this._pointerDownListener,!0),i.removeEventListener("click",this._clickListener,!0),i.removeEventListener("auxclick",this._clickListener,!0),i.removeEventListener("contextmenu",this._clickListener,!0),this._platform.IOS&&this._cursorStyleIsSet&&(i.style.cursor=this._cursorOriginalValue,this._cursorStyleIsSet=!1),this._isAttached=!1}}_addEventListeners(i){i.addEventListener("pointerdown",this._pointerDownListener,!0),i.addEventListener("click",this._clickListener,!0),i.addEventListener("auxclick",this._clickListener,!0),i.addEventListener("contextmenu",this._clickListener,!0)}};e.\u0275fac=function(r){return new(r||e)(C(Oe),C(at),C(ae,8))},e.\u0275prov=ie({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),QN=(()=>{let e=class e{constructor(i,r){this._platform=r,this._document=i}ngOnDestroy(){this._containerElement?.remove()}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){let i="cdk-overlay-container";if(this._platform.isBrowser||Td()){let s=this._document.querySelectorAll(`.${i}[platform="server"], .${i}[platform="test"]`);for(let o=0;o<s.length;o++)s[o].remove()}let r=this._document.createElement("div");r.classList.add(i),Td()?r.setAttribute("platform","test"):this._platform.isBrowser||r.setAttribute("platform","server"),this._document.body.appendChild(r),this._containerElement=r}};e.\u0275fac=function(r){return new(r||e)(C(Oe),C(at))},e.\u0275prov=ie({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),MS=class{constructor(e,t,i,r,s,o,a,c,l,u=!1){this._portalOutlet=e,this._host=t,this._pane=i,this._config=r,this._ngZone=s,this._keyboardDispatcher=o,this._document=a,this._location=c,this._outsideClickDispatcher=l,this._animationsDisabled=u,this._backdropElement=null,this._backdropClick=new We,this._attachments=new We,this._detachments=new We,this._locationChanges=nl.EMPTY,this._backdropClickHandler=d=>this._backdropClick.next(d),this._backdropTransitionendHandler=d=>{this._disposeBackdrop(d.target)},this._keydownEvents=new We,this._outsidePointerEvents=new We,r.scrollStrategy&&(this._scrollStrategy=r.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=r.positionStrategy}get overlayElement(){return this._pane}get backdropElement(){return this._backdropElement}get hostElement(){return this._host}attach(e){!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host);let t=this._portalOutlet.attach(e);return this._positionStrategy&&this._positionStrategy.attach(this),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),this._ngZone.onStable.pipe(il(1)).subscribe(()=>{this.hasAttached()&&this.updatePosition()}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),this._outsideClickDispatcher.add(this),typeof t?.onDestroy=="function"&&t.onDestroy(()=>{this.hasAttached()&&this._ngZone.runOutsideAngular(()=>Promise.resolve().then(()=>this.detach()))}),t}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();let e=this._portalOutlet.detach();return this._detachments.next(),this._keyboardDispatcher.remove(this),this._detachContentWhenStable(),this._locationChanges.unsubscribe(),this._outsideClickDispatcher.remove(this),e}dispose(){let e=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this._disposeBackdrop(this._backdropElement),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._outsidePointerEvents.complete(),this._outsideClickDispatcher.remove(this),this._host?.remove(),this._previousHostParent=this._pane=this._host=null,e&&this._detachments.next(),this._detachments.complete()}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick}attachments(){return this._attachments}detachments(){return this._detachments}keydownEvents(){return this._keydownEvents}outsidePointerEvents(){return this._outsidePointerEvents}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(e){e!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=e,this.hasAttached()&&(e.attach(this),this.updatePosition()))}updateSize(e){this._config=he(he({},this._config),e),this._updateElementSize()}setDirection(e){this._config=In(he({},this._config),{direction:e}),this._updateElementDirection()}addPanelClass(e){this._pane&&this._toggleClasses(this._pane,e,!0)}removePanelClass(e){this._pane&&this._toggleClasses(this._pane,e,!1)}getDirection(){let e=this._config.direction;return e?typeof e=="string"?e:e.value:"ltr"}updateScrollStrategy(e){e!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=e,this.hasAttached()&&(e.attach(this),e.enable()))}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){if(!this._pane)return;let e=this._pane.style;e.width=pt(this._config.width),e.height=pt(this._config.height),e.minWidth=pt(this._config.minWidth),e.minHeight=pt(this._config.minHeight),e.maxWidth=pt(this._config.maxWidth),e.maxHeight=pt(this._config.maxHeight)}_togglePointerEvents(e){this._pane.style.pointerEvents=e?"":"none"}_attachBackdrop(){let e="cdk-overlay-backdrop-showing";this._backdropElement=this._document.createElement("div"),this._backdropElement.classList.add("cdk-overlay-backdrop"),this._animationsDisabled&&this._backdropElement.classList.add("cdk-overlay-backdrop-noop-animation"),this._config.backdropClass&&this._toggleClasses(this._backdropElement,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropElement,this._host),this._backdropElement.addEventListener("click",this._backdropClickHandler),!this._animationsDisabled&&typeof requestAnimationFrame<"u"?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{this._backdropElement&&this._backdropElement.classList.add(e)})}):this._backdropElement.classList.add(e)}_updateStackingOrder(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){let e=this._backdropElement;if(e){if(this._animationsDisabled){this._disposeBackdrop(e);return}e.classList.remove("cdk-overlay-backdrop-showing"),this._ngZone.runOutsideAngular(()=>{e.addEventListener("transitionend",this._backdropTransitionendHandler)}),e.style.pointerEvents="none",this._backdropTimeout=this._ngZone.runOutsideAngular(()=>setTimeout(()=>{this._disposeBackdrop(e)},500))}}_toggleClasses(e,t,i){let r=Yc(t||[]).filter(s=>!!s);r.length&&(i?e.classList.add(...r):e.classList.remove(...r))}_detachContentWhenStable(){this._ngZone.runOutsideAngular(()=>{let e=this._ngZone.onStable.pipe(nr(Od(this._attachments,this._detachments))).subscribe(()=>{(!this._pane||!this._host||this._pane.children.length===0)&&(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._host.remove()),e.unsubscribe())})})}_disposeScrollStrategy(){let e=this._scrollStrategy;e&&(e.disable(),e.detach&&e.detach())}_disposeBackdrop(e){e&&(e.removeEventListener("click",this._backdropClickHandler),e.removeEventListener("transitionend",this._backdropTransitionendHandler),e.remove(),this._backdropElement===e&&(this._backdropElement=null)),this._backdropTimeout&&(clearTimeout(this._backdropTimeout),this._backdropTimeout=void 0)}},GN="cdk-overlay-connected-position-bounding-box",rQ=/([A-Za-z%]+)$/,OS=class{get positions(){return this._preferredPositions}constructor(e,t,i,r,s){this._viewportRuler=t,this._document=i,this._platform=r,this._overlayContainer=s,this._lastBoundingBoxSize={width:0,height:0},this._isPushed=!1,this._canPush=!0,this._growAfterOpen=!1,this._hasFlexibleDimensions=!0,this._positionLocked=!1,this._viewportMargin=0,this._scrollables=[],this._preferredPositions=[],this._positionChanges=new We,this._resizeSubscription=nl.EMPTY,this._offsetX=0,this._offsetY=0,this._appliedPanelClasses=[],this.positionChanges=this._positionChanges,this.setOrigin(e)}attach(e){this._overlayRef&&this._overlayRef,this._validatePositions(),e.hostElement.classList.add(GN),this._overlayRef=e,this._boundingBox=e.hostElement,this._pane=e.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe(()=>{this._isInitialRender=!0,this.apply()})}apply(){if(this._isDisposed||!this._platform.isBrowser)return;if(!this._isInitialRender&&this._positionLocked&&this._lastPosition){this.reapplyLastPosition();return}this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();let e=this._originRect,t=this._overlayRect,i=this._viewportRect,r=this._containerRect,s=[],o;for(let a of this._preferredPositions){let c=this._getOriginPoint(e,r,a),l=this._getOverlayPoint(c,t,a),u=this._getOverlayFit(l,t,i,a);if(u.isCompletelyWithinViewport){this._isPushed=!1,this._applyPosition(a,c);return}if(this._canFitWithFlexibleDimensions(u,l,i)){s.push({position:a,origin:c,overlayRect:t,boundingBoxRect:this._calculateBoundingBoxRect(c,a)});continue}(!o||o.overlayFit.visibleArea<u.visibleArea)&&(o={overlayFit:u,overlayPoint:l,originPoint:c,position:a,overlayRect:t})}if(s.length){let a=null,c=-1;for(let l of s){let u=l.boundingBoxRect.width*l.boundingBoxRect.height*(l.position.weight||1);u>c&&(c=u,a=l)}this._isPushed=!1,this._applyPosition(a.position,a.origin);return}if(this._canPush){this._isPushed=!0,this._applyPosition(o.position,o.originPoint);return}this._applyPosition(o.position,o.originPoint)}detach(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}dispose(){this._isDisposed||(this._boundingBox&&zo(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove(GN),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}reapplyLastPosition(){if(this._isDisposed||!this._platform.isBrowser)return;let e=this._lastPosition;if(e){this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();let t=this._getOriginPoint(this._originRect,this._containerRect,e);this._applyPosition(e,t)}else this.apply()}withScrollableContainers(e){return this._scrollables=e,this}withPositions(e){return this._preferredPositions=e,e.indexOf(this._lastPosition)===-1&&(this._lastPosition=null),this._validatePositions(),this}withViewportMargin(e){return this._viewportMargin=e,this}withFlexibleDimensions(e=!0){return this._hasFlexibleDimensions=e,this}withGrowAfterOpen(e=!0){return this._growAfterOpen=e,this}withPush(e=!0){return this._canPush=e,this}withLockedPosition(e=!0){return this._positionLocked=e,this}setOrigin(e){return this._origin=e,this}withDefaultOffsetX(e){return this._offsetX=e,this}withDefaultOffsetY(e){return this._offsetY=e,this}withTransformOriginOn(e){return this._transformOriginSelector=e,this}_getOriginPoint(e,t,i){let r;if(i.originX=="center")r=e.left+e.width/2;else{let o=this._isRtl()?e.right:e.left,a=this._isRtl()?e.left:e.right;r=i.originX=="start"?o:a}t.left<0&&(r-=t.left);let s;return i.originY=="center"?s=e.top+e.height/2:s=i.originY=="top"?e.top:e.bottom,t.top<0&&(s-=t.top),{x:r,y:s}}_getOverlayPoint(e,t,i){let r;i.overlayX=="center"?r=-t.width/2:i.overlayX==="start"?r=this._isRtl()?-t.width:0:r=this._isRtl()?0:-t.width;let s;return i.overlayY=="center"?s=-t.height/2:s=i.overlayY=="top"?0:-t.height,{x:e.x+r,y:e.y+s}}_getOverlayFit(e,t,i,r){let s=$N(t),{x:o,y:a}=e,c=this._getOffset(r,"x"),l=this._getOffset(r,"y");c&&(o+=c),l&&(a+=l);let u=0-o,d=o+s.width-i.width,h=0-a,m=a+s.height-i.height,g=this._subtractOverflows(s.width,u,d),y=this._subtractOverflows(s.height,h,m),_=g*y;return{visibleArea:_,isCompletelyWithinViewport:s.width*s.height===_,fitsInViewportVertically:y===s.height,fitsInViewportHorizontally:g==s.width}}_canFitWithFlexibleDimensions(e,t,i){if(this._hasFlexibleDimensions){let r=i.bottom-t.y,s=i.right-t.x,o=WN(this._overlayRef.getConfig().minHeight),a=WN(this._overlayRef.getConfig().minWidth),c=e.fitsInViewportVertically||o!=null&&o<=r,l=e.fitsInViewportHorizontally||a!=null&&a<=s;return c&&l}return!1}_pushOverlayOnScreen(e,t,i){if(this._previousPushAmount&&this._positionLocked)return{x:e.x+this._previousPushAmount.x,y:e.y+this._previousPushAmount.y};let r=$N(t),s=this._viewportRect,o=Math.max(e.x+r.width-s.width,0),a=Math.max(e.y+r.height-s.height,0),c=Math.max(s.top-i.top-e.y,0),l=Math.max(s.left-i.left-e.x,0),u=0,d=0;return r.width<=s.width?u=l||-o:u=e.x<this._viewportMargin?s.left-i.left-e.x:0,r.height<=s.height?d=c||-a:d=e.y<this._viewportMargin?s.top-i.top-e.y:0,this._previousPushAmount={x:u,y:d},{x:e.x+u,y:e.y+d}}_applyPosition(e,t){if(this._setTransformOrigin(e),this._setOverlayElementStyles(t,e),this._setBoundingBoxStyles(t,e),e.panelClass&&this._addPanelClasses(e.panelClass),this._positionChanges.observers.length){let i=this._getScrollVisibility();if(e!==this._lastPosition||!this._lastScrollVisibility||!sQ(this._lastScrollVisibility,i)){let r=new RS(e,i);this._positionChanges.next(r)}this._lastScrollVisibility=i}this._lastPosition=e,this._isInitialRender=!1}_setTransformOrigin(e){if(!this._transformOriginSelector)return;let t=this._boundingBox.querySelectorAll(this._transformOriginSelector),i,r=e.overlayY;e.overlayX==="center"?i="center":this._isRtl()?i=e.overlayX==="start"?"right":"left":i=e.overlayX==="start"?"left":"right";for(let s=0;s<t.length;s++)t[s].style.transformOrigin=`${i} ${r}`}_calculateBoundingBoxRect(e,t){let i=this._viewportRect,r=this._isRtl(),s,o,a;if(t.overlayY==="top")o=e.y,s=i.height-o+this._viewportMargin;else if(t.overlayY==="bottom")a=i.height-e.y+this._viewportMargin*2,s=i.height-a+this._viewportMargin;else{let m=Math.min(i.bottom-e.y+i.top,e.y),g=this._lastBoundingBoxSize.height;s=m*2,o=e.y-m,s>g&&!this._isInitialRender&&!this._growAfterOpen&&(o=e.y-g/2)}let c=t.overlayX==="start"&&!r||t.overlayX==="end"&&r,l=t.overlayX==="end"&&!r||t.overlayX==="start"&&r,u,d,h;if(l)h=i.width-e.x+this._viewportMargin*2,u=e.x-this._viewportMargin;else if(c)d=e.x,u=i.right-e.x;else{let m=Math.min(i.right-e.x+i.left,e.x),g=this._lastBoundingBoxSize.width;u=m*2,d=e.x-m,u>g&&!this._isInitialRender&&!this._growAfterOpen&&(d=e.x-g/2)}return{top:o,left:d,bottom:a,right:h,width:u,height:s}}_setBoundingBoxStyles(e,t){let i=this._calculateBoundingBoxRect(e,t);!this._isInitialRender&&!this._growAfterOpen&&(i.height=Math.min(i.height,this._lastBoundingBoxSize.height),i.width=Math.min(i.width,this._lastBoundingBoxSize.width));let r={};if(this._hasExactPosition())r.top=r.left="0",r.bottom=r.right=r.maxHeight=r.maxWidth="",r.width=r.height="100%";else{let s=this._overlayRef.getConfig().maxHeight,o=this._overlayRef.getConfig().maxWidth;r.height=pt(i.height),r.top=pt(i.top),r.bottom=pt(i.bottom),r.width=pt(i.width),r.left=pt(i.left),r.right=pt(i.right),t.overlayX==="center"?r.alignItems="center":r.alignItems=t.overlayX==="end"?"flex-end":"flex-start",t.overlayY==="center"?r.justifyContent="center":r.justifyContent=t.overlayY==="bottom"?"flex-end":"flex-start",s&&(r.maxHeight=pt(s)),o&&(r.maxWidth=pt(o))}this._lastBoundingBoxSize=i,zo(this._boundingBox.style,r)}_resetBoundingBoxStyles(){zo(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}_resetOverlayElementStyles(){zo(this._pane.style,{top:"",left:"",bottom:"",right:"",position:"",transform:""})}_setOverlayElementStyles(e,t){let i={},r=this._hasExactPosition(),s=this._hasFlexibleDimensions,o=this._overlayRef.getConfig();if(r){let u=this._viewportRuler.getViewportScrollPosition();zo(i,this._getExactOverlayY(t,e,u)),zo(i,this._getExactOverlayX(t,e,u))}else i.position="static";let a="",c=this._getOffset(t,"x"),l=this._getOffset(t,"y");c&&(a+=`translateX(${c}px) `),l&&(a+=`translateY(${l}px)`),i.transform=a.trim(),o.maxHeight&&(r?i.maxHeight=pt(o.maxHeight):s&&(i.maxHeight="")),o.maxWidth&&(r?i.maxWidth=pt(o.maxWidth):s&&(i.maxWidth="")),zo(this._pane.style,i)}_getExactOverlayY(e,t,i){let r={top:"",bottom:""},s=this._getOverlayPoint(t,this._overlayRect,e);if(this._isPushed&&(s=this._pushOverlayOnScreen(s,this._overlayRect,i)),e.overlayY==="bottom"){let o=this._document.documentElement.clientHeight;r.bottom=`${o-(s.y+this._overlayRect.height)}px`}else r.top=pt(s.y);return r}_getExactOverlayX(e,t,i){let r={left:"",right:""},s=this._getOverlayPoint(t,this._overlayRect,e);this._isPushed&&(s=this._pushOverlayOnScreen(s,this._overlayRect,i));let o;if(this._isRtl()?o=e.overlayX==="end"?"left":"right":o=e.overlayX==="end"?"right":"left",o==="right"){let a=this._document.documentElement.clientWidth;r.right=`${a-(s.x+this._overlayRect.width)}px`}else r.left=pt(s.x);return r}_getScrollVisibility(){let e=this._getOriginRect(),t=this._pane.getBoundingClientRect(),i=this._scrollables.map(r=>r.getElementRef().nativeElement.getBoundingClientRect());return{isOriginClipped:zN(e,i),isOriginOutsideView:DS(e,i),isOverlayClipped:zN(t,i),isOverlayOutsideView:DS(t,i)}}_subtractOverflows(e,...t){return t.reduce((i,r)=>i-Math.max(r,0),e)}_getNarrowedViewportRect(){let e=this._document.documentElement.clientWidth,t=this._document.documentElement.clientHeight,i=this._viewportRuler.getViewportScrollPosition();return{top:i.top+this._viewportMargin,left:i.left+this._viewportMargin,right:i.left+e-this._viewportMargin,bottom:i.top+t-this._viewportMargin,width:e-2*this._viewportMargin,height:t-2*this._viewportMargin}}_isRtl(){return this._overlayRef.getDirection()==="rtl"}_hasExactPosition(){return!this._hasFlexibleDimensions||this._isPushed}_getOffset(e,t){return t==="x"?e.offsetX==null?this._offsetX:e.offsetX:e.offsetY==null?this._offsetY:e.offsetY}_validatePositions(){}_addPanelClasses(e){this._pane&&Yc(e).forEach(t=>{t!==""&&this._appliedPanelClasses.indexOf(t)===-1&&(this._appliedPanelClasses.push(t),this._pane.classList.add(t))})}_clearPanelClasses(){this._pane&&(this._appliedPanelClasses.forEach(e=>{this._pane.classList.remove(e)}),this._appliedPanelClasses=[])}_getOriginRect(){let e=this._origin;if(e instanceof nt)return e.nativeElement.getBoundingClientRect();if(e instanceof Element)return e.getBoundingClientRect();let t=e.width||0,i=e.height||0;return{top:e.y,bottom:e.y+i,left:e.x,right:e.x+t,height:i,width:t}}};function zo(n,e){for(let t in e)e.hasOwnProperty(t)&&(n[t]=e[t]);return n}function WN(n){if(typeof n!="number"&&n!=null){let[e,t]=n.split(rQ);return!t||t==="px"?parseFloat(e):null}return n||null}function $N(n){return{top:Math.floor(n.top),right:Math.floor(n.right),bottom:Math.floor(n.bottom),left:Math.floor(n.left),width:Math.floor(n.width),height:Math.floor(n.height)}}function sQ(n,e){return n===e?!0:n.isOriginClipped===e.isOriginClipped&&n.isOriginOutsideView===e.isOriginOutsideView&&n.isOverlayClipped===e.isOverlayClipped&&n.isOverlayOutsideView===e.isOverlayOutsideView}var HN="cdk-global-overlay-wrapper",PS=class{constructor(){this._cssPosition="static",this._topOffset="",this._bottomOffset="",this._alignItems="",this._xPosition="",this._xOffset="",this._width="",this._height="",this._isDisposed=!1}attach(e){let t=e.getConfig();this._overlayRef=e,this._width&&!t.width&&e.updateSize({width:this._width}),this._height&&!t.height&&e.updateSize({height:this._height}),e.hostElement.classList.add(HN),this._isDisposed=!1}top(e=""){return this._bottomOffset="",this._topOffset=e,this._alignItems="flex-start",this}left(e=""){return this._xOffset=e,this._xPosition="left",this}bottom(e=""){return this._topOffset="",this._bottomOffset=e,this._alignItems="flex-end",this}right(e=""){return this._xOffset=e,this._xPosition="right",this}start(e=""){return this._xOffset=e,this._xPosition="start",this}end(e=""){return this._xOffset=e,this._xPosition="end",this}width(e=""){return this._overlayRef?this._overlayRef.updateSize({width:e}):this._width=e,this}height(e=""){return this._overlayRef?this._overlayRef.updateSize({height:e}):this._height=e,this}centerHorizontally(e=""){return this.left(e),this._xPosition="center",this}centerVertically(e=""){return this.top(e),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;let e=this._overlayRef.overlayElement.style,t=this._overlayRef.hostElement.style,i=this._overlayRef.getConfig(),{width:r,height:s,maxWidth:o,maxHeight:a}=i,c=(r==="100%"||r==="100vw")&&(!o||o==="100%"||o==="100vw"),l=(s==="100%"||s==="100vh")&&(!a||a==="100%"||a==="100vh"),u=this._xPosition,d=this._xOffset,h=this._overlayRef.getConfig().direction==="rtl",m="",g="",y="";c?y="flex-start":u==="center"?(y="center",h?g=d:m=d):h?u==="left"||u==="end"?(y="flex-end",m=d):(u==="right"||u==="start")&&(y="flex-start",g=d):u==="left"||u==="start"?(y="flex-start",m=d):(u==="right"||u==="end")&&(y="flex-end",g=d),e.position=this._cssPosition,e.marginLeft=c?"0":m,e.marginTop=l?"0":this._topOffset,e.marginBottom=this._bottomOffset,e.marginRight=c?"0":g,t.justifyContent=y,t.alignItems=l?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;let e=this._overlayRef.overlayElement.style,t=this._overlayRef.hostElement,i=t.style;t.classList.remove(HN),i.justifyContent=i.alignItems=e.marginTop=e.marginBottom=e.marginLeft=e.marginRight=e.position="",this._overlayRef=null,this._isDisposed=!0}},oQ=(()=>{let e=class e{constructor(i,r,s,o){this._viewportRuler=i,this._document=r,this._platform=s,this._overlayContainer=o}global(){return new PS}flexibleConnectedTo(i){return new OS(i,this._viewportRuler,this._document,this._platform,this._overlayContainer)}};e.\u0275fac=function(r){return new(r||e)(C(TS),C(Oe),C(at),C(QN))},e.\u0275prov=ie({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),aQ=0,Dd=(()=>{let e=class e{constructor(i,r,s,o,a,c,l,u,d,h,m,g){this.scrollStrategies=i,this._overlayContainer=r,this._componentFactoryResolver=s,this._positionBuilder=o,this._keyboardDispatcher=a,this._injector=c,this._ngZone=l,this._document=u,this._directionality=d,this._location=h,this._outsideClickDispatcher=m,this._animationsModuleType=g}create(i){let r=this._createHostElement(),s=this._createPaneElement(r),o=this._createPortalOutlet(s),a=new Ad(i);return a.direction=a.direction||this._directionality.value,new MS(o,r,s,a,this._ngZone,this._keyboardDispatcher,this._document,this._location,this._outsideClickDispatcher,this._animationsModuleType==="NoopAnimations")}position(){return this._positionBuilder}_createPaneElement(i){let r=this._document.createElement("div");return r.id=`cdk-overlay-${aQ++}`,r.classList.add("cdk-overlay-pane"),i.appendChild(r),r}_createHostElement(){let i=this._document.createElement("div");return this._overlayContainer.getContainerElement().appendChild(i),i}_createPortalOutlet(i){return this._appRef||(this._appRef=this._injector.get(iT)),new Ag(i,this._componentFactoryResolver,this._appRef,this._injector,this._document)}};e.\u0275fac=function(r){return new(r||e)(C(tQ),C(QN),C(Ld),C(oQ),C(nQ),C(Vt),C(ae),C(Oe),C(xN),C(rT),C(iQ),C(ir,8))},e.\u0275prov=ie({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var cQ=new J("cdk-connected-overlay-scroll-strategy",{providedIn:"root",factory:()=>{let n=je(Dd);return()=>n.scrollStrategies.reposition()}});function lQ(n){return()=>n.scrollStrategies.reposition()}var uQ={provide:cQ,deps:[Dd],useFactory:lQ},YN=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=se({type:e}),e.\u0275inj=re({providers:[Dd,uQ],imports:[Ns,Dg,xS,xS]});let n=e;return n})();function hQ(n,e){if(n&1){let t=lt();S(0,"div",1)(1,"button",2),ce("click",function(){ye(t);let r=fe();return be(r.action())}),F(2),w()()}if(n&2){let t=fe();q(2),Zn(" ",t.data.action," ")}}var fQ=["label"];function mQ(n,e){}var pQ=Math.pow(2,31)-1,kd=class{constructor(e,t){this._overlayRef=t,this._afterDismissed=new We,this._afterOpened=new We,this._onAction=new We,this._dismissedByAction=!1,this.containerInstance=e,e._onExit.subscribe(()=>this._finishDismiss())}dismiss(){this._afterDismissed.closed||this.containerInstance.exit(),clearTimeout(this._durationTimeoutId)}dismissWithAction(){this._onAction.closed||(this._dismissedByAction=!0,this._onAction.next(),this._onAction.complete(),this.dismiss()),clearTimeout(this._durationTimeoutId)}closeWithAction(){this.dismissWithAction()}_dismissAfter(e){this._durationTimeoutId=setTimeout(()=>this.dismiss(),Math.min(e,pQ))}_open(){this._afterOpened.closed||(this._afterOpened.next(),this._afterOpened.complete())}_finishDismiss(){this._overlayRef.dispose(),this._onAction.closed||this._onAction.complete(),this._afterDismissed.next({dismissedByAction:this._dismissedByAction}),this._afterDismissed.complete(),this._dismissedByAction=!1}afterDismissed(){return this._afterDismissed}afterOpened(){return this.containerInstance._onEnter}onAction(){return this._onAction}},XN=new J("MatSnackBarData"),tl=class{constructor(){this.politeness="assertive",this.announcementMessage="",this.duration=0,this.data=null,this.horizontalPosition="center",this.verticalPosition="bottom"}},gQ=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275dir=Me({type:e,selectors:[["","matSnackBarLabel",""]],hostAttrs:[1,"mat-mdc-snack-bar-label","mdc-snackbar__label"],standalone:!0});let n=e;return n})(),yQ=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275dir=Me({type:e,selectors:[["","matSnackBarActions",""]],hostAttrs:[1,"mat-mdc-snack-bar-actions","mdc-snackbar__actions"],standalone:!0});let n=e;return n})(),bQ=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275dir=Me({type:e,selectors:[["","matSnackBarAction",""]],hostAttrs:[1,"mat-mdc-snack-bar-action","mdc-snackbar__action"],standalone:!0});let n=e;return n})(),ZN=(()=>{let e=class e{constructor(i,r){this.snackBarRef=i,this.data=r}action(){this.snackBarRef.dismissWithAction()}get hasAction(){return!!this.data.action}};e.\u0275fac=function(r){return new(r||e)(z(kd),z(XN))},e.\u0275cmp=Ee({type:e,selectors:[["simple-snack-bar"]],hostAttrs:[1,"mat-mdc-simple-snack-bar"],exportAs:["matSnackBar"],standalone:!0,features:[Us],decls:3,vars:2,consts:[["matSnackBarLabel",""],["matSnackBarActions",""],["mat-button","","matSnackBarAction","",3,"click"]],template:function(r,s){r&1&&(S(0,"div",0),F(1),w(),$e(2,hQ,3,1,"div",1)),r&2&&(q(),Zn(" ",s.data.message,`
`),q(),Vg(2,s.hasAction?2:-1))},dependencies:[BN,gQ,yQ,bQ],styles:[".mat-mdc-simple-snack-bar{display:flex}"],encapsulation:2,changeDetection:0});let n=e;return n})(),vQ={snackBarState:dT("state",[zg("void, hidden",Wd({transform:"scale(0.8)",opacity:0})),zg("visible",Wd({transform:"scale(1)",opacity:1})),Gg("* => visible",qg("150ms cubic-bezier(0, 0, 0.2, 1)")),Gg("* => void, * => hidden",qg("75ms cubic-bezier(0.4, 0.0, 1, 1)",Wd({opacity:0})))])},_Q=0,wQ=(()=>{let e=class e extends el{constructor(i,r,s,o,a){super(),this._ngZone=i,this._elementRef=r,this._changeDetectorRef=s,this._platform=o,this.snackBarConfig=a,this._document=je(Oe),this._trackedModals=new Set,this._announceDelay=150,this._destroyed=!1,this._onAnnounce=new We,this._onExit=new We,this._onEnter=new We,this._animationState="void",this._liveElementId=`mat-snack-bar-container-live-${_Q++}`,this.attachDomPortal=c=>{this._assertNotAttached();let l=this._portalOutlet.attachDomPortal(c);return this._afterPortalAttached(),l},a.politeness==="assertive"&&!a.announcementMessage?this._live="assertive":a.politeness==="off"?this._live="off":this._live="polite",this._platform.FIREFOX&&(this._live==="polite"&&(this._role="status"),this._live==="assertive"&&(this._role="alert"))}attachComponentPortal(i){this._assertNotAttached();let r=this._portalOutlet.attachComponentPortal(i);return this._afterPortalAttached(),r}attachTemplatePortal(i){this._assertNotAttached();let r=this._portalOutlet.attachTemplatePortal(i);return this._afterPortalAttached(),r}onAnimationEnd(i){let{fromState:r,toState:s}=i;if((s==="void"&&r!=="void"||s==="hidden")&&this._completeExit(),s==="visible"){let o=this._onEnter;this._ngZone.run(()=>{o.next(),o.complete()})}}enter(){this._destroyed||(this._animationState="visible",this._changeDetectorRef.markForCheck(),this._changeDetectorRef.detectChanges(),this._screenReaderAnnounce())}exit(){return this._ngZone.run(()=>{this._animationState="hidden",this._changeDetectorRef.markForCheck(),this._elementRef.nativeElement.setAttribute("mat-exit",""),clearTimeout(this._announceTimeoutId)}),this._onExit}ngOnDestroy(){this._destroyed=!0,this._clearFromModals(),this._completeExit()}_completeExit(){queueMicrotask(()=>{this._onExit.next(),this._onExit.complete()})}_afterPortalAttached(){let i=this._elementRef.nativeElement,r=this.snackBarConfig.panelClass;r&&(Array.isArray(r)?r.forEach(a=>i.classList.add(a)):i.classList.add(r)),this._exposeToModals();let s=this._label.nativeElement,o="mdc-snackbar__label";s.classList.toggle(o,!s.querySelector(`.${o}`))}_exposeToModals(){let i=this._liveElementId,r=this._document.querySelectorAll('body > .cdk-overlay-container [aria-modal="true"]');for(let s=0;s<r.length;s++){let o=r[s],a=o.getAttribute("aria-owns");this._trackedModals.add(o),a?a.indexOf(i)===-1&&o.setAttribute("aria-owns",a+" "+i):o.setAttribute("aria-owns",i)}}_clearFromModals(){this._trackedModals.forEach(i=>{let r=i.getAttribute("aria-owns");if(r){let s=r.replace(this._liveElementId,"").trim();s.length>0?i.setAttribute("aria-owns",s):i.removeAttribute("aria-owns")}}),this._trackedModals.clear()}_assertNotAttached(){this._portalOutlet.hasAttached()}_screenReaderAnnounce(){this._announceTimeoutId||this._ngZone.runOutsideAngular(()=>{this._announceTimeoutId=setTimeout(()=>{let i=this._elementRef.nativeElement.querySelector("[aria-hidden]"),r=this._elementRef.nativeElement.querySelector("[aria-live]");if(i&&r){let s=null;this._platform.isBrowser&&document.activeElement instanceof HTMLElement&&i.contains(document.activeElement)&&(s=document.activeElement),i.removeAttribute("aria-hidden"),r.appendChild(i),s?.focus(),this._onAnnounce.next(),this._onAnnounce.complete()}},this._announceDelay)})}};e.\u0275fac=function(r){return new(r||e)(z(ae),z(nt),z(Xo),z(at),z(tl))},e.\u0275cmp=Ee({type:e,selectors:[["mat-snack-bar-container"]],viewQuery:function(r,s){if(r&1&&(sr(SS,7),sr(fQ,7)),r&2){let o;or(o=ar())&&(s._portalOutlet=o.first),or(o=ar())&&(s._label=o.first)}},hostAttrs:[1,"mdc-snackbar","mat-mdc-snack-bar-container","mdc-snackbar--open"],hostVars:1,hostBindings:function(r,s){r&1&&XS("@state.done",function(a){return s.onAnimationEnd(a)}),r&2&&YS("@state",s._animationState)},standalone:!0,features:[Ot,Us],decls:6,vars:3,consts:[["label",""],[1,"mdc-snackbar__surface"],[1,"mat-mdc-snack-bar-label"],["aria-hidden","true"],["cdkPortalOutlet",""]],template:function(r,s){r&1&&(S(0,"div",1)(1,"div",2,0)(3,"div",3),$e(4,mQ,0,0,"ng-template",4),w(),oe(5,"div"),w()()),r&2&&(q(5),Vs("aria-live",s._live)("role",s._role)("id",s._liveElementId))},dependencies:[SS],styles:['.mdc-snackbar{display:none;position:fixed;right:0;bottom:0;left:0;align-items:center;justify-content:center;box-sizing:border-box;pointer-events:none;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mdc-snackbar--opening,.mdc-snackbar--open,.mdc-snackbar--closing{display:flex}.mdc-snackbar--open .mdc-snackbar__label,.mdc-snackbar--open .mdc-snackbar__actions{visibility:visible}.mdc-snackbar__surface{padding-left:0;padding-right:8px;display:flex;align-items:center;justify-content:flex-start;box-sizing:border-box;transform:scale(0.8);opacity:0}.mdc-snackbar__surface::before{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;border:1px solid rgba(0,0,0,0);border-radius:inherit;content:"";pointer-events:none}@media screen and (forced-colors: active){.mdc-snackbar__surface::before{border-color:CanvasText}}[dir=rtl] .mdc-snackbar__surface,.mdc-snackbar__surface[dir=rtl]{padding-left:8px;padding-right:0}.mdc-snackbar--open .mdc-snackbar__surface{transform:scale(1);opacity:1;pointer-events:auto}.mdc-snackbar--closing .mdc-snackbar__surface{transform:scale(1)}.mdc-snackbar__label{padding-left:16px;padding-right:8px;width:100%;flex-grow:1;box-sizing:border-box;margin:0;visibility:hidden;padding-top:14px;padding-bottom:14px}[dir=rtl] .mdc-snackbar__label,.mdc-snackbar__label[dir=rtl]{padding-left:8px;padding-right:16px}.mdc-snackbar__label::before{display:inline;content:attr(data-mdc-snackbar-label-text)}.mdc-snackbar__actions{display:flex;flex-shrink:0;align-items:center;box-sizing:border-box;visibility:hidden}.mdc-snackbar__action+.mdc-snackbar__dismiss{margin-left:8px;margin-right:0}[dir=rtl] .mdc-snackbar__action+.mdc-snackbar__dismiss,.mdc-snackbar__action+.mdc-snackbar__dismiss[dir=rtl]{margin-left:0;margin-right:8px}.mat-mdc-snack-bar-container{margin:8px;position:static}.mat-mdc-snack-bar-container .mdc-snackbar__surface{min-width:344px}@media(max-width: 480px),(max-width: 344px){.mat-mdc-snack-bar-container .mdc-snackbar__surface{min-width:100%}}@media(max-width: 480px),(max-width: 344px){.mat-mdc-snack-bar-container{width:100vw}}.mat-mdc-snack-bar-container .mdc-snackbar__surface{max-width:672px}.mat-mdc-snack-bar-container .mdc-snackbar__surface{box-shadow:0px 3px 5px -1px rgba(0, 0, 0, 0.2), 0px 6px 10px 0px rgba(0, 0, 0, 0.14), 0px 1px 18px 0px rgba(0, 0, 0, 0.12)}.mat-mdc-snack-bar-container .mdc-snackbar__surface{background-color:var(--mdc-snackbar-container-color)}.mat-mdc-snack-bar-container .mdc-snackbar__surface{border-radius:var(--mdc-snackbar-container-shape)}.mat-mdc-snack-bar-container .mdc-snackbar__label{color:var(--mdc-snackbar-supporting-text-color)}.mat-mdc-snack-bar-container .mdc-snackbar__label{font-size:var(--mdc-snackbar-supporting-text-size);font-family:var(--mdc-snackbar-supporting-text-font);font-weight:var(--mdc-snackbar-supporting-text-weight);line-height:var(--mdc-snackbar-supporting-text-line-height)}.mat-mdc-snack-bar-container .mat-mdc-button.mat-mdc-snack-bar-action:not(:disabled){color:var(--mat-snack-bar-button-color);--mat-text-button-state-layer-color:currentColor;--mat-text-button-ripple-color:currentColor}.mat-mdc-snack-bar-container .mat-mdc-button.mat-mdc-snack-bar-action:not(:disabled) .mat-ripple-element{opacity:.1}.mat-mdc-snack-bar-container .mdc-snackbar__label::before{display:none}.mat-mdc-snack-bar-handset,.mat-mdc-snack-bar-container,.mat-mdc-snack-bar-label{flex:1 1 auto}.mat-mdc-snack-bar-handset .mdc-snackbar__surface{width:100%}'],encapsulation:2,data:{animation:[vQ.snackBarState]}});let n=e;return n})();function CQ(){return new tl}var EQ=new J("mat-snack-bar-default-options",{providedIn:"root",factory:CQ}),SQ=(()=>{let e=class e{get _openedSnackBarRef(){let i=this._parentSnackBar;return i?i._openedSnackBarRef:this._snackBarRefAtThisLevel}set _openedSnackBarRef(i){this._parentSnackBar?this._parentSnackBar._openedSnackBarRef=i:this._snackBarRefAtThisLevel=i}constructor(i,r,s,o,a,c){this._overlay=i,this._live=r,this._injector=s,this._breakpointObserver=o,this._parentSnackBar=a,this._defaultConfig=c,this._snackBarRefAtThisLevel=null,this.simpleSnackBarComponent=ZN,this.snackBarContainerComponent=wQ,this.handsetCssClass="mat-mdc-snack-bar-handset"}openFromComponent(i,r){return this._attach(i,r)}openFromTemplate(i,r){return this._attach(i,r)}open(i,r="",s){let o=he(he({},this._defaultConfig),s);return o.data={message:i,action:r},o.announcementMessage===i&&(o.announcementMessage=void 0),this.openFromComponent(this.simpleSnackBarComponent,o)}dismiss(){this._openedSnackBarRef&&this._openedSnackBarRef.dismiss()}ngOnDestroy(){this._snackBarRefAtThisLevel&&this._snackBarRefAtThisLevel.dismiss()}_attachSnackBarContainer(i,r){let s=r&&r.viewContainerRef&&r.viewContainerRef.injector,o=Vt.create({parent:s||this._injector,providers:[{provide:tl,useValue:r}]}),a=new Zc(this.snackBarContainerComponent,r.viewContainerRef,o),c=i.attach(a);return c.instance.snackBarConfig=r,c.instance}_attach(i,r){let s=he(he(he({},new tl),this._defaultConfig),r),o=this._createOverlay(s),a=this._attachSnackBarContainer(o,s),c=new kd(a,o);if(i instanceof ol){let l=new Jc(i,null,{$implicit:s.data,snackBarRef:c});c.instance=a.attachTemplatePortal(l)}else{let l=this._createInjector(s,c),u=new Zc(i,void 0,l),d=a.attachComponentPortal(u);c.instance=d.instance}return this._breakpointObserver.observe(bN.HandsetPortrait).pipe(nr(o.detachments())).subscribe(l=>{o.overlayElement.classList.toggle(this.handsetCssClass,l.matches)}),s.announcementMessage&&a._onAnnounce.subscribe(()=>{this._live.announce(s.announcementMessage,s.politeness)}),this._animateSnackBar(c,s),this._openedSnackBarRef=c,this._openedSnackBarRef}_animateSnackBar(i,r){i.afterDismissed().subscribe(()=>{this._openedSnackBarRef==i&&(this._openedSnackBarRef=null),r.announcementMessage&&this._live.clear()}),this._openedSnackBarRef?(this._openedSnackBarRef.afterDismissed().subscribe(()=>{i.containerInstance.enter()}),this._openedSnackBarRef.dismiss()):i.containerInstance.enter(),r.duration&&r.duration>0&&i.afterOpened().subscribe(()=>i._dismissAfter(r.duration))}_createOverlay(i){let r=new Ad;r.direction=i.direction;let s=this._overlay.position().global(),o=i.direction==="rtl",a=i.horizontalPosition==="left"||i.horizontalPosition==="start"&&!o||i.horizontalPosition==="end"&&o,c=!a&&i.horizontalPosition!=="center";return a?s.left("0"):c?s.right("0"):s.centerHorizontally(),i.verticalPosition==="top"?s.top("0"):s.bottom("0"),r.positionStrategy=s,this._overlay.create(r)}_createInjector(i,r){let s=i&&i.viewContainerRef&&i.viewContainerRef.injector;return Vt.create({parent:s||this._injector,providers:[{provide:kd,useValue:r},{provide:XN,useValue:i.data}]})}};e.\u0275fac=function(r){return new(r||e)(C(Dd),C(CN),C(Vt),C(Sg),C(e,12),C(EQ))},e.\u0275prov=ie({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var JN=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=se({type:e}),e.\u0275inj=re({providers:[SQ],imports:[YN,Dg,VN,Fs,ZN,Fs]});let n=e;return n})();var eF={apiKey:"AIzaSyB9Z6cZoMv6ga-E1TY2EBY4fWbLC809Kx8",authDomain:"colleague-care-961e7.firebaseapp.com",projectId:"colleague-care-961e7",storageBucket:"colleague-care-961e7.appspot.com",messagingSenderId:'"G-MSLYFHL1M7"',appId:"1:146426847182:web:aa565e2303cff0981cd59f",measurementId:"146426847182"},tF=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=se({type:e,bootstrap:[Eg]}),e.\u0275inj=re({providers:[uT(),fN("noop")],imports:[lT,GT,uN,LP,cx.initializeApp(eF),lx,JN,$T(()=>HT(eF)),qP(()=>zP()),QP(()=>ZP())]});let n=e;return n})();var TQ=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=se({type:e,bootstrap:[Eg]}),e.\u0275inj=re({imports:[tF,hT]});let n=e;return n})();export{TQ as a};
